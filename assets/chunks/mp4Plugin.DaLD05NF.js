import{b as gt,B as Ct,U as Ht,c as bn,d as gn,e as Gt,S as bs,f as Vr,W as Gi,s as tr,u as gs,A as Zs,g as Ss}from"./index.min.BYpDzovD.js";import{p as Ls}from"./theme.CMIUNJ5V.js";function Wi(n,a){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,r)}return t}function Ee(n){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?Wi(Object(t),!0).forEach(function(r){O(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Wi(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function re(){re=function(){return n};var n={},a=Object.prototype,t=a.hasOwnProperty,r=Object.defineProperty||function(f,m,y){f[m]=y.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",s=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function l(f,m,y){return Object.defineProperty(f,m,{value:y,enumerable:!0,configurable:!0,writable:!0}),f[m]}try{l({},"")}catch{l=function(m,y,X){return m[y]=X}}function u(f,m,y,X){var Z=m&&m.prototype instanceof h?m:h,R=Object.create(Z.prototype),Y=new M(X||[]);return r(R,"_invoke",{value:S(f,y,Y)}),R}function c(f,m,y){try{return{type:"normal",arg:f.call(m,y)}}catch(X){return{type:"throw",arg:X}}}n.wrap=u;var d={};function h(){}function p(){}function v(){}var g={};l(g,i,function(){return this});var b=Object.getPrototypeOf,L=b&&b(b(I([])));L&&L!==a&&t.call(L,i)&&(g=L);var G=v.prototype=h.prototype=Object.create(g);function V(f){["next","throw","return"].forEach(function(m){l(f,m,function(y){return this._invoke(m,y)})})}function W(f,m){function y(Z,R,Y,N){var _=c(f[Z],f,R);if(_.type!=="throw"){var K=_.arg,j=K.value;return j&&typeof j=="object"&&t.call(j,"__await")?m.resolve(j.__await).then(function(H){y("next",H,Y,N)},function(H){y("throw",H,Y,N)}):m.resolve(j).then(function(H){K.value=H,Y(K)},function(H){return y("throw",H,Y,N)})}N(_.arg)}var X;r(this,"_invoke",{value:function(Z,R){function Y(){return new m(function(N,_){y(Z,R,N,_)})}return X=X?X.then(Y,Y):Y()}})}function S(f,m,y){var X="suspendedStart";return function(Z,R){if(X==="executing")throw new Error("Generator is already running");if(X==="completed"){if(Z==="throw")throw R;return D()}for(y.method=Z,y.arg=R;;){var Y=y.delegate;if(Y){var N=T(Y,y);if(N){if(N===d)continue;return N}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(X==="suspendedStart")throw X="completed",y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);X="executing";var _=c(f,m,y);if(_.type==="normal"){if(X=y.done?"completed":"suspendedYield",_.arg===d)continue;return{value:_.arg,done:y.done}}_.type==="throw"&&(X="completed",y.method="throw",y.arg=_.arg)}}}function T(f,m){var y=m.method,X=f.iterator[y];if(X===void 0)return m.delegate=null,y==="throw"&&f.iterator.return&&(m.method="return",m.arg=void 0,T(f,m),m.method==="throw")||y!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+y+"' method")),d;var Z=c(X,f.iterator,m.arg);if(Z.type==="throw")return m.method="throw",m.arg=Z.arg,m.delegate=null,d;var R=Z.arg;return R?R.done?(m[f.resultName]=R.value,m.next=f.nextLoc,m.method!=="return"&&(m.method="next",m.arg=void 0),m.delegate=null,d):R:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,d)}function k(f){var m={tryLoc:f[0]};1 in f&&(m.catchLoc=f[1]),2 in f&&(m.finallyLoc=f[2],m.afterLoc=f[3]),this.tryEntries.push(m)}function w(f){var m=f.completion||{};m.type="normal",delete m.arg,f.completion=m}function M(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(k,this),this.reset(!0)}function I(f){if(f){var m=f[i];if(m)return m.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var y=-1,X=function Z(){for(;++y<f.length;)if(t.call(f,y))return Z.value=f[y],Z.done=!1,Z;return Z.value=void 0,Z.done=!0,Z};return X.next=X}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=v,r(G,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=l(v,o,"GeneratorFunction"),n.isGeneratorFunction=function(f){var m=typeof f=="function"&&f.constructor;return!!m&&(m===p||(m.displayName||m.name)==="GeneratorFunction")},n.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,v):(f.__proto__=v,l(f,o,"GeneratorFunction")),f.prototype=Object.create(G),f},n.awrap=function(f){return{__await:f}},V(W.prototype),l(W.prototype,s,function(){return this}),n.AsyncIterator=W,n.async=function(f,m,y,X,Z){Z===void 0&&(Z=Promise);var R=new W(u(f,m,y,X),Z);return n.isGeneratorFunction(m)?R:R.next().then(function(Y){return Y.done?Y.value:R.next()})},V(G),l(G,o,"Generator"),l(G,i,function(){return this}),l(G,"toString",function(){return"[object Generator]"}),n.keys=function(f){var m=Object(f),y=[];for(var X in m)y.push(X);return y.reverse(),function Z(){for(;y.length;){var R=y.pop();if(R in m)return Z.value=R,Z.done=!1,Z}return Z.done=!0,Z}},n.values=I,M.prototype={constructor:M,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!f)for(var m in this)m.charAt(0)==="t"&&t.call(this,m)&&!isNaN(+m.slice(1))&&(this[m]=void 0)},stop:function(){this.done=!0;var f=this.tryEntries[0].completion;if(f.type==="throw")throw f.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var m=this;function y(_,K){return R.type="throw",R.arg=f,m.next=_,K&&(m.method="next",m.arg=void 0),!!K}for(var X=this.tryEntries.length-1;X>=0;--X){var Z=this.tryEntries[X],R=Z.completion;if(Z.tryLoc==="root")return y("end");if(Z.tryLoc<=this.prev){var Y=t.call(Z,"catchLoc"),N=t.call(Z,"finallyLoc");if(Y&&N){if(this.prev<Z.catchLoc)return y(Z.catchLoc,!0);if(this.prev<Z.finallyLoc)return y(Z.finallyLoc)}else if(Y){if(this.prev<Z.catchLoc)return y(Z.catchLoc,!0)}else{if(!N)throw new Error("try statement without catch or finally");if(this.prev<Z.finallyLoc)return y(Z.finallyLoc)}}}},abrupt:function(f,m){for(var y=this.tryEntries.length-1;y>=0;--y){var X=this.tryEntries[y];if(X.tryLoc<=this.prev&&t.call(X,"finallyLoc")&&this.prev<X.finallyLoc){var Z=X;break}}Z&&(f==="break"||f==="continue")&&Z.tryLoc<=m&&m<=Z.finallyLoc&&(Z=null);var R=Z?Z.completion:{};return R.type=f,R.arg=m,Z?(this.method="next",this.next=Z.finallyLoc,d):this.complete(R)},complete:function(f,m){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&m&&(this.next=m),d},finish:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.finallyLoc===f)return this.complete(y.completion,y.afterLoc),w(y),d}},catch:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc===f){var X=y.completion;if(X.type==="throw"){var Z=X.arg;w(y)}return Z}}throw new Error("illegal catch attempt")},delegateYield:function(f,m,y){return this.delegate={iterator:I(f),resultName:m,nextLoc:y},this.method==="next"&&(this.arg=void 0),d}},n}function Fr(n){"@babel/helpers - typeof";return Fr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Fr(n)}function wi(n,a,t,r,e,i,s){try{var o=n[i](s),l=o.value}catch(u){t(u);return}o.done?a(l):Promise.resolve(l).then(r,e)}function We(n){return function(){var a=this,t=arguments;return new Promise(function(r,e){var i=n.apply(a,t);function s(l){wi(i,r,e,s,o,"next",l)}function o(l){wi(i,r,e,s,o,"throw",l)}s(void 0)})}}function jt(n,a){if(!(n instanceof a))throw new TypeError("Cannot call a class as a function")}function Ti(n,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,Ln(r.key),r)}}function Qt(n,a,t){return a&&Ti(n.prototype,a),t&&Ti(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function O(n,a,t){return a=Ln(a),a in n?Object.defineProperty(n,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[a]=t,n}function Zn(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),a&&Ur(n,a)}function mr(n){return mr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mr(n)}function Ur(n,a){return Ur=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},Ur(n,a)}function Xs(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function $(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Gs(n,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $(n)}function Sn(n){var a=Xs();return function(){var r=mr(n),e;if(a){var i=mr(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Gs(this,e)}}function Ws(n,a){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,a||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(n)}function Ln(n){var a=Ws(n,"string");return typeof a=="symbol"?a:String(a)}function Vi(n,a){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,r)}return t}function Ft(n){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?Vi(Object(t),!0).forEach(function(r){C(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Vi(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Ze(){Ze=function(){return n};var n={},a=Object.prototype,t=a.hasOwnProperty,r=Object.defineProperty||function(f,m,y){f[m]=y.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",s=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function l(f,m,y){return Object.defineProperty(f,m,{value:y,enumerable:!0,configurable:!0,writable:!0}),f[m]}try{l({},"")}catch{l=function(m,y,X){return m[y]=X}}function u(f,m,y,X){var Z=m&&m.prototype instanceof h?m:h,R=Object.create(Z.prototype),Y=new M(X||[]);return r(R,"_invoke",{value:S(f,y,Y)}),R}function c(f,m,y){try{return{type:"normal",arg:f.call(m,y)}}catch(X){return{type:"throw",arg:X}}}n.wrap=u;var d={};function h(){}function p(){}function v(){}var g={};l(g,i,function(){return this});var b=Object.getPrototypeOf,L=b&&b(b(I([])));L&&L!==a&&t.call(L,i)&&(g=L);var G=v.prototype=h.prototype=Object.create(g);function V(f){["next","throw","return"].forEach(function(m){l(f,m,function(y){return this._invoke(m,y)})})}function W(f,m){function y(Z,R,Y,N){var _=c(f[Z],f,R);if(_.type!=="throw"){var K=_.arg,j=K.value;return j&&typeof j=="object"&&t.call(j,"__await")?m.resolve(j.__await).then(function(H){y("next",H,Y,N)},function(H){y("throw",H,Y,N)}):m.resolve(j).then(function(H){K.value=H,Y(K)},function(H){return y("throw",H,Y,N)})}N(_.arg)}var X;r(this,"_invoke",{value:function(Z,R){function Y(){return new m(function(N,_){y(Z,R,N,_)})}return X=X?X.then(Y,Y):Y()}})}function S(f,m,y){var X="suspendedStart";return function(Z,R){if(X==="executing")throw new Error("Generator is already running");if(X==="completed"){if(Z==="throw")throw R;return D()}for(y.method=Z,y.arg=R;;){var Y=y.delegate;if(Y){var N=T(Y,y);if(N){if(N===d)continue;return N}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(X==="suspendedStart")throw X="completed",y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);X="executing";var _=c(f,m,y);if(_.type==="normal"){if(X=y.done?"completed":"suspendedYield",_.arg===d)continue;return{value:_.arg,done:y.done}}_.type==="throw"&&(X="completed",y.method="throw",y.arg=_.arg)}}}function T(f,m){var y=m.method,X=f.iterator[y];if(X===void 0)return m.delegate=null,y==="throw"&&f.iterator.return&&(m.method="return",m.arg=void 0,T(f,m),m.method==="throw")||y!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+y+"' method")),d;var Z=c(X,f.iterator,m.arg);if(Z.type==="throw")return m.method="throw",m.arg=Z.arg,m.delegate=null,d;var R=Z.arg;return R?R.done?(m[f.resultName]=R.value,m.next=f.nextLoc,m.method!=="return"&&(m.method="next",m.arg=void 0),m.delegate=null,d):R:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,d)}function k(f){var m={tryLoc:f[0]};1 in f&&(m.catchLoc=f[1]),2 in f&&(m.finallyLoc=f[2],m.afterLoc=f[3]),this.tryEntries.push(m)}function w(f){var m=f.completion||{};m.type="normal",delete m.arg,f.completion=m}function M(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(k,this),this.reset(!0)}function I(f){if(f){var m=f[i];if(m)return m.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var y=-1,X=function Z(){for(;++y<f.length;)if(t.call(f,y))return Z.value=f[y],Z.done=!1,Z;return Z.value=void 0,Z.done=!0,Z};return X.next=X}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=v,r(G,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=l(v,o,"GeneratorFunction"),n.isGeneratorFunction=function(f){var m=typeof f=="function"&&f.constructor;return!!m&&(m===p||(m.displayName||m.name)==="GeneratorFunction")},n.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,v):(f.__proto__=v,l(f,o,"GeneratorFunction")),f.prototype=Object.create(G),f},n.awrap=function(f){return{__await:f}},V(W.prototype),l(W.prototype,s,function(){return this}),n.AsyncIterator=W,n.async=function(f,m,y,X,Z){Z===void 0&&(Z=Promise);var R=new W(u(f,m,y,X),Z);return n.isGeneratorFunction(m)?R:R.next().then(function(Y){return Y.done?Y.value:R.next()})},V(G),l(G,o,"Generator"),l(G,i,function(){return this}),l(G,"toString",function(){return"[object Generator]"}),n.keys=function(f){var m=Object(f),y=[];for(var X in m)y.push(X);return y.reverse(),function Z(){for(;y.length;){var R=y.pop();if(R in m)return Z.value=R,Z.done=!1,Z}return Z.done=!0,Z}},n.values=I,M.prototype={constructor:M,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!f)for(var m in this)m.charAt(0)==="t"&&t.call(this,m)&&!isNaN(+m.slice(1))&&(this[m]=void 0)},stop:function(){this.done=!0;var f=this.tryEntries[0].completion;if(f.type==="throw")throw f.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var m=this;function y(_,K){return R.type="throw",R.arg=f,m.next=_,K&&(m.method="next",m.arg=void 0),!!K}for(var X=this.tryEntries.length-1;X>=0;--X){var Z=this.tryEntries[X],R=Z.completion;if(Z.tryLoc==="root")return y("end");if(Z.tryLoc<=this.prev){var Y=t.call(Z,"catchLoc"),N=t.call(Z,"finallyLoc");if(Y&&N){if(this.prev<Z.catchLoc)return y(Z.catchLoc,!0);if(this.prev<Z.finallyLoc)return y(Z.finallyLoc)}else if(Y){if(this.prev<Z.catchLoc)return y(Z.catchLoc,!0)}else{if(!N)throw new Error("try statement without catch or finally");if(this.prev<Z.finallyLoc)return y(Z.finallyLoc)}}}},abrupt:function(f,m){for(var y=this.tryEntries.length-1;y>=0;--y){var X=this.tryEntries[y];if(X.tryLoc<=this.prev&&t.call(X,"finallyLoc")&&this.prev<X.finallyLoc){var Z=X;break}}Z&&(f==="break"||f==="continue")&&Z.tryLoc<=m&&m<=Z.finallyLoc&&(Z=null);var R=Z?Z.completion:{};return R.type=f,R.arg=m,Z?(this.method="next",this.next=Z.finallyLoc,d):this.complete(R)},complete:function(f,m){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&m&&(this.next=m),d},finish:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.finallyLoc===f)return this.complete(y.completion,y.afterLoc),w(y),d}},catch:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc===f){var X=y.completion;if(X.type==="throw"){var Z=X.arg;w(y)}return Z}}throw new Error("illegal catch attempt")},delegateYield:function(f,m,y){return this.delegate={iterator:I(f),resultName:m,nextLoc:y},this.method==="next"&&(this.arg=void 0),d}},n}function Tt(n){"@babel/helpers - typeof";return Tt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Tt(n)}function ki(n,a,t,r,e,i,s){try{var o=n[i](s),l=o.value}catch(u){t(u);return}o.done?a(l):Promise.resolve(l).then(r,e)}function mt(n){return function(){var a=this,t=arguments;return new Promise(function(r,e){var i=n.apply(a,t);function s(l){ki(i,r,e,s,o,"next",l)}function o(l){ki(i,r,e,s,o,"throw",l)}s(void 0)})}}function Fe(n,a){if(!(n instanceof a))throw new TypeError("Cannot call a class as a function")}function Ri(n,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,Gn(r.key),r)}}function Ue(n,a,t){return a&&Ri(n.prototype,a),t&&Ri(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function C(n,a,t){return a=Gn(a),a in n?Object.defineProperty(n,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[a]=t,n}function $t(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),a&&Ut(n,a)}function Vt(n){return Vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vt(n)}function Ut(n,a){return Ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},Ut(n,a)}function Xn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function cr(n,a,t){return Xn()?cr=Reflect.construct.bind():cr=function(e,i,s){var o=[null];o.push.apply(o,i);var l=Function.bind.apply(e,o),u=new l;return s&&Ut(u,s.prototype),u},cr.apply(null,arguments)}function ws(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function fr(n){var a=typeof Map=="function"?new Map:void 0;return fr=function(r){if(r===null||!ws(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a<"u"){if(a.has(r))return a.get(r);a.set(r,e)}function e(){return cr(r,arguments,Vt(this).constructor)}return e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Ut(e,r)},fr(n)}function Ts(n,a){if(n==null)return{};var t={},r=Object.keys(n),e,i;for(i=0;i<r.length;i++)e=r[i],!(a.indexOf(e)>=0)&&(t[e]=n[e]);return t}function Vs(n,a){if(n==null)return{};var t=Ts(n,a),r,e;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(e=0;e<i.length;e++)r=i[e],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function B(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function ks(n,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return B(n)}function qt(n){var a=Xn();return function(){var r=Vt(n),e;if(a){var i=Vt(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return ks(this,e)}}function Rs(n,a){for(;!Object.prototype.hasOwnProperty.call(n,a)&&(n=Vt(n),n!==null););return n}function dr(){return typeof Reflect<"u"&&Reflect.get?dr=Reflect.get.bind():dr=function(a,t,r){var e=Rs(a,t);if(e){var i=Object.getOwnPropertyDescriptor(e,t);return i.get?i.get.call(arguments.length<3?a:r):i.value}},dr.apply(this,arguments)}function xs(n,a){if(n){if(typeof n=="string")return xi(n,a);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xi(n,a)}}function xi(n,a){(a==null||a>n.length)&&(a=n.length);for(var t=0,r=new Array(a);t<a;t++)r[t]=n[t];return r}function Ys(n,a){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=xs(n))||a){t&&(n=t);var r=0,e=function(){};return{s:e,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function Ms(n,a){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,a||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(n)}function Gn(n){var a=Ms(n,"string");return typeof a=="symbol"?a:String(a)}var fe=function(){function n(){Fe(this,n)}return Ue(n,null,[{key:"start",value:function(t){return!t||!t.length||t.length===1&&t.end(0)-t.start(0)<1e-6||t.length===1&&t.start(0)<0?0:t.start(0)}},{key:"end",value:function(t){return!t||!t.length||t.length===1&&t.end(0)-t.start(0)<1e-6?0:t.end(t.length-1)}},{key:"get",value:function(t){if(t)try{return t.buffered}catch{}}},{key:"buffers",value:function(t,r){if(!t||!t.length)return[];for(var e=[],i=0,s=t.length;i<s;i++){var o=e.length;if(!o||!r)e.push([t.start(i),t.end(i)]);else{var l=e[o-1],u=l[1],c=t.start(i);if(c-u<=r){var d=t.end(i);d>u&&(l[1]=d)}else e.push([t.start(i),t.end(i)])}}return e}},{key:"totalLength",value:function(t){return!t||!t.length?0:t.reduce(function(r,e){return r+=e[1]-e[0]},0)}},{key:"info",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(!t||!t.length)return{start:0,end:0,buffers:[]};for(var i=0,s=0,o=0,l=0,u=0,c=0,d=0,h=n.buffers(t,e),p=0,v=h.length;p<v;p++){var g=h[p];if(r+e>=g[0]&&r<=g[1])i=g[0],s=g[1],o=p;else if(r+e<g[0]){l=g[0],u=g[1];break}else r+e>g[1]&&(c=g[0],d=g[1])}return{start:i,end:s,index:o,buffers:h,nextStart:l,nextEnd:u,prevStart:c,prevEnd:d,currentTime:r,behind:r-i,remaining:s?s-r:0,length:n.totalLength&&n.totalLength(h)}}},{key:"isBuffered",value:function(t,r){if(t){var e=n.get(t);if(e!=null&&e.length){for(var i=0;i<e.length;i++)if(r>=e.start(i)&&r<=e.end(i))return!0}}return!1}}]),n}(),Is=typeof window<"u",Pe,U={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWORK_NOTFOUND:"network_notfound",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",MSE_CHANGE_TYPE:"MSE_CHANGE_TYPE",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",WAITING_TIMEOUT_ERROR:"WAITING_TIMEOUT_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"}},ve=(Pe={},C(Pe,U.MANIFEST,{HLS:1100,DASH:1200}),C(Pe,U.NETWORK,2100),C(Pe,U.NETWORK_TIMEOUT,2101),C(Pe,U.NETWORK_FORBIDDEN,2103),C(Pe,U.NETWORK_NOTFOUND,2104),C(Pe,U.NETWROK_RANGE_NOT_SATISFIABLE,2116),C(Pe,U.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),C(Pe,U.REMUX,{FMP4:4100,MP4:4200}),C(Pe,U.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,MSE_CHANGE_TYPE:5205,EME_HIJACK:5301}),C(Pe,U.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),C(Pe,U.OTHER,8e3),C(Pe,U.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002,WAITING_TIMEOUT_ERROR:9003}),Pe),ce=function(n){$t(t,n);var a=qt(t);function t(r,e,i,s,o){var l;return Fe(this,t),l=a.call(this,o||(i==null?void 0:i.message)),l.errorType=r===U.NETWORK_TIMEOUT?U.NETWORK:r,l.originError=i,l.ext=s,l.errorCode=ve[r][e]||ve[r],l.errorMessage=l.message,l.errorCode||(l.errorType=U.OTHER,l.errorCode=ve[l.errorType]),l}return Ue(t,null,[{key:"create",value:function(e,i,s,o,l){return e instanceof t?e:(e instanceof Error&&(s=e,e=""),e||(e=U.OTHER),new t(e,i,s,o,l))}},{key:"network",value:function(e){var i;return new t(e!=null&&e.isTimeout?U.NETWORK_TIMEOUT:U.NETWORK,null,e instanceof Error?e:null,{url:e==null?void 0:e.url,response:e==null?void 0:e.response,httpCode:e==null||(i=e.response)===null||i===void 0?void 0:i.status})}}]),t}(fr(Error)),rr={DEBUG:1,LOG:2,WARN:3,ERROR:4},Es=200*1024,_s=["Boolean","Number","String","Undefined","Null","Date","Object"],Me=function(){function n(a,t){Fe(this,n),this.name=a||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(t==null?void 0:t.logCacheLevel)||3,this.logMaxSize=(t==null?void 0:t.logMaxSize)||Es,this.logSize=0,this.logTextArray=[]}return Ue(n,[{key:"debug",value:function(){for(var t,r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];this.logCache.apply(this,[rr.DEBUG].concat(e)),!n.disabled&&(t=console).debug.apply(t,["[".concat(Kt(),"]"),this._prefix].concat(e))}},{key:"log",value:function(){for(var t,r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];this.logCache.apply(this,[rr.LOG].concat(e)),!n.disabled&&(t=console).log.apply(t,["[".concat(Kt(),"]"),this._prefix].concat(e))}},{key:"warn",value:function(){for(var t,r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];this.logCache.apply(this,[rr.WARN].concat(e)),!n.disabled&&(t=console).warn.apply(t,["[".concat(Kt(),"]"),this._prefix].concat(e))}},{key:"error",value:function(){for(var t,r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];this.logCache.apply(this,[rr.ERROR].concat(e)),!n.disabled&&(t=console).error.apply(t,["[".concat(Kt(),"]"),this._prefix].concat(e))}},{key:"logCache",value:function(t){if(!(t<this.logCacheLevel)){var r="";try{for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];var o=i.map(function(u){return Wn(u)});r="[".concat(Kt(),"]")+this._prefix+JSON.stringify(o)}catch{return}if(t>=this.logCacheLevel&&(this.logSize+=r.length,this.logTextArray.push(r)),this.logSize>this.logMaxSize){var l=this.logTextArray.shift();this.logSize-=l.length}}}},{key:"getLogCache",value:function(){var t=this.logTextArray.join(`
`);return this.reset(),t}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var t;n.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(t){this.logCacheLevel=t}}],[{key:"enable",value:function(){n.disabled=!1}},{key:"disable",value:function(){n.disabled=!0}}]),n}();C(Me,"disabled",!0);function Kt(){return new Date().toLocaleString()}function Cs(n){if(Tt(n)!=="object")return n;var a=Object.prototype.toString.call(n).slice(8,-1);switch(a){case"Array":case"Uint8Array":case"ArrayBuffer":return a+"["+n.length+"]";case"Object":return"{}";default:return a}}function Wn(n,a,t){t||(t=1),a||(a=2);var r={};if(!n||Tt(n)!=="object")return n;var e=Object.prototype.toString.call(n).slice(8,-1);if(!_s.includes(e))return e;if(!(t>a)){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t===a?r[i]=Cs(n[i]):Tt(n[i])==="object"?r[i]=Wn(n[i],a,t+1):r[i]=n[i]);return r}}function Mt(){var n,a,t=new Promise(function(r,e){n=r,a=e});return t.used=!1,t.resolve=function(){return t.used=!0,n.apply(void 0,arguments)},t.reject=function(){return t.used=!0,a.apply(void 0,arguments)},t}function Yt(){try{return parseInt(performance.now(),10)}catch{return new Date().getTime()}}var Ps={stringify:function(a){try{return JSON.stringify(a)}catch{return""}},parse:function(a){try{return JSON.parse(a)}catch{return}}};function Yi(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;try{return Is?n&&typeof ManagedMediaSource<"u"?ManagedMediaSource:window.MediaSource:null}catch{}}function kr(n){return/ManagedMediaSource/gi.test(Object.prototype.toString.call(n))}function Ns(n){var a=[];if(n instanceof TimeRanges)for(var t=0;t<n.length;t++)a.push({start:n.start(t),end:n.end(t)});return a}var ir={APPEND:"appendBuffer",REMOVE:"removeBuffer",UPDATE_DURATION:"updateDuration"},he=function(){function n(a,t){var r=this;Fe(this,n),C(this,"media",null),C(this,"mediaSource",null),C(this,"_openPromise",Mt()),C(this,"_queue",Object.create(null)),C(this,"_sourceBuffer",Object.create(null)),C(this,"_mseFullFlag",{}),C(this,"_st",0),C(this,"_opst",0),C(this,"_logger",null),C(this,"_config",null),C(this,"_url",null),C(this,"_onStartStreaming",function(){r._logger.debug("startstreaming")}),C(this,"_onEndStreaming",function(){r._logger.debug("endstreaming")}),C(this,"_onSBUpdateEnd",function(e){var i=r._queue[e];if(i){var s=i[0];if((s==null?void 0:s.opName)!==ir.UPDATE_DURATION&&i.shift(),s){var o,l,u=Yt()-r._opst;r._logger.debug("UpdateEnd(".concat(e,"/").concat(s.opName,")"),Ps.stringify(Ns((o=r._sourceBuffer[e])===null||o===void 0?void 0:o.buffered)),u,s.context),s.promise.resolve({name:s.opName,context:s.context,costtime:u});var c=(l=s.context)===null||l===void 0?void 0:l.callback;c&&typeof c=="function"&&c(s.context),r._startQueue(e)}}}),C(this,"_onSBUpdateError",function(e,i){var s=r._queue[e];if(s){var o=s[0];o&&(r._logger.error("UpdateError",e,o.opName,o.context),o.promise.reject(new ce(U.MEDIA,U.SUB_TYPES.MSE_APPEND_BUFFER,i)))}}),this._config=Object.assign(n.getDefaultConfig(),t),a&&this.bindMedia(a),this._logger=new Me("MSE"),this._config.openLog&&Me.enable()}return Ue(n,[{key:"isOpened",get:function(){var t;return((t=this.mediaSource)===null||t===void 0?void 0:t.readyState)==="open"}},{key:"hasOpTasks",get:function(){var t=this,r=!1;return Object.keys(this._queue).forEach(function(e){var i=t._queue[e];Array.isArray(i)&&(r||(r=i.length>0))}),r}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var t;return((t=this.mediaSource)===null||t===void 0?void 0:t.duration)||-1}},{key:"isEnded",get:function(){return this.mediaSource?this.mediaSource.readyState==="ended":!1}},{key:"streaming",get:function(){return kr(this.mediaSource)?this.mediaSource.streaming:!0}},{key:"isFull",value:function(t){return t?this._mseFullFlag[t]:this._mseFullFlag[n.VIDEO]}},{key:"updateDuration",value:function(t){var r=this,e=this.mediaSource&&this.mediaSource.duration>t;if(this.mediaSource&&this.mediaSource.duration>t){var i=0;if(Object.keys(this._sourceBuffer).forEach(function(s){try{i=Math.max(r.bufferEnd(s)||0,i)}catch{}}),t<i)return Promise.resolve()}return this._enqueueBlockingOp(function(){if(r.isEnded){r._logger.debug("setDuration but ended");return}r.mediaSource&&(r.mediaSource.duration=t,r._logger.debug("setDuration",t))},ir.UPDATE_DURATION,{isReduceDuration:e})}},{key:"open",value:function(){var t=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var r=this.mediaSource,e=function i(){var s=Yt()-t._st;t._logger.debug("sourceopen",s),r.removeEventListener("sourceopen",i),t._openPromise.resolve({costtime:s})};r.addEventListener("sourceopen",e),this._openPromise=Mt()}return this._openPromise}},{key:"bindMedia",value:function(){var a=mt(Ze().mark(function r(e){var i=this,s,o,l,u;return Ze().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(this.mediaSource||this.media)){d.next=3;break}return d.next=3,this.unbindMedia();case 3:if(s=Yi(this._config.preferMMS),!(!e||!s)){d.next=6;break}throw new Error("Param media or MediaSource does not exist");case 6:return this.media=e,o=this.mediaSource=new s,l=kr(o),this._st=Yt(),u=function h(){var p=Yt()-i._st;i._logger.debug("sourceopen"),o.removeEventListener("sourceopen",h),URL.revokeObjectURL(e.src),i._openPromise.resolve({costtime:p})},o.addEventListener("sourceopen",u),l&&(o.addEventListener("startstreaming",this._onStartStreaming),o.addEventListener("endstreaming",this._onEndStreaming)),this._url=URL.createObjectURL(o),e.src=this._url,e.disableRemotePlayback=l,d.abrupt("return",this._openPromise);case 17:case"end":return d.stop()}},r,this)}));function t(r){return a.apply(this,arguments)}return t}()},{key:"unbindMedia",value:function(){var a=mt(Ze().mark(function r(){var e=this,i,s,o;return Ze().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),i=this.mediaSource,i){if(Object.keys(this._queue).forEach(function(c){var d=e._queue[c];d&&d.forEach(function(h){var p,v;return(p=h.promise)===null||p===void 0||(v=p.resolve)===null||v===void 0?void 0:v.call(p)})}),s=!!this.media&&this.media.readyState>=1,o=i.readyState==="open",s&&o)try{i.endOfStream()}catch{}Object.keys(this._sourceBuffer).forEach(function(c){try{i.removeSourceBuffer(e._sourceBuffer[c])}catch{}}),kr(i)&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming))}if(this.media){this.media.disableRemotePlayback=!1,this.media.removeAttribute("src");try{this.media.load()}catch{}this.media=null}this.mediaSource=null,this._openPromise=Mt(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return u.stop()}},r,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"createSource",value:function(t,r){if(!(this._sourceBuffer[t]||!this.mediaSource)){var e;try{e=this._sourceBuffer[t]=this.mediaSource.addSourceBuffer(r)}catch(i){throw new ce(U.MEDIA,U.SUB_TYPES.MSE_ADD_SB,i)}e.mimeType=r,e.addEventListener("updateend",this._onSBUpdateEnd.bind(this,t)),e.addEventListener("error",this._onSBUpdateError.bind(this,t))}}},{key:"changeType",value:function(t,r){var e=this,i=this._sourceBuffer[t];return!this.mediaSource||!i||i.mimeType===r?Promise.resolve():typeof i.changeType!="function"?Promise.reject(new ce(U.MEDIA,U.SUB_TYPES.MSE_CHANGE_TYPE,new Error("changeType is not a function"))):this._enqueueOp(t,function(){try{i.changeType(r)}catch(s){throw new ce(U.MEDIA,U.SUB_TYPES.MSE_CHANGE_TYPE,s)}i.mimeType=r,e._onSBUpdateEnd(t)},"changeType",{mimeType:r})}},{key:"createOrChangeSource",value:function(t,r){return this.createSource(t,r),this.changeType(t,r)}},{key:"append",value:function(t,r,e){var i=this;return!r||!r.byteLength||!this._sourceBuffer[t]?Promise.resolve():this._enqueueOp(t,function(){var s;!i.mediaSource||i.media.error||(i._logger.debug("MSE APPEND START",e),i._opst=Yt(),(s=i._sourceBuffer[t])===null||s===void 0||s.appendBuffer(r))},ir.APPEND,e)}},{key:"remove",value:function(t,r,e,i){var s=this,o=!1;return this._mseFullFlag[t]&&(o=!0),this._enqueueOp(t,function(){if(!(!s.mediaSource||s.media.error)){var l=s._sourceBuffer[t];if(r>=e||!l){s._onSBUpdateEnd(t);return}s._opst=Yt(),s._logger.debug("MSE REMOVE START",t,r,e,i),l.remove(r,e)}},ir.REMOVE,i,o)}},{key:"clearBuffer",value:function(t,r){var e=this,i;return Object.keys(this._sourceBuffer).forEach(function(s){i=e.remove(s,t,r)}),i||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var t=this,r;return Object.keys(this._sourceBuffer).forEach(function(e){var i=t._sourceBuffer[e];r=t.remove(e,0,fe.end(fe.get(i)))}),r}},{key:"clearOpQueues",value:function(t,r){var e;this._logger.debug("MSE clearOpQueue START");var i=this._queue[t];if(r&&i){this._queue[t]=[];return}if(!(!i||!i[t]||i.length<5)){var s=[];i.forEach(function(o){o.context&&o.context.isinit&&s.push(o)}),this._queue[t]=i.slice(0,2),s.length>0&&(e=this._queue[t]).push.apply(e,s)}}},{key:"endOfStream",value:function(t){var r=this;return!this.mediaSource||this.mediaSource.readyState!=="open"?Promise.resolve():this._enqueueBlockingOp(function(){var e=r.mediaSource;!e||e.readyState!=="open"||(r._logger.debug("MSE endOfStream START"),t?e.endOfStream(t):e.endOfStream())},"endOfStream")}},{key:"setLiveSeekableRange",value:function(t,r){var e=this.mediaSource;t<0||r<t||!(e!=null&&e.setLiveSeekableRange)||e.readyState!=="open"||e.setLiveSeekableRange(t,r)}},{key:"getSourceBuffer",value:function(t){return this._sourceBuffer[t]}},{key:"buffered",value:function(t){return fe.get(this._sourceBuffer[t])}},{key:"bufferStart",value:function(t){return fe.start(this.buffered(t))}},{key:"bufferEnd",value:function(t){return fe.end(this.buffered(t))}},{key:"_enqueueOp",value:function(t,r,e,i,s){var o=this;if(!this.mediaSource)return Promise.resolve();var l=this._queue[t]=this._queue[t]||[],u={exec:r,promise:Mt(),opName:e,context:i};return s?(l.splice(0,0,u),this._mseFullFlag[t]=!1,this._startQueue(t)):l.push(u),this.isOpened||this.isEnded?l.length===1&&this._startQueue(t):this._openPromise.then(function(){l.length===1&&o._startQueue(t)}),u.promise}},{key:"_enqueueBlockingOp",value:function(){var a=mt(Ze().mark(function r(e,i,s){var o=this,l,u;return Ze().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.mediaSource){d.next=2;break}return d.abrupt("return",Promise.resolve());case 2:if(l=Object.keys(this._sourceBuffer),l.length){d.next=5;break}return d.abrupt("return",e());case 5:return u=[],l.forEach(function(h){var p=o._queue[h],v=Mt();u.push(v),p.push({exec:function(){v.resolve()},promise:v,opName:i,context:s}),p.length===1&&o._startQueue(h)}),d.abrupt("return",Promise.all(u).then(function(){try{return e()}finally{l.forEach(function(h){var p=o._queue[h],v=o._sourceBuffer[h];p==null||p.shift(),(!v||!v.updating)&&o._startQueue(h)})}}));case 8:case"end":return d.stop()}},r,this)}));function t(r,e,i){return a.apply(this,arguments)}return t}()},{key:"_startQueue",value:function(t){var r=this._queue[t];if(r){var e=r[0];if(e&&!this._mseFullFlag[t])try{e.exec()}catch(i){i&&i.message&&i.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[t]=!0,e.context&&Tt(e.context)==="object"&&(e.context.isFull=!0),this._logger.error("[MSE error],  context,",e.context," ,name,",e.opName,",err,SourceBuffer is full"),e.promise.reject(new ce(U.MEDIA,U.SUB_TYPES.MSE_FULL,i))):(this._logger.error(i),e.promise.reject(i.constructor===ce?i:new ce(U.MEDIA,U.SUB_TYPES.MSE_OTHER,i)),r.shift(),this._startQueue(t))}}}},{key:"setTimeoffset",value:function(t,r,e){var i=this;return this._enqueueOp(t,function(){r<0&&(r+=.001),i._sourceBuffer[t].timestampOffset=r,i._onSBUpdateEnd(t)},"setTimeoffset",e)}},{key:"abort",value:function(t,r){var e=this;return this.isOpened?this._enqueueOp(t,function(){e._sourceBuffer[t].abort(),e._onSBUpdateEnd(t)},"abort",r):Promise.resolve()}}],[{key:"isSupported",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"',r=Yi();if(!r)return!1;try{return r.isTypeSupported(t)}catch(e){return this._logger.error(t,e),!1}}},{key:"isMMSOnly",value:function(){return typeof ManagedMediaSource<"u"&&typeof MediaSource>"u"}},{key:"getDefaultConfig",value:function(){return{openLog:!1,preferMMS:!1}}}]),n}();C(he,"VIDEO","video");C(he,"AUDIO","audio");var Wt={FETCH:"fetch",XHR:"xhr"},zt={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},at=function(n){$t(t,n);var a=qt(t);function t(r,e,i,s){var o;return Fe(this,t),o=a.call(this,s),C(B(o),"retryCount",0),C(B(o),"isTimeout",!1),C(B(o),"loaderType",Wt.FETCH),C(B(o),"startTime",0),C(B(o),"endTime",0),C(B(o),"options",{}),o.url=r,o.request=e,o.response=i,o}return Ue(t)}(fr(Error)),wn=Object.prototype.toString;function Ks(n){return n!==null&&Tt(n)==="object"}function Mi(n){if(wn.call(n)!=="[object Object]")return!1;var a=Object.getPrototypeOf(n);return a===null||a===Object.prototype}function Ds(n){return wn.call(n)==="[object Date]"}function Tn(n){if(!(!n||n[0]===null||n[0]===void 0||n[0]===0&&(n[1]===null||n[1]===void 0))){var a="bytes="+n[0]+"-";return n[1]&&(a+=n[1]),a}}function Ii(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Vn(n,a){if(n){if(!a)return n;var t,r=Object.keys(a).map(function(i){if(t=a[i],t!=null)return Array.isArray(t)?i=i+"[]":t=[t],t.map(function(s){return Ds(s)?s=s.toISOString():Ks(s)&&(s=JSON.stringify(s)),"".concat(Ii(i),"=").concat(Ii(s))}).join("&")}).filter(Boolean).join("&");if(r){var e=n.indexOf("#");e!==-1&&(n=n.slice(0,e)),n+=(n.indexOf("?")===-1?"?":"&")+r}return n}}function zr(n,a,t,r,e,i,s,o,l,u,c){e=e!=null?parseFloat(e):null,r=parseInt(r||"0",10),Number.isNaN(r)&&(r=0);var d={range:l,vid:u,index:o,contentLength:r,age:e,startTime:i,firstByteTime:s,endTime:Date.now(),priOptions:c};return{data:n,done:a,options:d,response:t}}function Jr(n,a){return Math.round(n*8*1e3/a/1024)}var P={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",MEDIASOURCE_OPENED:"core.mediasourceopened",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",APPEND_BUFFER:"core.appendbuffer",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",CHASEFRAME:"core.chaseframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},Ei=2*1024*1024,Or=function(n){$t(t,n);var a=qt(t);function t(){var r;return Fe(this,t),r=a.call(this),C(B(r),"_abortController",null),C(B(r),"_timeoutTimer",null),C(B(r),"_reader",null),C(B(r),"_response",null),C(B(r),"_aborted",!1),C(B(r),"_index",-1),C(B(r),"_range",null),C(B(r),"_receivedLength",0),C(B(r),"_running",!1),C(B(r),"_logger",null),C(B(r),"_vid",""),C(B(r),"_onProcessMinLen",0),C(B(r),"_onCancel",null),C(B(r),"_priOptions",null),r}return Ue(t,[{key:"load",value:function(e){var i,s=this,o=e.url,l=e.vid,u=e.timeout,c=e.responseType,d=e.onProgress,h=e.index,p=e.onTimeout,v=e.onCancel,g=e.range,b=e.transformResponse,L=e.request,G=e.params,V=e.logger,W=e.method,S=e.headers,T=e.body,k=e.mode,w=e.credentials,M=e.cache,I=e.redirect,D=e.referrer,f=e.referrerPolicy,m=e.onProcessMinLen,y=e.priOptions;this._logger=V,this._aborted=!1,this._onProcessMinLen=m,this._onCancel=v,this._abortController=typeof AbortController<"u"&&new AbortController,this._running=!0,this._index=h,this._range=g||[0,0],this._vid=l||o,this._priOptions=y||{};var X={method:W,headers:S,body:T,mode:k,credentials:w,cache:M,redirect:I,referrer:D,referrerPolicy:f,signal:(i=this._abortController)===null||i===void 0?void 0:i.signal},Z=!1;clearTimeout(this._timeoutTimer),o=Vn(o,G);var R=Tn(g);R&&(L?S=L.headers:S=X.headers=X.headers||(Headers?new Headers:{}),Headers&&S instanceof Headers?S.append("Range",R):S.Range=R),u&&(this._timeoutTimer=setTimeout(function(){if(Z=!0,s.cancel(),p){var N=new at(o,X,null,"timeout");N.isTimeout=!0,p(N,{index:s._index,range:s._range,vid:s._vid,priOptions:s._priOptions})}},u));var Y=Date.now();return this._logger.debug("[fetch load start], index,",h,",range,",g),new Promise(function(N,_){fetch(L||o,L?void 0:X).then(function(){var K=mt(Ze().mark(function j(H){var be,ge,Oe,me;return Ze().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:if(clearTimeout(s._timeoutTimer),s._response=H,!(s._aborted||!s._running)){ae.next=4;break}return ae.abrupt("return");case 4:if(b&&(H=b(H,o)||H),H.ok){ae.next=7;break}throw new at(o,X,H,"bad network response");case 7:if(be=Date.now(),c!==zt.TEXT){ae.next=15;break}return ae.next=11,H.text();case 11:ge=ae.sent,s._running=!1,ae.next=37;break;case 15:if(c!==zt.JSON){ae.next=22;break}return ae.next=18,H.json();case 18:ge=ae.sent,s._running=!1,ae.next=37;break;case 22:if(!d){ae.next=29;break}return s.resolve=N,s.reject=_,s._loadChunk(H,d,Y,be),ae.abrupt("return");case 29:return ae.next=31,H.arrayBuffer();case 31:ge=ae.sent,ge=new Uint8Array(ge),s._running=!1,Oe=Date.now()-Y,me=Jr(ge.byteLength,Oe),s.emit(P.REAL_TIME_SPEED,{speed:me,len:ge.byteLength,time:Oe,vid:s._vid,index:s._index,range:s._range,priOptions:s._priOptions});case 37:s._logger.debug("[fetch load end], index,",h,",range,",g),N(zr(ge,!0,H,H.headers.get("Content-Length"),H.headers.get("age"),Y,be,h,g,s._vid,s._priOptions));case 39:case"end":return ae.stop()}},j)}));return function(j){return K.apply(this,arguments)}}()).catch(function(K){var j;clearTimeout(s._timeoutTimer),s._running=!1,!(s._aborted&&!Z)&&(K=K instanceof at?K:new at(o,X,null,(j=K)===null||j===void 0?void 0:j.message),K.startTime=Y,K.endTime=Date.now(),K.isTimeout=Z,K.options={index:s._index,range:s._range,vid:s._vid,priOptions:s._priOptions},_(K))})})}},{key:"cancel",value:function(){var r=mt(Ze().mark(function i(){return Ze().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this._aborted){o.next=2;break}return o.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){o.next=14;break}if(o.prev=5,!this._reader){o.next=9;break}return o.next=9,this._reader.cancel();case 9:o.next=13;break;case 11:o.prev=11,o.t0=o.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch{}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return o.stop()}},i,this,[[5,11]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"_loadChunk",value:function(e,i,s,o){var l=this;if(!e.body||!e.body.getReader){this._running=!1;var u=new at(e.url,"",e,"onProgress of bad response.body.getReader");u.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(u);return}this._onProcessMinLen>0&&(this._cache=new Uint8Array(Ei),this._writeIdx=0);var c=this._reader=e.body.getReader(),d,h,p,v=function(){var g=mt(Ze().mark(function b(){var L,G,V,W,S,T,k,w;return Ze().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return h=Date.now(),I.prev=1,I.next=4,c.read();case 4:d=I.sent,p=Date.now(),I.next=13;break;case 8:return I.prev=8,I.t0=I.catch(1),p=Date.now(),l._aborted||(l._running=!1,I.t0.options={index:l._index,range:l._range,vid:l._vid,priOptions:l._priOptions},l.reject(I.t0)),I.abrupt("return");case 13:if(G=((L=l._range)===null||L===void 0?void 0:L.length)>0?l._range[0]:0,V=G+l._receivedLength,!l._aborted){I.next=19;break}return l._running=!1,i(void 0,!1,{range:[V,V],vid:l._vid,index:l._index,startTime:h,endTime:p,st:s,firstByteTime:o,priOptions:l._priOptions},e),I.abrupt("return");case 19:W=d.value?d.value.byteLength:0,l._receivedLength+=W,l._logger.debug("【fetchLoader,onProgress call】,task,",l._range,", start,",V,", end,",G+l._receivedLength,", done,",d.done),l._onProcessMinLen>0?l._writeIdx+W>=l._onProcessMinLen||d.done?(S=new Uint8Array(l._writeIdx+W),S.set(l._cache.slice(0,l._writeIdx),0),W>0&&S.set(d.value,l._writeIdx),l._writeIdx=0,l._logger.debug("【fetchLoader,onProgress enough】,done,",d.done,",len,",S.byteLength,", writeIdx,",l._writeIdx)):W>0&&l._writeIdx+W<Ei?(l._cache.set(d.value,l._writeIdx),l._writeIdx+=W,l._logger.debug("【fetchLoader,onProgress cache】,len,",W,", writeIdx,",l._writeIdx)):W>0&&(T=new Uint8Array(l._writeIdx+W+2048),l._logger.debug("【fetchLoader,onProgress extra start】,size,",l._writeIdx+W+2048,", datalen,",W,", writeIdx,",l._writeIdx),T.set(l._cache.slice(0,l._writeIdx),0),W>0&&T.set(d.value,l._writeIdx),l._writeIdx+=W,delete l._cache,l._cache=T,l._logger.debug("【fetchLoader,onProgress extra end】,len,",W,", writeIdx,",l._writeIdx)):S=d.value,(S&&S.byteLength>0||d.done)&&i(S,d.done,{range:[l._range[0]+l._receivedLength-(S?S.byteLength:0),l._range[0]+l._receivedLength],vid:l._vid,index:l._index,startTime:h,endTime:p,st:s,firstByteTime:o,priOptions:l._priOptions},e),d.done?(k=Date.now()-s,w=Jr(l._receivedLength,k),l.emit(P.REAL_TIME_SPEED,{speed:w,len:l._receivedLength,time:k,vid:l._vid,index:l._index,range:l._range,priOptions:l._priOptions}),l._running=!1,l._logger.debug("[fetchLoader onProgress end],task,",l._range,",done,",d.done),l.resolve(zr(d,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),s,o,l._index,l._range,l._vid,l._priOptions))):v();case 25:case"end":return I.stop()}},b,null,[[1,8]])}));return function(){return g.apply(this,arguments)}}();v()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return typeof fetch<"u"}}]),t}(gt);function Hs(n){return Ft({loaderType:Wt.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:zt.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},n)}var Fs=function(n){$t(t,n);var a=qt(t);function t(){var r;return Fe(this,t),r=a.call(this),C(B(r),"_xhr",null),C(B(r),"_aborted",!1),C(B(r),"_timeoutTimer",null),C(B(r),"_range",null),C(B(r),"_receivedLength",0),C(B(r),"_url",null),C(B(r),"_onProgress",null),C(B(r),"_index",-1),C(B(r),"_headers",null),C(B(r),"_currentChunkSizeKB",384),C(B(r),"_timeout",null),C(B(r),"_xhr",null),C(B(r),"_withCredentials",null),C(B(r),"_startTime",-1),C(B(r),"_loadCompleteResolve",null),C(B(r),"_loadCompleteReject",null),C(B(r),"_runing",!1),C(B(r),"_logger",!1),C(B(r),"_vid",""),C(B(r),"_responseType",void 0),C(B(r),"_credentials",void 0),C(B(r),"_method",void 0),C(B(r),"_transformResponse",void 0),C(B(r),"_firstRtt",void 0),C(B(r),"_onCancel",null),C(B(r),"_priOptions",null),r}return Ue(t,[{key:"load",value:function(e){var i=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials=e.credentials==="include"||e.credentials==="same-origin",this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=Vn(e.url,e.params);var s=Date.now();return new Promise(function(o,l){i._loadCompleteResolve=o,i._loadCompleteReject=l,i._startLoad()}).catch(function(o){if(clearTimeout(i._timeoutTimer),i._runing=!1,!i._aborted)throw o=o instanceof at?o:new at(i._url,i._request),o.startTime=s,o.endTime=Date.now(),o.options={index:i._index,vid:i._vid,priOptions:i._priOptions},o})}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===zt.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var i=this._currentChunkSizeKB*1024,s=this._range[0]+this._receivedLength,o=this._range[1];i<this._range[1]-s&&(o=s+i),e=[s,o],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(e){var i=this;try{this._startTime=Date.now();var s=this._xhr=new XMLHttpRequest;s.open(this._method||"GET",this._url,!0),s.responseType=this._responseType,this._timeout&&(s.timeout=this._timeout),s.withCredentials=this._withCredentials,s.onload=this._onLoad.bind(this),s.onreadystatechange=this._onReadyStatechange.bind(this),s.onerror=function(u){var c,d,h;i._running=!1;var p=new at(i._url,i._request,u==null||(c=u.currentTarget)===null||c===void 0?void 0:c.response,"xhr.onerror.status:"+(u==null||(d=u.currentTarget)===null||d===void 0?void 0:d.status)+",statusText,"+(u==null||(h=u.currentTarget)===null||h===void 0?void 0:h.statusText));p.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i._loadCompleteReject(p)},s.ontimeout=function(u){i.cancel();var c=new at(i._url,i._request,{status:408},"timeout");i._onTimeout&&(c.isTimeout=!0,i._onTimeout(c,{index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions})),c.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i._loadCompleteReject(c)};var o=this._headers||{},l=Tn(e);l&&(o.Range=l),o&&Object.keys(o).forEach(function(u){s.setRequestHeader(u,o[u])}),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",e),s.send(this._body)}catch(u){u.options={index:this._index,range:e,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(u)}}},{key:"_onReadyStatechange",value:function(e){var i=e.target;i.readyState===2&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var i,s=e.target.status;if(s<200||s>299){var o=new at(this._url,null,Ft(Ft({},e.target.response),{},{status:s}),"bad response,status:"+s);return o.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(o)}var l=null,u=!1,c,d=((i=this._range)===null||i===void 0?void 0:i.length)>0?this._range[0]:0;if(this._responseType===zt.ARRAY_BUFFER){var h,p=new Uint8Array(e.target.response);if(c=d+this._receivedLength,p&&p.byteLength>0){this._receivedLength+=p.byteLength;var v=Date.now()-this._startTime,g=Jr(this._receivedLength,v);this.emit(P.REAL_TIME_SPEED,{speed:g,len:this._receivedLength,time:v,vid:this._vid,index:this._index,range:[c,d+this._receivedLength],priOptions:this._priOptions})}l=p,((h=this._range)===null||h===void 0?void 0:h.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]?u=!1:u=!0,this._logger.debug("[xhr load done->], tast :",this._range,", start",c,"end ",d+this._receivedLength,",dataLen,",p?p.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",u)}else u=!0,l=e.target.response;var b={ok:s>=200&&s<300,status:s,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(b=this._transformResponse(b,this._url)||b),this._onProgress&&this._onProgress(l,u,{index:this._index,vid:this._vid,range:[c,d+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},b),u?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(zr(this._onProgress?null:l,u,b,b.headers["content-length"],b.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted&&(this._aborted=!0,this._runing=!1,dr(Vt(t.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr))return this._xhr.abort()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var i=e.getAllResponseHeaders().trim().split(`\r
`),s={},o=Ys(i),l;try{for(o.s();!(l=o.n()).done;){var u=l.value,c=u.split(": ");s[c[0].toLowerCase()]=c.slice(1).join(": ")}}catch(d){o.e(d)}finally{o.f()}return s}}],[{key:"isSupported",value:function(){return typeof XMLHttpRequest<"u"}}]),t}(gt),Us=["retry","retryDelay","onRetryError","transformError"],zs=function(){function n(a,t){Fe(this,n),this.promise=Mt(),this.alive=!!t.onProgress,!t.logger&&(t.logger=new Me("Loader")),this._loaderType=a,this._loader=a===Wt.FETCH&&typeof fetch<"u"?new Or:new Fs,this._config=t,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=t.retryCheckFunc,this._logger=t.logger}return Ue(n,[{key:"exec",value:function(){var t=this,r=this._config,e=r.retry,i=r.retryDelay,s=r.onRetryError,o=r.transformError,l=Vs(r,Us),u=function(){var c=mt(Ze().mark(function d(){var h,p,v;return Ze().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,b.next=3,t._loader.load(l);case 3:h=b.sent,t.promise.resolve(h),b.next=27;break;case 7:if(b.prev=7,b.t0=b.catch(0),t._loader.running=!1,t._logger.debug("[task request catch err]",b.t0),!t._canceled){b.next=13;break}return b.abrupt("return");case 13:if(b.t0.loaderType=t._loaderType,b.t0.retryCount=t._retryCount,p=b.t0,o&&(p=o(p)||p),s&&t._retryCount>0&&s(p,t._retryCount,{index:l.index,vid:l.vid,range:l.range,priOptions:l.priOptions}),t._retryCount++,v=!0,t._retryCheckFunc&&(v=t._retryCheckFunc(b.t0)),!(v&&t._retryCount<=e)){b.next=26;break}return clearTimeout(t._retryTimer),t._logger.debug("[task request setTimeout],retry",t._retryCount,",retry range,",l.range),t._retryTimer=setTimeout(u,i),b.abrupt("return");case 26:t.promise.reject(p);case 27:case"end":return b.stop()}},d,null,[[0,7]])}));return function(){return c.apply(this,arguments)}}();return u(),this.promise}},{key:"cancel",value:function(){var a=mt(Ze().mark(function r(){return Ze().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,i.abrupt("return",this._loader.cancel());case 4:case"end":return i.stop()}},r,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),n}();function kn(n){return n&&!n.paused&&!n.ended&&n.playbackRate!==0&&n.readyState!==0}function Rn(n){if(!n)return{};if(typeof n.getVideoPlaybackQuality=="function"){var a=n.getVideoPlaybackQuality();return{droppedVideoFrames:a.droppedVideoFrames||a.corruptedVideoFrames,totalVideoFrames:a.totalVideoFrames,creationTime:a.creationTime}}return{droppedVideoFrames:n.webkitDroppedFrameCount,totalVideoFrames:n.webkitDecodedFrameCount,creationTime:performance.now()}}function wt(){for(var n=arguments.length,a=new Array(n),t=0;t<n;t++)a[t]=arguments[t];if(a=a.filter(Boolean),a.length<2)return a[0];var r=new Uint8Array(a.reduce(function(i,s){return i+s.byteLength},0)),e=0;return a.forEach(function(i){r.set(i,e),e+=i.byteLength}),r}function Js(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return new Promise(function(a){return setTimeout(a,n)})}var yt=function(n){$t(t,n);var a=qt(t);function t(r){var e;return Fe(this,t),e=a.call(this,r),C(B(e),"type",Wt.FETCH),C(B(e),"_queue",[]),C(B(e),"_alive",[]),C(B(e),"_currentTask",null),C(B(e),"_finnalUrl",""),C(B(e),"_config",void 0),e._config=Hs(r),(e._config.loaderType===Wt.XHR||!Or.isSupported())&&(e.type=Wt.XHR),e.log=r.logger,e}return Ue(t,[{key:"isFetch",value:function(){return this.type===Wt.FETCH}},{key:"load",value:function(e){var i=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};typeof e=="string"||!e?s.url=e||s.url||this._config.url:s=e,s=Object.assign({},this._config,s),s.params&&(s.params=Object.assign({},s.params)),s.headers&&Mi(s.headers)&&(s.headers=Object.assign({},s.headers)),s.body&&Mi(s.body)&&(s.body=Object.assign({},s.body)),s.transformRequest&&(s=s.transformRequest(s)||s),s.logger=this.log;var o=new zs(this.type,s);return o.loader.on(P.REAL_TIME_SPEED,function(l){i.emit(P.REAL_TIME_SPEED,l)}),this._queue.push(o),this._queue.length===1&&(!this._currentTask||!this._currentTask.running)&&this._processTask(),o.promise}},{key:"cancel",value:function(){var r=mt(Ze().mark(function i(){var s;return Ze().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return s=this._queue.map(function(u){return u.cancel()}).concat(this._alive.map(function(u){return u.cancel()})),this._currentTask&&s.push(this._currentTask.cancel()),this._queue=[],this._alive=[],l.next=6,Promise.all(s);case 6:return l.next=8,Js();case 8:case"end":return l.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),!!this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var i=this._currentTask.exec().catch(function(s){});i&&typeof i.finally=="function"&&i.finally(function(){var s,o;(s=e._currentTask)!==null&&s!==void 0&&s.alive&&((o=e._alive)===null||o===void 0?void 0:o.length)>0&&(e._alive=e._alive.filter(function(l){return l&&l!==e._currentTask})),e._processTask()})}}}],[{key:"isFetchSupport",value:function(){return Or.isSupported()}}]),t}(gt),xn=function(){function n(){Fe(this,n),C(this,"_prevCurrentTime",0)}return Ue(n,[{key:"do",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,e=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;if(t){var s=t.currentTime,o=0;if(this._prevCurrentTime===s){var l=fe.info(fe.get(t),s);if(!l.buffers.length)return;e&&l.nextStart||l.nextStart&&l.nextStart-s<r?o=l.nextStart+.1:l.end&&l.end-s>i&&!t.seeking&&(o=s+.1)}this._prevCurrentTime=s,o&&s!==o&&(t.currentTime=o)}}}]),n}(),Yn=function(){function n(a){var t=this;Fe(this,n),C(this,"_seiSet",new Set),this.emitter=a,a.on(P.SEI,function(r){r&&t._seiSet.add(r)})}return Ue(n,[{key:"throw",value:function(t,r){var e=this;if(!(t==null||!this._seiSet.size)){var i=t-.2,s=t+.2,o=[];this._seiSet.forEach(function(l){l.time>=i&&l.time<=s&&o.push(l)}),o.forEach(function(l){e._seiSet.delete(l),e.emitter.emit(P.SEI_IN_TIME,l)}),r&&this._seiSet.forEach(function(l){l.time<t-5&&e._seiSet.delete(l)})}}},{key:"reset",value:function(){this._seiSet.clear()}}]),n}(),Os=1e3,Bs=50,As=3,js=3e3,Mn=function(){function n(a){Fe(this,n),C(this,"_chunkSpeed",0),C(this,"_chunkCache",[]),C(this,"_speeds",[]),C(this,"_totalSize",0),C(this,"_totalCost",0),this._opts=a||{}}return Ue(n,[{key:"addRecord",value:function(t,r){!t||!r||(this._speeds.push(8e3*t/r),this._speeds=this._speeds.slice(-As))}},{key:"addChunkRecord",value:function(t,r){var e,i;if(!(!t||!r||t<(((e=this._opts)===null||e===void 0?void 0:e.skipChunkSize)||Os))){this._totalSize+=t,this._totalCost+=r,this._chunkSpeed=8e3*t/r,this._chunkCache.push({size:t,duration:r,timestamp:performance.now()});var s=((i=this._opts)===null||i===void 0?void 0:i.chunkCountForSpeed)||Bs;this._chunkCache.length>s&&(this._chunkCache=this._chunkCache.slice(-s))}}},{key:"getAvgSpeed",value:function(){var t;if(!this._chunkCache.length&&!this._speeds.length)return 0;if(this._speeds.length)return this._speeds.reduce(function(o,l){return o+=l})/this._speeds.length;var r=this._chunkCache[this._chunkCache.length-1],e=performance.now()-r.timestamp;e>(((t=this._opts)===null||t===void 0?void 0:t.longtimeNoReceived)||js)&&this._chunkCache.push({size:0,duration:e,timestamp:performance.now()});var i=this._chunkCache.reduce(function(o,l){return o+=l.size},0),s=this._chunkCache.reduce(function(o,l){return o+=l.duration},0);return 8e3*i/s}},{key:"getLatestSpeed",value:function(){return!this._chunkCache.length&&!this._speeds.length?0:this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeed}},{key:"getTotalSize",value:function(){return this._totalSize}},{key:"getTotalCost",value:function(){return this._totalCost}},{key:"reset",value:function(){this._chunkCache=[],this._speeds=[],this._totalSize=0,this._totalCost=0}}]),n}(),_i=function(){function n(a){Fe(this,n),C(this,"encodeType",""),C(this,"audioCodec",""),C(this,"videoCodec",""),C(this,"domain",""),C(this,"fps",0),C(this,"bitrate",0),C(this,"width",0),C(this,"height",0),C(this,"samplerate",0),C(this,"channelCount",0),C(this,"gop",0),C(this,"_bitsAccumulateSize",0),C(this,"_bitsAccumulateDuration",0),C(this,"_startGopId",-1),this._timescale=a}return Ue(n,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(t){this.encodeType=t}},{key:"setFpsFromScriptData",value:function(t){var r,e=t.data,i=e==null||(r=e.onMetaData)===null||r===void 0?void 0:r.framerate;i&&i>0&&i<100&&(this.fps=i)}},{key:"setVideoMeta",value:function(t){if(this.width=t.width,this.height=t.height,this.videoCodec=t.codec,this.encodeType=t.codecType,t.fpsNum&&t.fpsDen){var r=t.fpsNum/t.fpsDen;r>0&&r<100&&(this.fps=r)}}},{key:"setAudioMeta",value:function(t){this.audioCodec=t.codec,this.samplerate=t.sampleRate,this.channelCount=t.channelCount}},{key:"setDomain",value:function(t){this.domain=t.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(t){var r=this;if((!this.fps||this.fps>=100)&&t.length){var e=t.reduce(function(i,s){return i+=s.duration},0)/t.length;this.fps=Math.round(this._timescale/e)}t.forEach(function(i){r._startGopId===-1&&(r._startGopId=i.gopId),i.gopId===r._startGopId&&r.gop++,r._bitsAccumulateDuration+=i.duration/(r._timescale/1e3),r._bitsAccumulateSize+=i.units.reduce(function(s,o){return s+=o.length},0),r._bitsAccumulateDuration>=1e3&&(r.bitrate=r._bitsAccumulateSize*8,r._bitsAccumulateDuration=0,r._bitsAccumulateSize=0)})}}]),n}(),In=function(){function n(a){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;Fe(this,n),C(this,"_core",null),C(this,"_samples",[]),this._core=a,this._timescale=t,this._stats=new _i(t),this._bindEvents()}return Ue(n,[{key:"getStats",value:function(){var t,r,e,i,s,o,l,u,c,d,h,p=((t=this._core)===null||t===void 0?void 0:t.media)||{},v=p.currentTime,g=v===void 0?0:v,b=p.decodeFps,L=b===void 0?0:b;return Ft(Ft({},this._stats.getStats()),{},{downloadSpeed:((r=this._core)===null||r===void 0||(e=r.speedInfo)===null||e===void 0?void 0:e.call(r).speed)||0,avgSpeed:((i=this._core)===null||i===void 0||(s=i.speedInfo)===null||s===void 0?void 0:s.call(i).avgSpeed)||0,totalReceivedByte:((o=this._core)===null||o===void 0||(l=o.speedInfo)===null||l===void 0?void 0:l.call(o).totalSize)||0,totalReceivedCost:((u=this._core)===null||u===void 0||(c=u.speedInfo)===null||c===void 0?void 0:c.call(u).totalCost)||0,currentTime:g,bufferEnd:((d=this._core)===null||d===void 0||(h=d.bufferInfo())===null||h===void 0?void 0:h.remaining)||0,decodeFps:L})}},{key:"_bindEvents",value:function(){var t=this;this._core.on(P.DEMUXED_TRACK,function(r){var e=r.videoTrack;return t._stats.updateBitrate(e.samples)}),this._core.on(P.FLV_SCRIPT_DATA,function(r){t._stats.setFpsFromScriptData(r)}),this._core.on(P.METADATA_PARSED,function(r){r.type==="video"?t._stats.setVideoMeta(r.track):t._stats.setAudioMeta(r.track)}),this._core.on(P.TTFB,function(r){t._stats.setDomain(r.responseUrl)})}},{key:"reset",value:function(){this._samples=[],this._stats=new _i(this._timescale)}}]),n}();function Qs(n,a){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,e,i,s,o=[],l=!0,u=!1;try{if(i=(t=t.call(n)).next,a!==0)for(;!(l=(r=i.call(t)).done)&&(o.push(r.value),o.length!==a);l=!0);}catch(c){u=!0,e=c}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(u)throw e}}return o}}function oe(n,a){if(!(n instanceof a))throw new TypeError("Cannot call a class as a function")}function Ci(n,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,Cn(r.key),r)}}function le(n,a,t){return a&&Ci(n.prototype,a),t&&Ci(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function E(n,a,t){return a=Cn(a),a in n?Object.defineProperty(n,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[a]=t,n}function En(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),a&&Br(n,a)}function pr(n){return pr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},pr(n)}function Br(n,a){return Br=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},Br(n,a)}function $s(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function qs(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function ea(n,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qs(n)}function _n(n){var a=$s();return function(){var r=pr(n),e;if(a){var i=pr(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return ea(this,e)}}function ta(n,a){return ia(n)||Qs(n,a)||di(n,a)||aa()}function Ye(n){return ra(n)||na(n)||di(n)||sa()}function ra(n){if(Array.isArray(n))return Ar(n)}function ia(n){if(Array.isArray(n))return n}function na(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function di(n,a){if(n){if(typeof n=="string")return Ar(n,a);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ar(n,a)}}function Ar(n,a){(a==null||a>n.length)&&(a=n.length);for(var t=0,r=new Array(a);t<a;t++)r[t]=n[t];return r}function sa(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aa(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oa(n,a){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=di(n))||a){t&&(n=t);var r=0,e=function(){};return{s:e,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function la(n,a){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,a||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(n)}function Cn(n){var a=la(n,"string");return typeof a=="symbol"?a:String(a)}var bt={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},ot={AV1:"av1",AVC:"avc",HEVC:"hevc"},ye={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m",OPUS:"opus"},pe={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},gr=function(){function n(){oe(this,n),E(this,"id",1),E(this,"type",bt.VIDEO),E(this,"codecType",ot.AVC),E(this,"pid",-1),E(this,"hvcC",void 0),E(this,"codec",""),E(this,"timescale",0),E(this,"formatTimescale",0),E(this,"sequenceNumber",0),E(this,"baseMediaDecodeTime",0),E(this,"baseDts",0),E(this,"duration",0),E(this,"warnings",[]),E(this,"samples",[]),E(this,"pps",[]),E(this,"sps",[]),E(this,"vps",[]),E(this,"fpsNum",0),E(this,"fpsDen",0),E(this,"sarRatio",[]),E(this,"width",0),E(this,"height",0),E(this,"nalUnitSize",4),E(this,"present",!1),E(this,"isVideoEncryption",!1),E(this,"isAudioEncryption",!1),E(this,"isVideo",!0),E(this,"lastKeyFrameDts",0),E(this,"kid",null),E(this,"pssh",null),E(this,"ext",void 0)}return le(n,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var t=this.samples[0],r=this.samples[this.samples.length-1];return r.dts-t.dts+r.duration}return 0}},{key:"exist",value:function(){return/av01/.test(this.codec)?!0:!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),n}(),Zr=function(){function n(){oe(this,n),E(this,"id",2),E(this,"type",bt.AUDIO),E(this,"codecType",ye.AAC),E(this,"pid",-1),E(this,"codec",""),E(this,"sequenceNumber",0),E(this,"sampleDuration",0),E(this,"timescale",0),E(this,"formatTimescale",0),E(this,"baseMediaDecodeTime",0),E(this,"duration",0),E(this,"warnings",[]),E(this,"samples",[]),E(this,"baseDts",0),E(this,"sampleSize",16),E(this,"sampleRate",0),E(this,"channelCount",0),E(this,"objectType",0),E(this,"sampleRateIndex",0),E(this,"config",[]),E(this,"present",!1),E(this,"isVideoEncryption",!1),E(this,"isAudioEncryption",!1),E(this,"kid",null),E(this,"ext",void 0)}return le(n,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&(this.codecType===ye.AAC||this.codecType===ye.G711PCMA||this.codecType===ye.G711PCMU||this.codecType===ye.OPUS))}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var t=this.samples[0],r=this.samples[this.samples.length-1];return r.dts-t.dts+r.duration}return 0}}]),n}(),Pt=function(){function n(a,t,r){oe(this,n),E(this,"flag",{}),E(this,"keyframe",!1),E(this,"gopId",0),E(this,"duration",0),E(this,"size",0),E(this,"units",[]),E(this,"chromaFormat",420),this.originPts=this.pts=a,this.originDts=this.dts=t,r&&(this.units=r)}return le(n,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),n}(),rt=le(function n(a,t,r,e){oe(this,n),E(this,"duration",1024),E(this,"flag",{dependsOn:2,isNonSyncSample:0}),E(this,"keyframe",!0),this.originPts=this.pts=this.dts=a,this.data=t,this.size=t.byteLength,this.sampleOffset=e,r&&(this.duration=r)}),Pn=le(function n(a,t){oe(this,n),E(this,"time",0),this.data=a,this.originPts=this.pts=t}),ua=function(n){En(t,n);var a=_n(t);function t(){return oe(this,t),a.apply(this,arguments)}return le(t)}(Pn),Nn=function(n){En(t,n);var a=_n(t);function t(){return oe(this,t),a.apply(this,arguments)}return le(t)}(Pn),Sr=function(){function n(){oe(this,n),E(this,"id",3),E(this,"type",bt.METADATA),E(this,"timescale",0),E(this,"flvScriptSamples",[]),E(this,"seiSamples",[])}return le(n,[{key:"exist",value:function(){return!!((this.flvScriptSamples.length||this.seiSamples.length)&&this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!!(this.flvScriptSamples.length||this.seiSamples.length)}}]),n}(),kt=function(){function n(a){oe(this,n),this.name=a||"",this._prefix="[".concat(this.name,"]")}return le(n,[{key:"warn",value:function(){var t;if(!n.disabled){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(e))}}}],[{key:"enable",value:function(){n.disabled=!1}},{key:"disable",value:function(){n.disabled=!0}}]),n}();E(kt,"disabled",!0);var Lr=typeof window<"u",hi=Lr&&navigator.userAgent.toLocaleLowerCase(),Kn=Lr&&/^((?!chrome|android).)*safari/.test(hi),ca=Lr&&hi.includes("firefox"),da=Lr&&hi.includes("android"),Ae=function(){function n(){oe(this,n)}return le(n,null,[{key:"getRateIndexByRate",value:function(t){return n.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,r){for(var e=t.length,i=0;i+2<e&&!(t[i]===255&&(t[i+1]&246)===240);)i++;if(!(i>=e)){var s=i,o=[],l=(t[i+2]&60)>>>2,u=n.FREQ[l];if(!u)throw new Error("Invalid sampling index: ".concat(l));for(var c=((t[i+2]&192)>>>6)+1,d=(t[i+2]&1)<<2|(t[i+3]&192)>>>6,h=n._getConfig(l,d,c),p=h.config,v=h.codec,g,b,L=0,G=n.getFrameDuration(u);i+7<e;){if(t[i]!==255||(t[i+1]&246)!==240){i++;continue}if(b=(t[i+3]&3)<<11|t[i+4]<<3|(t[i+5]&224)>>5,!b||e-i<b)break;g=(~t[i+1]&1)*2,o.push({pts:r+L*G,data:t.subarray(i+7+g,i+b)}),L++,i+=b}return{skip:s,remaining:i>=e?void 0:t.subarray(i),frames:o,samplingFrequencyIndex:l,sampleRate:u,objectType:c,channelCount:d,codec:v,config:p,originCodec:"mp4a.40.".concat(c)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var r=t[0]>>>3,e=(t[0]&7)<<1|t[1]>>>7,i=(t[1]&120)>>>3,s=n.FREQ[e];if(s){var o=n._getConfig(e,i,r),l=o.config,u=o.codec;return{samplingFrequencyIndex:e,sampleRate:s,objectType:r,channelCount:i,config:l,codec:u,originCodec:"mp4a.40.".concat(r)}}}}},{key:"getFrameDuration",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4;return 1024*r/t}},{key:"_getConfig",value:function(t,r,e){var i=[],s,o;return ca?t>=6?(s=5,o=t-3):(s=2,o=t):da?(s=2,o=t):(s=e===2||e===5?e:5,o=t,t>=6?o=t-3:r===1&&(s=2,o=t)),i[0]=s<<3,i[0]|=(t&14)>>1,i[1]=(t&1)<<7,i[1]|=r<<3,s===5&&(i[1]|=(o&14)>>1,i[2]=(o&1)<<7,i[2]|=8,i[3]=0),{config:i,codec:"mp4a.40.".concat(s)}}},{key:"getSilentFrame",value:function(t,r){switch(t){case"mp4a.40.2":if(r===1)return new Uint8Array([0,200,0,128,35,128]);if(r===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(r===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(r===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(r===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(r===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(r===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}]),n}();E(Ae,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var jr=function(){function n(){oe(this,n)}return le(n,null,[{key:"getFrameDuration",value:function(t){return 20}},{key:"parseHeaderPackets",value:function(t){if(t.length){for(var r=new DataView(t.buffer,t.byteOffset,t.byteLength),e="",i=0;i<8;i++)e+=String.fromCodePoint(t[i]);if(e!=="OpusHead")throw new Error("Invalid Opus MagicSignature");var s=t[9];console.log("Pre-skip",t[10],t[11]);var o=r.getUint32(12,!0),l=r.getInt16(16,!0);if(o){var u="opus",c="opus",d=new Uint8Array(t.buffer,t.byteOffset+8,t.byteLength-8);return{outputGain:l,sampleRate:o,channelCount:s,config:d,codec:u,originCodec:c}}}}}]),n}(),ha=500,Pi=3,Rr=1e3,xr=5e3,ma=1e3,fa=200,Ni=5e3,Ki=5,pa=function(){function n(a,t,r){oe(this,n),this.videoTrack=a,this.audioTrack=t,this.metadataTrack=r,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastVideoDuration=0,this._keyFrameInNextChunk=!1,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0}return le(n,[{key:"fix",value:function(){var t=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;r=Math.round(r*1e3);var s=this.videoTrack,o=this.audioTrack;(e||!i)&&(this._videoLastSample=null,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0),e&&!i&&(this._baseDtsInited=!1),this._baseDtsInited||this._calculateBaseDts(o,s),!i&&r&&(this._audioNextPts=this._videoNextDts=r);var l=this._baseDtsInited&&(this._videoTimestampBreak||!this.videoTrack.exist())&&(this._audioTimestampBreak||!this.audioTrack.exist());if(l&&this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(o),this._keyFrameInNextChunk=!1,this._fixVideo(s),this.metadataTrack.exist()){var u=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach(function(c){c.pts=c.originPts-t._baseDts,c.time=Math.max(0,c.pts)/u}),this.metadataTrack.flvScriptSamples.forEach(function(c){c.pts=c.originPts-t._baseDts,c.time=Math.max(0,c.pts)/u})}s.samples.length&&(s.baseMediaDecodeTime=s.samples[0].dts),o.samples.length&&(o.baseMediaDecodeTime=o.samples[0].pts*o.timescale/1e3)}},{key:"_fixVideo",value:function(t){var r=this,e=t.samples;if(e.length){e.forEach(function(G){G.dts-=r._baseDts,G.pts-=r._baseDts,G.keyframe&&(r._keyFrameInNextChunk=!0)});var i;if(t.fpsNum&&t.fpsDen)i=t.timescale*(t.fpsDen/t.fpsNum);else if(t.length>1){var s=t.samples[0],o=t.samples[e.length-1];i=Math.floor((o.dts-s.dts)/(e.length-1))}else i=this._lastVideoDuration||40;var l=e.pop();if(this._videoLastSample&&e.unshift(this._videoLastSample),this._videoLastSample=l,!!e.length){if(this._videoNextDts===void 0){var u=e[0];this._videoNextDts=u.dts}var c=e.length,d=0,h=e[0],p=this._videoNextDts-h.dts;if(Math.abs(p)>fa){if(Math.abs(h.dts-this._lastVideoExceptionChunkFirstDtsDot)>Ni){var v;this._lastVideoExceptionChunkFirstDtsDot=h.dts,t.warnings.push({type:pe.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts,firstSampleDts:h.dts,nextSampleDts:(v=e[1])===null||v===void 0?void 0:v.dts,sampleDuration:p})}this._videoTimestampBreak>=Ki?(this._videoNextDts=h.dts,this._videoTimestampBreak=0):(h.dts+=p,h.pts+=p,this.audioTrack.exist()||(this._videoTimestampBreak=1))}for(var g=0;g<c;g++){var b=e[g].dts,L=e[g+1];g<c-1?d=L.dts-b:l?d=l.dts-b:d=i,(d>ma||d<0)&&(this._videoTimestampBreak++,Math.abs(b-this._lastVideoExceptionLargeGapDot)>Ni&&(this._lastVideoExceptionLargeGapDot=b,t.warnings.push({type:pe.LARGE_VIDEO_GAP,time:b/t.timescale,dts:b,originDts:e[g].originDts,nextDts:this._videoNextDts,sampleDuration:d,refSampleDuration:i})),d=i),e[g].duration=d,this._videoNextDts+=d,this._lastVideoDuration=d}}}}},{key:"_fixAudio",value:function(t){var r=this,e=t.samples;e.length&&(e.forEach(function(i){i.dts=i.pts-=r._baseDts}),this._doFixAudioInternal(t,e,1e3))}},{key:"_calculateBaseDts",value:function(t,r){var e=t.samples,i=r.samples;if(!e.length&&!i.length)return!1;var s=1/0,o=1/0;e.length&&(t.baseDts=s=e[0].pts),i.length&&(r.baseDts=o=i[0].dts),this._baseDts=Math.min(s,o);var l=o-s;return Number.isFinite(l)&&Math.abs(l)>ha&&r.warnings.push({type:pe.LARGE_AV_SHIFT,videoBaseDts:o,audioBasePts:s,baseDts:this._baseDts,delta:l}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){var t=this._calculateBaseDts(this.audioTrack,this.videoTrack);t&&(this.audioTrack.exist()?this.videoTrack.exist()?this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts):this._baseDts-=this._audioNextPts:this._baseDts-=this._videoNextDts,this._videoTimestampBreak=0,this._audioTimestampBreak=0)}},{key:"_doFixAudioInternal",value:function(t,r,e){if(!t.sampleDuration)switch(t.codecType){case ye.AAC:{t.sampleDuration=Ae.getFrameDuration(t.timescale,e);break}case ye.OPUS:{t.sampleDuration=jr.getFrameDuration(t.samples,e);break}case ye.G711PCMA:case ye.G711PCMU:{t.sampleDuration=this._getG711Duration(t);break}default:console.error("can't fix audio codecType:",t.codecType);break}var i=t.sampleDuration,s=t.codecType===ye.OPUS?20:t.codecType===ye.AAC?1024:i*t.timescale/1e3;if(this._audioNextPts===void 0){var o=r[0];this._audioNextPts=o.pts}for(var l=0;l<r.length;l++){var u=this._audioNextPts,c=r[l],d=c.pts-u;if(l===0&&this._audioTimestampBreak>=Ki&&this._keyFrameInNextChunk&&(u=this._audioNextPts=c.dts,d=0,this._audioTimestampBreak=0),!this._audioTimestampBreak&&d>=Pi*i&&d<=Rr&&!Kn){var h=this._getSilentFrame(t)||r[0].data.subarray(),p=Math.floor(d/i);Math.abs(c.pts-this._lastAudioExceptionGapDot)>xr&&(this._lastAudioExceptionGapDot=c.pts,t.warnings.push({type:pe.AUDIO_FILLED,pts:c.pts,originPts:c.originPts,count:p,nextPts:u,refSampleDuration:i}));for(var v=0;v<p;v++){var g=new rt(Math.floor(this._audioNextPts+i)-Math.floor(this._audioNextPts),h,s);g.originPts=Math.floor(this._baseDts+u),r.splice(l,0,g),this._audioNextPts+=i,l++}l--}else if(d<=-Pi*i&&d>=-1*Rr)Math.abs(c.pts-this._lastAudioExceptionOverlapDot)>xr&&(this._lastAudioExceptionOverlapDot=c.pts,t.warnings.push({type:pe.AUDIO_DROPPED,pts:c.pts,originPts:c.originPts,nextPts:u,refSampleDuration:i})),r.splice(l,1),l--;else{if(Math.abs(d)>Rr&&(this._audioTimestampBreak++,Math.abs(c.pts-this._lastAudioExceptionLargeGapDot)>xr&&(this._lastAudioExceptionLargeGapDot=c.pts,t.warnings.push({type:pe.LARGE_AUDIO_GAP,time:c.pts/1e3,pts:c.pts,originPts:c.originPts,nextPts:u,sampleDuration:d,refSampleDuration:i}))),t.codecType===ye.OPUS){var b=r[r.length-1];b&&(b.duration=c.pts-b.pts)}else c.dts=c.pts=u,c.duration=s;this._audioNextPts+=i}}}},{key:"_getG711Duration",value:function(t){var r=t.sampleSize,e=t.channelCount,i=t.sampleRate,s=t.samples[0];if(s)return s.data.byteLength*2/e/(r/8)/i*1e3}},{key:"_getSilentFrame",value:function(t){return t.codecType===ye.AAC?Ae.getSilentFrame(t.codec,t.channelCount):new Uint8Array(8*t.sampleDuration*t.channelCount)}}]),n}();function He(){for(var n=arguments.length,a=new Array(n),t=0;t<n;t++)a[t]=arguments[t];a=a.filter(Boolean);var r=new Uint8Array(a.reduce(function(i,s){return i+s.byteLength},0)),e=0;return a.forEach(function(i){r.set(i,e),e+=i.byteLength}),r}var va=Math.pow(2,32);function de(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(n[a]<<8)+(n[a+1]||0)}function ya(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(n[a]<<16)+(n[a+1]<<8)+(n[a+2]||0)}function F(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(n[a]<<24>>>0)+(n[a+1]<<16)+(n[a+2]<<8)+(n[a+3]||0)}function Lt(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return F(n,a)*va+F(n,a+4)}function Dn(n){for(var a="avc1.",t,r=0;r<3;r++)t=n[r].toString(16),t.length<2&&(t="0".concat(t)),a+=t;return a}function ba(n){var a="";if(n.forEach(function(e){a+=ga(e)}),a.length<=32)for(var t=32-a.length,r=0;r<t;r++)a+="0";return a}function Di(n){if(!Array.isArray(n)){for(var a=[],t="",r=0;r<n.length;r++)r%2&&(t=n[r-1]+n[r],a.push(parseInt(t,16)),t="");return a}return n.map(function(e){return parseInt(e,16)})}function ga(n){return("0"+Number(n).toString(16)).slice(-2).toUpperCase()}function Yr(n,a){return+(n+"."+a)}function Za(n){if(n.length<5)return 0;var a=Math.hypot(n[0],n[3]),t=Math.hypot(n[1],n[4]);return a===0||t===0?0:180*Math.atan2(n[1]/t,n[0]/a)/Math.PI}var tt=function(){function n(){oe(this,n)}return le(n,null,[{key:"parseAnnexB",value:function(t){for(var r=t.length,e=2,i=0;t[e]!==null&&t[e]!==void 0&&t[e]!==1;)e++;if(e++,i=e+2,i>=r)return[];for(var s=[];i<r;)switch(t[i]){case 0:if(t[i-1]!==0){i+=2;break}else if(t[i-2]!==0){i++;break}e!==i-2&&s.push(t.subarray(e,i-2));do i++;while(t[i]!==1&&i<r);e=i+1,i=e+2;break;case 1:if(t[i-1]!==0||t[i-2]!==0){i+=3;break}e!==i-2&&s.push(t.subarray(e,i-2)),e=i+1,i=e+2;break;default:i+=3;break}return e<r&&s.push(t.subarray(e)),s}},{key:"parseAvcC",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4;if(!(t.length<4)){for(var e=t.length,i=[],s=0,o;s+r<e;)if(o=F(t,s),r===3&&(o>>>=8),s+=r,!!o){if(s+o>e)break;i.push(t.subarray(s,s+o)),s+=o}return i}}},{key:"parseSEI",value:function(t,r){for(var e=t.length,i=r?2:1,s=0,o=0,l="";t[i]===255;)s+=255,i++;for(s+=t[i++];t[i]===255;)o+=255,i++;if(o+=t[i++],s===5&&e>i+16)for(var u=0;u<16;u++)l+=t[i].toString(16),i++;return{payload:t.subarray(i,i+o),type:s,size:o,uuid:l}}},{key:"removeEPB",value:function(t){for(var r=t.byteLength,e=[],i=1;i<r-2;)t[i]===0&&t[i+1]===0&&t[i+2]===3?(e.push(i+2),i+=2):i++;if(!e.length)return t;var s=r-e.length,o=new Uint8Array(s),l=0;for(i=0;i<s;l++,i++)l===e[0]&&(l++,e.shift()),o[i]=t[l];return o}}]),n}(),Qr=function(){function n(a){if(oe(this,n),E(this,"_bytesAvailable",void 0),E(this,"_bitsAvailable",0),E(this,"_word",0),!a)throw new Error("ExpGolomb data params is required");this._data=a,this._bytesAvailable=a.byteLength,this._bytesAvailable&&this._loadWord()}return le(n,[{key:"bitsAvailable",get:function(){return this._bitsAvailable}},{key:"_loadWord",value:function(){var t=this._data.byteLength-this._bytesAvailable,r=Math.min(4,this._bytesAvailable);if(r===0)throw new Error("No bytes available");var e=new Uint8Array(4);e.set(this._data.subarray(t,t+r)),this._word=new DataView(e.buffer).getUint32(0),this._bitsAvailable=r*8,this._bytesAvailable-=r}},{key:"skipBits",value:function(t){if(this._bitsAvailable>t)this._word<<=t,this._bitsAvailable-=t;else{t-=this._bitsAvailable;var r=Math.floor(t/8);t-=r*8,this._bytesAvailable-=r,this._loadWord(),this._word<<=t,this._bitsAvailable-=t}}},{key:"readBits",value:function(t){if(t>32)throw new Error("Cannot read more than 32 bits");var r=Math.min(this._bitsAvailable,t),e=this._word>>>32-r;return this._bitsAvailable-=r,this._bitsAvailable>0?this._word<<=r:this._bytesAvailable>0&&this._loadWord(),r=t-r,r>0&&this._bitsAvailable?e<<r|this.readBits(r):e}},{key:"skipLZ",value:function(){var t;for(t=0;t<this._bitsAvailable;++t)if(this._word&2147483648>>>t)return this._word<<=t,this._bitsAvailable-=t,t;return this._loadWord(),t+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var t=this.skipLZ();return this.readBits(t+1)-1}},{key:"readEG",value:function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}},{key:"readBool",value:function(){return this.readBits(1)===1}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(t){for(var r=8,e=8,i,s=0;s<t;s++)e!==0&&(i=this.readEG(),e=(r+i+256)%256),r=e===0?r:e}}]),n}(),Hn=function(){function n(){oe(this,n)}return le(n,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(t){if(!(t.length<7)){for(var r=(t[4]&3)+1,e,i=[],s=[],o=6,l=t[5]&31,u,c=0;c<l;c++)if(u=t[o]<<8|t[o+1],o+=2,!!u){var d=t.subarray(o,o+u);o+=u,i.push(d),e||(e=n.parseSPS(tt.removeEPB(d)))}var h=t[o];o++;for(var p,v=0;v<h;v++)p=t[o]<<8|t[o+1],o+=2,p&&(s.push(t.subarray(o,o+p)),o+=p);return{sps:e,spsArr:i,ppsArr:s,nalUnitSize:r}}}},{key:"parseSPS",value:function(t){var r=new Qr(t);r.readUByte();var e=r.readUByte(),i=r.readUByte(),s=r.readUByte();r.skipUEG();var o=420;if(e===100||e===110||e===122||e===244||e===44||e===83||e===86||e===118||e===128||e===138||e===144){var l=r.readUEG();if(l<=3&&(o=[0,420,422,444][l]),l===3&&r.skipBits(1),r.skipUEG(),r.skipUEG(),r.skipBits(1),r.readBool())for(var u=l!==3?8:12,c=0;c<u;c++)r.readBool()&&(c<6?r.skipScalingList(16):r.skipScalingList(64))}r.skipUEG();var d=r.readUEG();if(d===0)r.readUEG();else if(d===1){r.skipBits(1),r.skipUEG(),r.skipUEG();for(var h=r.readUEG(),p=0;p<h;p++)r.skipUEG()}r.skipUEG(),r.skipBits(1);var v=r.readUEG(),g=r.readUEG(),b=r.readBits(1);b===0&&r.skipBits(1),r.skipBits(1);var L=0,G=0,V=0,W=0;r.readBool()&&(L=r.readUEG(),G=r.readUEG(),V=r.readUEG(),W=r.readUEG());var S,T,k,w,M;if(r.readBool()){if(r.readBool()){var I=r.readUByte();switch(I){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:{S=[r.readUByte()<<8|r.readUByte(),r.readUByte()<<8|r.readUByte()];break}}}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var D=r.readBits(32),f=r.readBits(32);T=r.readBool(),k=f,w=D*2,M=k/w}}return{codec:Dn(t.subarray(1,4)),profileIdc:e,profileCompatibility:i,levelIdc:s,chromaFormat:o,width:Math.ceil((v+1)*16-2*(L+G)),height:(2-b)*(g+1)*16-(b?2:4)*(V+W),sarRatio:S,fpsNum:k,fpsDen:w,fps:M,fixedFrame:T}}}]),n}(),$r=function(){function n(){oe(this,n)}return le(n,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!(t.length<23)){r=r||{};for(var e=(t[21]&3)+1,i,s,o=[],l=[],u=[],c=23,d=t[22],h,p,v,g=0;g<d;g++){h=t[c]&63,p=t[c+1]<<8|t[c+2],c+=3;for(var b=0;b<p;b++)if(v=t[c]<<8|t[c+1],c+=2,!!v){switch(h){case 32:{var L=t.subarray(c,c+v);i||(i=n.parseVPS(tt.removeEPB(L),r)),u.push(L)}break;case 33:{var G=t.subarray(c,c+v);s||(s=n.parseSPS(tt.removeEPB(G),r)),o.push(G)}break;case 34:l.push(t.subarray(c,c+v));break}c+=v}}return{hvcC:r,sps:s,spsArr:o,ppsArr:l,vpsArr:u,nalUnitSize:e}}}},{key:"parseVPS",value:function(t,r){r=r||{};var e=new Qr(t);e.readUByte(),e.readUByte(),e.readBits(12);var i=e.readBits(3);return r.numTemporalLayers=Math.max(r.numTemporalLayers||0,i+1),e.readBits(17),n._parseProfileTierLevel(e,i,r),r}},{key:"parseSPS",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};r=r||{};var e=new Qr(t);e.readUByte(),e.readUByte(),e.readBits(4);var i=e.readBits(3);r.numTemporalLayers=Math.max(i+1,r.numTemporalLayers||0),r.temporalIdNested=e.readBits(1),n._parseProfileTierLevel(e,i,r),e.readUEG();var s=r.chromaFormatIdc=e.readUEG(),o=420;s<=3&&(o=[0,420,422,444][s]);var l=0;s===3&&(l=e.readBits(1));var u=e.readUEG(),c=e.readUEG(),d=e.readBits(1),h,p,v,g;if(d===1&&(h=e.readUEG(),p=e.readUEG(),v=e.readUEG(),g=e.readUEG()),r.bitDepthLumaMinus8=e.readUEG(),r.bitDepthChromaMinus8=e.readUEG(),d===1){var b=(s===1||s===2)&&l===0?2:1,L=s===1&&l===0?2:1;u-=b*(p+h),c-=L*(g+v)}return{codec:"hev1.1.6.L93.B0",width:u,height:c,chromaFormat:o,hvcC:r}}},{key:"_parseProfileTierLevel",value:function(t,r,e){var i=e.generalTierFlag||0;e.generalProfileSpace=t.readBits(2),e.generalTierFlag=Math.max(t.readBits(1),i),e.generalProfileIdc=Math.max(t.readBits(5),e.generalProfileIdc||0),e.generalProfileCompatibilityFlags=t.readBits(32),e.generalConstraintIndicatorFlags=[t.readBits(8),t.readBits(8),t.readBits(8),t.readBits(8),t.readBits(8),t.readBits(8)];var s=t.readBits(8);i<e.generalTierFlag?e.generalLevelIdc=s:e.generalLevelIdc=Math.max(s,e.generalLevelIdc||0);var o=[],l=[];if(r>t.bitsAvailable)throw new Error("maxSubLayersMinus inavlid size ".concat(r));for(var u=0;u<r;u++)o[u]=t.readBits(1),l[u]=t.readBits(1);r>0&&t.readBits((8-r)*2);for(var c=0;c<r;c++)o[c]!==0&&(t.readBits(2),t.readBits(1),t.readBits(5),t.readBits(16),t.readBits(16),t.readBits(4),t.readBits(16),t.readBits(16),t.readBits(12)),l[c]!==0&&t.readBits(8)}}]),n}(),Hi=function(){function n(){oe(this,n)}return le(n,null,[{key:"decode",value:function(t){for(var r=[],e=t,i=0,s=t.length;i<s;){if(e[i]<128){r.push(String.fromCharCode(e[i])),++i;continue}else if(!(e[i]<192)){if(e[i]<224){if(n._checkContinuation(e,i,1)){var o=(e[i]&31)<<6|e[i+1]&63;if(o>=128){r.push(String.fromCharCode(o&65535)),i+=2;continue}}}else if(e[i]<240){if(n._checkContinuation(e,i,2)){var l=(e[i]&15)<<12|(e[i+1]&63)<<6|e[i+2]&63;if(l>=2048&&(l&63488)!==55296){r.push(String.fromCharCode(l&65535)),i+=3;continue}}}else if(e[i]<248&&n._checkContinuation(e,i,3)){var u=(e[i]&7)<<18|(e[i+1]&63)<<12|(e[i+2]&63)<<6|e[i+3]&63;if(u>65536&&u<1114112){u-=65536,r.push(String.fromCharCode(u>>>10|55296)),r.push(String.fromCharCode(u&1023|56320)),i+=4;continue}}}r.push("�"),++i}return r.join("")}},{key:"_checkContinuation",value:function(t,r,e){var i=t;if(r+e<i.length){for(;e--;)if((i[++r]&192)!==128)return!1;return!0}else return!1}}]),n}(),Sa=function(){function n(){oe(this,n)}return le(n,null,[{key:"parse",value:function(t){if(!(t.length<3)){var r={},e=n._parseValue(new DataView(t.buffer,t.byteOffset,t.byteLength)),i=n._parseValue(new DataView(t.buffer,t.byteOffset+e.size,t.byteLength-e.size));return r[e.data]=i.data,r}}},{key:"_parseValue",value:function(t){var r=t.byteLength,e=t.getUint8(0),i=1,s=!1,o;switch(e){case 0:o=t.getFloat64(1),i+=8;break;case 1:{o=!!t.getUint8(1),i+=1;break}case 2:{var l=n._parseString(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i)),u=l.data,c=l.size;o=u,i+=c}break;case 3:{o={};var d=0;for((t.getUint32(r-4)&16777215)===9&&(d=3);i<r-4;){var h=n._parseObject(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i-d)),p=h.size,v=h.data,g=h.isEnd;if(g)break;o[v.name]=v.value,i+=p}if(i<=r-3){var b=t.getUint32(i-1)&16777215;b===9&&(i+=3)}}break;case 8:{o={},i+=4;var L=0;for((t.getUint32(r-4)&16777215)===9&&(L=3);i<r-8;){var G=n._parseObject(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i-L)),V=G.size,W=G.data,S=G.isEnd;if(S)break;o[W.name]=W.value,i+=V}if(i<=r-3){var T=t.getUint32(i-1)&16777215;T===9&&(i+=3)}}break;case 9:o=void 0,i=1,s=!0;break;case 10:{o=[];var k=t.getUint32(1);i+=4;for(var w=0;w<k;w++){var M=n._parseValue(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i)),I=M.data,D=M.size;o.push(I),i+=D}}break;case 11:{var f=t.getFloat64(i)+t.getInt16(i+8)*6e4;o=new Date(f),i+=10}break;case 12:{var m=t.getUint32(1);i+=4,o="",m>0&&(o=Hi.decode(new Uint8Array(t.buffer,t.byteOffset+i,m))),i+=m}break;default:i=r;break}return{data:o,size:i,isEnd:s}}},{key:"_parseString",value:function(t){var r=t.getUint16(0),e="";return r>0&&(e=Hi.decode(new Uint8Array(t.buffer,t.byteOffset+2,r))),{data:e,size:2+r}}},{key:"_parseObject",value:function(t){if(!(t.byteLength<3)){var r=n._parseString(t),e=n._parseValue(new DataView(t.buffer,t.byteOffset+r.size,t.byteLength-r.size));return{data:{name:r.data,value:e.data},size:r.size+e.size,isEnd:e.isEnd}}}}]),n}(),it={MP3:2,G711A:7,G711M:8,AAC:10,OPUS:13},je=new kt("FlvDemuxer"),Fn=function(){function n(a,t,r){oe(this,n),E(this,"_headerParsed",!1),E(this,"_remainingData",null),E(this,"_gopId",0),E(this,"_needAddMetaBeforeKeyFrameNal",!0),this.videoTrack=a||new gr,this.audioTrack=t||new Zr,this.metadataTrack=r||new Sr,this._fixer=new pa(this.videoTrack,this.audioTrack,this.metadataTrack)}return le(n,[{key:"demux",value:function(t){var r,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=arguments.length>3?arguments[3]:void 0,o=this.audioTrack,l=this.videoTrack,u=this.metadataTrack;if((e||!i)&&(this._remainingData=null),e&&(this._headerParsed=!1),e?(l.reset(),o.reset(),u.reset()):(l.samples=[],o.samples=[],u.seiSamples=[],u.flvScriptSamples=[],l.warnings=[],o.warnings=[],this._remainingData&&(t=He(this._remainingData,t),this._remainingData=null)),!t.length)return{videoTrack:l,audioTrack:o,metadataTrack:u};var c=0;if(!this._headerParsed){if(!n.probe(t))throw new Error("Invalid flv file");o.present=(t[4]&4)>>>2!==0,l.present=(t[4]&1)!==0,this._headerParsed=!0,c=F(t,5)+4}for(var d=t.length,h,p,v,g,b;c+15<d&&(h=t[c],p=t[c+1]<<16|t[c+2]<<8|t[c+3],!(c+15+p>d));)v=(t[c+7]<<24>>>0)+(t[c+4]<<16)+(t[c+5]<<8)+t[c+6],c+=11,g=t.subarray(c,c+p),h===8?this._parseAudio(g,v):h===9?(s&&(this.seamlessLoadingSwitching=!0),this._parseVideo(g,v)):h===18?this._parseScript(g,v):je.warn("Invalid tag type: ".concat(h)),c+=p,b=F(t,c),b!==11+p&&je.warn("Invalid PrevTagSize ".concat(b," (").concat(11+p,")")),c+=4;c<d&&(this._remainingData=t.subarray(c)),o.formatTimescale=l.formatTimescale=l.timescale=u.timescale=1e3,o.timescale=o.codecType===ye.OPUS?1e3:o.sampleRate||0,!o.exist()&&o.hasSample()&&o.reset(),!l.exist()&&l.hasSample()&&l.reset();var L=u.flvScriptSamples[u.flvScriptSamples.length-1],G=L==null||(r=L.data)===null||r===void 0?void 0:r.onMetaData;return G&&(l!=null&&l.exist()&&(G.hasOwnProperty("duration")&&(l.duration=G.duration*1e3),G.hasOwnProperty("width")&&G.hasOwnProperty("height")&&(l.width=G.width,l.height=G.height)),o!=null&&o.exist()&&G.hasOwnProperty("duration")&&(o.duration=G.duration*1e3)),{videoTrack:l,audioTrack:o,metadataTrack:u}}},{key:"fix",value:function(t,r,e){return this._fixer.fix(t,r,e),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(t,r,e,i,s){return this.demux(t,r,e,s),this.fix(i,r,e)}},{key:"_parseAudio",value:function(t,r){if(t.length){var e=(t[0]&240)>>>4,i=this.audioTrack;if(e!==it.AAC&&e!==it.G711A&&e!==it.G711M&&e!==it.OPUS){je.warn("Unsupported sound format: ".concat(e)),i.reset();return}if(e!==it.AAC&&e!==it.OPUS){var s=(t[0]&12)>>2,o=(t[0]&2)>>1,l=t[0]&1;i.sampleRate=n.AUDIO_RATE[s],i.sampleSize=o?16:8,i.channelCount=l+1}switch(e){case it.G711A:case it.G711M:this._parseG711(t,r,e);break;case it.AAC:this._parseAac(t,r);break;case it.OPUS:this._parseOpus(t,r);break}}}},{key:"_parseOpus",value:function(t,r){var e=this.audioTrack,i=t[1];switch(e.codecType=ye.OPUS,i){case 0:{var s=jr.parseHeaderPackets(t.subarray(2));s?(e.codec=s.codec,e.channelCount=s.channelCount,e.sampleRate=s.sampleRate,e.config=s.config,e.sampleDuration=jr.getFrameDuration([],e.timescale)):(e.reset(),je.warn("Cannot parse AudioSpecificConfig",t));break}case 1:{if(r==null)return;var o=new rt(r,t.subarray(2),e.sampleDuration);e.samples.push(o);break}default:je.warn("Unknown OpusPacketType: ".concat(i))}}},{key:"_parseG711",value:function(t,r,e){var i=this.audioTrack;i.codecType=e===7?ye.G711PCMA:ye.G711PCMU,i.sampleRate=8e3,i.codec=i.codecType,i.samples.push(new rt(r,t.subarray(1)))}},{key:"_parseAac",value:function(t,r){var e=this.audioTrack;if(e.codecType=ye.AAC,t[1]===0){var i=Ae.parseAudioSpecificConfig(t.subarray(2));i?(e.codec=i.codec,e.channelCount=i.channelCount,e.sampleRate=i.sampleRate,e.config=i.config,e.objectType=i.objectType,e.sampleRateIndex=i.samplingFrequencyIndex):(e.reset(),je.warn("Cannot parse AudioSpecificConfig",t))}else if(t[1]===1){if(r==null)return;e.samples.push(new rt(r,t.subarray(2)))}else je.warn("Unknown AACPacketType: ".concat(t[1]))}},{key:"_parseVideo",value:function(t,r){var e=this;if(!(t.length<6)){var i=(t[0]&240)>>>4,s=t[0]&15,o=this.videoTrack;if(s!==7&&s!==12){o.reset(),je.warn("Unsupported codecId: ".concat(s));return}var l=s===12;o.codecType=l?ot.HEVC:ot.AVC;var u=t[1],c=(t[2]<<16|t[3]<<8|t[4])<<8>>8;if(u===0){var d=t.subarray(5),h=l?$r.parseHEVCDecoderConfigurationRecord(d):Hn.parseAVCDecoderConfigurationRecord(d);if(h){var p=h.hvcC,v=h.sps,g=h.ppsArr,b=h.spsArr,L=h.vpsArr,G=h.nalUnitSize;p&&(o.hvcC=o.hvcC||p),v&&(o.codec=v.codec,o.width=v.width,o.height=v.height,o.sarRatio=v.sarRatio,o.fpsNum=v.fpsNum,o.fpsDen=v.fpsDen),b.length&&(o.sps=b),g.length&&(o.pps=g),L&&L.length&&(o.vps=L),G&&(o.nalUnitSize=G)}else je.warn("Cannot parse ".concat(l?"HEVC":"AVC","DecoderConfigurationRecord"),t)}else if(u===1){var V=tt.parseAvcC(t.subarray(5),o.nalUnitSize);if(V=this._checkAddMetaNalToUnits(l,V,o),V&&V.length){var W=new Pt(r+c,r,V);if(this.seamlessLoadingSwitching&&r<o.lastKeyFrameDts)return;this.seamlessLoadingSwitching=!1,i===1&&(W.setToKeyframe(),o.lastKeyFrameDts=r),o.samples.push(W),V.forEach(function(S){var T=l?S[0]>>>1&63:S[0]&31;switch(T){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!l&&T!==5||l&&T===5)break;W.setToKeyframe();break;case 6:case 39:case 40:if(!l&&T!==6||l&&T===6)break;e.metadataTrack.seiSamples.push(new Nn(tt.parseSEI(tt.removeEPB(S),l),r+c));break}}),W.keyframe&&this._gopId++,W.gopId=this._gopId}else je.warn("Cannot parse NALUs",t)}else u===2||je.warn("Unknown AVCPacketType: ".concat(u))}}},{key:"_checkAddMetaNalToUnits",value:function(t,r,e){if(!t||!this._needAddMetaBeforeKeyFrameNal)return this._needAddMetaBeforeKeyFrameNal=!1,r;var i=r.map(function(s){return s[0]>>>1&63});return i.includes(32)?(this._needAddMetaBeforeKeyFrameNal=!1,r):(r.unshift(e.pps[0]),r.unshift(e.sps[0]),r.unshift(e.vps[0]),r.filter(Boolean))}},{key:"_parseScript",value:function(t,r){this.metadataTrack.flvScriptSamples.push(new ua(Sa.parse(t),r))}}],[{key:"probe",value:function(t){return t[0]!==70||t[1]!==76||t[2]!==86||t[3]!==1?!1:F(t,5)>=9}}]),n}();E(Fn,"AUDIO_RATE",[5500,11e3,22e3,44e3]);var La=9e4/2,Fi=3,nr=9e4,Mr=5*9e4,Ir=9e4,Xa=9e4/2,Ga=9e4*5,Wa=function(){function n(a,t,r,e){oe(this,n),this.videoTrack=a,this.audioTrack=t,this.metadataTrack=r,this._baseDts=-1,this._baseVideoDts=-1,this._baseAudioDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0,this._needForceFixLargeGap=e==null?void 0:e.forceFixLargeGap,this._largeGapThreshold=(e==null?void 0:e.largeGapThreshold)||Ga}return le(n,[{key:"fix",value:function(){var t=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;r=Math.round(r*9e4);var s=this.videoTrack,o=this.audioTrack,l=s.samples,u=o.samples;if(!(!l.length&&!u.length)){var c=l[0],d=u[0],h=0;if(l.length&&u.length&&(h=c.dts-d.pts),this._baseDtsInited||this._calculateBaseDts(this.audioTrack,this.videoTrack),e&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=r,this._baseAudioDts-=r,this._baseVideoDts-=r),!i){this._videoNextDts=h>0?r+h:r,this._audioNextPts=h>0?r:r-h,this._needForceFixLargeGap&&(this._videoNextDts=0,this._audioNextPts=0);var p=c?c.dts-this._baseDts-this._videoNextDts:0,v=d?d.pts-this._baseDts-this._audioNextPts:0;Math.abs(p||v)>Ir&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=r)}if(this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(o),this._fixVideo(s),this.metadataTrack.exist()){var g=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach(function(b){b.pts=b.originPts-t._baseDts,b.time=Math.max(0,b.pts)/g})}s.samples.length&&(s.baseMediaDecodeTime=s.samples[0].dts),o.samples.length&&(o.baseMediaDecodeTime=o.samples[0].pts*o.timescale/9e4)}}},{key:"_fixVideo",value:function(t){var r=this,e=t.samples;if(e.length){if(e.forEach(function(k){k.dts-=r._needForceFixLargeGap?r._baseVideoDts:r._baseDts,k.pts-=r._needForceFixLargeGap?r._baseVideoDts:r._baseDts}),this._videoNextDts===void 0){var i=e[0];this._videoNextDts=i.dts}var s=e.length,o=0,l=e[0],u=e[1],c=this._videoNextDts-l.dts;if(Math.abs(c)>Xa){var d;if(t.warnings.push({type:pe.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts/90,firstSampleDts:l.dts/90,nextSampleDts:(((d=e[1])===null||d===void 0?void 0:d.dts)||0)/90,sampleDuration:c/90}),l.dts+=c,l.pts+=c,u&&Math.abs(u.dts-l.dts)>Ir)this._videoTimestampBreak=!0,e.forEach(function(k,w){w!==0&&(k.dts+=c,k.pts+=c)});else for(var h=1;h<s-1;h++){var p,v=(p=e[h])===null||p===void 0?void 0:p.dts,g=e[h-1].dts;v&&v-g<0&&(e[h].dts+=c,e[h].pts+=c)}}var b;if(t.fpsNum&&t.fpsDen&&(b=t.timescale*(t.fpsDen/t.fpsNum)),b<90*10&&(b=0),!b){var L=t.samples[0],G=t.samples[1];b=s===1?9e3:Math.floor(G.dts-L.dts)}for(var V=0;V<s;V++){var W=e[V].dts,S=e[V+1];if(V<s-1?o=S.dts-W:e[V-1]?o=Math.min(W-e[V-1].dts,b):o=b,o>Ir||o<0){this._videoTimestampBreak=!0,o=this._audioTimestampBreak?b:Math.max(o,30*90);var T=this._audioNextPts||0;S&&S.dts>T&&(o=b),t.warnings.push({type:pe.LARGE_VIDEO_GAP,time:W/t.timescale,dts:W,originDts:e[V].originDts,nextDts:this._videoNextDts,sampleDuration:o,refSampleDuration:b})}e[V].duration=o,this._videoNextDts+=o}}}},{key:"_fixAudio",value:function(t){var r=this,e=t.samples;e.length&&(e.forEach(function(i){i.pts-=r._needForceFixLargeGap?r._baseAudioDts:r._baseDts,i.dts=i.pts}),this._doFixAudioInternal(t,e,9e4))}},{key:"_calculateBaseDts",value:function(t,r){var e=t.samples,i=r.samples;if(!e.length&&!i.length)return!1;var s=1/0,o=1/0;e.length&&(t.baseDts=s=e[0].pts,this._baseAudioDts=s),i.length&&(r.baseDts=o=i[0].dts,this._baseVideoDts=o),this._baseDts=Math.min(s,o);var l=o-s,u=!1;return Number.isFinite(l)&&Math.abs(l)>La&&r.warnings.push({type:pe.LARGE_AV_SHIFT,videoBaseDts:o,audioBasePts:s,baseDts:this._baseDts,delta:l}),Number.isFinite(l)&&Math.abs(l)>this._largeGapThreshold*nr&&(u=!0),this._baseDtsInited||(u&&this._needForceFixLargeGap?this._needForceFixLargeGap=!0:this._needForceFixLargeGap=!1),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){if(this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak){var t=this._calculateBaseDts(this.audioTrack,this.videoTrack);if(!t)return;this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1}}},{key:"_doFixAudioInternal",value:function(t,r,e){t.sampleDuration||(t.sampleDuration=Ae.getFrameDuration(t.timescale,e));var i=t.sampleDuration;if(this._audioNextPts===void 0){var s=r[0];this._audioNextPts=s.pts}for(var o=0;o<r.length;o++){var l=this._audioNextPts,u=r[o],c=u.pts-l;if(!this._audioTimestampBreak&&c>=Fi*i&&c<=nr&&!Kn){var d=Ae.getSilentFrame(t.codec,t.channelCount)||r[0].data.subarray(),h=Math.floor(c/i);Math.abs(u.pts-this._lastAudioExceptionGapDot)>Mr&&(this._lastAudioExceptionGapDot=u.pts),t.warnings.push({type:pe.AUDIO_FILLED,pts:u.pts/90,originPts:u.originPts,count:h,nextPts:l/90,refSampleDuration:i});for(var p=0;p<h;p++){var v=new rt(Math.floor(l),d);v.originPts=Math.floor(this._baseDts+l),r.splice(o,0,v),this._audioNextPts+=i,o++}o--}else c<=-Fi*i&&c>=-1*nr?(Math.abs(u.pts-this._lastAudioExceptionOverlapDot)>Mr&&(this._lastAudioExceptionOverlapDot=u.pts,t.warnings.push({type:pe.AUDIO_DROPPED,pts:u.pts/90,originPts:u.originPts,nextPts:l/90,refSampleDuration:i})),r.splice(o,1),o--):(Math.abs(c)>=nr&&(this._audioTimestampBreak=!0,Math.abs(u.pts-this._lastAudioExceptionLargeGapDot)>Mr&&(this._lastAudioExceptionLargeGapDot=u.pts,t.warnings.push({type:pe.LARGE_AUDIO_GAP,time:u.pts/1e3,pts:u.pts/90,originPts:u.originPts,nextPts:l/90,sampleDuration:c,refSampleDuration:i}))),u.dts=u.pts=l,this._audioNextPts+=i)}}}]),n}(),Qe=new kt("TsDemuxer"),Un=function(){function n(a,t,r){var e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};oe(this,n),E(this,"_pmtId",-1),E(this,"_remainingPacketData",null),E(this,"_videoPesData",[]),E(this,"_audioPesData",[]),E(this,"_gopId",0),this.videoTrack=a||new gr,this.audioTrack=t||new Zr,this.metadataTrack=r||new Sr,this._fixer=new Wa(this.videoTrack,this.audioTrack,this.metadataTrack,e)}return le(n,[{key:"demux",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=this.audioTrack,s=this.videoTrack,o=this.metadataTrack;r&&(this._pmtId=-1,s.reset(),i.reset(),o.reset()),!e||r?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(s.samples=[],i.samples=[],o.seiSamples=[],s.warnings=[],i.warnings=[],this._remainingPacketData&&(t=He(this._remainingPacketData,t),this._remainingPacketData=null));var l=t.length,u=l%188;u&&(this._remainingPacketData=t.subarray(l-u),l-=u);for(var c=s.pid,d=i.pid,h=0;h<l;h+=188){if(t[h]!==71)throw new Error("TS packet did not start with 0x47");var p=!!(t[h+1]&64),v=((t[h+1]&31)<<8)+t[h+2],g=(t[h+3]&48)>>4,b=void 0;if(g>1){if(b=h+5+t[h+4],b===h+188)continue}else b=h+4;switch(v){case 0:p&&(b+=t[b]+1),this._pmtId=(t[b+10]&31)<<8|t[b+11];break;case this._pmtId:{p&&(b+=t[b]+1);var L=b+3+((t[b+1]&15)<<8|t[b+2])-4,G=(t[b+10]&15)<<8|t[b+11];for(b+=12+G;b<L;){var V=(t[b+1]&31)<<8|t[b+2];switch(t[b]){case 15:i.pid=d=V;break;case 27:if(c!==-1)break;s.codecType=ot.AVC,s.pid=c=V;break;case 36:if(c!==-1)break;s.codecType=ot.HEVC,s.pid=c=V;break;default:Qe.warn("Unsupported stream. type: ".concat(t[b],", pid: ").concat(V))}b+=((t[b+3]&15)<<8|t[b+4])+5}}break;case c:p&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(t.subarray(b,h+188));break;case d:p&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(t.subarray(b,h+188));break;case 17:case 8191:break;default:Qe.warn("Unknown pid: ".concat(v))}}return this._parseVideoData(),this._parseAudioData(),i.formatTimescale=s.formatTimescale=s.timescale=o.timescale=9e4,i.timescale=i.sampleRate||0,{videoTrack:s,audioTrack:i,metadataTrack:o}}},{key:"fix",value:function(t,r,e){return this._fixer.fix(t,r,e),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(t,r,e,i){return this.demux(t,r,e),this.fix(i,r,e)}},{key:"_parseVideoData",value:function(){if(this._videoPesData.length){var t=n._parsePES(He.apply(void 0,Ye(this._videoPesData)));if(!t){Qe.warn("Cannot parse video pes",this._videoPesData);return}var r=tt.parseAnnexB(t.data);r?this._createVideoSample(r,t.pts,t.dts):Qe.warn("Cannot parse avc units",t),this._videoPesData=[]}}},{key:"_createVideoSample",value:function(t,r,e){var i=this;if(t.length){var s=this.videoTrack,o=s.codecType===ot.HEVC,l=new Pt(r,e);t.forEach(function(u){var c=o?u[0]>>>1&63:u[0]&31;switch(c){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!o&&c!==5||o&&c===5)break;l.setToKeyframe(),i._gopId++;break;case 6:case 39:case 40:if(!o&&c!==6||o&&c===6)break;i.metadataTrack.seiSamples.push(new Nn(tt.parseSEI(tt.removeEPB(u),o),r));return;case 32:if(!o)break;if(!s.vps.length){var d=$r.parseVPS(tt.removeEPB(u),s.hvcC);s.hvcC=s.hvcC||d,s.vps=[u]}break;case 7:case 33:if(!o&&c!==7||o&&c===7)break;if(!s.sps.length){var h=tt.removeEPB(u),p=o?$r.parseSPS(h,s.hvcC):Hn.parseSPS(h);s.sps=[u],s.hvcC=s.hvcC||p.hvcC,s.codec=p.codec,s.width=p.width,s.height=p.height,s.sarRatio=p.sarRatio,s.fpsNum=p.fpsNum,s.fpsDen=p.fpsDen}break;case 8:case 34:if(!o&&c!==8||o&&c===8)break;s.pps.length||(s.pps=[u]);break;case 9:case 35:break;case 38:if(o){for(var v=!1,g=2;g<u.byteLength;g++)if(u[g]===255){v=!0;break}if(!v)return}break}l.units.push(u)}),l.gopId=this._gopId,this._pushVideoSample(s,l)}}},{key:"_pushVideoSample",value:function(t,r){if(r.units.length)if(r.pts===null||r.pts===void 0){Qe.warn("Video sample no pts",r);var e=t.samples[t.samples.length-1];e?(r.pts=e.pts,r.dts=e.dts):Qe.warn("Drop video sample",r)}else t.samples.push(r)}},{key:"_parseAudioData",value:function(){if(this._audioPesData.length){var t=n._parsePES(He.apply(void 0,Ye(this._audioPesData)));if(!t){Qe.warn("Cannot parse audio pes",this._audioPesData);return}this._parseAacData(t),this._audioPesData=[]}}},{key:"_parseAacData",value:function(t){var r=this.audioTrack,e=t.pts;if(e==null){if(Qe.warn("AAC pes not pts",r),!r.samples.length||!r.sampleRate)return;e=r.samples[r.samples.length-1].pts+Ae.getFrameDuration(r.sampleRate)}var i=Ae.parseADTS(t.data,e);if(i){var s;r.codec=i.codec,r.channelCount=i.channelCount,r.sampleRate=i.sampleRate,r.objectType=i.objectType,r.sampleRateIndex=i.samplingFrequencyIndex,r.config=i.config,(s=r.samples).push.apply(s,Ye(i.frames.map(function(o){return new rt(o.pts,o.data)}))),i.skip&&Qe.warn("Skip aac adts ".concat(i.skip," bits")),i.remaining&&Qe.warn("Remaining aac adts ".concat(i.remaining," bits"))}else Qe.warn("Cannot parse aac adts",t)}}],[{key:"probe",value:function(t){return t.length?t[0]===71&&t[188]===71&&t[376]===71:!1}},{key:"_parsePES",value:function(t){var r=t[8];if(!(r==null||t.length<r+9)){var e=t[0]<<16|t[1]<<8|t[2];if(e===1){var i=(t[4]<<8)+t[5];if(!(i&&i>t.length-6)){var s,o,l=t[7];return l&192&&(s=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,l&64?(o=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,s-o>60*9e4&&(s=o)):o=s),{data:t.subarray(9+r),pts:s,dts:o}}}}}}]),n}(),Er=function(){function n(a,t,r){oe(this,n),this.dv=new DataView(a),this.start=this.offset=t||this.dv.byteOffset,this.end=r?this.start+r:this.start+this.dv.byteLength}return le(n,[{key:"buffer",get:function(){return this.dv.buffer}},{key:"unreadLength",get:function(){return Math.max(this.end-this.offset,0)}},{key:"size",get:function(){return this.end-this.start}},{key:"readFloat",value:function(t){var r=0;switch(t){case 4:r=this.dv.getFloat32(this.offset);break;case 8:r=this.dv.getFloat64(this.offset);break;default:throw new Error("read ".concat(t,"-byte float is not supported"))}return this.offset+=t,r}},{key:"back",value:function(t){this.offset-=t}},{key:"skip",value:function(t){this.offset+=t}},{key:"readInt",value:function(t){var r=this.offset;switch(this.offset+=t,t){case 1:return this.dv.getInt8(r);case 2:return this.dv.getInt16(r);case 4:return this.dv.getInt32(r);default:throw new Error("read ".concat(t,"-byte integers is not supported"))}}},{key:"read",value:function(t){var r=this.offset;switch(this.offset+=t,t){case 1:return this.dv.getUint8(r);case 2:return this.dv.getUint16(r);case 3:return(this.dv.getUint16(r)<<8)+this.dv.getUint8(r+2);case 4:return this.dv.getUint32(r);default:return this.back(t-4),this.read(t-4)+this.dv.getUint32(r)*Math.pow(256,t-4)}}},{key:"write",value:function(t,r){var e=this.offset;switch(this.offset+=t,t){case 1:return this.dv.setUint8(e,r);case 2:return this.dv.setUint16(e,r);case 3:return this.dv.setUint8(e,r>>>16),this.dv.setUint16(e+1,65535&r);case 4:return this.dv.setUint32(e,r);default:throw new Error("write ".concat(t,"-byte integers is not supported"))}}},{key:"readToBuffer",value:function(t){var r;return this.offset||t?r=this.dv.buffer.slice(this.offset,t?this.offset+t:this.end):r=this.dv.buffer,this.offset+=r.byteLength,r}},{key:"readToUint8",value:function(t){var r=new Uint8Array(this.dv.buffer,this.offset,t||this.unreadLength);return this.offset+=r.byteLength,r}},{key:"readString",value:function(t){for(var r=0,e="";r<t;r++)e+=String.fromCharCode(this.dv.getUint8(this.offset)),this.offset++;return e}}],[{key:"fromUint8",value:function(t){return new n(t.buffer,t.byteOffset,t.byteLength)}},{key:"concatUint8s",value:function(t){var r=new Uint8Array(t.reduce(function(i,s){return i+s.byteLength},0)),e=0;return t.forEach(function(i){r.set(i,e),e+=i.byteLength}),r}},{key:"concatUint8",value:function(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];return this.concatUint8s(r)}}]),n}(),wa=function(){function n(a,t){oe(this,n),this.offset=0,this.val=a,this.size=t}return le(n,[{key:"skip",value:function(t){this.offset+=t}},{key:"read",value:function(t){var r=this.size-this.offset-t;if(r>=0){var e=0,i=0;if(this.offset+=t,this.size>31){for(;i<t;i++)e+=Math.pow(2,i);return this.val/Math.pow(2,r)&e}else{for(;i<t;i++)e+=1<<i;return this.val>>>r&e}}throw new Error("the number of the read operation exceeds the total length limit of bits")}}],[{key:"fromByte",value:function(t,r){return new n(t.read(r),r<<3)}}]),n}(),Q=function(){function n(){oe(this,n)}return le(n,null,[{key:"findBox",value:function(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=[];if(!t)return i;for(var s=0,o="",l=0;t.length>7;){if(s=F(t),o=String.fromCharCode.apply(null,t.subarray(4,8)),l=8,s===1?(s=Lt(t,8),l+=8):s||(s=t.length),!r[0]||o===r[0]){var u=t.subarray(0,s);if(r.length<2)i.push({start:e,size:s,headerSize:l,type:o,data:u});else return n.findBox(u.subarray(l),r.slice(1),e+l)}e+=s,t=t.subarray(s)}return i}},{key:"tfhd",value:function(t){return A(t,!0,function(r,e){r.trackId=F(e);var i=4,s=r.flags&255&1,o=r.flags&255&2,l=r.flags&255&8,u=r.flags&255&16,c=r.flags&255&32;s&&(i+=4,r.baseDataOffset=F(e,i),i+=4),o&&(r.sampleDescriptionIndex=F(e,i),i+=4),l&&(r.defaultSampleDuration=F(e,i),i+=4),u&&(r.defaultSampleSize=F(e,i),i+=4),c&&(r.defaultSampleFlags=F(e,i))})}},{key:"sidx",value:function(t){return A(t,!0,function(r,e){var i=0;r.reference_ID=F(e,i),i+=4,r.timescale=F(e,i),i+=4,r.version===0?(r.earliest_presentation_time=F(e,i),i+=4,r.first_offset=F(e,i),i+=4):(r.earliest_presentation_time=Lt(e,i),i+=8,r.first_offset=Lt(e,i),i+=8),i+=2,r.references=[];var s=de(e,i);i+=2;for(var o=0;o<s;o++){var l={};r.references.push(l);var u=F(e,i);i+=4,l.reference_type=u>>31&1,l.referenced_size=u&2147483647,l.subsegment_duration=F(e,i),i+=4,u=F(e,i),i+=4,l.starts_with_SAP=u>>31&1,l.SAP_type=u>>28&7,l.SAP_delta_time=u&268435455}})}},{key:"moov",value:function(t){return A(t,!1,function(r,e,i){r.mvhd=n.mvhd(n.findBox(e,["mvhd"],i)[0]),r.trak=n.findBox(e,["trak"],i).map(function(s){return n.trak(s)}),r.pssh=n.pssh(n.findBox(e,["pssh"],i)[0])})}},{key:"mvhd",value:function(t){return A(t,!0,function(r,e){var i=0;r.version===1?(r.timescale=F(e,16),r.duration=Lt(e,20),i+=28):(r.timescale=F(e,8),r.duration=F(e,12),i+=16),r.nextTrackId=F(e,i+76)})}},{key:"trak",value:function(t){return A(t,!1,function(r,e,i){r.tkhd=n.tkhd(n.findBox(e,["tkhd"],i)[0]),r.mdia=n.mdia(n.findBox(e,["mdia"],i)[0])})}},{key:"tkhd",value:function(t){return A(t,!0,function(r,e){var i=Er.fromUint8(e);r.version===1?(i.read(8),i.read(8),r.trackId=i.read(4),i.read(4),r.duration=i.read(8)):(i.read(4),i.read(4),r.trackId=i.read(4),i.read(4),r.duration=i.read(4)),i.skip(16),r.matrix=[];for(var s=0;s<36;s++)r.matrix.push(i.read(1));i.back(36);for(var o=[],l=0,u;l<3;l++)o.push(Yr(i.readInt(2),i.readInt(2))),o.push(Yr(i.readInt(2),i.readInt(2))),u=i.readInt(4),o.push(Yr(u>>30,u&1073741823));r.rotation=Za(o),r.width=i.read(4),r.height=i.read(4)})}},{key:"mdia",value:function(t){return A(t,!1,function(r,e,i){r.mdhd=n.mdhd(n.findBox(e,["mdhd"],i)[0]),r.hdlr=n.hdlr(n.findBox(e,["hdlr"],i)[0]),r.minf=n.minf(n.findBox(e,["minf"],i)[0])})}},{key:"mdhd",value:function(t){return A(t,!0,function(r,e){var i=0;r.version===1?(r.timescale=F(e,16),r.duration=Lt(e,20),i+=28):(r.timescale=F(e,8),r.duration=F(e,12),i+=16);var s=de(e,i);r.language=String.fromCharCode((s>>10&31)+96,(s>>5&31)+96,(s&31)+96)})}},{key:"hdlr",value:function(t){return A(t,!0,function(r,e){r.version===0&&(r.handlerType=String.fromCharCode.apply(null,e.subarray(4,8)))})}},{key:"minf",value:function(t){return A(t,!1,function(r,e,i){r.vmhd=n.vmhd(n.findBox(e,["vmhd"],i)[0]),r.smhd=n.smhd(n.findBox(e,["smhd"],i)[0]),r.stbl=n.stbl(n.findBox(e,["stbl"],i)[0])})}},{key:"vmhd",value:function(t){return A(t,!0,function(r,e){r.graphicsmode=de(e),r.opcolor=[de(e,2),de(e,4),de(e,6)]})}},{key:"smhd",value:function(t){return A(t,!0,function(r,e){r.balance=de(e)})}},{key:"stbl",value:function(t){return A(t,!1,function(r,e,i){var s,o,l;r.stsd=n.stsd(n.findBox(e,["stsd"],i)[0]),r.stts=n.stts(n.findBox(e,["stts"],i)[0]),r.ctts=n.ctts(n.findBox(e,["ctts"],i)[0]),r.stsc=n.stsc(n.findBox(e,["stsc"],i)[0]),r.stsz=n.stsz(n.findBox(e,["stsz"],i)[0]),r.stco=n.stco(n.findBox(e,["stco"],i)[0]),r.stco||(r.co64=n.co64(n.findBox(e,["co64"],i)[0]),r.stco=r.co64);var u=(s=r.stsd.entries[0])===null||s===void 0||(o=s.sinf)===null||o===void 0||(l=o.schi)===null||l===void 0?void 0:l.tenc.default_IV_size;r.stss=n.stss(n.findBox(e,["stss"],i)[0]),r.senc=n.senc(n.findBox(e,["senc"],i)[0],u)})}},{key:"senc",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;return A(t,!0,function(e,i){var s=0,o=F(i,s);s+=4,e.samples=[];for(var l=0;l<o;l++){var u={};u.InitializationVector=[];for(var c=0;c<r;c++)u.InitializationVector[c]=i[s+c];if(s+=r,e.flags&2){u.subsamples=[];var d=de(i,s);s+=2;for(var h=0;h<d;h++){var p={};p.BytesOfClearData=de(i,s),s+=2,p.BytesOfProtectedData=F(i,s),s+=4,u.subsamples.push(p)}}e.samples.push(u)}})}},{key:"pssh",value:function(t){return A(t,!0,function(r,e){for(var i=[],s=[],o=0,l=0;l<16;l++)s.push(Cr(e[o+l]));if(o+=16,r.version>0){var u=F(e,o);o+=4;for(var c=0;c<(""+u).length;c++)for(var d=0;d<16;d++){var h=e[o];o+=1,i.push(Cr(h))}}var p=F(e,o);r.data_size=p,o+=4,r.kid=i,r.system_id=s,r.buffer=e})}},{key:"stsd",value:function(t){return A(t,!0,function(r,e,i){r.entryCount=F(e),r.entries=n.findBox(e.subarray(4),[],i+4).map(function(s){switch(s.type){case"av01":return n.av01(s);case"avc1":case"avc2":case"avc3":case"avc4":return n.avc1(s);case"hvc1":case"hev1":return n.hvc1(s);case"mp4a":return n.mp4a(s);case"alaw":case"ulaw":return n.alaw(s);case"enca":return A(s,!1,function(o,l,u){o.channelCount=de(l,16),o.samplesize=de(l,18),o.sampleRate=F(l,24)/65536,l=l.subarray(28),o.sinf=n.sinf(n.findBox(l,["sinf"],u)[0]),o.esds=n.esds(n.findBox(l,["esds"],u)[0])});case"encv":return A(s,!1,function(o,l,u){o.width=de(l,24),o.height=de(l,26),o.horizresolution=F(l,28),o.vertresolution=F(l,32),l=l.subarray(78),o.sinf=n.sinf(n.findBox(l,["sinf"],u)[0]),o.avcC=n.avcC(n.findBox(l,["avcC"],u)[0]),o.hvcC=n.hvcC(n.findBox(l,["hvcC"],u)[0]),o.pasp=n.pasp(n.findBox(l,["pasp"],u)[0])})}}).filter(Boolean)})}},{key:"tenc",value:function(t){return A(t,!1,function(r,e){var i=6;r.default_IsEncrypted=e[i],i+=1,r.default_IV_size=e[i],i+=1,r.default_KID=[];for(var s=0;s<16;s++)r.default_KID.push(Cr(e[i])),i+=1})}},{key:"schi",value:function(t){return A(t,!1,function(r,e,i){r.tenc=n.tenc(n.findBox(e,["tenc"],i)[0])})}},{key:"sinf",value:function(t){return A(t,!1,function(r,e,i){r.schi=n.schi(n.findBox(e,["schi"],i)[0]),r.frma=n.frma(n.findBox(e,["frma"],i)[0])})}},{key:"frma",value:function(t){return A(t,!1,function(r,e){r.data_format="";for(var i=0;i<4;i++)r.data_format+=String.fromCharCode(e[i])})}},{key:"colr",value:function(t){return A(t,!1,function(r,e){var i=Er.fromUint8(e);r.data=t.data,r.colorType=i.readString(4),r.colorType==="nclx"?(r.colorPrimaries=i.read(2),r.transferCharacteristics=i.read(2),r.matrixCoefficients=i.read(2),r.fullRangeFlag=i.read(1)>>7):(r.colorType==="rICC"||r.colorType==="prof")&&(r.iccProfile=e.readToUint8())})}},{key:"av01",value:function(t){return A(t,!1,function(r,e,i){var s=_r(r,e),o=e.subarray(s);i+=s,r.av1C=n.av1C(n.findBox(o,["av1C"],i)[0]),r.colr=n.colr(n.findBox(o,["colr"],i)[0])})}},{key:"av1C",value:function(t){return A(t,!1,function(r,e){r.data=t.data;var i=Er.fromUint8(e),s=wa.fromByte(i,4);r.marker=s.read(1),r.version=s.read(7),r.seqProfile=s.read(3),r.seqLevelIdx0=s.read(5),r.seqTier0=s.read(1),r.highBitdepth=s.read(1),r.twelveBit=s.read(1),r.monochrome=s.read(1),r.chromaSubsamplingX=s.read(1),r.chromaSubsamplingY=s.read(1),r.chromaSamplePosition=s.read(2),r.reserved=s.read(3),r.initialPresentationDelayPresent=s.read(1),r.initialPresentationDelayPresent?r.initialPresentationDelayMinusOne=s.read(4):r.initialPresentationDelayMinusOne=0,r.configOBUs=i.readToUint8();var o;r.seqLevelIdx0===2&&r.highBitdepth===1?o=r.twelveBit===1?"12":"10":r.seqProfile<=2&&(o=r.highBitdepth===1?"10":"08"),r.codec=["av01",r.seqProfile,(r.seqLevelIdx0<10?"0"+r.seqLevelIdx0:r.seqLevelIdx0)+(r.seqTier0?"H":"M"),o].join(".")})}},{key:"avc1",value:function(t){return A(t,!1,function(r,e,i){var s=_r(r,e),o=e.subarray(s);i+=s,r.avcC=n.avcC(n.findBox(o,["avcC"],i)[0]),r.pasp=n.pasp(n.findBox(o,["pasp"],i)[0])})}},{key:"avcC",value:function(t){return A(t,!1,function(r,e){r.data=t.data,r.configurationVersion=e[0],r.AVCProfileIndication=e[1],r.profileCompatibility=e[2],r.AVCLevelIndication=e[3],r.codec=Dn([e[1],e[2],e[3]]),r.lengthSizeMinusOne=e[4]&3,r.spsLength=e[5]&31,r.sps=[];for(var i=6,s=0;s<r.spsLength;s++){var o=de(e,i);i+=2,r.sps.push(e.subarray(i,i+o)),i+=o}r.ppsLength=e[i],i+=1,r.pps=[];for(var l=0;l<r.ppsLength;l++){var u=de(e,i);i+=2,r.pps.push(e.subarray(i,i+=u)),i+=u}})}},{key:"hvc1",value:function(t){return A(t,!1,function(r,e,i){var s=_r(r,e),o=e.subarray(s);i+=s,r.hvcC=n.hvcC(n.findBox(o,["hvcC"],i)[0]),r.pasp=n.pasp(n.findBox(o,["pasp"],i)[0])})}},{key:"hvcC",value:function(t){return A(t,!1,function(r,e){r.data=t.data,r.codec="hev1.1.6.L93.B0",r.configurationVersion=e[0];var i=e[1];r.generalProfileSpace=i>>6,r.generalTierFlag=(i&32)>>5,r.generalProfileIdc=i&31,r.generalProfileCompatibility=F(e,2),r.generalConstraintIndicatorFlags=e.subarray(6,12),r.generalLevelIdc=e[12],r.avgFrameRate=de(e,19),r.numOfArrays=e[22],r.vps=[],r.sps=[],r.pps=[];for(var s=23,o=0,l=0,u=0,c=0;c<r.numOfArrays;c++){o=e[s]&63,l=de(e,s+1),s+=3;for(var d=[],h=0;h<l;h++)u=de(e,s),s+=2,d.push(e.subarray(s,s+u)),s+=u;if(o===32){var p;(p=r.vps).push.apply(p,d)}else if(o===33){var v;(v=r.sps).push.apply(v,d)}else if(o===34){var g;(g=r.pps).push.apply(g,d)}}})}},{key:"pasp",value:function(t){return A(t,!1,function(r,e){r.hSpacing=F(e),r.vSpacing=F(e,4)})}},{key:"mp4a",value:function(t){return A(t,!1,function(r,e,i){var s=zi(r,e);r.esds=n.esds(n.findBox(e.subarray(s),["esds"],i+s)[0])})}},{key:"esds",value:function(t){return A(t,!0,function(r,e){r.codec="mp4a.";for(var i=0,s=0,o=0,l=0;e.length;){for(i=0,l=e[i],s=e[i+1],i+=2;s&128;)o=(s&127)<<7,s=e[i],i+=1;if(o+=s&127,l===3)e=e.subarray(i+3);else if(l===4)r.codec+=(e[i].toString(16)+".").padStart(3,"0"),e=e.subarray(i+13);else if(l===5){var u=r.config=e.subarray(i,i+o),c=(u[0]&248)>>3;c===31&&u.length>=2&&(c=32+((u[0]&7)<<3)+((u[1]&224)>>5)),r.objectType=c,r.codec+=c.toString(16),r.codec[r.codec.length-1]==="."&&(r.codec=r.codec.substring(0,r.codec.length-1));return}else{r.codec[r.codec.length-1]==="."&&(r.codec=r.codec.substring(0,r.codec.length-1));return}}})}},{key:"alaw",value:function(t){return A(t,!1,function(r,e){zi(r,e)})}},{key:"stts",value:function(t){return A(t,!0,function(r,e){for(var i=F(e),s=[],o=4,l=0;l<i;l++)s.push({count:F(e,o),delta:F(e,o+4)}),o+=8;r.entryCount=i,r.entries=s})}},{key:"ctts",value:function(t){return A(t,!0,function(r,e){var i=F(e),s=[],o=4;if(r.version===1)for(var l=0;l<i;l++)s.push({count:F(e,o),offset:F(e,o+4)}),o+=8;else for(var u=0;u<i;u++)s.push({count:F(e,o),offset:-(~F(e,o+4)+1)}),o+=8;r.entryCount=i,r.entries=s})}},{key:"stsc",value:function(t){return A(t,!0,function(r,e){for(var i=F(e),s=[],o=4,l=0;l<i;l++)s.push({firstChunk:F(e,o),samplesPerChunk:F(e,o+4),sampleDescriptionIndex:F(e,o+8)}),o+=12;r.entryCount=i,r.entries=s})}},{key:"stsz",value:function(t){return A(t,!0,function(r,e){var i=F(e),s=F(e,4),o=[];if(!i)for(var l=8,u=0;u<s;u++)o.push(F(e,l)),l+=4;r.sampleSize=i,r.sampleCount=s,r.entrySizes=o})}},{key:"stco",value:function(t){return A(t,!0,function(r,e){for(var i=F(e),s=[],o=4,l=0;l<i;l++)s.push(F(e,o)),o+=4;r.entryCount=i,r.entries=s})}},{key:"co64",value:function(t){return A(t,!0,function(r,e){for(var i=F(e),s=[],o=4,l=0;l<i;l++)s.push(Lt(e,o)),o+=8;r.entryCount=i,r.entries=s})}},{key:"stss",value:function(t){return A(t,!0,function(r,e){for(var i=F(e),s=[],o=4,l=0;l<i;l++)s.push(F(e,o)),o+=4;r.entryCount=i,r.entries=s})}},{key:"moof",value:function(t){return A(t,!1,function(r,e,i){r.mfhd=n.mfhd(n.findBox(e,["mfhd"],i)[0]),r.traf=n.findBox(e,["traf"],i).map(function(s){return n.traf(s)})})}},{key:"mfhd",value:function(t){return A(t,!0,function(r,e){r.sequenceNumber=F(e)})}},{key:"traf",value:function(t){return A(t,!1,function(r,e,i){r.tfhd=n.tfhd(n.findBox(e,["tfhd"],i)[0]),r.tfdt=n.tfdt(n.findBox(e,["tfdt"],i)[0]),r.trun=n.trun(n.findBox(e,["trun"],i)[0])})}},{key:"trun",value:function(t){return A(t,!0,function(r,e){var i=r.version,s=r.flags,o=e.length,l=r.sampleCount=F(e),u=4;if(o>u&&s&1&&(r.dataOffset=-(~F(e,u)+1),u+=4),o>u&&s&4&&(r.firstSampleFlags=F(e,u),u+=4),r.samples=[],o>u)for(var c,d=0;d<l;d++)c={},s&256&&(c.duration=F(e,u),u+=4),s&512&&(c.size=F(e,u),u+=4),s&1024&&(c.flags=F(e,u),u+=4),s&2048&&(i?c.cts=-(~F(e,u+4)+1):c.cts=F(e,u),u+=4),r.samples.push(c)})}},{key:"tfdt",value:function(t){return A(t,!0,function(r,e){r.version===1?r.baseMediaDecodeTime=Lt(e):r.baseMediaDecodeTime=F(e)})}},{key:"probe",value:function(t){return!!n.findBox(t,["ftyp"])}},{key:"parseSampleFlags",value:function(t){return{isLeading:(t[0]&12)>>>2,dependsOn:t[0]&3,isDependedOn:(t[1]&192)>>>6,hasRedundancy:(t[1]&48)>>>4,paddingValue:(t[1]&14)>>>1,isNonSyncSample:t[1]&1,degradationPriority:t[2]<<8|t[3]}}},{key:"moovToTrack",value:function(t,r,e){var i,s,o=t.trak;if(!(!o||!o.length)){var l=o.find(function(Tr){var Zt,St;return((Zt=Tr.mdia)===null||Zt===void 0||(St=Zt.hdlr)===null||St===void 0?void 0:St.handlerType)==="vide"}),u=o.find(function(Tr){var Zt,St;return((Zt=Tr.mdia)===null||Zt===void 0||(St=Zt.hdlr)===null||St===void 0?void 0:St.handlerType)==="soun"});if(l&&r){var c,d,h,p,v,g,b,L=r,G=(c=l.tkhd)===null||c===void 0?void 0:c.trackId;G!=null&&(L.id=l.tkhd.trackId),L.tkhdDuration=l.tkhd.duration,L.mvhdDurtion=t.mvhd.duration,L.mvhdTimecale=t.mvhd.timescale,L.timescale=L.formatTimescale=l.mdia.mdhd.timescale,L.duration=l.mdia.mdhd.duration||L.mvhdDurtion/L.mvhdTimecale*L.timescale,L.rotation=l.tkhd.rotation,L.matrix=l.tkhd.matrix;var V=l.mdia.minf.stbl.stsd.entries[0];if(L.width=V.width,L.height=V.height,V.pasp&&(L.sarRatio=[V.pasp.hSpacing,V.pasp.vSpacing]),V.av1C)L.codecType=ot.AV1,L.codec=V.av1C.codec,L.av1C=V.av1C.data,L.colr=V.colr.data;else if(V.hvcC)L.codecType=ot.HEVC,L.codec=V.hvcC.codec,L.vps=V.hvcC.vps,L.sps=V.hvcC.sps,L.pps=V.hvcC.pps,L.hvcC=V.hvcC.data;else if(V.avcC)L.codec=V.avcC.codec,L.sps=V.avcC.sps,L.pps=V.avcC.pps;else throw new Error("unknown video stsd entry");if(L.present=!0,L.ext={},L.ext.stss=(d=l.mdia)===null||d===void 0||(h=d.minf)===null||h===void 0||(p=h.stbl)===null||p===void 0?void 0:p.stss,L.ext.ctts=(v=l.mdia)===null||v===void 0||(g=v.minf)===null||g===void 0||(b=g.stbl)===null||b===void 0?void 0:b.ctts,V&&V.type==="encv"){var W,S,T,k,w,M,I,D;L.isVideoEncryption=!0,V.default_KID=(W=V.sinf)===null||W===void 0||(S=W.schi)===null||S===void 0?void 0:S.tenc.default_KID,V.default_IsEncrypted=(T=V.sinf)===null||T===void 0||(k=T.schi)===null||k===void 0?void 0:k.tenc.default_IsEncrypted,V.default_IV_size=(w=V.sinf)===null||w===void 0||(M=w.schi)===null||M===void 0?void 0:M.tenc.default_IV_size,L.videoSenc=l.mdia.minf.stbl.senc&&l.mdia.minf.stbl.senc.samples,V.data_format=(I=V.sinf)===null||I===void 0||(D=I.frma)===null||D===void 0?void 0:D.data_format,L.useEME=t.useEME,L.kidValue=t.kidValue,L.pssh=t.pssh,L.encv=V}}if(u&&e){var f,m,y,X,Z,R,Y,N,_,K=e,j=(f=u.tkhd)===null||f===void 0?void 0:f.trackId;j!=null&&(K.id=u.tkhd.trackId),K.tkhdDuration=u.tkhd.duration,K.mvhdDurtion=t.mvhd.duration,K.mvhdTimecale=t.mvhd.timescale,K.timescale=K.formatTimescale=u.mdia.mdhd.timescale,K.duration=u.mdia.mdhd.duration||K.mvhdDurtion/K.mvhdTimecale*K.timescale;var H=u.mdia.minf.stbl.stsd.entries[0];switch(K.sampleSize=H.sampleSize,K.sampleRate=H.sampleRate,K.channelCount=H.channelCount,K.present=!0,H.type){case"alaw":K.codecType=K.codec=ye.G711PCMA,K.sampleRate=8e3;break;case"ulaw":K.codecType=K.codec=ye.G711PCMU,K.sampleRate=8e3;break;default:K.sampleDuration=Ae.getFrameDuration(K.sampleRate,K.timescale),K.sampleRateIndex=Ae.getRateIndexByRate(K.sampleRate),K.objectType=((i=H.esds)===null||i===void 0?void 0:i.objectType)||2,H.esds&&(K.config=Array.from(H.esds.config)),K.codec=((s=H.esds)===null||s===void 0?void 0:s.codec)||"mp4a.40.2";break}if(K.sampleDuration=Ae.getFrameDuration(K.sampleRate,K.timescale),K.objectType=((m=H.esds)===null||m===void 0?void 0:m.objectType)||2,H.esds&&(H.esds.config?K.config=Array.from(H.esds.config):console.warn("esds config is null")),K.codec=((y=H.esds)===null||y===void 0?void 0:y.codec)||"mp4a.40.2",K.sampleRateIndex=Ae.getRateIndexByRate(K.sampleRate),K.ext={},K.ext.stss=(X=u.mdia)===null||X===void 0||(Z=X.minf)===null||Z===void 0||(R=Z.stbl)===null||R===void 0?void 0:R.stss,K.ext.ctts=(Y=u.mdia)===null||Y===void 0||(N=Y.minf)===null||N===void 0||(_=N.stbl)===null||_===void 0?void 0:_.ctts,K.present=!0,H&&H.type==="enca"){var be,ge,Oe,me,pt,ae,lt,Be;K.isAudioEncryption=!0,H.data_format=(be=H.sinf)===null||be===void 0||(ge=be.frma)===null||ge===void 0?void 0:ge.data_format,H.default_KID=(Oe=H.sinf)===null||Oe===void 0||(me=Oe.schi)===null||me===void 0?void 0:me.tenc.default_KID,H.default_IsEncrypted=(pt=H.sinf)===null||pt===void 0||(ae=pt.schi)===null||ae===void 0?void 0:ae.tenc.default_IsEncrypted,H.default_IV_size=(lt=H.sinf)===null||lt===void 0||(Be=lt.schi)===null||Be===void 0?void 0:Be.tenc.default_IV_size,K.audioSenc=u.mdia.minf.stbl.senc&&u.mdia.minf.stbl.senc.samples,K.useEME=t.useEME,K.kidValue=t.kidValue,K.enca=H}}if(e&&(e.isVideoEncryption=r?r.isVideoEncryption:!1),r&&(r.isAudioEncryption=e?e.isAudioEncryption:!1),r!=null&&r.encv||e!=null&&e.enca){var ut,wr,Si=r==null||(ut=r.encv)===null||ut===void 0?void 0:ut.default_KID,Li=e==null||(wr=e.enca)===null||wr===void 0?void 0:wr.default_KID,Xi=Si||Li?(Si||Li).join(""):null;r&&(r.kid=Xi),e&&(e.kid=Xi)}return r&&(r.flags=3841),e&&(e.flags=1793),{videoTrack:r,audioTrack:e}}}},{key:"evaluateDefaultDuration",value:function(t,r,e){var i,s=r==null||(i=r.samples)===null||i===void 0?void 0:i.length;if(!s)return 1024;var o=1024*s/r.timescale;return o*t.timescale/e}},{key:"moofToSamples",value:function(t,r,e){var i={};return t.mfhd&&(r&&(r.sequenceNumber=t.mfhd.sequenceNumber),e&&(e.sequenceNumber=t.mfhd.sequenceNumber)),t.traf.forEach(function(s){var o=s.tfhd,l=s.tfdt,u=s.trun;if(!(!o||!u)){l&&(r&&r.id===o.trackId&&(r.baseMediaDecodeTime=l.baseMediaDecodeTime),e&&e.id===o.trackId&&(e.baseMediaDecodeTime=l.baseMediaDecodeTime));var c=o.defaultSampleSize||0,d=o.defaultSampleDuration||n.evaluateDefaultDuration(r,e,u.samples.length||u.sampleCount),h=u.dataOffset||0,p=0,v=-1;if(!u.samples.length&&u.sampleCount){i[o.trackId]=[];for(var g=0;g<u.sampleCount;g++)i[o.trackId].push({offset:h,dts:p,duration:d,size:c}),p+=d,h+=c}else i[o.trackId]=u.samples.map(function(b,L){return b={offset:h,dts:p,pts:p+(b.cts||0),duration:b.duration||d,size:b.size||c,gopId:v,keyframe:L===0||b.flags!==null&&b.flags!==void 0&&(b.flags&65536)>>>0!==65536},b.keyframe&&(v++,b.gopId=v),p+=b.duration,h+=b.size,b})}}),i}},{key:"moovToSamples",value:function(t){var r=t.trak;if(!(!r||!r.length)){var e=r.find(function(I){var D,f;return((D=I.mdia)===null||D===void 0||(f=D.hdlr)===null||f===void 0?void 0:f.handlerType)==="vide"}),i=r.find(function(I){var D,f;return((D=I.mdia)===null||D===void 0||(f=D.hdlr)===null||f===void 0?void 0:f.handlerType)==="soun"});if(!(!e&&!i)){var s,o;if(e){var l,u,c=(l=e.mdia)===null||l===void 0||(u=l.minf)===null||u===void 0?void 0:u.stbl;if(!c)return;var d=c.stts,h=c.stsc,p=c.stsz,v=c.stco,g=c.stss,b=c.ctts;if(!d||!h||!p||!v||!g)return;s=Ui(d,h,p,v,b,g)}if(i){var L,G,V,W=(L=i.mdia)===null||L===void 0||(G=L.minf)===null||G===void 0?void 0:G.stbl;if(!W)return;var S=(V=i.mdia.mdhd)===null||V===void 0?void 0:V.timescale,T=W.stts,k=W.stsc,w=W.stsz,M=W.stco;if(!S||!T||!k||!w||!M)return;o=Ui(T,k,w,M)}return{videoSamples:s,audioSamples:o}}}}}]),n}();function Ui(n,a,t,r,e,i){var s=[],o=e==null?void 0:e.entries,l=a.entries,u=r.entries,c=t.entrySizes,d=i==null?void 0:i.entries,h;d&&(h={},d.forEach(function(k){h[k-1]=!0}));var p;o&&(p=[],o.forEach(function(k){for(var w=k.count,M=k.offset,I=0;I<w;I++)p.push(M)}));var v,g=-1,b=0,L=0,G=0,V=0,W=0,S=l[0].samplesPerChunk,T=l[1]?l[1].firstChunk-1:1/0;return n.entries.forEach(function(k){for(var w=k.count,M=k.delta,I=0;I<w;I++)v={dts:b,duration:M,size:c[L]||t.sampleSize,offset:u[G]+W,index:L},d&&(v.keyframe=h[L],v.keyframe&&g++,v.gopId=g),p&&L<p.length&&(v.pts=v.dts+p[L]),s.push(v),b+=M,L++,L<S?W+=v.size:(G++,W=0,G>=T&&(V++,T=l[V+1]?l[V+1].firstChunk-1:1/0),S+=l[V].samplesPerChunk)}),s}function _r(n,a){return n.dataReferenceIndex=de(a,6),n.width=de(a,24),n.height=de(a,26),n.horizresolution=F(a,28),n.vertresolution=F(a,32),n.frameCount=de(a,40),n.depth=de(a,74),78}function zi(n,a){return n.dataReferenceIndex=de(a,6),n.channelCount=de(a,16),n.sampleSize=de(a,18),n.sampleRate=F(a,24)/65536,28}function A(n,a,t){if(n){if(n.size!==n.data.length)throw new Error("box ".concat(n.type," size !== data.length"));var r={start:n.start,size:n.size,headerSize:n.headerSize,type:n.type};return a&&(r.version=n.data[n.headerSize],r.flags=ya(n.data,n.headerSize+1),r.headerSize+=4),t(r,n.data.subarray(r.headerSize),r.start+r.headerSize),r}}var Ta=function(a,t,r){for(var e=String(r),i=t>>0,s=Math.ceil(i/e.length),o=[],l=String(a);s--;)o.push(e);return o.join("").substring(0,i-l.length)+l},Cr=function(){for(var a=[],t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];return r.forEach(function(i){a.push(Ta(Number(i).toString(16),2,0))}),a[0]},zn=function(){function n(a,t,r){oe(this,n),E(this,"__loadedMoofWraps",[]),E(this,"__lastRemainData",null),E(this,"__lastRemainDataStart",0),E(this,"__nextMoofStart",-1),this.videoTrack=a||new gr,this.audioTrack=t||new Zr,this.metadataTrack=r||new Sr}return le(n,[{key:"demuxPart",value:function(t,r,e){var i=this,s=this.videoTrack,o=this.audioTrack,l=s.exist(),u=o.exist(),c=/av01/.test(s.codec);s.samples=[],o.samples=[];var d=t,h=r;if(this.__lastRemainData){var p=this.__lastRemainDataStart+this.__lastRemainData.byteLength,v=r<=p&&r>this.__lastRemainDataStart&&r+t.byteLength>p;if(v){var g=t.subarray(this.__lastRemainData.byteLength+this.__lastRemainDataStart-r);d=He(this.__lastRemainData,g),h=this.__lastRemainDataStart,this.__lastRemainData=null}else this.__lastRemainData=null,this.__lastRemainDataStart=0,this.__nextMoofStart=-1}if(!e){var b=Q.findBox(d,["moov"])[0];if(!b)throw new Error("cannot found moov box");e=Q.moov(b)}if(d){var L=h+d.byteLength;!l&&!u&&Q.moovToTrack(e,s,o);var G=[];this.__nextMoofStart<0?Q.findBox(d,["moof"],h).forEach(function(k){return G.push(k)}):this.__nextMoofStart>=h&&this.__nextMoofStart<=L-8&&Q.findBox(d.subarray(this.__nextMoofStart-h),["moof"],this.__nextMoofStart).forEach(function(k){return G.push(k)}),G.filter(function(k){return k.size<=k.data.length}).forEach(function(k){var w=Q.moof(k);i.__nextMoofStart=w.start+Math.max.apply(Math,Ye(w.traf.map(function(M){return M.trun.samples.reduce(function(I,D){return I+D.size},M.trun.dataOffset||0)}))),i.__loadedMoofWraps.push({start:w.start,nextMoofStart:i.__nextMoofStart,moof:w}),i.__loadedMoofWraps.sort(function(M,I){return M.start-I.start})});var V=oa(this.__loadedMoofWraps),W;try{var S=function(){var w=W.value;if(w.start>L||w.nextMoofStart<h)return"continue";var M=w.start,I=Q.moofToSamples(w.moof,s,o),D=s.baseMediaDecodeTime,f=o.baseMediaDecodeTime,m;Object.keys(I).forEach(function(y){s.id==y?I[y].some(function(X){var Z=X.offset+=M;if(!(Z<h)){if(Z+X.size>L)return!0;var R=new Pt((X.pts||X.dts)+D,X.dts+D);R.duration=X.duration,R.gopId=X.gopId,X.keyframe&&R.setToKeyframe();var Y=d.subarray(Z-h,Z-h+X.size);if(R.data=Y,!c)for(var N=0,_=Y.length-1;N<_;)m=F(Y,N),N+=4,R.units.push(Y.subarray(N,N+m)),N+=m;i.__lastRemainDataStart=Z+X.size,s.samples.push(R)}}):o.id==y&&I[y].some(function(X){var Z=X.offset+M;if(!(Z<h)){if(Z+X.size>L)return!0;var R=d.subarray(Z-h,Z-h+X.size);o.samples.push(new rt(X.dts+f,R,X.duration)),i.__lastRemainDataStart=Z+X.size}})})};for(V.s();!(W=V.n()).done;)var T=S()}catch(k){V.e(k)}finally{V.f()}}return this.__lastRemainDataStart>h&&this.__lastRemainDataStart<d.byteLength+h?this.__lastRemainData=d.subarray(this.__lastRemainDataStart-h):(this.__lastRemainData=d,this.__lastRemainDataStart=h),s.samples.length&&(s.baseMediaDecodeTime=s.samples[0].pts),o.samples.length&&(o.baseMediaDecodeTime=o.samples[0].pts),{videoTrack:s,audioTrack:o,metadataTrack:this.metadataTrack}}},{key:"demux",value:function(t,r){var e=this.videoTrack,i=this.audioTrack,s=e.exist(),o=i.exist();if(e.samples=[],i.samples=[],r){if(!o){var l=Q.findBox(r,["moov"])[0];if(!l)throw new Error("cannot found moov box");Q.moovToTrack(Q.moov(l),null,i)}var u=Q.findBox(r,["moof"])[0];if(u){var c=Q.moofToSamples(Q.moof(u),null,i)[i.id],d=i.baseMediaDecodeTime;if(c){var h=u.start;c.map(function(W){W.offset+=h;var S=r.subarray(W.offset,W.offset+W.size);i.samples.push(new rt(W.dts+d,S,W.duration))})}}}if(t){if(!s&&!o){var p=Q.findBox(t,["moov"])[0];if(!p)throw new Error("cannot found moov box");Q.moovToTrack(Q.moov(p),e,i)}var v=Q.findBox(t,["moof"])[0];if(v){var g=Q.moofToSamples(Q.moof(v),e,i),b=e.baseMediaDecodeTime,L=i.baseMediaDecodeTime,G=v.start,V;Object.keys(g).forEach(function(W){e.id==W?g[W].map(function(S){S.offset+=G;var T=new Pt((S.pts||S.dts)+b,S.dts+b);T.duration=S.duration,T.gopId=S.gopId,S.keyframe&&T.setToKeyframe();var k=t.subarray(S.offset,S.offset+S.size);T.data=k;for(var w=0,M=k.length-1;w<M;)V=F(k,w),w+=4,T.units.push(k.subarray(w,w+V)),w+=V;e.samples.push(T)}):i.id==W&&g[W].map(function(S){S.offset+=G;var T=t.subarray(S.offset,S.offset+S.size);i.samples.push(new rt(S.dts+L,T,S.duration))})})}}return{videoTrack:e,audioTrack:i,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(t){return Q.probe(t)}}]),n}();function Va(n){for(var a=0,t=arguments.length,r=new Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];r.forEach(function(o){a+=o.length});var i=new n(a),s=0;return r.forEach(function(o){i.set(o,s),s+=o.length}),i}var Xe=function(){function n(){oe(this,n),this.buffer=new Uint8Array(0)}return le(n,[{key:"write",value:function(){for(var t=this,r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];e.forEach(function(s){s?t.buffer=Va(Uint8Array,t.buffer,s):window.console.warn(s)})}}],[{key:"writeUint16",value:function(t){return new Uint8Array([t>>8&255,t&255])}},{key:"writeUint32",value:function(t){return new Uint8Array([t>>24,t>>16&255,t>>8&255,t&255])}}]),n}(),Ji=Math.pow(2,32)-1,ee=function(){function n(){oe(this,n)}return le(n,null,[{key:"box",value:function(t){for(var r=arguments.length,e=new Array(r>1?r-1:0),i=1;i<r;i++)e[i-1]=arguments[i];e=e.filter(Boolean);var s=8+e.reduce(function(u,c){return u+c.byteLength},0),o=new Uint8Array(s);o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=s&255,o.set(t,4);var l=8;return e.forEach(function(u){o.set(u,l),l+=u.byteLength}),o}},{key:"ftyp",value:function(t){var r=t.find(function(e){return e.type===bt.VIDEO&&e.codecType===ot.HEVC});return r?n.FTYPHEV1:n.FTYPAVC1}},{key:"initSegment",value:function(t){var r=n.ftyp(t),e=He(r,n.moov(t));return e}},{key:"pssh",value:function(t){var r=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],Di(t.kid),[0,0,0,0]));return n.box(n.types.pssh,r)}},{key:"moov",value:function(t){if(t[0].useEME&&(t[0].encv||t[0].enca)){t[0].pssh||(t[0].pssh={kid:t[0].kid});var r=this.pssh(t[0].pssh);return n.box.apply(n,[n.types.moov,n.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale),n.mvex(t)].concat(Ye(t.map(function(e){return n.trak(e)})),[r]))}else return n.box.apply(n,[n.types.moov,n.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale)].concat(Ye(t.map(function(e){return n.trak(e)})),[n.mvex(t)]))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,e=n.box(n.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,r&255,t>>24&255,t>>16&255,t>>8&255,t&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return e}},{key:"trak",value:function(t){var r=n.box(n.types.trak,n.tkhd(t.id,t.tkhdDuration||0,t.width,t.height),n.mdia(t));return r}},{key:"tkhd",value:function(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=n.box(n.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,e&255,0,0,i>>8&255,i&255,0,0]));return s}},{key:"mdia",value:function(t){var r=n.box(n.types.mdia,n.mdhd(t.duration,t.timescale),n.hdlr(t.type),n.minf(t));return r}},{key:"mdhd",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,e=n.box(n.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,r&255,t>>24&255,t>>16&255,t>>8&255,t&255,85,196,0,0]));return e}},{key:"hdlr",value:function(t){var r=n.box(n.types.hdlr,n.HDLR_TYPES[t]);return r}},{key:"minf",value:function(t){var r=n.box(n.types.minf,t.type===bt.VIDEO?n.VMHD:n.SMHD,n.DINF,n.stbl(t));return r}},{key:"stbl",value:function(t){var r=[];t&&t.ext&&t.ext.stss&&r.push(n.stss(t.ext.stss.entries));var e=n.box(n.types.stbl,n.stsd(t),n.STTS,r[0],n.STSC,n.STSZ,n.STCO);return e}},{key:"stsd",value:function(t){var r;t.type==="audio"?t.useEME&&t.enca?r=n.enca(t):t.codecType===ye.OPUS?r=n.opus(t):r=n.mp4a(t):t.useEME&&t.encv?r=n.encv(t):t.av1C?r=n.av01(t):r=n.avc1hev1(t);var e=n.box(n.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r);return e}},{key:"enca",value:function(t){var r=t.enca.channelCount,e=t.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,e>>8&255,e&255,0,0]),s=n.esds(t.config),o=n.sinf(t.enca);return n.box(n.types.enca,i,s,o)}},{key:"encv",value:function(t){var r,e,i=t.sps.length>0?t.sps[0]:[],s=t.pps.length>0?t.pps[0]:[],o=t.width,l=t.height,u=t.sarRatio[0],c=t.sarRatio[1],d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,o&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h=new Uint8Array((r=(e=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,i.length&255]).concat.apply(e,Ye(i)).concat([1,s.length>>>8&255,s.length&255])).concat.apply(r,Ye(s))),p=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),v=n.sinf(t.encv),g=new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,c>>24,c>>16&255,c>>8&255,c&255]);return n.box(n.types.encv,d,n.box(n.types.avcC,h),n.box(n.types.btrt,p),v,n.box(n.types.pasp,g))}},{key:"schi",value:function(t){var r=new Uint8Array([]),e=n.tenc(t);return n.box(n.types.schi,r,e)}},{key:"tenc",value:function(t){var r=new Uint8Array([0,0,0,0,0,0,t.default_IsEncrypted&255,t.default_IV_size&255].concat(Di(t.default_KID)));return n.box(n.types.tenc,r)}},{key:"sinf",value:function(t){var r=new Uint8Array([]),e=new Uint8Array([t.data_format.charCodeAt(0),t.data_format.charCodeAt(1),t.data_format.charCodeAt(2),t.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),s=n.schi(t);return n.box(n.types.sinf,r,n.box(n.types.frma,e),n.box(n.types.schm,i),s)}},{key:"av01",value:function(t){return n.box(n.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,t.width&255,t.height>>8&255,t.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),t.av1C,t.colr)}},{key:"avc1hev1",value:function(t){var r=t.codecType===ot.HEVC,e=r?n.types.hvc1:n.types.avc1,i=r?n.hvcC(t):n.avcC(t),s=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,t.width&255,t.height>>8&255,t.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return r?s.push(n.box(n.types.fiel,new Uint8Array([1,0]))):t.sarRatio&&t.sarRatio.length>1&&s.push(n.pasp(t.sarRatio)),n.box.apply(n,[e].concat(s))}},{key:"avcC",value:function(t){var r,e,i=[],s=[],o;return t.sps.forEach(function(l){o=l.byteLength,i.push(o>>>8&255),i.push(o&255),i.push.apply(i,Ye(l))}),t.pps.forEach(function(l){o=l.byteLength,s.push(o>>>8&255),s.push(o&255),s.push.apply(s,Ye(l))}),n.box(n.types.avcC,new Uint8Array((r=(e=[1,i[3],i[4],i[5],255,224|t.sps.length]).concat.apply(e,i).concat([t.pps.length])).concat.apply(r,s)))}},{key:"hvcC",value:function(t){var r=t.hvcC;if(r instanceof ArrayBuffer||r instanceof Uint8Array)return r;var e=t.vps,i=t.sps,s=t.pps,o;if(r){var l=r.generalProfileCompatibilityFlags,u=r.generalConstraintIndicatorFlags,c=(e.length&&1)+(i.length&&1)+(s.length&&1);o=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,l>>>24,l>>>16,l>>>8,l,u[0],u[1],u[2],u[3],u[4],u[5],r.generalLevelIdc,240,0,252,r.chromaFormatIdc|252,r.bitDepthLumaMinus8|248,r.bitDepthChromaMinus8|248,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,c];var d=function(p){var v;o.push(p.length>>8,p.length),(v=o).push.apply(v,Ye(p))};e.length&&(o.push(160,0,e.length),e.forEach(d)),i.length&&(o.push(161,0,i.length),i.forEach(d)),s.length&&(o.push(162,0,s.length),s.forEach(d))}else o=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return n.box(n.types.hvcC,new Uint8Array(o))}},{key:"pasp",value:function(t){var r=ta(t,2),e=r[0],i=r[1];return n.box(n.types.pasp,new Uint8Array([e>>24,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"mp4a",value:function(t){return n.box(n.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,t.sampleRate&255,0,0]),t.config.length?n.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length,e=n.box(n.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([r]).concat(t).concat([6,1,2])));return e}},{key:"opus",value:function(t){var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,t.sampleRate&255,0,0]),e=t.config.length?n.dOps(t):[];return n.box(n.types.Opus,r,e)}},{key:"dOps",value:function(t){if(t.config)return t.config[4]=t.sampleRate>>>24&255,t.config[5]=t.sampleRate>>>16&255,t.config[6]=t.sampleRate>>>8&255,t.config[7]=t.sampleRate&255,n.box(n.types.dOps,t.config)}},{key:"mvex",value:function(t){var r=n.box.apply(n,[n.types.mvex].concat(Ye(t.map(function(e){return n.trex(e.id)}))));return r}},{key:"trex",value:function(t){var r=n.box(n.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]));return r}},{key:"trex1",value:function(t){var r=n.box(n.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]));return r}},{key:"trex2",value:function(t){var r=n.box(n.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]));return r}},{key:"moof",value:function(t){var r=n.box.apply(n,[n.types.moof,n.mfhd(t[0].samples?t[0].samples[0].gopId:0)].concat(Ye(t.map(function(e){return n.traf(e)}))));return r}},{key:"mfhd",value:function(t){var r=n.box(n.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]));return r}},{key:"traf",value:function(t){var r=n.tfhd(t.id),e=n.tfdt(t,t.baseMediaDecodeTime),i=0,s;if(t.isVideo&&t.videoSenc&&(s=t.videoSenc,s.forEach(function(m){i=i+8,m.subsamples&&m.subsamples.length&&(i=i+2,i=i+m.subsamples.length*6)})),t.videoSencLength=i,!t.useEME||!t.isVideoEncryption&&!t.isAudioEncryption){var o=n.sdtp(t),l=76;return n.box(n.types.traf,r,e,o,n.trun(t.samples,o.byteLength+l))}else if(t.isVideoEncryption)if(t.isVideo){var u=n.saiz(t),c=n.saio(t),d=n.trun1(t),h=n.senc(t),p=n.box(n.types.traf,r,e,u,c,d,h);return p}else if(t.isAudioEncryption){var b=n.sbgp(),L=n.saiz(t),G=n.saio(t),V=n.senc(t),W=n.trun1(t),S=n.box(n.types.traf,r,e,b,L,G,V,W);return S}else{var v=n.sbgp(),g=n.trun1(t);return n.box(n.types.traf,r,e,v,g)}else if(t.isVideo){var T=n.trun1(t);return n.box(n.types.traf,r,e,T)}else{var k=n.sbgp(),w=n.saiz(t),M=n.saio(t),I=n.senc(t),D=n.trun1(t),f=n.box(n.types.traf,r,e,k,w,M,I,D);return f}}},{key:"sdtp",value:function(t){var r=new Xe;return t.samples.forEach(function(e){r.write(new Uint8Array(t.isVideo?[e.keyframe?32:16]:[16]))}),n.box(n.types.sdtp,this.extension(0,0),r.buffer)}},{key:"trun1",value:function(t){var r=new Xe,e=Xe.writeUint32(t.samples.length),i=null;if(t.isVideo){var s=t.videoSencLength;i=Xe.writeUint32(t.samples.length*16+s+149),!t.isVideoEncryption&&t.isAudioEncryption&&(i=Xe.writeUint32(t.samples.length*16+92))}else{var o=t.samples.length*12+124;t.isAudioEncryption&&(o=t.samples.length*12+8*t.audioSenc.length+177),i=Xe.writeUint32(o)}return t.samples.forEach(function(l){r.write(Xe.writeUint32(l.duration)),r.write(Xe.writeUint32(l.size)),r.write(Xe.writeUint32(l.keyframe?33554432:65536)),t.isVideo&&r.write(Xe.writeUint32(l.cts?l.cts:0))}),n.box(n.types.trun,this.extension(0,t.flags),e,i,r.buffer)}},{key:"senc",value:function(t){var r=new Xe,e=t.samples.length,i=t.isVideo?16:8,s=t.isVideo?2:0,o=[],l=0;return t.isVideo?(o=t.videoSenc,l=t.videoSencLength):o=t.audioSenc,l=l||i*e,r.write(Xe.writeUint32(16+l),n.types.senc,this.extension(0,s)),r.write(Xe.writeUint32(e)),o.forEach(function(u){for(var c=0;c<u.InitializationVector.length;c++)r.write(new Uint8Array([u.InitializationVector[c]]));u.subsamples&&u.subsamples.length&&(r.write(Xe.writeUint16(u.subsamples.length)),u.subsamples.forEach(function(d){r.write(Xe.writeUint16(d.BytesOfClearData)),r.write(Xe.writeUint32(d.BytesOfProtectedData))}))}),r.buffer}},{key:"saio",value:function(t){var r=t.samples.length*12+141;!t.isVideo&&t.isAudioEncryption&&(r=149);var e=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,r&255]);return n.box(n.types.saio,e)}},{key:"saiz",value:function(t){var r=t.samples.length,e=new Uint8Array([0,0,0,0,16,r>>24&255,r>>16&255,r>>8&255,r&255]);return n.box(n.types.saiz,e)}},{key:"sbgp",value:function(){var t=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return n.box(n.types.sbgp,this.extension(0,0),t)}},{key:"extension",value:function(t,r){return new Uint8Array([t,r>>16&255,r>>8&255,r&255])}},{key:"tfhd",value:function(t){return n.box(n.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}},{key:"tfdt",value:function(t,r){var e=Math.floor(r/(Ji+1)),i=Math.floor(r%(Ji+1));return t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)?n.box(n.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])):n.box(n.types.tfdt,new Uint8Array([1,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"trun",value:function(t,r){var e=t.length,i=12+16*e;r+=8+i;var s=new Uint8Array(i);s.set([0,0,15,1,e>>>24&255,e>>>16&255,e>>>8&255,e&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0);for(var o=0;o<e;o++){var l=t[o],u=l.duration,c=l.size,d=l.flag,h=d===void 0?{}:d,p=l.cts,v=p===void 0?0:p;s.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,h.isLeading<<2|(h.dependsOn===null||h.dependsOn===void 0?1:h.dependsOn),h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|(h.isNonSyncSample===null||h.isNonSyncSample===void 0?1:h.isNonSyncSample),h.degradationPriority&61440,h.degradationPriority&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*o)}return n.box(n.types.trun,s)}},{key:"moovMP4",value:function(t){return n.box.apply(n,[n.types.moov,n.mvhd(t[0].duration,t[0].timescale)].concat(Ye(t.map(function(r){return n.trackMP4(r)}))))}},{key:"trackMP4",value:function(t){return n.box(n.types.trak,n.tkhd(t.id,t.duration,t.width,t.height),n.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return n.box(n.types.mdia,n.mdhd(t.duration,t.timescale),n.hdlr(t.type),n.minfMP4(t))}},{key:"minfMP4",value:function(t){return n.box(n.types.minf,t.type===bt.VIDEO?n.VMHD:n.SMHD,n.DINF,n.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,e=[n.stsd(t),n.stts(r.stts),n.stsc(r.stsc),n.stsz(r.stsz),n.stco(r.stco)];return r.stss.length&&e.push(n.stss(r.stss)),r.ctts.length&&e.push(n.ctts(r.ctts)),n.box.apply(n,[n.types.stbl].concat(e))}},{key:"stts",value:function(t){var r=t.length,e=new Uint8Array(8*r),i=0;return t.forEach(function(s){var o=s.value,l=s.count;e.set([l>>24,l>>16&255,l>>8&255,l&255,o>>24,o>>16&255,o>>8&255,o&255],i),i+=8}),n.box(n.types.stts,He(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]),e))}},{key:"stsc",value:function(t){var r=t.length,e=new Uint8Array(12*r),i=0;return t.forEach(function(s){var o=s.firstChunk,l=s.samplesPerChunk,u=s.sampleDescIndex;e.set([o>>24,o>>16&255,o>>8&255,o&255,l>>24,l>>16&255,l>>8&255,l&255,u>>24,u>>16&255,u>>8&255,u&255],i),i+=12}),n.box(n.types.stsc,He(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]),e))}},{key:"stsz",value:function(t){var r=t.length,e=new Uint8Array(4*r),i=0;return t.forEach(function(s){e.set([s>>24,s>>16&255,s>>8&255,s&255],i),i+=4}),n.box(n.types.stsz,He(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]),e))}},{key:"stco",value:function(t){var r=t.length,e=new Uint8Array(4*r),i=0;return t.forEach(function(s){e.set([s>>24,s>>16&255,s>>8&255,s&255],i),i+=4}),n.box(n.types.stco,He(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]),e))}},{key:"stss",value:function(t){var r=t.length,e=new Uint8Array(4*r),i=0;return t.forEach(function(s){e.set([s>>24,s>>16&255,s>>8&255,s&255],i),i+=4}),n.box(n.types.stss,He(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]),e))}},{key:"ctts",value:function(t){var r=t.length,e=new Uint8Array(8*r),i=0;return t.forEach(function(s){var o=s.value,l=s.count;e.set([l>>24,l>>16&255,l>>8&255,l&255,o>>24,o>>16&255,o>>8&255,o&255],i),i+=8}),n.box(n.types.ctts,He(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]),e))}},{key:"styp",value:function(){return n.box(n.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(t){var r=t.timescale,e=t.samples[0].duration,i=e*t.samples.length,s=t.samples[0].sampleOffset*e,o=8;t.samples.forEach(function(h){o+=h.size});var l=0;if(t.isVideo){var u=0,c;t.videoSenc&&(c=t.videoSenc),t.isVideo&&c.forEach(function(h){u=u+8,h.subsamples&&h.subsamples.length&&(u=u+2,u=u+h.subsamples.length*6)}),t.videoSencLength=u,l=o+141+t.samples.length*16+u,t.useEME&&t.isAudioEncryption&&!t.isVideoEncryption&&(l=o+t.samples.length*16+84)}else l=o+116+t.samples.length*12,t.useEME&&t.isAudioEncryption&&(l=o+169+t.samples.length*12+8*t.audioSenc.length);var d=new Uint8Array([0,0,0,0,0,0,0,t.id&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255,0,0,0,0,0,0,0,1,0,l>>16&255,l>>8&255,l&255,i>>24&255,i>>16&255,i>>8&255,i&255,144,0,0,0]);return n.box(n.types.sidx,d)}},{key:"mdat",value:function(t){var r=n.box(n.types.mdat,t);return r}}]),n}();E(ee,"types",["Opus","dOps","av01","av1C","avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce(function(n,a){return n[a]=[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)],n},Object.create(null)));E(ee,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])});E(ee,"FTYPAVC1",ee.box(ee.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])));E(ee,"FTYPHEV1",ee.box(ee.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49])));E(ee,"DINF",ee.box(ee.types.dinf,ee.box(ee.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]))));E(ee,"VMHD",ee.box(ee.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])));E(ee,"SMHD",ee.box(ee.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0])));E(ee,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0]));E(ee,"STTS",ee.box(ee.types.stts,ee.StblTable));E(ee,"STSC",ee.box(ee.types.stsc,ee.StblTable));E(ee,"STSZ",ee.box(ee.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0])));E(ee,"STCO",ee.box(ee.types.stco,ee.StblTable));var mi=function(){function n(a,t){oe(this,n),this.name=a||"",this._prefix="[".concat(this.name,"]"),n.disabled=t}return le(n,[{key:"debug",value:function(){var t;if(!n.disabled){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(e))}}},{key:"log",value:function(){var t;if(!n.disabled){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(e))}}},{key:"warn",value:function(){var t;if(!n.disabled){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(e))}}},{key:"error",value:function(){var t;if(!n.disabled){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(e))}}},{key:"table",value:function(){var t;n.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){n.disabled=!1}},{key:"disable",value:function(){n.disabled=!0}}]),n}();E(mi,"disabled",!0);var fi=function(){function n(a,t,r){oe(this,n),this.videoTrack=a,this.audioTrack=t;var e=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=e&&Number(e[1])<50,this.log=new mi("FMP4Remuxer",r&&r.openLog?!r.openLog:!0)}return le(n,[{key:"remux",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=this.videoTrack,i=this.audioTrack,s=e.exist(),o=i.exist(),l,u,c,d=[];t&&(r&&r.initMerge?(s&&d.push(this.videoTrack),o&&d.push(this.audioTrack),c=ee.initSegment(d)):(s&&(l=ee.initSegment([this.videoTrack])),o&&(u=ee.initSegment([this.audioTrack]))));var h,p;return s&&e.hasSample()&&(h=this._remuxVideo()),o&&i.hasSample()&&(p=this._remuxAudio()),e.samples=[],i.samples=[],{initSegment:c,videoInitSegment:l,audioInitSegment:u,videoSegment:h,audioSegment:p}}},{key:"_remuxVideo",value:function(){var t=this.videoTrack;this.forceFirstIDR&&(t.samples[0].flag={dependsOn:2,isNonSyncSample:0});var r=t.samples,e=/av01/.test(t.codec),i=0;e?r.forEach(function(V){i+=V.data.byteLength}):r.forEach(function(V){i+=V.units.reduce(function(W,S){return W+S.byteLength},0),i+=V.units.length*4});var s=new Uint8Array(i);if(e)for(var o=0,l=r.length,u=0,c;o<l;o++)c=r[o],s.set(c.data,u),c.size=c.data.byteLength,u+=c.size;else for(var d=new DataView(s.buffer),h=function(W,S){S=r[p];var T=0;S.units.forEach(function(k){d.setUint32(W,k.byteLength),W+=4,s.set(k,W),W+=k.byteLength,T+=4+k.byteLength}),S.size=T,g=W,b=S},p=0,v=r.length,g=0,b;p<v;p++)h(g,b);var L=ee.mdat(s),G=ee.moof([t]);return He(G,L)}},{key:"_remuxAudio",value:function(){var t=this.audioTrack,r=new Uint8Array(t.samples.reduce(function(s,o){return s+o.size},0));t.samples.reduce(function(s,o){return r.set(o.data,s),s+o.size},0);var e=ee.mdat(r),i=ee.moof([t]);return He(i,e)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),n}();class _e{static create(...a){return new this(...a)}mixIn(a){return Object.assign(this,a)}clone(){const a=new this.constructor;return Object.assign(a,this),a}}class Ce extends _e{constructor(a=[],t=a.length*4){super();let r=a;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),(r instanceof Int8Array||r instanceof Uint8ClampedArray||r instanceof Int16Array||r instanceof Uint16Array||r instanceof Int32Array||r instanceof Uint32Array||r instanceof Float32Array||r instanceof Float64Array)&&(r=new Uint8Array(r.buffer,r.byteOffset,r.byteLength)),r instanceof Uint8Array){const e=r.byteLength,i=[];for(let s=0;s<e;s+=1)i[s>>>2]|=r[s]<<24-s%4*8;this.words=i,this.sigBytes=e}else this.words=a,this.sigBytes=t}static random(a){const t=[],r=e=>{let i=e,s=987654321;const o=4294967295;return()=>{s=36969*(s&65535)+(s>>16)&o,i=18e3*(i&65535)+(i>>16)&o;let l=(s<<16)+i&o;return l/=4294967296,l+=.5,l*(Math.random()>.5?1:-1)}};for(let e=0,i;e<a;e+=4){const s=r((i||Math.random())*4294967296);i=s()*987654071,t.push(s()*4294967296|0)}return new Ce(t,a)}toString(a=qr){return a.stringify(this)}concat(a){const t=this.words,r=a.words,e=this.sigBytes,i=a.sigBytes;if(this.clamp(),e%4)for(let s=0;s<i;s+=1){const o=r[s>>>2]>>>24-s%4*8&255;t[e+s>>>2]|=o<<24-(e+s)%4*8}else for(let s=0;s<i;s+=4)t[e+s>>>2]=r[s>>>2];return this.sigBytes+=i,this}clamp(){const{words:a,sigBytes:t}=this;a[t>>>2]&=4294967295<<32-t%4*8,a.length=Math.ceil(t/4)}clone(){const a=super.clone.call(this);return a.words=this.words.slice(0),a}}const qr={stringify(n){const{words:a,sigBytes:t}=n,r=[];for(let e=0;e<t;e+=1){const i=a[e>>>2]>>>24-e%4*8&255;r.push((i>>>4).toString(16)),r.push((i&15).toString(16))}return r.join("")},parse(n){const a=n.length,t=[];for(let r=0;r<a;r+=2)t[r>>>3]|=parseInt(n.substr(r,2),16)<<24-r%8*4;return new Ce(t,a/2)}},Oi={stringify(n){const{words:a,sigBytes:t}=n,r=[];for(let e=0;e<t;e+=1){const i=a[e>>>2]>>>24-e%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse(n){const a=n.length,t=[];for(let r=0;r<a;r+=1)t[r>>>2]|=(n.charCodeAt(r)&255)<<24-r%4*8;return new Ce(t,a)}},Jn={stringify(n){try{return decodeURIComponent(escape(Oi.stringify(n)))}catch{throw new Error("Malformed UTF-8 data")}},parse(n){return Oi.parse(unescape(encodeURIComponent(n)))}};class On extends _e{constructor(){super(),this._minBufferSize=0}reset(){this._data=new Ce,this._nDataBytes=0}_append(a){let t=a;typeof t=="string"&&(t=Jn.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(a){let t;const{_data:r,blockSize:e}=this,i=r.words,s=r.sigBytes,o=e*4;let l=s/o;a?l=Math.ceil(l):l=Math.max((l|0)-this._minBufferSize,0);const u=l*e,c=Math.min(u*4,s);if(u){for(let d=0;d<u;d+=e)this._doProcessBlock(i,d);t=i.splice(0,u),r.sigBytes-=c}return new Ce(t,c)}clone(){const a=super.clone.call(this);return a._data=this._data.clone(),a}}class ka extends On{constructor(a){super(),this.blockSize=512/32,this.cfg=Object.assign(new _e,a),this.reset()}static _createHelper(a){return(t,r)=>new a(r).finalize(t)}static _createHmacHelper(a){return(t,r)=>new Ra(a,r).finalize(t)}reset(){super.reset.call(this),this._doReset()}update(a){return this._append(a),this._process(),this}finalize(a){return a&&this._append(a),this._doFinalize()}}class Ra extends _e{constructor(a,t){super();const r=new a;this._hasher=r;let e=t;typeof e=="string"&&(e=Jn.parse(e));const i=r.blockSize,s=i*4;e.sigBytes>s&&(e=r.finalize(t)),e.clamp();const o=e.clone();this._oKey=o;const l=e.clone();this._iKey=l;const u=o.words,c=l.words;for(let d=0;d<i;d+=1)u[d]^=1549556828,c[d]^=909522486;o.sigBytes=s,l.sigBytes=s,this.reset()}reset(){const a=this._hasher;a.reset(),a.update(this._iKey)}update(a){return this._hasher.update(a),this}finalize(a){const t=this._hasher,r=t.finalize(a);return t.reset(),t.finalize(this._oKey.clone().concat(r))}}const xa=(n,a,t)=>{const r=[];let e=0;for(let i=0;i<a;i+=1)if(i%4){const s=t[n.charCodeAt(i-1)]<<i%4*2,o=t[n.charCodeAt(i)]>>>6-i%4*2,l=s|o;r[e>>>2]|=l<<24-e%4*8,e+=1}return Ce.create(r,e)},Bi={stringify(n){const{words:a,sigBytes:t}=n,r=this._map;n.clamp();const e=[];for(let s=0;s<t;s+=3){const o=a[s>>>2]>>>24-s%4*8&255,l=a[s+1>>>2]>>>24-(s+1)%4*8&255,u=a[s+2>>>2]>>>24-(s+2)%4*8&255,c=o<<16|l<<8|u;for(let d=0;d<4&&s+d*.75<t;d+=1)e.push(r.charAt(c>>>6*(3-d)&63))}const i=r.charAt(64);if(i)for(;e.length%4;)e.push(i);return e.join("")},parse(n){let a=n.length;const t=this._map;let r=this._reverseMap;if(!r){this._reverseMap=[],r=this._reverseMap;for(let i=0;i<t.length;i+=1)r[t.charCodeAt(i)]=i}const e=t.charAt(64);if(e){const i=n.indexOf(e);i!==-1&&(a=i)}return xa(n,a,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},J=[];for(let n=0;n<64;n+=1)J[n]=Math.abs(Math.sin(n+1))*4294967296|0;const we=(n,a,t,r,e,i,s)=>{const o=n+(a&t|~a&r)+e+s;return(o<<i|o>>>32-i)+a},Te=(n,a,t,r,e,i,s)=>{const o=n+(a&r|t&~r)+e+s;return(o<<i|o>>>32-i)+a},Ve=(n,a,t,r,e,i,s)=>{const o=n+(a^t^r)+e+s;return(o<<i|o>>>32-i)+a},ke=(n,a,t,r,e,i,s)=>{const o=n+(t^(a|~r))+e+s;return(o<<i|o>>>32-i)+a};class Ya extends ka{_doReset(){this._hash=new Ce([1732584193,4023233417,2562383102,271733878])}_doProcessBlock(a,t){const r=a;for(let M=0;M<16;M+=1){const I=t+M,D=a[I];r[I]=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360}const e=this._hash.words,i=r[t+0],s=r[t+1],o=r[t+2],l=r[t+3],u=r[t+4],c=r[t+5],d=r[t+6],h=r[t+7],p=r[t+8],v=r[t+9],g=r[t+10],b=r[t+11],L=r[t+12],G=r[t+13],V=r[t+14],W=r[t+15];let S=e[0],T=e[1],k=e[2],w=e[3];S=we(S,T,k,w,i,7,J[0]),w=we(w,S,T,k,s,12,J[1]),k=we(k,w,S,T,o,17,J[2]),T=we(T,k,w,S,l,22,J[3]),S=we(S,T,k,w,u,7,J[4]),w=we(w,S,T,k,c,12,J[5]),k=we(k,w,S,T,d,17,J[6]),T=we(T,k,w,S,h,22,J[7]),S=we(S,T,k,w,p,7,J[8]),w=we(w,S,T,k,v,12,J[9]),k=we(k,w,S,T,g,17,J[10]),T=we(T,k,w,S,b,22,J[11]),S=we(S,T,k,w,L,7,J[12]),w=we(w,S,T,k,G,12,J[13]),k=we(k,w,S,T,V,17,J[14]),T=we(T,k,w,S,W,22,J[15]),S=Te(S,T,k,w,s,5,J[16]),w=Te(w,S,T,k,d,9,J[17]),k=Te(k,w,S,T,b,14,J[18]),T=Te(T,k,w,S,i,20,J[19]),S=Te(S,T,k,w,c,5,J[20]),w=Te(w,S,T,k,g,9,J[21]),k=Te(k,w,S,T,W,14,J[22]),T=Te(T,k,w,S,u,20,J[23]),S=Te(S,T,k,w,v,5,J[24]),w=Te(w,S,T,k,V,9,J[25]),k=Te(k,w,S,T,l,14,J[26]),T=Te(T,k,w,S,p,20,J[27]),S=Te(S,T,k,w,G,5,J[28]),w=Te(w,S,T,k,o,9,J[29]),k=Te(k,w,S,T,h,14,J[30]),T=Te(T,k,w,S,L,20,J[31]),S=Ve(S,T,k,w,c,4,J[32]),w=Ve(w,S,T,k,p,11,J[33]),k=Ve(k,w,S,T,b,16,J[34]),T=Ve(T,k,w,S,V,23,J[35]),S=Ve(S,T,k,w,s,4,J[36]),w=Ve(w,S,T,k,u,11,J[37]),k=Ve(k,w,S,T,h,16,J[38]),T=Ve(T,k,w,S,g,23,J[39]),S=Ve(S,T,k,w,G,4,J[40]),w=Ve(w,S,T,k,i,11,J[41]),k=Ve(k,w,S,T,l,16,J[42]),T=Ve(T,k,w,S,d,23,J[43]),S=Ve(S,T,k,w,v,4,J[44]),w=Ve(w,S,T,k,L,11,J[45]),k=Ve(k,w,S,T,W,16,J[46]),T=Ve(T,k,w,S,o,23,J[47]),S=ke(S,T,k,w,i,6,J[48]),w=ke(w,S,T,k,h,10,J[49]),k=ke(k,w,S,T,V,15,J[50]),T=ke(T,k,w,S,c,21,J[51]),S=ke(S,T,k,w,L,6,J[52]),w=ke(w,S,T,k,l,10,J[53]),k=ke(k,w,S,T,g,15,J[54]),T=ke(T,k,w,S,s,21,J[55]),S=ke(S,T,k,w,p,6,J[56]),w=ke(w,S,T,k,W,10,J[57]),k=ke(k,w,S,T,d,15,J[58]),T=ke(T,k,w,S,G,21,J[59]),S=ke(S,T,k,w,u,6,J[60]),w=ke(w,S,T,k,b,10,J[61]),k=ke(k,w,S,T,o,15,J[62]),T=ke(T,k,w,S,v,21,J[63]),e[0]=e[0]+S|0,e[1]=e[1]+T|0,e[2]=e[2]+k|0,e[3]=e[3]+w|0}_doFinalize(){const a=this._data,t=a.words,r=this._nDataBytes*8,e=a.sigBytes*8;t[e>>>5]|=128<<24-e%32;const i=Math.floor(r/4294967296),s=r;t[(e+64>>>9<<4)+15]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360,t[(e+64>>>9<<4)+14]=(s<<8|s>>>24)&16711935|(s<<24|s>>>8)&4278255360,a.sigBytes=(t.length+1)*4,this._process();const o=this._hash,l=o.words;for(let u=0;u<4;u+=1){const c=l[u];l[u]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360}return o}clone(){const a=super.clone.call(this);return a._hash=this._hash.clone(),a}}class Ma extends _e{constructor(a){super(),this.cfg=Object.assign(new _e,{keySize:128/32,hasher:Ya,iterations:1},a)}compute(a,t){let r;const{cfg:e}=this,i=e.hasher.create(),s=Ce.create(),o=s.words,{keySize:l,iterations:u}=e;for(;o.length<l;){r&&i.update(r),r=i.update(a).finalize(t),i.reset();for(let c=1;c<u;c+=1)r=i.finalize(r),i.reset();s.concat(r)}return s.sigBytes=l*4,s}}class er extends On{constructor(a,t,r){super(),this.cfg=Object.assign(new _e,r),this._xformMode=a,this._key=t,this.reset()}static createEncryptor(a,t){return this.create(this._ENC_XFORM_MODE,a,t)}static createDecryptor(a,t){return this.create(this._DEC_XFORM_MODE,a,t)}static _createHelper(a){const t=r=>typeof r=="string"?Qn:_t;return{encrypt(r,e,i){return t(e).encrypt(a,r,e,i)},decrypt(r,e,i){return t(e).decrypt(a,r,e,i)}}}reset(){super.reset.call(this),this._doReset()}process(a){return this._append(a),this._process()}finalize(a){return a&&this._append(a),this._doFinalize()}}er._ENC_XFORM_MODE=1;er._DEC_XFORM_MODE=2;er.keySize=128/32;er.ivSize=128/32;class Bn extends _e{constructor(a,t){super(),this._cipher=a,this._iv=t}static createEncryptor(a,t){return this.Encryptor.create(a,t)}static createDecryptor(a,t){return this.Decryptor.create(a,t)}}function An(n,a,t){const r=n;let e;const i=this._iv;i?(e=i,this._iv=void 0):e=this._prevBlock;for(let s=0;s<t;s+=1)r[a+s]^=e[s]}class Jt extends Bn{}Jt.Encryptor=class extends Jt{processBlock(n,a){const t=this._cipher,{blockSize:r}=t;An.call(this,n,a,r),t.encryptBlock(n,a),this._prevBlock=n.slice(a,a+r)}};Jt.Decryptor=class extends Jt{processBlock(n,a){const t=this._cipher,{blockSize:r}=t,e=n.slice(a,a+r);t.decryptBlock(n,a),An.call(this,n,a,r),this._prevBlock=e}};const Ia={pad(n,a){const t=a*4,r=t-n.sigBytes%t,e=r<<24|r<<16|r<<8|r,i=[];for(let o=0;o<r;o+=4)i.push(e);const s=Ce.create(i,r);n.concat(s)},unpad(n){const a=n,t=a.words[a.sigBytes-1>>>2]&255;a.sigBytes-=t}};class jn extends er{constructor(a,t,r){super(a,t,Object.assign({mode:Jt,padding:Ia},r)),this.blockSize=128/32}reset(){let a;super.reset.call(this);const{cfg:t}=this,{iv:r,mode:e}=t;this._xformMode===this.constructor._ENC_XFORM_MODE?a=e.createEncryptor:(a=e.createDecryptor,this._minBufferSize=1),this._mode=a.call(e,this,r&&r.words),this._mode.__creator=a}_doProcessBlock(a,t){this._mode.processBlock(a,t)}_doFinalize(){let a;const{padding:t}=this.cfg;return this._xformMode===this.constructor._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),a=this._process(!0)):(a=this._process(!0),t.unpad(a)),a}}class Xr extends _e{constructor(a){super(),this.mixIn(a)}toString(a){return(a||this.formatter).stringify(this)}}const Ea={stringify(n){let a;const{ciphertext:t,salt:r}=n;return r?a=Ce.create([1398893684,1701076831]).concat(r).concat(t):a=t,a.toString(Bi)},parse(n){let a;const t=Bi.parse(n),r=t.words;return r[0]===1398893684&&r[1]===1701076831&&(a=Ce.create(r.slice(2,4)),r.splice(0,4),t.sigBytes-=16),Xr.create({ciphertext:t,salt:a})}};class _t extends _e{static encrypt(a,t,r,e){const i=Object.assign(new _e,this.cfg,e),s=a.createEncryptor(r,i),o=s.finalize(t),l=s.cfg;return Xr.create({ciphertext:o,key:r,iv:l.iv,algorithm:a,mode:l.mode,padding:l.padding,blockSize:s.blockSize,formatter:i.format})}static decrypt(a,t,r,e){let i=t;const s=Object.assign(new _e,this.cfg,e);return i=this._parse(i,s.format),a.createDecryptor(r,s).finalize(i.ciphertext)}static _parse(a,t){return typeof a=="string"?t.parse(a,this):a}}_t.cfg=Object.assign(new _e,{format:Ea});const _a={execute(n,a,t,r){let e=r;e||(e=Ce.random(64/8));const i=Ma.create({keySize:a+t}).compute(n,e),s=Ce.create(i.words.slice(a),t*4);return i.sigBytes=a*4,Xr.create({key:i,iv:s,salt:e})}};class Qn extends _t{static encrypt(a,t,r,e){const i=Object.assign(new _e,this.cfg,e),s=i.kdf.execute(r,a.keySize,a.ivSize);i.iv=s.iv;const o=_t.encrypt.call(this,a,t,s.key,i);return o.mixIn(s),o}static decrypt(a,t,r,e){let i=t;const s=Object.assign(new _e,this.cfg,e);i=this._parse(i,s.format);const o=s.kdf.execute(r,a.keySize,a.ivSize,i.salt);return s.iv=o.iv,_t.decrypt.call(this,a,i,o.key,s)}}Qn.cfg=Object.assign(_t.cfg,{kdf:_a});const Ke=[],$n=[],qn=[],es=[],ts=[],rs=[],ei=[],ti=[],ri=[],ii=[],qe=[];for(let n=0;n<256;n+=1)n<128?qe[n]=n<<1:qe[n]=n<<1^283;let $e=0,ct=0;for(let n=0;n<256;n+=1){let a=ct^ct<<1^ct<<2^ct<<3^ct<<4;a=a>>>8^a&255^99,Ke[$e]=a,$n[a]=$e;const t=qe[$e],r=qe[t],e=qe[r];let i=qe[a]*257^a*16843008;qn[$e]=i<<24|i>>>8,es[$e]=i<<16|i>>>16,ts[$e]=i<<8|i>>>24,rs[$e]=i,i=e*16843009^r*65537^t*257^$e*16843008,ei[a]=i<<24|i>>>8,ti[a]=i<<16|i>>>16,ri[a]=i<<8|i>>>24,ii[a]=i,$e?($e=t^qe[qe[qe[e^t]]],ct^=qe[qe[ct]]):(ct=1,$e=ct)}const Ca=[0,1,2,4,8,16,32,64,128,27,54];class is extends jn{_doReset(){let a;if(this._nRounds&&this._keyPriorReset===this._key)return;this._keyPriorReset=this._key;const t=this._keyPriorReset,r=t.words,e=t.sigBytes/4;this._nRounds=e+6;const s=(this._nRounds+1)*4;this._keySchedule=[];const o=this._keySchedule;for(let u=0;u<s;u+=1)u<e?o[u]=r[u]:(a=o[u-1],u%e?e>6&&u%e===4&&(a=Ke[a>>>24]<<24|Ke[a>>>16&255]<<16|Ke[a>>>8&255]<<8|Ke[a&255]):(a=a<<8|a>>>24,a=Ke[a>>>24]<<24|Ke[a>>>16&255]<<16|Ke[a>>>8&255]<<8|Ke[a&255],a^=Ca[u/e|0]<<24),o[u]=o[u-e]^a);this._invKeySchedule=[];const l=this._invKeySchedule;for(let u=0;u<s;u+=1){const c=s-u;u%4?a=o[c]:a=o[c-4],u<4||c<=4?l[u]=a:l[u]=ei[Ke[a>>>24]]^ti[Ke[a>>>16&255]]^ri[Ke[a>>>8&255]]^ii[Ke[a&255]]}}encryptBlock(a,t){this._doCryptBlock(a,t,this._keySchedule,qn,es,ts,rs,Ke)}decryptBlock(a,t){const r=a;let e=r[t+1];r[t+1]=r[t+3],r[t+3]=e,this._doCryptBlock(r,t,this._invKeySchedule,ei,ti,ri,ii,$n),e=r[t+1],r[t+1]=r[t+3],r[t+3]=e}_doCryptBlock(a,t,r,e,i,s,o,l){const u=a,c=this._nRounds;let d=u[t]^r[0],h=u[t+1]^r[1],p=u[t+2]^r[2],v=u[t+3]^r[3],g=4;for(let W=1;W<c;W+=1){const S=e[d>>>24]^i[h>>>16&255]^s[p>>>8&255]^o[v&255]^r[g];g+=1;const T=e[h>>>24]^i[p>>>16&255]^s[v>>>8&255]^o[d&255]^r[g];g+=1;const k=e[p>>>24]^i[v>>>16&255]^s[d>>>8&255]^o[h&255]^r[g];g+=1;const w=e[v>>>24]^i[d>>>16&255]^s[h>>>8&255]^o[p&255]^r[g];g+=1,d=S,h=T,p=k,v=w}const b=(l[d>>>24]<<24|l[h>>>16&255]<<16|l[p>>>8&255]<<8|l[v&255])^r[g];g+=1;const L=(l[h>>>24]<<24|l[p>>>16&255]<<16|l[v>>>8&255]<<8|l[d&255])^r[g];g+=1;const G=(l[p>>>24]<<24|l[v>>>16&255]<<16|l[d>>>8&255]<<8|l[h&255])^r[g];g+=1;const V=(l[v>>>24]<<24|l[d>>>16&255]<<16|l[h>>>8&255]<<8|l[p&255])^r[g];g+=1,u[t]=b,u[t+1]=L,u[t+2]=G,u[t+3]=V}}is.keySize=256/32;const Pa=jn._createHelper(is);class Ot extends Bn{}Ot.Encryptor=class extends Ot{processBlock(n,a){const t=n,r=this._cipher,{blockSize:e}=r,i=this._iv;let s=this._counter;i&&(this._counter=i.slice(0),s=this._counter,this._iv=void 0);const o=s.slice(0);r.encryptBlock(o,0),s[e-1]=s[e-1]+1|0;for(let l=0;l<e;l+=1)t[a+l]^=o[l]}};Ot.Decryptor=Ot.Encryptor;const Na={pad(){},unpad(){}};var hr={decryptWordArray:function(a,t,r){var e=qr.parse(t),i=qr.parse(ba(r)),s=Ce.create(new Uint8Array(a)),o=Pa.decrypt(Xr.create({ciphertext:s}),e,{iv:i,mode:Ot,padding:Na});return hr.wordArrayToUint8Array(o)},wordArrayToUint8Array:function(a){for(var t=a.sigBytes,r=a.words,e=new Uint8Array(t),i=0,s=0;i!==t;){var o=r[s++];if(e[i++]=(o&4278190080)>>>24,i===t||(e[i++]=(o&16711680)>>>16,i===t)||(e[i++]=(o&65280)>>>8,i===t))break;e[i++]=o&255}return e},decoderAESCTRData:function(a,t,r){if(a.videoSenc){var e=a.kidValue,i=a.videoSenc;a.samples.forEach(function(l,u){var c=i[u],d=l.data,h=[],p=[],v=c.InitializationVector;if(c.subsamples&&c.subsamples.length)c.subsamples.forEach(function(V){var W=V.BytesOfClearData+V.BytesOfProtectedData,S=d.slice(0,W);h.push(S.slice(0,V.BytesOfClearData)),p.push(S.slice(V.BytesOfClearData)),d=d.slice(W)});else{var g=l.size;h.push(d.slice(0,0)),p.push(d.slice(0,g)),d=d.slice(g)}var b=new Xe;b.write.apply(b,p);var L=r?r(b.buffer,e,v):hr.decryptWordArray(b.buffer,e,v),G=new Xe;h.forEach(function(V,W){var S=p[W].length,T=L.slice(0,S);G.write(V),G.write(T),L=L.slice(S)}),a.samples[u].data=G.buffer})}if(t.audioSenc){var s=t.kidValue,o=t.audioSenc;t.samples.forEach(function(l,u){var c=o[u],d=r?r(l.data,s,c.InitializationVector):hr.decryptWordArray(l.data,s,c.InitializationVector);t.samples[u].data=d})}}},Ai=20,Ka=function(){function n(a,t,r,e){var i=this;oe(this,n),E(this,"_videoSamples",[]),E(this,"_audioSamples",[]),E(this,"_lastRemainBuffer",[]),E(this,"_lastRemainBufferStartPos",0),this.videoTrack=new gr,this.audioTrack=new Zr,this.metadataTrack=r||new Sr,this.log=new mi("MP4Demuxer",e&&e.openLog?!e.openLog:!0),a&&a.forEach(function(s){var o;(o=i._videoSamples).push.apply(o,Ye(s.frames))}),t&&t.forEach(function(s){var o;(o=i._audioSamples).push.apply(o,Ye(s.frames))})}return le(n,[{key:"parseSamples",value:function(t){if(!t)throw new Error("moov is required");if(!this.videoTrack.codec&&!this.audioTrack.codec&&(Q.moovToTrack(t,this.videoTrack,this.audioTrack),this.videoSenc=this.videoTrack.videoSenc,this.audioSenc=this.audioTrack.audioSenc),!this._audioSamples.length&&!this._videoSamples.length){var r=Q.moovToSamples(t);if(!r)throw new Error("cannot parse samples from moov box");this._videoSamples=r.videoSamples||[],this._audioSamples=r.audioSamples||[]}}},{key:"demux",value:function(t,r,e,i,s){this.parseSamples(s);var o=this.videoTrack,l=this.audioTrack;o.samples=[],l.samples=[];var u,c,d;if(e){for(var h,p=0,v=e[0],g=e[1];v<=g;v++){if(u=this._videoSamples[v],!u)throw new Error("cannot found video frame #".concat(v));d=u.offset-r,c=t.subarray(d,d+u.size),h=new Pt(u.pts||u.dts,u.dts),h.duration=u.duration,h.gopId=u.gopId,u.keyframe&&h.setToKeyframe();for(var b=0,L=c.length-1;b<L;)p=F(c,b),b+=4,h.units.push(c.subarray(b,b+p)),b+=p;o.samples.push(h)}o.baseMediaDecodeTime=o.samples[0].dts}if(i){for(var G=i[0],V=i[1];G<=V;G++){if(u=this._audioSamples[G],!u)throw new Error("cannot found video frame #".concat(G));d=u.offset-r,c=t.subarray(d,d+u.size),l.samples.push(new rt(u.dts,c,u.duration))}l.baseMediaDecodeTime=l.samples[0].dts}return{videoTrack:o,audioTrack:l,metadataTrack:this.metadataTrack}}},{key:"demuxPart",value:function(t,r,e,i,s,o,l,u){if(this.parseSamples(s),this.videoTrack.useEME=o,this.audioTrack.useEME=o,this._lastRemainBuffer&&this._lastRemainBuffer.byteLength>0&&r>this._lastRemainBufferStartPos&&r<=this._lastRemainBufferStartPos+this._lastRemainBuffer.byteLength)for(var c=0;c<Ai;)try{var d=this._lastRemainBuffer.subarray(0,r-this._lastRemainBufferStartPos),h=new Uint8Array(t.byteLength+d.byteLength);h.set(d,0),h.set(new Uint8Array(t),d.byteLength),t=h,r-=d.byteLength,this._lastRemainBuffer=null,this._lastRemainBufferStartPos=0;break}catch(m){if(c<Ai)c++;else throw new Error("new Uint8Array error:,"+m.errorMessage)}var p=this.videoTrack,v=this.audioTrack;p.samples=[],v.samples=[],p.videoSenc=null,v.audioSenc=null;var g,b,L,G=0,V=0;if(this._videoSamples.length>0&&e.length>0){for(var W,S=t.byteLength+r,T=e[0];T<=e[1];T++){if(g=this._videoSamples[T],!g)throw new Error("cannot found video frame #".concat(T));g.offset>=r&&g.offset+g.size<=S&&(L=g.offset-r,G=L+g.size,b=t.subarray(L,G),W=new Pt(g.pts||g.dts,g.dts),W.duration=g.duration,W.gopId=g.gopId,W.sampleOffset=g.index,g.keyframe&&W.setToKeyframe(),W.data=b,W.size=g.size,p.samples.push(W))}p.samples.length>0&&(p.gopId=p.samples[0].gopId,p.baseMediaDecodeTime=p.samples[0].dts,p.startPts=p.samples[0].pts/p.timescale,p.endPts=p.samples[p.samples.length-1].pts/p.timescale,this.videoSenc&&(p.videoSenc=this.videoSenc.slice(p.samples[0].sampleOffset,p.samples[0].sampleOffset+p.samples.length),p.kidValue=l))}if(this._audioSamples.length>0&&i.length>0){for(var k=i[0];k<=i[1];k++){if(g=this._audioSamples[k],!g)throw new Error("cannot found video frame #".concat(k));g.offset>=r&&g.offset+g.size<=t.byteLength+r&&(L=g.offset-r,V=L+g.size,b=t.subarray(L,V),v.samples.push(new rt(g.dts,b,g.duration,g.index)))}v.samples.length>0&&(v.gopId=v.samples[0].gopId||p.gopId,v.baseMediaDecodeTime=v.samples[0].dts,v.startPts=v.samples[0].pts/v.timescale,v.endPts=v.samples[v.samples.length-1].pts/v.timescale,this.audioSenc&&(v.audioSenc=this.audioSenc.slice(v.samples[0].sampleOffset,v.samples[0].sampleOffset+v.samples.length),v.kidValue=l))}this.decoderData(p,v,u);for(var w=0,M=0;M<p.samples.length;M++)for(var I=0,D=p.samples[M].data,f=D.length-1;I<f;)w=F(D,I),I+=4,p.samples[M].units.push(D.subarray(I,I+w)),I+=w;return this._lastRemainBuffer=t.subarray(Math.max(G,V)),this._lastRemainBuffer.byteLength>0?this._lastRemainBufferStartPos=r+t.byteLength-this._lastRemainBuffer.byteLength:this._lastRemainBufferStartPos=0,{videoTrack:p,audioTrack:v,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this._videoSamples=[],this._audioSamples=[],this._lastRemainBuffer=null,this._lastRemainBufferStartPos=0,this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}},{key:"decoderData",value:function(t,r,e){t.useEME||r.useEME||hr.decoderAESCTRData(t,r,e)}}],[{key:"probe",value:function(t){return Q.probe(t)}}]),n}(),Da=function(){function n(){jt(this,n),O(this,"_ttfb",0),O(this,"_demuxStart",0),O(this,"_demuxEnd",0),O(this,"_demuxCost",0),O(this,"_remuxStart",0),O(this,"_remuxEnd",0),O(this,"_remuxCost",0),O(this,"_appendStart",0),O(this,"_appendEnd",0),O(this,"_appendCost",0)}return Qt(n,[{key:"set",value:function(t,r){this["_".concat(t)]=r}},{key:"start",value:function(t){this["_".concat(t,"Start")]=Date.now()}},{key:"end",value:function(t){this["_".concat(t,"End")]=Date.now(),this["_".concat(t,"Cost")]=this["_".concat(t,"Cost")]+(this["_".concat(t,"End")]-this["_".concat(t,"Start")])}},{key:"transferCost",get:function(){return{ttfbCost:this._ttfb,demuxCost:this._demuxCost,remuxCost:this._remuxCost,appendCost:this._appendCost}}}]),n}(),Xt={TTFB:"ttfb",DEMUX:"demux",REMUX:"remux",APPEND:"append"},dt=new Me("BufferService"),Ha=function(){function n(a,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};jt(this,n),O(this,"flv",null),O(this,"_demuxer",new Fn),O(this,"_remuxer",null),O(this,"_mse",null),O(this,"_softVideo",null),O(this,"_sourceCreated",!1),O(this,"_needInitSegment",!0),O(this,"_discontinuity",!0),O(this,"_contiguous",!1),O(this,"_initSegmentId",""),O(this,"_cachedBuffer",null),O(this,"_demuxStartTime",0),O(this,"_opts",null),this.flv=a,this._opts=r,t?this._softVideo=t:(this._remuxer=new fi(this._demuxer.videoTrack,this._demuxer.audioTrack),this._mse=new he(null,{preferMMS:typeof r.preferMMS=="boolean"?r.preferMMS:!!r.perferMMS}),this._mse.bindMedia(a.media))}return Qt(n,[{key:"baseDts",get:function(){var t,r;return(t=this._demuxer)===null||t===void 0||(r=t._fixer)===null||r===void 0?void 0:r._baseDts}},{key:"blobUrl",get:function(){var t;return(t=this._mse)===null||t===void 0?void 0:t.url}},{key:"isFull",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:he.VIDEO;return this._mse.isFull(t)}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!0,this._initSegmentId=""}},{key:"unContiguous",value:function(t){this._contiguous=!1,this._demuxStartTime=t}},{key:"reset",value:function(){var a=We(re().mark(function r(){var e,i=arguments;return re().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(e=i.length>0&&i[0]!==void 0?i[0]:!1,!(this._mse&&!e)){o.next=6;break}return o.next=4,this._mse.unbindMedia();case 4:return o.next=6,this._mse.bindMedia(this.flv.media);case 6:this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!1,this._sourceCreated=!1,this._initSegmentId="",this.resetSeamlessSwitchStats();case 12:case"end":return o.stop()}},r,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"resetSeamlessSwitchStats",value:function(){this.seamlessLoadingSwitch=null,this.seamlessLoadingSwitching=!1,this._demuxer&&(this._demuxer.seamlessLoadingSwitching=!1)}},{key:"endOfStream",value:function(){var a=We(re().mark(function r(){return re().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=7;break}if(!this._sourceCreated){i.next=5;break}return i.next=4,this._mse.endOfStream();case 4:this.flv.emit(P.BUFFEREOS);case 5:i.next=8;break;case 7:this._softVideo&&this._softVideo.endOfStream();case 8:case"end":return i.stop()}},r,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"updateDuration",value:function(){var a=We(re().mark(function r(e){return re().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!this._mse){s.next=7;break}if(this._mse.isOpened){s.next=4;break}return s.next=4,this._mse.open();case 4:return dt.debug("update duration",e),s.next=7,this._mse.updateDuration(e);case 7:case"end":return s.stop()}},r,this)}));function t(r){return a.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var a=We(re().mark(function r(){return re().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=3;break}return i.next=3,this._mse.unbindMedia();case 3:this._mse=null,this._softVideo=null,this._demuxer=null,this._remuxer=null;case 7:case"end":return i.stop()}},r,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"appendBuffer",value:function(){var a=We(re().mark(function r(e){var i=this,s,o,l,u,c,d,h,p,v,g,b,L,G,V,W,S,T;return re().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(s=!1,this._cachedBuffer&&(e=wt(this._cachedBuffer,e),this._cachedBuffer=null),o=this._demuxer,!(!e||!e.length||!o)){w.next=5;break}return w.abrupt("return");case 5:w.prev=5,this.flv._transferCost.start(Xt.DEMUX),o.demuxAndFix(e,this.seamlessLoadingSwitching||this._discontinuity,this._contiguous,this._demuxStartTime,this.seamlessLoadingSwitching),this.seamlessLoadingSwitching=!1,this.flv._transferCost.end(Xt.DEMUX),w.next=15;break;case 12:throw w.prev=12,w.t0=w.catch(5),new ce(U.DEMUX,U.SUB_TYPES.FLV,w.t0);case 15:if(l=o.videoTrack,u=o.audioTrack,c=o.metadataTrack,!this.seamlessLoadingSwitch){w.next=25;break}if(d=l.samples.findIndex(function(M){return M.originDts===l.lastKeyFrameDts}),!(d>=0)){w.next=25;break}return l.samples.splice(d),w.next=22,this.seamlessLoadingSwitch();case 22:this.seamlessLoadingSwitch=null,e=null,s=!0;case 25:if(h=l.exist(),p=u.exist(),this._opts.onlyAudio&&(h=!1,l.present=!1),this._opts.onlyVideo&&(p=!1,u.present=!1),!(!h&&l.present||!p&&u.present)){w.next=42;break}if(v=0,g=h?l:p?u:void 0,g&&g.samples.length&&(v=(g.samples[g.samples.length-1].originPts-g.samples[0].originPts)/g.timescale*1e3),!(v>this._opts.analyzeDuration)){w.next=40;break}dt.warn("analyze duration exceeded, ".concat(v,"ms"),g),l.present=h,u.present=p,this.flv.emit(P.ANALYZE_DURATION_EXCEEDED,{duration:v}),w.next=42;break;case 40:return this._cachedBuffer=e,w.abrupt("return");case 42:if(b=l.type,L=u.type,this._fireEvents(l,u,c),s||(this._discontinuity=!1,this._contiguous=!0,this._demuxStartTime=0),G=this._mse,V=function(){var I;if((I=i.flv)!==null&&I!==void 0&&I.emit){var D;(D=i.flv)===null||D===void 0||D.emit(P.APPEND_BUFFER,{})}},this.flv.emit(P.DEMUXED_TRACK,{videoTrack:l}),W="".concat(l.codec,"/").concat(l.width,"/").concat(l.height,"/").concat(u.codec,"/").concat(u.config),W!==this._initSegmentId&&(this._needInitSegment=!0,this._initSegmentId=W,this._emitMetaParsedEvent(l,u)),!G){w.next=81;break}if(this._sourceCreated){w.next=59;break}return w.next=55,G.open();case 55:h&&(dt.log("codec: video/mp4;codecs=".concat(l.codec)),G.createSource(b,"video/mp4;codecs=".concat(l.codec))),p&&(dt.log("codec: audio/mp4;codecs=".concat(u.codec)),G.createSource(L,"audio/mp4;codecs=".concat(u.codec))),this._sourceCreated=!0,this.flv.emit(P.SOURCEBUFFER_CREATED);case 59:w.prev=59,this._needInitSegment&&!this._opts.mseLowLatency&&(l.duration=this._opts.durationForMSELowLatencyOff*l.timescale,u.duration=this._opts.durationForMSELowLatencyOff*p.timescale),this.flv._transferCost.start(Xt.REMUX),S=this._remuxer.remux(this._needInitSegment),this.flv._transferCost.end(Xt.REMUX),w.next=69;break;case 66:throw w.prev=66,w.t1=w.catch(59),new ce(U.REMUX,U.SUB_TYPES.FMP4,w.t1);case 69:if(!(this._needInitSegment&&!S.videoInitSegment&&!S.audioInitSegment)){w.next=71;break}return w.abrupt("return");case 71:return this._needInitSegment=!1,T=[],S.videoInitSegment&&T.push(G.append(b,S.videoInitSegment)),S.audioInitSegment&&T.push(G.append(L,S.audioInitSegment)),S.videoSegment&&T.push(G.append(b,S.videoSegment)),S.audioSegment&&T.push(G.append(L,S.audioSegment)),this.flv._transferCost.start(Xt.APPEND),w.abrupt("return",Promise.all(T).then(V).then(function(){i.flv._transferCost.end(Xt.APPEND),V()}));case 81:this._softVideo&&(this._softVideo.appendBuffer(l,u),V());case 82:case"end":return w.stop()}},r,this,[[5,12],[59,66]])}));function t(r){return a.apply(this,arguments)}return t}()},{key:"evictBuffer",value:function(){var a=We(re().mark(function r(e){var i=this,s,o,l,u;return re().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(s=this.flv.media,!(!this._mse||!this._demuxer||!s||!e||e<0)){d.next=3;break}return d.abrupt("return");case 3:if(o=s.currentTime,l=o-e,!(l<=0)){d.next=7;break}return d.abrupt("return");case 7:if(u=fe.start(fe.get(s)),!(u+1>=l)){d.next=10;break}return d.abrupt("return");case 10:return d.abrupt("return",this._mse.clearBuffer(0,l).then(function(){return i.flv.emit(P.REMOVE_BUFFER,{removeEnd:l})}));case 11:case"end":return d.stop()}},r,this)}));function t(r){return a.apply(this,arguments)}return t}()},{key:"_emitMetaParsedEvent",value:function(t,r){t.exist()&&this.flv.emit(P.METADATA_PARSED,{type:"video",track:t,meta:{codec:t.codec,timescale:t.timescale,width:t.width,height:t.height,sarRatio:t.sarRatio,baseDts:t.baseDts}}),r.exist()&&this.flv.emit(P.METADATA_PARSED,{type:"audio",track:r,meta:{codec:r.codec,channelCount:r.channelCount,sampleRate:r.sampleRate,timescale:r.timescale,baseDts:r.baseDts}}),dt.debug("track parsed",t,r)}},{key:"_fireEvents",value:function(t,r,e){var i=this;dt.debug("videoTrack samples count: ".concat(t.samples.length,", audioTrack samples count: ").concat(r.samples.length)),e.flvScriptSamples.forEach(function(s){i.flv.emit(P.FLV_SCRIPT_DATA,s),dt.debug("flvScriptData",s)}),t.samples.forEach(function(s){s.keyframe&&i.flv.emit(P.KEYFRAME,{pts:s.originPts})}),t.warnings.forEach(function(s){var o;switch(s.type){case pe.LARGE_AV_SHIFT:o=P.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case pe.LARGE_VIDEO_GAP:o=P.LARGE_VIDEO_DTS_GAP_DETECT;break;case pe.LARGE_VIDEO_GAP_BETWEEN_CHUNK:o=P.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}o&&i.flv.emit(P.STREAM_EXCEPTION,Ee(Ee({},s),{},{type:o})),dt.warn("video exception",s)}),r.warnings.forEach(function(s){var o;switch(s.type){case pe.LARGE_AUDIO_GAP:o=P.LARGE_AUDIO_DTS_GAP_DETECT;break;case pe.AUDIO_FILLED:o=P.AUDIO_GAP_DETECT;break;case pe.AUDIO_DROPPED:o=P.AUDIO_OVERLAP_DETECT;break}o&&i.flv.emit(P.STREAM_EXCEPTION,Ee(Ee({},s),{},{type:o})),dt.warn("audio exception",s)}),e.seiSamples.forEach(function(s){i.flv.emit(P.SEI,Ee(Ee({},s),{},{sei:{code:s.data.type,content:s.data.payload,dts:s.pts}}))})}}]),n}();function Fa(n){var a=Ee({retryCount:3,retryDelay:1e3,disconnectRetryCount:0,loadTimeout:1e4,maxReaderInterval:5e3,preloadTime:5,defaultVodLoadSize:1e7,isLive:!1,softDecode:!1,bufferBehind:10,maxJumpDistance:3,analyzeDuration:2e4,seamlesslyReload:!1,keepStatusAfterSwitch:!0,onlyVideo:!1,onlyAudio:!1,preferMMS:!1,mseLowLatency:!0,durationForMSELowLatencyOff:6,chunkCountForSpeed:50,skipChunkSize:1e3,longtimeNoReceived:3e3,enableStartGapJump:!0},n);return a.isLive&&a.preloadTime&&(a.maxLatency||(a.maxLatency=a.preloadTime*2),a.targetLatency||(a.targetLatency=a.preloadTime),(a.disconnectTime===null||a.disconnectTime===void 0)&&(a.disconnectTime=a.maxLatency)),a}function ji(n,a){var t=0,r=n.length-1,e=0,i=0,s=r;for(a<n[0]&&(t=0,i=s+1);i<=s;)if(e=i+Math.floor((s-i)/2),e===r||a>=n[e]&&a<n[e+1]){t=e;break}else n[e]<a?i=e+1:s=e-1;return t}var nt=new Me("flv"),sr=.1,Ua=.3,Bt=function(n){Zn(t,n);var a=Sn(t);function t(r){var e;return jt(this,t),e=a.call(this),O($(e),"media",null),O($(e),"_loading",!1),O($(e),"_opts",null),O($(e),"_bufferService",null),O($(e),"_gapService",null),O($(e),"_stats",null),O($(e),"_mediaLoader",null),O($(e),"_maxChunkWaitTimer",null),O($(e),"_tickTimer",null),O($(e),"_tickInterval",500),O($(e),"_urlSwitching",!1),O($(e),"_seamlessSwitching",!1),O($(e),"_disconnectRetryCount",0),O($(e),"_preLoadEndPoint",0),O($(e),"_keyframes",null),O($(e),"_acceptRanges",!0),O($(e),"_onProgress",function(){var i=We(re().mark(function s(o,l,u,c){var d,h,p,v,g,b,L,G,V,W;return re().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(d=u.startTime,h=u.endTime,p=u.st,v=u.firstByteTime,e._loading=!l,e._firstProgressEmit){T.next=13;break}if(e.media){T.next=6;break}return(g=e._mediaLoader)===null||g===void 0||g.cancel(),T.abrupt("return");case 6:b=c.headers,L=p?v-p:h-d,e.emit(P.TTFB,{url:e._opts.url,responseUrl:c.url,elapsed:L}),e.emit(P.LOAD_RESPONSE_HEADERS,{headers:b}),e._transferCost.set(Xt.TTFB,L),e._acceptRanges=!!(b!=null&&b.get("Accept-Ranges"))||!!(b!=null&&b.get("Content-Range")),e._firstProgressEmit=!0;case 13:if(e._bufferService){T.next=15;break}return T.abrupt("return");case 15:return clearTimeout(e._maxChunkWaitTimer),e._bandwidthService.addChunkRecord(o==null?void 0:o.byteLength,h-d),T.prev=17,T.next=20,e._bufferService.appendBuffer(o);case 20:(G=e._bufferService)===null||G===void 0||G.evictBuffer(e._opts.bufferBehind),T.next=33;break;case 23:if(T.prev=23,T.t0=T.catch(17),!(!e.isLive&&e._bufferService.isFull())){T.next=32;break}return T.next=28,e._mediaLoader.cancel();case 28:return e._loading=!1,V=e.bufferInfo().remaining,e._opts.preloadTime=parseInt(V)/2,T.abrupt("return");case 32:return T.abrupt("return",e._emitError(ce.create(T.t0)));case 33:if(e._urlSwitching&&(e._urlSwitching=!1,e.emit(P.SWITCH_URL_SUCCESS,{url:e._opts.url})),e._seamlessSwitching&&(e._seamlessSwitching=!1,e._tick()),!(l&&!e.media.seeking)){T.next=40;break}return e.emit(P.LOAD_COMPLETE),nt.debug("load done"),e.isLive&&e._disconnectRetryCount<=0&&e._end(),T.abrupt("return");case 40:if(e.isLive){T.next=42;break}return T.abrupt("return");case 42:W=e._opts.maxReaderInterval,W&&e._firstProgressEmit&&(clearTimeout(e._maxChunkWaitTimer),e._maxChunkWaitTimer=setTimeout(function(){if(e._disconnectRetryCount){e._disconnectRetryCount--,e.load();return}nt.debug("onMaxChunkWait",W),e._end()},W));case 44:case"end":return T.stop()}},s,null,[[17,23]])}));return function(s,o,l,u){return i.apply(this,arguments)}}()),O($(e),"_onRetryError",function(i,s){nt.debug("load retry",i,s),e.emit(P.LOAD_RETRY,{error:ce.network(i),retryTime:s})}),O($(e),"_end",function(){e._clear(),e._bufferService&&e._bufferService.endOfStream(),nt.debug("end stream")}),O($(e),"_resetDisconnectCount",function(){e._disconnectRetryCount=e._opts.disconnectRetryCount}),O($(e),"_tick",function(){clearTimeout(e._tickTimer);var i=$(e),s=i.media;if(s){e._tickTimer=setTimeout(e._tick,e._tickInterval);var o=fe.end(fe.get(s));if(!(o<sr||!s.readyState)){var l=e._opts;if(kn(s)&&s.currentTime)e._gapService&&e._gapService.do(s,l.maxJumpDistance,e.isLive,3);else{if(!s.currentTime&&e._gapService&&l.enableStartGapJump){var u=e._opts.mseLowLatency||e._opts.mseLowLatency===!1&&e.bufferInfo(Ua).nextStart;u&&e._gapService.do(s,l.maxJumpDistance,e.isLive,3);return}l.isLive&&s.readyState===4&&o-s.currentTime>l.disconnectTime&&e.disconnect()}}}}),O($(e),"_onPlay",function(){var i,s,o=e._opts.softDecode||((i=e.media)===null||i===void 0||(s=i.buffered)===null||s===void 0?void 0:s.length);if(e.isLive){!e._loading&&o&&e.replay(void 0,!0);return}var l=e.bufferInfo();(l.start||l.nextStart)>sr&&e._tick()}),O($(e),"_onLoadeddata",function(){e.isLive&&!e._opts.mseLowLatency&&e.media.duration!==1/0&&e._bufferService.updateDuration(1/0).catch(function(i){})}),O($(e),"_onSeeking",We(re().mark(function i(){return re().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:!e.isLive&&e.seekable&&(e._preLoadEndPoint=-1,e._checkPreload());case 1:case"end":return o.stop()}},i)}))),O($(e),"_onTimeupdate",function(){if(e.media){var i=e._opts,s=e.media.currentTime;if(i.isLive&&i.maxLatency&&i.targetLatency){var o=fe.end(fe.get(e.media)),l=o-s;l>=i.maxLatency&&(e.media.currentTime=o-i.targetLatency,e.emit(P.CHASEFRAME,{currentTime:e.media.currentTime,latency:i.targetLatency}))}e._seiService.throw(s,!0),!(i.isLive||!e.seekable||e._loading)&&e._checkPreload()}}),O($(e),"_onWaiting",function(){e.isLive&&!e._loading&&e._disconnectRetryCount&&(e._disconnectRetryCount--,e.load())}),O($(e),"_onBufferUpdate",function(){if(!e._opts.isLive){var i=e.bufferInfo(),s=i.end,o=i.nextEnd;Math.abs((s||o)-e.media.duration)<1&&(e._end(),e.media.readyState<=2&&e._tick())}}),O($(e),"_checkPreload",We(re().mark(function i(){var s,o,l,u,c,d,h,p,v,g;return re().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(s=e.bufferInfo(),o=s.remaining,l=o===void 0?0:o,u=e._opts,c=e._keyframes.filepositions,d=e._keyframes.times,h=e.media.currentTime,!(l<u.preloadTime)){L.next=19;break}if(p=ji(e._keyframes.times,h+l+sr),v=ji(e._keyframes.times,h+l+e._opts.preloadTime),v===p&&(v=p+1),e._preLoadEndPoint!==v){L.next=11;break}return L.abrupt("return");case 11:if(g=c[p],g!=null){L.next=14;break}return L.abrupt("return");case 14:return L.next=16,e._mediaLoader.cancel();case 16:e._loadData(null,[g,c[v]]),e._preLoadEndPoint=v,e._bufferService.unContiguous(d[p]);case 19:case"end":return L.stop()}},i)}))),O($(e),"_onFlvScriptData",function(i){var s,o,l,u,c=(s=i.data)===null||s===void 0||(o=s.onMetaData)===null||o===void 0?void 0:o.keyframes,d=(l=i.data)===null||l===void 0||(u=l.onMetaData)===null||u===void 0?void 0:u.duration;c&&(e._keyframes=c),!e._opts.isLive&&d&&e._bufferService.updateDuration(d)}),e._opts=Fa(r),e.media=e._opts.media||document.createElement("video"),e._opts.media=null,e._firstProgressEmit=!1,e._mediaLoader=new yt(Ee(Ee({},e._opts.fetchOptions),{},{retry:e._opts.retryCount,retryDelay:e._opts.retryDelay,timeout:e._opts.loadTimeout,onRetryError:e._onRetryError,onProgress:e._onProgress,responseType:"arraybuffer"})),e._disconnectRetryCount=e._opts.disconnectRetryCount,e._transferCost=new Da,e._bufferService=new Ha($(e),e._opts.softDecode?e.media:void 0,e._opts),e._seiService=new Yn($(e)),e._bandwidthService=new Mn({chunkCountForSpeed:e._opts.chunkCountForSpeed,skipChunkSize:e._opts.skipChunkSize,longtimeNoReceived:e._opts.longtimeNoReceived}),e._stats=new In($(e)),e._opts.softDecode||(e._gapService=new xn),e.media.addEventListener("play",e._onPlay),e.media.addEventListener("loadeddata",e._onLoadeddata),e.media.addEventListener("seeking",e._onSeeking),e.media.addEventListener("timeupdate",e._onTimeupdate),e.media.addEventListener("progress",e._onBufferUpdate),e.media.addEventListener("waiting",e._onWaiting),e.on(P.FLV_SCRIPT_DATA,e._onFlvScriptData),e}return Qt(t,[{key:"version",get:function(){return"3.0.20"}},{key:"isLive",get:function(){return this._opts.isLive}},{key:"baseDts",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.baseDts}},{key:"seekable",get:function(){return!!this._keyframes&&this._acceptRanges}},{key:"loader",get:function(){return this._mediaLoader}},{key:"blobUrl",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.blobUrl}},{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed(),totalSize:this._bandwidthService.getTotalSize(),totalCost:this._bandwidthService.getTotalCost()}}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"bufferInfo",value:function(){var e,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:sr;return fe.info(fe.get(this.media),(e=this.media)===null||e===void 0?void 0:e.currentTime,i)}},{key:"playbackQuality",value:function(){return Rn(this.media)}},{key:"load",value:function(){var r=We(re().mark(function i(s){var o,l=arguments;return re().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(o=l.length>1&&l[1]!==void 0?l[1]:!1,this._bufferService){c.next=3;break}return c.abrupt("return");case 3:return c.next=5,this._reset(o);case 5:this._loadData(s,this._opts.isLive?[]:[0,this._opts.defaultVodLoadSize]),clearTimeout(this._tickTimer),this._tickTimer=setTimeout(this._tick,this._tickInterval);case 8:case"end":return c.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"replay",value:function(){var r=We(re().mark(function i(){var s=this,o,l,u=arguments;return re().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(o=u.length>0&&u[0]!==void 0?u[0]:this._opts.seamlesslyReload,l=u.length>1?u[1]:void 0,this.media){d.next=4;break}return d.abrupt("return");case 4:if(this._resetDisconnectCount(),!o){d.next=11;break}return d.next=8,this._clear();case 8:setTimeout(function(){s._seamlessSwitching=!0,s._loadData(s._opts.url),s._bufferService.seamlessSwitch()}),d.next=13;break;case 11:return d.next=13,this.load();case 13:return d.abrupt("return",this.media.play(!l).catch(function(){}));case 14:case"end":return d.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"disconnect",value:function(){var e;return nt.debug("disconnect!"),(e=this._bufferService)===null||e===void 0||e.resetSeamlessSwitchStats(),this._clear()}},{key:"switchURL",value:function(){var r=We(re().mark(function i(s,o){var l=this;return re().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this._bufferService){c.next=2;break}return c.abrupt("return");case 2:if(this._resetDisconnectCount(),!(this._loading&&o)){c.next=6;break}return this._bufferService.seamlessLoadingSwitch=function(){var d=We(re().mark(function h(p){return re().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,l._clear();case 2:l._bufferService.seamlessLoadingSwitching=!0,l._urlSwitching=!0,l._seamlessSwitching=!0,l._bufferService.seamlessSwitch(),l._loadData(s);case 7:case"end":return g.stop()}},h)}));return function(h){return d.apply(this,arguments)}}(),c.abrupt("return");case 6:if(!(!o||!this._opts.isLive)){c.next=11;break}return c.next=9,this.load(s);case 9:return this._urlSwitching=!0,c.abrupt("return",this.media.play(!0).catch(function(){}));case 11:return c.next=13,this._clear();case 13:setTimeout(function(){l._urlSwitching=!0,l._seamlessSwitching=!0,l._loadData(s),l._bufferService.seamlessSwitch()});case 14:case"end":return c.stop()}},i,this)}));function e(i,s){return r.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var r=We(re().mark(function i(){return re().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.media){o.next=2;break}return o.abrupt("return");case 2:return this.removeAllListeners(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("loadeddata",this._onLoadeddata),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),this.media.removeEventListener("waiting",this._onWaiting),this.media.removeEventListener("progress",this._onBufferUpdate),o.next=12,Promise.all([this._clear(),this._bufferService.destroy()]);case 12:this.media=null,this._bufferService=null;case 14:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_emitError",value:function(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;nt.table(e),nt.error(e),nt.error((i=this.media)===null||i===void 0?void 0:i.error),this._urlSwitching&&(this._urlSwitching=!1,this._seamlessSwitching=!1,this.emit(P.SWITCH_URL_FAILED,e)),this.emit(P.ERROR,e),s&&(this._seiService.reset(),this._end())}},{key:"_reset",value:function(){var r=We(re().mark(function i(){var s,o=arguments;return re().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return s=o.length>0&&o[0]!==void 0?o[0]:!1,this._seiService.reset(),this._bandwidthService.reset(),this._stats.reset(),u.next=6,this._clear();case 6:return u.next=8,this._bufferService.reset(s);case 8:case"end":return u.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_loadData",value:function(){var r=We(re().mark(function i(s,o){var l;return re().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s&&(this._opts.url=s),l=s=this._opts.url,s){c.next=4;break}throw new Error("Source url is missing");case 4:if(this._opts.preProcessUrl&&(l=this._opts.preProcessUrl(s).url),this._mediaLoader.finnalUrl=l,this.emit(P.LOAD_START,{url:l,seamlessSwitching:this._seamlessSwitching}),nt.debug("load data, loading:",this._loading,l),!this._loading){c.next=11;break}return c.next=11,this._mediaLoader.cancel();case 11:return this._loading=!0,c.prev=12,c.next=15,this._mediaLoader.load({url:l,range:o});case 15:c.next=21;break;case 17:return c.prev=17,c.t0=c.catch(12),this._loading=!1,c.abrupt("return",this._emitError(ce.network(c.t0),!1));case 21:case"end":return c.stop()}},i,this,[[12,17]])}));function e(i,s){return r.apply(this,arguments)}return e}()},{key:"_clear",value:function(){var r=We(re().mark(function i(){return re().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this._mediaLoader){o.next=3;break}return o.next=3,this._mediaLoader.cancel();case 3:clearTimeout(this._maxChunkWaitTimer),clearTimeout(this._tickTimer),this._loading=!1,this._firstProgressEmit=!1;case 7:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()}],[{key:"isSupported",value:function(e){return!e||e==="video"||e==="audio"?he.isSupported():typeof WebAssembly<"u"}},{key:"enableLogger",value:function(){Me.enable(),kt.enable()}},{key:"disableLogger",value:function(){Me.disable(),kt.disable()}}]),t}(gt);try{localStorage.getItem("xgd")?Bt.enableLogger():Bt.disableLogger()}catch{}var za=function(){function n(a,t){var r=this;jt(this,n),O(this,"_onLowDecode",function(){var e,i,s,o,l=r._opts,u=l.media,c=l.innerDegrade,d=l.backupURL;(e=r._plugin)===null||e===void 0||(i=e.player)===null||i===void 0||i.emit("lowdecode",u.degradeInfo),(s=r._plugin)===null||s===void 0||(o=s.player)===null||o===void 0||o.emit("core_event",Ee(Ee({},u.degradeInfo),{},{eventName:P.LOWDECODE})),(c===1||c===3)&&d&&r._degrade(d)}),O(this,"_degrade",function(e){var i=r._plugin.player,s=i.video;if((s==null?void 0:s.TAG)==="MVideo"){var o=i.video.degradeVideo;i.video=o,s.degrade(e),e&&(i.config.url=e);var l=i.root.firstChild;l.TAG==="MVideo"&&i.root.replaceChild(o,l);var u=r._plugin.constructor.pluginName.toLowerCase();i.unRegisterPlugin(u),i.once("canplay",function(){i.play()})}}),O(this,"forceDegradeToVideo",function(e){var i=r._opts.innerDegrade;(i===1||i===3)&&r._degrade(e)}),this._opts=a,this._plugin=t,this._init()}return Qt(n,[{key:"_init",value:function(){var t=this._opts,r=t.media,e=t.isLive,i=t.preloadTime,s=t.innerDegrade,o=t.decodeMode;if(r){if(!e&&r.setPlayMode){r.setPlayMode("VOD");return}s&&r.setAttribute("innerdegrade",s),i&&r.setAttribute("preloadtime",i),r.setDecodeMode&&r.setDecodeMode(o),this._bindEvents()}}},{key:"_bindEvents",value:function(){var t=this._opts.media;t.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var t,r;(t=this._opts)===null||t===void 0||(r=t.media)===null||r===void 0||r.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),n}(),Ja=function(n){Zn(t,n);var a=Sn(t);function t(){var r;jt(this,t);for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return r=a.call.apply(a,[this].concat(i)),O($(r),"logger",nt),O($(r),"flv",null),O($(r),"pluginExtension",null),O($(r),"getStats",function(){var o;return(o=r.flv)===null||o===void 0?void 0:o.getStats()}),O($(r),"destroy",function(){var o;r.flv&&(r.flv.destroy(),r.flv=null),(o=r.pluginExtension)===null||o===void 0||o.destroy(),r.pluginExtension=null}),O($(r),"_onSwitchURL",function(o,l){if(r.flv){var u,c;r.player.config.url=o,Fr(l)==="object"&&(l=l.seamless),r.flv.switchURL(o,l),!l&&(u=r.player.config)!==null&&u!==void 0&&(c=u.flv)!==null&&c!==void 0&&c.keepStatusAfterSwitch&&r._keepPauseStatus()}}),O($(r),"_keepPauseStatus",function(){var o=r.player.paused;o&&r.player.once("canplay",function(){r.player.pause()})}),O($(r),"_onDefinitionChange",function(o){var l=o.to;r.flv&&r.flv.switchURL(l)}),r}return Qt(t,[{key:"core",get:function(){return this.flv}},{key:"version",get:function(){var e;return(e=this.flv)===null||e===void 0?void 0:e.version}},{key:"softDecode",get:function(){var e,i,s=(e=this.player)===null||e===void 0||(i=e.config)===null||i===void 0?void 0:i.mediaType;return!!s&&s!=="video"&&s!=="audio"}},{key:"loader",get:function(){var e;return(e=this.flv)===null||e===void 0?void 0:e.loader}},{key:"transferCost",get:function(){return this.flv._transferCost.transferCost}},{key:"beforePlayerInit",value:function(){var e=this,i=this.player.config,s=this.player.media||this.player.video;if(i.url){this.flv&&this.flv.destroy(),this.player.switchURL=this._onSwitchURL;var o=i.flv||{};if((o.disconnectTime===null||o.disconnectTime===void 0)&&(o.disconnectTime=0),this.flv=new Bt(Ee({softDecode:this.softDecode,isLive:i.isLive,media:s,preProcessUrl:function(c,d){var h,p;return((h=e.player)===null||h===void 0||(p=h.preProcessUrl)===null||p===void 0?void 0:p.call(h,c,d))||{url:c,ext:d}}},o)),this.softDecode||Ct.defineGetterOrSetter(this.player,{url:{get:function(){var c;return(c=e.flv)===null||c===void 0?void 0:c.blobUrl},configurable:!0}}),this.softDecode&&(this.pluginExtension=new za(Ee({media:this.player.video,isLive:i.isLive},i.flv),this),this.player.forceDegradeToVideo=function(){for(var u,c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];return(u=e.pluginExtension)===null||u===void 0?void 0:u.forceDegradeToVideo.apply(u,d)}),i.isLive){var l;(l=this.player)===null||l===void 0||l.useHooks("replay",function(){var u;return(u=e.flv)===null||u===void 0?void 0:u.replay()})}this.on(Ht,this._onSwitchURL),this.on(bn,this.destroy),this._transError(),this._transCoreEvent(P.TTFB),this._transCoreEvent(P.LOAD_START),this._transCoreEvent(P.LOAD_RESPONSE_HEADERS),this._transCoreEvent(P.LOAD_COMPLETE),this._transCoreEvent(P.LOAD_RETRY),this._transCoreEvent(P.SOURCEBUFFER_CREATED),this._transCoreEvent(P.ANALYZE_DURATION_EXCEEDED),this._transCoreEvent(P.APPEND_BUFFER),this._transCoreEvent(P.REMOVE_BUFFER),this._transCoreEvent(P.BUFFEREOS),this._transCoreEvent(P.KEYFRAME),this._transCoreEvent(P.CHASEFRAME),this._transCoreEvent(P.METADATA_PARSED),this._transCoreEvent(P.SEI),this._transCoreEvent(P.SEI_IN_TIME),this._transCoreEvent(P.FLV_SCRIPT_DATA),this._transCoreEvent(P.STREAM_EXCEPTION),this._transCoreEvent(P.SWITCH_URL_SUCCESS),this._transCoreEvent(P.SWITCH_URL_FAILED),this.flv.load(i.url,!0)}}},{key:"_transError",value:function(){var e=this;this.flv.on(P.ERROR,function(i){e.player&&e.player.emit(gn,new Gt(e.player,i))})}},{key:"_transCoreEvent",value:function(e){var i=this;this.flv.on(e,function(s){i.player&&i.player.emit("core_event",Ee(Ee({},s),{},{eventName:e}))})}}],[{key:"pluginName",get:function(){return"flv"}},{key:"isSupported",value:function(e,i){return Bt.isSupported(e,i)}},{key:"isSupportedMMS",value:function(){return typeof ManagedMediaSource<"u"}}]),t}(Ct);O(Ja,"Flv",Bt);function Oa(n,a){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,e,i,s,o=[],l=!0,u=!1;try{if(i=(t=t.call(n)).next,a===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(r=i.call(t)).done)&&(o.push(r.value),o.length!==a);l=!0);}catch(c){u=!0,e=c}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(u)throw e}}return o}}function Qi(n,a){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,r)}return t}function se(n){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?Qi(Object(t),!0).forEach(function(r){x(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Qi(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function z(){z=function(){return n};var n={},a=Object.prototype,t=a.hasOwnProperty,r=Object.defineProperty||function(f,m,y){f[m]=y.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",s=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function l(f,m,y){return Object.defineProperty(f,m,{value:y,enumerable:!0,configurable:!0,writable:!0}),f[m]}try{l({},"")}catch{l=function(m,y,X){return m[y]=X}}function u(f,m,y,X){var Z=m&&m.prototype instanceof h?m:h,R=Object.create(Z.prototype),Y=new M(X||[]);return r(R,"_invoke",{value:S(f,y,Y)}),R}function c(f,m,y){try{return{type:"normal",arg:f.call(m,y)}}catch(X){return{type:"throw",arg:X}}}n.wrap=u;var d={};function h(){}function p(){}function v(){}var g={};l(g,i,function(){return this});var b=Object.getPrototypeOf,L=b&&b(b(I([])));L&&L!==a&&t.call(L,i)&&(g=L);var G=v.prototype=h.prototype=Object.create(g);function V(f){["next","throw","return"].forEach(function(m){l(f,m,function(y){return this._invoke(m,y)})})}function W(f,m){function y(Z,R,Y,N){var _=c(f[Z],f,R);if(_.type!=="throw"){var K=_.arg,j=K.value;return j&&typeof j=="object"&&t.call(j,"__await")?m.resolve(j.__await).then(function(H){y("next",H,Y,N)},function(H){y("throw",H,Y,N)}):m.resolve(j).then(function(H){K.value=H,Y(K)},function(H){return y("throw",H,Y,N)})}N(_.arg)}var X;r(this,"_invoke",{value:function(Z,R){function Y(){return new m(function(N,_){y(Z,R,N,_)})}return X=X?X.then(Y,Y):Y()}})}function S(f,m,y){var X="suspendedStart";return function(Z,R){if(X==="executing")throw new Error("Generator is already running");if(X==="completed"){if(Z==="throw")throw R;return D()}for(y.method=Z,y.arg=R;;){var Y=y.delegate;if(Y){var N=T(Y,y);if(N){if(N===d)continue;return N}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(X==="suspendedStart")throw X="completed",y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);X="executing";var _=c(f,m,y);if(_.type==="normal"){if(X=y.done?"completed":"suspendedYield",_.arg===d)continue;return{value:_.arg,done:y.done}}_.type==="throw"&&(X="completed",y.method="throw",y.arg=_.arg)}}}function T(f,m){var y=m.method,X=f.iterator[y];if(X===void 0)return m.delegate=null,y==="throw"&&f.iterator.return&&(m.method="return",m.arg=void 0,T(f,m),m.method==="throw")||y!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+y+"' method")),d;var Z=c(X,f.iterator,m.arg);if(Z.type==="throw")return m.method="throw",m.arg=Z.arg,m.delegate=null,d;var R=Z.arg;return R?R.done?(m[f.resultName]=R.value,m.next=f.nextLoc,m.method!=="return"&&(m.method="next",m.arg=void 0),m.delegate=null,d):R:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,d)}function k(f){var m={tryLoc:f[0]};1 in f&&(m.catchLoc=f[1]),2 in f&&(m.finallyLoc=f[2],m.afterLoc=f[3]),this.tryEntries.push(m)}function w(f){var m=f.completion||{};m.type="normal",delete m.arg,f.completion=m}function M(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(k,this),this.reset(!0)}function I(f){if(f){var m=f[i];if(m)return m.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var y=-1,X=function Z(){for(;++y<f.length;)if(t.call(f,y))return Z.value=f[y],Z.done=!1,Z;return Z.value=void 0,Z.done=!0,Z};return X.next=X}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=v,r(G,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=l(v,o,"GeneratorFunction"),n.isGeneratorFunction=function(f){var m=typeof f=="function"&&f.constructor;return!!m&&(m===p||(m.displayName||m.name)==="GeneratorFunction")},n.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,v):(f.__proto__=v,l(f,o,"GeneratorFunction")),f.prototype=Object.create(G),f},n.awrap=function(f){return{__await:f}},V(W.prototype),l(W.prototype,s,function(){return this}),n.AsyncIterator=W,n.async=function(f,m,y,X,Z){Z===void 0&&(Z=Promise);var R=new W(u(f,m,y,X),Z);return n.isGeneratorFunction(m)?R:R.next().then(function(Y){return Y.done?Y.value:R.next()})},V(G),l(G,o,"Generator"),l(G,i,function(){return this}),l(G,"toString",function(){return"[object Generator]"}),n.keys=function(f){var m=Object(f),y=[];for(var X in m)y.push(X);return y.reverse(),function Z(){for(;y.length;){var R=y.pop();if(R in m)return Z.value=R,Z.done=!1,Z}return Z.done=!0,Z}},n.values=I,M.prototype={constructor:M,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!f)for(var m in this)m.charAt(0)==="t"&&t.call(this,m)&&!isNaN(+m.slice(1))&&(this[m]=void 0)},stop:function(){this.done=!0;var f=this.tryEntries[0].completion;if(f.type==="throw")throw f.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var m=this;function y(_,K){return R.type="throw",R.arg=f,m.next=_,K&&(m.method="next",m.arg=void 0),!!K}for(var X=this.tryEntries.length-1;X>=0;--X){var Z=this.tryEntries[X],R=Z.completion;if(Z.tryLoc==="root")return y("end");if(Z.tryLoc<=this.prev){var Y=t.call(Z,"catchLoc"),N=t.call(Z,"finallyLoc");if(Y&&N){if(this.prev<Z.catchLoc)return y(Z.catchLoc,!0);if(this.prev<Z.finallyLoc)return y(Z.finallyLoc)}else if(Y){if(this.prev<Z.catchLoc)return y(Z.catchLoc,!0)}else{if(!N)throw new Error("try statement without catch or finally");if(this.prev<Z.finallyLoc)return y(Z.finallyLoc)}}}},abrupt:function(f,m){for(var y=this.tryEntries.length-1;y>=0;--y){var X=this.tryEntries[y];if(X.tryLoc<=this.prev&&t.call(X,"finallyLoc")&&this.prev<X.finallyLoc){var Z=X;break}}Z&&(f==="break"||f==="continue")&&Z.tryLoc<=m&&m<=Z.finallyLoc&&(Z=null);var R=Z?Z.completion:{};return R.type=f,R.arg=m,Z?(this.method="next",this.next=Z.finallyLoc,d):this.complete(R)},complete:function(f,m){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&m&&(this.next=m),d},finish:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.finallyLoc===f)return this.complete(y.completion,y.afterLoc),w(y),d}},catch:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc===f){var X=y.completion;if(X.type==="throw"){var Z=X.arg;w(y)}return Z}}throw new Error("illegal catch attempt")},delegateYield:function(f,m,y){return this.delegate={iterator:I(f),resultName:m,nextLoc:y},this.method==="next"&&(this.arg=void 0),d}},n}function At(n){"@babel/helpers - typeof";return At=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},At(n)}function $i(n,a,t,r,e,i,s){try{var o=n[i](s),l=o.value}catch(u){t(u);return}o.done?a(l):Promise.resolve(l).then(r,e)}function ie(n){return function(){var a=this,t=arguments;return new Promise(function(r,e){var i=n.apply(a,t);function s(l){$i(i,r,e,s,o,"next",l)}function o(l){$i(i,r,e,s,o,"throw",l)}s(void 0)})}}function Se(n,a){if(!(n instanceof a))throw new TypeError("Cannot call a class as a function")}function qi(n,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,ss(r.key),r)}}function Le(n,a,t){return a&&qi(n.prototype,a),t&&qi(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function x(n,a,t){return a=ss(a),a in n?Object.defineProperty(n,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[a]=t,n}function Gr(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),a&&ni(n,a)}function vr(n){return vr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vr(n)}function ni(n,a){return ni=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},ni(n,a)}function Ba(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Aa(n,a){if(n==null)return{};var t={},r=Object.keys(n),e,i;for(i=0;i<r.length;i++)e=r[i],!(a.indexOf(e)>=0)&&(t[e]=n[e]);return t}function si(n,a){if(n==null)return{};var t=Aa(n,a),r,e;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(e=0;e<i.length;e++)r=i[e],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function q(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function ja(n,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return q(n)}function Wr(n){var a=Ba();return function(){var r=vr(n),e;if(a){var i=vr(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return ja(this,e)}}function ft(n,a){return qa(n)||Oa(n,a)||ns(n,a)||ro()}function Qa(n){return $a(n)||eo(n)||ns(n)||to()}function $a(n){if(Array.isArray(n))return ai(n)}function qa(n){if(Array.isArray(n))return n}function eo(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function ns(n,a){if(n){if(typeof n=="string")return ai(n,a);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ai(n,a)}}function ai(n,a){(a==null||a>n.length)&&(a=n.length);for(var t=0,r=new Array(a);t<a;t++)r[t]=n[t];return r}function to(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ro(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function io(n,a){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,a||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(n)}function ss(n){var a=io(n,"string");return typeof a=="symbol"?a:String(a)}var no=function(){function n(){Se(this,n);var a=window.crypto||window.msCrypto;this.subtle=a&&(a.subtle||a.webkitSubtle),this.externalDecryptor=null}return Le(n,[{key:"destroy",value:function(){var t;(t=this.externalDecryptor)!==null&&t!==void 0&&t.destroy&&this.externalDecryptor.destroy()}},{key:"decrypt",value:function(t,r){if(!(!t&&!r)){var e=[];return t&&(e[0]=this._decryptSegment(t)),r&&(e[1]=this._decryptSegment(r)),Promise.all(e)}}},{key:"_decryptSegment",value:function(){var a=ie(z().mark(function r(e){var i;return z().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(i=e.data,!e.key){o.next=5;break}return o.next=4,this._decryptData(e.data,e.key,e.keyIv);case 4:i=o.sent;case 5:if(e.map){o.next=7;break}return o.abrupt("return",i);case 7:return o.abrupt("return",wt(e.map,i));case 8:case"end":return o.stop()}},r,this)}));function t(r){return a.apply(this,arguments)}return t}()},{key:"_decryptData",value:function(){var a=ie(z().mark(function r(e,i,s){var o;return z().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!this.externalDecryptor){u.next=6;break}return u.next=3,this.externalDecryptor.decrypt(e,i,s);case 3:return u.abrupt("return",u.sent);case 6:if(this.subtle){u.next=8;break}throw new Error("crypto is not defined");case 8:return u.next=10,this.subtle.importKey("raw",i,{name:"AES-CBC"},!1,["encrypt","decrypt"]);case 10:return o=u.sent,u.t0=Uint8Array,u.next=14,this.subtle.decrypt({name:"AES-CBC",iv:s},o,e);case 14:return u.t1=u.sent,u.abrupt("return",new u.t0(u.t1));case 16:case"end":return u.stop()}},r,this)}));function t(r,e,i){return a.apply(this,arguments)}return t}()}]),n}(),te=se(se({},P),{},{STREAM_PARSED:"core.streamparsed",NO_AUDIO_TRACK:"core.noaudiotrack",SUBTITLE_SEGMENTS:"core.subtitlesegments",SUBTITLE_PLAYLIST:"core.subtitleplaylist",SEI_PAYLOAD_TIME:"core.seipayloadtime",APPEND_COST:"core.appendcost"}),Pr=new Me("Transmuxer"),en=function(){function n(a,t,r,e){Se(this,n),x(this,"_initSegmentId",""),this.hls=a,this._demuxer=t?new zn:new Un(null,null,null,e),this._isMP4=t,r&&(this._remuxer=new fi(this._demuxer.videoTrack,this._demuxer.audioTrack))}return Le(n,[{key:"transmux",value:function(t,r,e,i,s,o){var l=this._demuxer;try{this._isMP4?l.demux(t,r):l.demuxAndFix(wt(t,r),e,i,s)}catch(T){throw new ce(U.DEMUX,U.SUB_TYPES.HLS,T)}var u=l.videoTrack,c=l.audioTrack,d=l.metadataTrack,h={codec:u.codec,timescale:u.timescale,firstDts:u.firstDts/u.timescale,firstPts:u.firstPts/u.timescale,duration:u.samplesDuration/u.timescale},p={codec:c.codec,timescale:c.timescale,firstDts:c.firstDts/u.timescale,firstPts:c.firstPts/u.timescale,duration:c.samplesDuration/u.timescale},v="".concat(u.codec,"/").concat(u.width,"/").concat(u.height,"/").concat(c.codec,"/").concat(c.config);if(v!==this._initSegmentId&&(this._initSegmentId=v,o=!0),this._fireEvents(u,c,d,e||o),this.hls.emit(te.DEMUXED_TRACK,{videoTrack:u,audioTrack:c}),this._remuxer){o&&this.hls.isLive&&!this.hls.config.mseLowLatency&&(u.duration=this.hls.totalDuration*u.timescale,c.duration=this.hls.totalDuration*c.timescale);try{var g=this._remuxer.remux(o),b=g.videoInitSegment,L=g.videoSegment,G=g.audioInitSegment,V=g.audioSegment,W=wt(b,L),S=wt(G,V);return[W?se(se({},h),{},{data:W}):void 0,S?se(se({},p),{},{data:S}):void 0]}catch(T){throw new ce(U.REMUX,U.SUB_TYPES.FMP4,T)}}else return[u,c]}},{key:"_fireEvents",value:function(t,r,e,i){var s=this,o=[t,r],l="discontinuity: ".concat(i);o.forEach(function(u){var c;(c=u.samples)!==null&&c!==void 0&&c.length&&(l+="; ".concat(u.samples.length," ").concat(u.type===bt.VIDEO?"video":"audio"," samples, firstDts/firstPts/duration: ").concat((u.firstDts/u.timescale).toFixed(3),"/").concat((u.firstPts/u.timescale).toFixed(3),"/").concat((u.samplesDuration/u.timescale).toFixed(3))),i&&u.exist()&&s.hls.emit(te.METADATA_PARSED,{type:u.type,track:u,meta:se({codec:u.codec,timescale:u.timescale,baseDts:u.baseDts},u.type===bt.VIDEO?{width:u.width,height:u.height,sarRatio:u.sarRatio}:{codec:u.codec,channelCount:u.channelCount,sampleRate:u.sampleRate})})}),Pr.debug(l),t.warnings.forEach(function(u){var c;switch(u.type){case pe.LARGE_AV_SHIFT:c=te.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case pe.LARGE_VIDEO_GAP:c=te.LARGE_VIDEO_DTS_GAP_DETECT;break;case pe.LARGE_VIDEO_GAP_BETWEEN_CHUNK:c=te.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}c&&s.hls.emit(te.STREAM_EXCEPTION,se(se({},u),{},{type:c})),Pr.warn("video exception",u)}),r.warnings.forEach(function(u){var c;switch(u.type){case pe.LARGE_AUDIO_GAP:c=te.LARGE_AUDIO_DTS_GAP_DETECT;break;case pe.AUDIO_FILLED:c=te.AUDIO_GAP_DETECT;break;case pe.AUDIO_DROPPED:c=te.AUDIO_OVERLAP_DETECT;break}c&&s.hls.emit(te.STREAM_EXCEPTION,se(se({},u),{},{type:c})),Pr.warn("audio exception",u)}),t.samples.forEach(function(u){u.keyframe&&s.hls.emit(te.KEYFRAME,{pts:u.pts})}),e.seiSamples.forEach(function(u){s.hls.emit(te.SEI,se(se({},u),{},{originPts:u.originPts/90,sei:{code:u.data.type,content:u.data.payload,dts:u.pts}}))})}}]),n}(),so=["data"],ao=["data"],tn=new Me("BufferService"),oo=function(){function n(a){var t=this;Se(this,n),x(this,"_decryptor",new no),x(this,"_transmuxer",null),x(this,"_mse",null),x(this,"_softVideo",null),x(this,"_sourceCreated",!1),x(this,"_needInitSegment",!0),x(this,"_directAppend",!1),this.hls=a,a.config.softDecode?this._softVideo=a.media:(this._mse=new he(null,{preferMMS:a.config.preferMMS}),a.config.url&&this._mse.bindMedia(a.media).then(function(r){t.hls.emit(P.MEDIASOURCE_OPENED,r)})),a.config.decryptor&&(this._decryptor.externalDecryptor=a.config.decryptor)}return Le(n,[{key:"baseDts",get:function(){var t,r,e;return(t=this._transmuxer)===null||t===void 0||(r=t._demuxer)===null||r===void 0||(e=r._fixer)===null||e===void 0?void 0:e._baseDts}},{key:"nbSb",get:function(){var t;return(t=this._mse)!==null&&t!==void 0&&t._sourceBuffer?Object.keys(this._mse._sourceBuffer).length:0}},{key:"msIsOpened",get:function(){var t;return(t=this._mse)===null||t===void 0?void 0:t.isOpened}},{key:"msHasOpTasks",get:function(){var t;return(t=this._mse)===null||t===void 0?void 0:t.hasOpTasks}},{key:"msStreaming",get:function(){var t;return(t=this._mse)===null||t===void 0?void 0:t.streaming}},{key:"updateDuration",value:function(){var a=ie(z().mark(function r(e){return z().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(tn.debug("update duration",e),!this._mse){s.next=9;break}if(this._mse.isOpened){s.next=5;break}return s.next=5,this._mse.open();case 5:return s.next=7,this._mse.updateDuration(e);case 7:s.next=10;break;case 9:this._softVideo&&(this._softVideo.duration=e);case 10:case"end":return s.stop()}},r,this)}));function t(r){return a.apply(this,arguments)}return t}()},{key:"createSource",value:function(t,r,e,i){if(!this._sourceCreated){var s=t||r;if(s){if(Un.probe(s))this._transmuxer||(this._transmuxer=new en(this.hls,!1,!this._softVideo,this.hls.config.fixerConfig));else if(Q.probe(s))if(this._softVideo)this._transmuxer||(this._transmuxer=new en(this.hls,!0,null,this.hls.config.fixerConfig));else{this._directAppend=!0;var o=!1;t&&!e&&Q.findBox(t,["moov","trak"]).forEach(function(l){var u=Q.findBox(l.data,["trak","mdia","minf","stbl","stsd"])[0];if(u){var c=Q.stsd(u).entries[0];if(c){if(c.hvcC)e=c.hvcC.codec||"hev1.1.6.L93.B0";else if(c.avcC)e=c.avcC.codec;else if(c.sampleRate||c.esds){var d;i=((d=c.esds)===null||d===void 0?void 0:d.codec)||"mp4a.40.2",o=!0}}}}),r&&!i&&Q.findBox(r,["moov","trak","mdia","minf","stbl","stsd"]).forEach(function(l){var u=Q.stsd(l).entries[0];u&&u.esds&&(i=u.esds.codec)}),t&&!e&&(e="avc1.42e01e"),r&&!i&&(i="mp4a.40.2"),o&&(e+=", ".concat(i),i=""),this._createMseSource(e,i)}else throw new ce(U.OTHER,null,null,null,"unsupported stream");this._softVideo&&(this._sourceCreated=!0)}}}},{key:"appendBuffer",value:function(){var a=ie(z().mark(function r(e,i,s,o,l,u,c){var d=this,h,p,v,g,b,L,G,V,W,S,T,k,w,M;return z().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!(!(s!=null&&s.length)&&!(o!=null&&o.length))){D.next=2;break}return D.abrupt("return");case 2:if(h=function(){var m;if((m=d.hls)!==null&&m!==void 0&&m.emit){var y;(y=d.hls)===null||y===void 0||y.emit(P.APPEND_BUFFER,{start:e.start,end:e.end})}},!this._directAppend){D.next=8;break}return p=[],s&&p.push(this._mse.append(he.VIDEO,s)),o&&p.push(this._mse.append(he.AUDIO,o)),D.abrupt("return",Promise.all(p).then(h));case 8:if(v=this._needInitSegment||l,g=this._transmuxer.transmux(s,o,v,u,c,this._needInitSegment||l),b=ft(g,2),L=b[0],G=b[1],o&&i&&(i==null||i.setTrackExist(!1,!0)),o&&e&&(e==null||e.setTrackExist(!0,!1)),i||e==null||e.setTrackExist(!!L,!!G),L&&!G&&this.hls.emit(te.NO_AUDIO_TRACK),!this._softVideo){D.next=20;break}this._softVideo.appendBuffer(L,G),this._needInitSegment=!1,h(),D.next=30;break;case 20:if(!this._mse){D.next=30;break}return V=!this._sourceCreated,V&&this._createMseSource(L==null?void 0:L.codec,G==null?void 0:G.codec),this._needInitSegment=!1,W=this._mse,S=[],v&&!V&&this._handleCodecChange(L,G).forEach(function(f){return S.push(f)}),L&&(T=L.data,k=si(L,so),S.push(W.append(he.VIDEO,T,k))),G&&(w=G.data,M=si(G,ao),S.push(W.append(he.AUDIO,w,M))),D.abrupt("return",Promise.all(S).then(h));case 30:case"end":return D.stop()}},r,this)}));function t(r,e,i,s,o,l,u){return a.apply(this,arguments)}return t}()},{key:"removeBuffer",value:function(){var a=ie(z().mark(function r(){var e=this,i,s,o,l=arguments;return z().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(i=l.length>0&&l[0]!==void 0?l[0]:0,s=l.length>1&&l[1]!==void 0?l[1]:1/0,o=this.hls.media,!(!this._mse||!o||i<0||s<i||i>=this._mse.duration)){c.next=5;break}return c.abrupt("return");case 5:return c.abrupt("return",this._mse.clearBuffer(i,s).then(function(){return e.hls.emit(P.REMOVE_BUFFER,{start:i,end:s,removeEnd:s})}));case 6:case"end":return c.stop()}},r,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"evictBuffer",value:function(){var a=ie(z().mark(function r(e){var i,s,o,l;return z().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(i=this.hls.media,!(!this._mse||!i||!e||e<0)){c.next=3;break}return c.abrupt("return");case 3:if(s=i.currentTime,o=s-e,!(o<=0)){c.next=7;break}return c.abrupt("return");case 7:if(l=fe.start(fe.get(i)),!(l+1>=o)){c.next=10;break}return c.abrupt("return");case 10:return c.abrupt("return",this.removeBuffer(0,o));case 11:case"end":return c.stop()}},r,this)}));function t(r){return a.apply(this,arguments)}return t}()},{key:"clearAllBuffer",value:function(){var a=ie(z().mark(function r(){return z().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=2;break}return i.abrupt("return",this._mse.clearAllBuffer());case 2:case"end":return i.stop()}},r,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"decryptBuffer",value:function(t,r){return this._decryptor.decrypt(t,r)}},{key:"reset",value:function(){var a=ie(z().mark(function r(){var e,i=arguments;return z().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(e=i.length>0&&i[0]!==void 0?i[0]:!1,!(this._mse&&!e)){o.next=8;break}return this._transmuxer=null,this._sourceCreated=!1,o.next=6,this._mse.unbindMedia();case 6:return o.next=8,this._mse.bindMedia(this.hls.media);case 8:this._needInitSegment=!0,this._directAppend=!1;case 10:case"end":return o.stop()}},r,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"endOfStream",value:function(){var a=ie(z().mark(function r(){return z().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=5;break}if(!this._sourceCreated){i.next=5;break}return i.next=4,this._mse.endOfStream();case 4:this.hls.emit(P.BUFFEREOS);case 5:this._softVideo&&this._softVideo.endOfStream();case 6:case"end":return i.stop()}},r,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"setLiveSeekableRange",value:function(){var a=ie(z().mark(function r(e,i){return z().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this._mse&&this._mse.setLiveSeekableRange(e,i);case 1:case"end":return o.stop()}},r,this)}));function t(r,e){return a.apply(this,arguments)}return t}()},{key:"detachMedia",value:function(){var a=ie(z().mark(function r(){return z().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=3;break}return i.next=3,this._mse.unbindMedia();case 3:case"end":return i.stop()}},r,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var a=ie(z().mark(function r(){var e;return z().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return(e=this._decryptor)===null||e===void 0||e.destroy(),s.next=3,this.detachMedia();case 3:this._decryptor=null,this._mse=null,this._softVideo=null;case 6:case"end":return s.stop()}},r,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"_createMseSource",value:function(t,r){tn.debug("create mse source, videoCodec=".concat(t,", audioCodec=").concat(r));var e=this._mse;e&&(t&&(e.createSource(he.VIDEO,"video/mp4;codecs=".concat(t)),this._sourceCreated=!0),r&&(e.createSource(he.AUDIO,"audio/mp4;codecs=".concat(r)),this._sourceCreated=!0),this.hls.emit(P.SOURCEBUFFER_CREATED))}},{key:"_handleCodecChange",value:function(t,r){var e=[],i=this._mse,s=[{type:he.VIDEO,codecs:t==null?void 0:t.codec},{type:he.AUDIO,codecs:r==null?void 0:r.codec}];return s.filter(function(o){return!!o.codecs}).forEach(function(o){var l=o.type,u=o.codecs,c=i.getSourceBuffer(l);if(c){var d=u.split(",")[0];new RegExp(d,"ig").test(c.mimeType)||e.push(i.changeType(l,"".concat(l,"/mp4;codecs=").concat(u)))}}),e}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0}},{key:"isFull",value:function(){var t,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:he.VIDEO;return(t=this._mse)===null||t===void 0?void 0:t.isFull(r)}}]),n}();function lo(n){var a=(n==null?void 0:n.media)||document.createElement("video");return se(se({maxPlaylistSize:50,retryCount:3,retryDelay:1e3,pollRetryCount:2,loadTimeout:1e4,manifestLoadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0,useLowLatency:!0,targetLatency:10,maxLatency:20,allowedStreamTrackChange:!0,seiInTime:!1,manifestList:[],minSegmentsStartPlay:3,preferMMS:!1,preferMMSStreaming:!1,mseLowLatency:!0,fixerConfig:{forceFixLargeGap:!1,largeGapThreshold:5}},n),{},{media:a})}var uo=Le(function n(){Se(this,n),x(this,"version",0),x(this,"streams",[]),x(this,"isMaster",!0)}),as={Audio:"AUDIO",Video:"VIDEO",SubTitle:"SUBTITLE",ClosedCaptions:"CLOSED-CAPTIONS"},ar={CLEAR_KEY:"org.w3.clearkey",FAIRPLAY:["urn:uuid:94ce86fb-07ff-4f43-adb8-93d2fa968ca2","com.apple.streamingkeydelivery"],WIDEVINE:["urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha","com.widevine"],PLAYREADY:["urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready"]};function os(n){for(var a=[],t=0;t<n.length;t++)Array.isArray(n[t])?a=a.concat(os(n[t])):a.push(n[t]);return a}var pi=Le(function n(){Se(this,n),x(this,"id",0),x(this,"url",""),x(this,"default",!1),x(this,"autoSelect",!1),x(this,"forced",!1),x(this,"group",""),x(this,"name",""),x(this,"lang",""),x(this,"segments",[]),x(this,"endSN",0)}),co=function(n){Gr(t,n);var a=Wr(t);function t(){var r;Se(this,t);for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return r=a.call.apply(a,[this].concat(i)),x(q(r),"mediaType",as.Audio),x(q(r),"channels",0),r}return Le(t)}(pi),ho=function(n){Gr(t,n);var a=Wr(t);function t(){var r;Se(this,t);for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return r=a.call.apply(a,[this].concat(i)),x(q(r),"mediaType",as.SubTitle),r}return Le(t)}(pi),mo=Le(function n(){Se(this,n),x(this,"id",0),x(this,"bitrate",0),x(this,"width",0),x(this,"height",0),x(this,"name",""),x(this,"url",""),x(this,"audioCodec",""),x(this,"videoCodec",""),x(this,"textCodec",""),x(this,"audioGroup",""),x(this,"audioStreams",[]),x(this,"subtitleStreams",[]),x(this,"closedCaptionsStream",[])}),fo=Le(function n(){Se(this,n),x(this,"version",0),x(this,"url",""),x(this,"type",""),x(this,"startCC",0),x(this,"endCC",0),x(this,"startSN",0),x(this,"endSN",0),x(this,"totalDuration",0),x(this,"targetDuration",0),x(this,"partTargetDuration",0),x(this,"canSkipUntil",0),x(this,"canSkipDateRanges",!1),x(this,"skippedSegments",0),x(this,"canBlockReload",!1),x(this,"partHoldBack",0),x(this,"live",!0),x(this,"lowLatency",!1),x(this,"endPartIndex",0),x(this,"segments",[]),x(this,"dateRanges",{}),x(this,"skippedSegments",0)}),or=function(){function n(a){Se(this,n),x(this,"sn",0),x(this,"cc",0),x(this,"url",""),x(this,"parentUrl",""),x(this,"title",""),x(this,"start",0),x(this,"duration",0),x(this,"dataTime",""),x(this,"key",null),x(this,"byteRange",null),x(this,"isInitSegment",!1),x(this,"initSegment",null),x(this,"isLast",!1),x(this,"hasAudio",!1),x(this,"hasVideo",!1),x(this,"independent",!1),x(this,"partIndex",0),this.parentUrl=a}return Le(n,[{key:"end",get:function(){return this.start+this.duration}},{key:"setTrackExist",value:function(t,r){this.hasVideo=t,this.hasAudio=r}},{key:"setByteRange",value:function(t,r){this.byteRange=[0];var e=t.split("@");e.length===1&&r&&r.byteRange?(this.byteRange[0]=r.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(e[1]),this.byteRange[1]=this.byteRange[0]+parseInt(e[0])-1}}]),n}(),po=function(){function n(a){Se(this,n),x(this,"method",""),x(this,"url",""),x(this,"iv",null),x(this,"keyFormat",""),x(this,"keyFormatVersions",""),a instanceof n&&(this.method=a.method,this.url=a.url,this.keyFormat=a.keyFormat,this.keyFormatVersions=a.keyFormatVersions,a.iv&&(this.iv=new Uint8Array(a.iv)))}return Le(n,[{key:"clone",value:function(t){var r=new n(this);return t!=null&&r.setIVFromSN(t),r}},{key:"setIVFromSN",value:function(t){if(!this.iv&&this.method==="AES-128"&&typeof t=="number"&&this.url){this.iv=new Uint8Array(16);for(var r=12;r<16;r++)this.iv[r]=t>>8*(15-r)&255}}},{key:"isSegmentEncrypted",value:function(){var t=this.method;return t==="AES-128"}},{key:"isValidKeySystem",value:function(){var t=os([ar.CLEAR_KEY,ar.FAIRPLAY,ar.WIDEVINE,ar.PLAYREADY]).indexOf(this.keyFormat)>-1;if(!t)return!1;var r=["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)>-1;return!!r}},{key:"isSupported",value:function(){return this.method?this.isSegmentEncrypted()?!0:!!this.isValidKeySystem():!1}}]),n}(),vo=/^#(EXT[^:]*)(?::(.*))?$/,rn=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,yo=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,bo=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function go(n){return n.split(/[\r\n]/).map(function(a){return a.trim()}).filter(Boolean)}function ls(n){var a=n.match(vo);if(!(!a||!a[1]))return[a[1].replace("EXT-X-",""),a[2]]}function ht(n){for(var a={},t=rn.exec(n);t;)a[t[1]]=t[2]||t[3],t=rn.exec(n);return a}function Et(n,a){if(!a||!n||yo.test(n))return n;var t=bo.exec(a);return t?n[0]==="/"?t[1]+n:t[1]+t[2]+n:n}var Zo={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function Nr(n,a){var t=Zo[n];if(!(!t||!a||!a.length)){for(var r=0;r<t.length;r++)for(var e=0;e<a.length;e++)if(t[r].test(a[e]))return a[e]}}function So(n,a){var t;if(a){for(var r in a)if(Object.prototype.hasOwnProperty.call(a,r)&&n[r]!==a[r]){t=r;break}}var e=null;n.DURATION&&(e=parseFloat(n.DURATION),Number.isFinite(e)?n._endDate&&(e=(n._endDate.getTime()-n._startDate.getTime())/1e3):e=null);var i=Lo(n.CUE||n["X-CUE"],{pre:!1,post:!1,once:!1});return!!n.ID&&!t&&Number.isFinite(n._startDate.getTime())&&(e===null||e>=0)&&(n.END_ON_NEXT!=="YES"||!!n.CLASS)&&(!n.CUE||!i.pre&&!i.post||i.pre!==i.post)&&(n.CLASS!=="com.apple.hls.interstitial"||"X-ASSET-URI"in n||"X-ASSET-LIST"in n)}function Lo(n,a){return(n?n.split(/[ ,]+/):[]).reduce(function(t,r){return t[r.toLowerCase()]=!0,t},a)}function Xo(n,a){for(var t=new uo,r=0,e,i=[],s=[];e=n[r++];){var o=ls(e);if(o){var l=ft(o,2),u=l[0],c=l[1];if(u==="VERSION")t.version=parseInt(c);else if(u==="MEDIA"&&c){var d=ht(c),h=void 0;switch(d.TYPE){case"AUDIO":h=new co;break;case"SUBTITLES":h=new ho;break;default:h=new pi}h.url=Et(d.URI,a),h.default=d.DEFAULT==="YES",h.autoSelect=d.AUTOSELECT==="YES",h.group=d["GROUP-ID"],h.name=d.NAME,h.lang=d.LANGUAGE,d.CHANNELS&&(h.channels=Number(d.CHANNELS.split("/")[0]),Number.isNaN(h.channels)&&(h.channels=0)),d.TYPE==="AUDIO"&&d.URI&&i.push(h),d.TYPE==="SUBTITLES"&&s.push(h)}else if(u==="STREAM-INF"&&c){var p=new mo,v=ht(c);if(p.bitrate=parseInt(v["AVERAGE-BANDWIDTH"]||v.BANDWIDTH),p.name=v.NAME,p.url=Et(n[r++],a),v.RESOLUTION){var g=v.RESOLUTION.split("x"),b=ft(g,2),L=b[0],G=b[1];p.width=parseInt(L),p.height=parseInt(G)}if(v.CODECS){var V=v.CODECS.split(/[ ,]+/).filter(Boolean);p.videoCodec=Nr("video",V),p.audioCodec=Nr("audio",V),p.textCodec=Nr("text",V)}p.audioGroup=v.AUDIO,p.subtitleGroup=v.SUBTITLES,t.streams.push(p)}}}return t.streams.forEach(function(W,S){W.id=S}),i.length&&(i.forEach(function(W,S){W.id=S}),t.streams.forEach(function(W){W.audioGroup&&(W.audioStreams=i.filter(function(S){return S.group===W.audioGroup}))})),s.length&&(s.forEach(function(W,S){W.id=S}),t.streams.forEach(function(W){W.subtitleGroup&&(W.subtitleStreams=s.filter(function(S){return S.group===W.subtitleGroup}))})),t}function Go(n,a,t){var r=new fo;r.url=a;for(var e=new or(a),i=null,s=null,o=0,l=0,u=0,c=0,d,h=!1,p=0;d=n[c++];){if(d[0]!=="#"){if(r.lowLatency){l++;continue}e.sn=l,e.cc=u,e.url=Et(d,a),s&&(e.key=s.clone(l)),i&&(e.initSegment=i),r.segments.push(e),e=new or(a),l++;continue}var v=ls(d);if(v){var g=ft(v,2),b=g[0],L=g[1];switch(b){case"VERSION":r.version=parseInt(L);break;case"PLAYLIST-TYPE":r.type=L==null?void 0:L.toUpperCase();break;case"TARGETDURATION":r.targetDuration=parseFloat(L);break;case"PART-INF":{t&&(r.lowLatency=!0);var G=ht(L);G["PART-TARGET"]&&(r.partTargetDuration=parseFloat(G["PART-TARGET"]))}break;case"SERVER-CONTROL":{var V=ht(L);r.canBlockReload=V["CAN-BLOCK-RELOAD"]==="YES",r.partHoldBack=parseFloat(V["PART-HOLD-BACK"]||0),r.canSkipUntil=parseFloat(V["CAN-SKIP-UNTIL"]||0),r.canSkipDateRanges=V["CAN-SKIP-DATERANGES"]==="YES"}break;case"ENDLIST":h=!0;break;case"MEDIA-SEQUENCE":l=r.startSN=parseInt(L);break;case"DISCONTINUITY-SEQUENCE":u=r.startCC=parseInt(L);break;case"DISCONTINUITY":u++;break;case"BYTERANGE":e.setByteRange(L,r.segments[r.segments.length-1]);break;case"PART":{if(!r.lowLatency)break;var W=ht(L);e.duration=parseFloat(W.DURATION),e.independent=W.INDEPENDENT==="YES",e.sn=l,e.cc=u,e.partIndex=p,e.start=o,e.duration=parseFloat(W.DURATION),o+=e.duration,e.url=Et(W.URI,a),s&&(e.key=s.clone(l)),i&&(e.initSegment=i),r.segments.push(e),e=new or(a),p++}break;case"PRELOAD-HINT":break;case"PROGRAM-DATE-TIME":e.dataTime=L;break;case"EXTINF":{if(r.lowLatency){p=0;break}var S=L.split(","),T=ft(S,2),k=T[0],w=T[1];e.start=o,e.duration=parseFloat(k),o+=e.duration,e.title=w}break;case"KEY":{var M=ht(L);if(M.METHOD==="NONE"){s=null;break}if(s=new po,s.method=M.METHOD,s.url=/^blob:/.test(M.URI)?M.URI:Et(M.URI,a),s.keyFormat=M.KEYFORMAT||"identity",s.keyFormatVersions=M.KEYFORMATVERSIONS,!s.isSupported())throw new Error("encrypt ".concat(M.METHOD,"/").concat(M.KEYFORMAT," is not supported"));if(M.IV){var I=M.IV.slice(2);I=(I.length&1?"0":"")+I,s.iv=new Uint8Array(I.length/2);for(var D=0,f=I.length/2;D<f;D++)s.iv[D]=parseInt(I.slice(D*2,D*2+2),16)}}break;case"MAP":{var m=ht(L);e.url=Et(m.URI,a),m.BYTERANGE&&e.setByteRange(m.BYTERANGE),e.isInitSegment=!0,e.sn=0,s&&(e.key=s.clone(0)),i=e,e=new or(a)}break;case"SKIP":{var y=ht(L),X=parseInt(y["SKIPPED-SEGMENTS"],10);X<=Number.MAX_SAFE_INTEGER&&(r.skippedSegments+=X)}break;case"DATERANGE":{var Z=ht(L),R=r.dateRanges[Z.ID];Z._startDate=R?R._startDate:new Date(Z["START-DATE"]);var Y=(R==null?void 0:R._endDate)||new Date(Z.END_DATE);Number.isFinite(Y)&&(Z._endDate=Y),(So(Z,R)||r.skippedSegments)&&(r.dateRanges[Z.ID]=Z)}break}}}r.segments=r.segments.filter(function(_){return _.duration!==0});var N=r.segments[r.segments.length-1];return N&&(h&&(N.isLast=!0),r.endSN=N.sn,r.endPartIndex=N.partIndex),h&&(r.live=!1),r.totalDuration=o,r.endCC=u,r}var lr=function(){function n(){Se(this,n)}return Le(n,null,[{key:"parse",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;if(!t.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var i=go(t);return n.isMediaPlaylist(t)?Go(i,r,e):Xo(i,r)}},{key:"isMediaPlaylist",value:function(t){return t.includes("#EXTINF:")||t.includes("#EXT-X-TARGETDURATION:")}}]),n}(),Wo=function(){function n(a){var t=this;Se(this,n),x(this,"_emitOnLoaded",function(l,u){var c=l.response,d=l.options,h=d||{},p=h.firstByteTime,v=h.startTime,g=h.endTime,b=h.contentLength,L=g-v;t.hls.emit(P.SPEED,{time:L,byteLength:b,url:u}),t.hls.emit(P.LOAD_COMPLETE,{url:u,elapsed:L||0}),t.hls.emit(P.TTFB,{url:u,responseUrl:c.url,elapsed:p-v}),t.hls.emit(P.LOAD_RESPONSE_HEADERS,{headers:c.headers,url:u})}),x(this,"_onLoaderRetry",function(l,u){t.hls.emit(te.LOAD_RETRY,{error:ce.network(l),retryTime:u})}),this.hls=a,this._timer=null,this._useLowLatency=a.config.useLowLatency;var r=this.hls.config,e=r.retryCount,i=r.retryDelay,s=r.manifestLoadTimeout,o=r.fetchOptions;this._loader=new yt(se(se({},o),{},{responseType:"text",retry:e,retryDelay:i,timeout:s,onRetryError:this._onLoaderRetry})),this._audioLoader=new yt(se(se({},o),{},{responseType:"text",retry:e,retryDelay:i,timeout:s,onRetryError:this._onLoaderRetry})),this._subtitleLoader=new yt(se(se({},o),{},{responseType:"text",retry:e,retryDelay:i,timeout:s,onRetryError:this._onLoaderRetry}))}return Le(n,[{key:"load",value:function(){var a=ie(z().mark(function r(e,i,s){var o,l,u,c,d,h,p,v,g,b,L,G,V,W,S,T,k,w,M,I;return z().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=[this._loader.load(e)],i&&o.push(this._audioLoader.load(i)),s&&o.push(this._subtitleLoader.load(s)),f.prev=3,f.next=6,Promise.all(o);case 6:if(v=f.sent,g=ft(v,3),b=g[0],L=g[1],G=g[2],b){f.next=13;break}return f.abrupt("return",[]);case 13:this._emitOnLoaded(b,e),l=b.data,d=b.response.url||e,i?(u=L==null?void 0:L.data,c=G==null?void 0:G.data,h=(L==null||(V=L.response)===null||V===void 0?void 0:V.url)||i,p=(G==null||(W=G.response)===null||W===void 0?void 0:W.url)||s,u&&this._emitOnLoaded(L,i),c&&this._emitOnLoaded(G,s)):(c=L==null?void 0:L.data,p=(L==null||(S=L.response)===null||S===void 0?void 0:S.url)||s,c&&this._emitOnLoaded(L,s)),f.next=22;break;case 19:throw f.prev=19,f.t0=f.catch(3),ce.network(f.t0);case 22:if(T=this.hls.config.onPreM3U8Parse,f.prev=23,T&&(l=T(l)||l,u&&(u=T(u,!0)||u),c&&(c=T(c,!0)||c)),k=lr.parse(l,d,this._useLowLatency),!(((I=k)===null||I===void 0?void 0:I.live)===!1&&k.segments&&!k.segments.length)){f.next=28;break}throw new Error("empty segments list");case 28:u&&(w=lr.parse(u,h,this._useLowLatency)),c&&(M=lr.parse(c,p,this._useLowLatency)),f.next=35;break;case 32:throw f.prev=32,f.t1=f.catch(23),new ce(U.MANIFEST,U.SUB_TYPES.HLS,f.t1);case 35:return k&&(k.isMaster?this.hls.emit(te.HLS_MANIFEST_LOADED,{playlist:k}):this.hls.emit(te.HLS_LEVEL_LOADED,{playlist:k})),f.abrupt("return",[k,w,M]);case 37:case"end":return f.stop()}},r,this,[[3,19],[23,32]])}));function t(r,e,i){return a.apply(this,arguments)}return t}()},{key:"parseText",value:function(t,r){var e=this.hls.config.onPreM3U8Parse,i;try{var s;if(e&&(t=e(t)||t),i=lr.parse(t,r,this._useLowLatency),((s=i)===null||s===void 0?void 0:s.live)===!1&&i.segments&&!i.segments.length)throw new Error("empty segments list")}catch(o){throw new ce(U.MANIFEST,U.SUB_TYPES.HLS,o)}return i&&(i.isMaster?this.hls.emit(te.HLS_MANIFEST_LOADED,{playlist:i}):this.hls.emit(te.HLS_LEVEL_LOADED,{playlist:i})),[i]}},{key:"poll",value:function(t,r,e,i,s,o){var l=this;clearTimeout(this._timer),o=o||3e3;var u=this.hls.config.pollRetryCount,c=function(){var d=ie(z().mark(function h(){var p;return z().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return clearTimeout(l._timer),g.prev=1,g.next=4,l.load(t,r,e);case 4:if(p=g.sent,p[0]){g.next=7;break}return g.abrupt("return");case 7:u=l.hls.config.pollRetryCount,i(p[0],p[1],p[2]),g.next=15;break;case 11:g.prev=11,g.t0=g.catch(1),u--,u<=0&&s(g.t0);case 15:l._timer=setTimeout(c,o);case 16:case"end":return g.stop()}},h,null,[[1,11]])}));return function(){return d.apply(this,arguments)}}();this._timer=setTimeout(c,o)}},{key:"stopPoll",value:function(){return clearTimeout(this._timer),this.cancel()}},{key:"cancel",value:function(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])}}]),n}();function us(n,a,t){return a>t&&(t=a),Math.min(Math.max(n,a),t)}var Kr=new Me("playlist"),nn=function(){function n(a,t,r){Se(this,n),x(this,"live",void 0),x(this,"id",0),x(this,"bitrate",0),x(this,"width",0),x(this,"height",0),x(this,"name",""),x(this,"url",""),x(this,"audioCodec",""),x(this,"videoCodec",""),x(this,"textCodec",""),x(this,"startCC",0),x(this,"endCC",0),x(this,"startSN",0),x(this,"endSN",-1),x(this,"totalDuration",0),x(this,"targetDuration",0),x(this,"partTargetDuration",0),x(this,"canSkipUntil",0),x(this,"canSkipDateRanges",!1),x(this,"skippedSegments",0),x(this,"canBlockReload",!1),x(this,"partHoldBack",0),x(this,"lowLatency",!1),x(this,"endPartIndex",0),x(this,"snDiff",null),x(this,"segments",[]),x(this,"audioStreams",[]),x(this,"subtitleStreams",[]),x(this,"closedCaptions",[]),x(this,"currentAudioStream",null),x(this,"currentSubtitleStream",null),this.update(this._setLLPlaybackPoint(a),t,r)}return Le(n,[{key:"lastSegment",get:function(){return this.segments.length?this.segments[this.segments.length-1]:null}},{key:"segmentDuration",get:function(){var t;return this.targetDuration||((t=this.segments[0])===null||t===void 0?void 0:t.duration)||0}},{key:"liveEdge",get:function(){return this.endTime},set:function(t){this.endTime=t}},{key:"endTime",get:function(){var t;return((t=this.lastSegment)===null||t===void 0?void 0:t.end)||0},set:function(t){var r=this.lastSegment;r&&(r.duration=t-r.start)}},{key:"currentSubtitleEndSn",get:function(){var t;return((t=this.currentSubtitleStream)===null||t===void 0?void 0:t.endSN)||0}},{key:"clearOldSegment",value:function(t,r){return this.currentAudioStream&&this._clearSegments(t,r),this._clearSegments(t,r)}},{key:"getAudioSegment",value:function(t){if(!(!t||!this.currentAudioStream)){var r=t.sn-this.snDiff;return this.currentAudioStream.segments.find(function(e){return e.sn===r})}}},{key:"update",value:function(t,r){this.url=t.url,Array.isArray(t.segments)?((this.live===null||this.live===void 0)&&(this.live=t.live),this._updateSegments(t,this),this.startCC=t.startCC,this.endCC=t.endCC,this.startSN=t.startSN,this.endSN=t.endSN||-1,this.totalDuration=t.totalDuration,this.targetDuration=t.targetDuration,this.live=t.live,this.lowLatency=t.lowLatency,this.canBlockReload=t.canBlockReload,this.canSkipDateRanges=t.canSkipDateRanges,this.canSkipUntil=t.canSkipUntil,this.partHoldBack=t.partHoldBack,this.partTargetDuration=t.partTargetDuration,this.skippedSegments=t.skippedSegments,this.endPartIndex=t.endPartIndex,r&&this.currentAudioStream&&Array.isArray(r.segments)&&(this._updateSegments(r,this.currentAudioStream),(this.snDiff===null||this.snDiff===void 0)&&t.segments.length&&r.segments.length&&(this.snDiff=t.segments[0].sn-r.segments[0].sn))):(this.id=t.id,this.bitrate=t.bitrate,this.width=t.width,this.height=t.height,this.name=t.name,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.textCodec=t.textCodec,this.audioStreams=t.audioStreams,this.subtitleStreams=t.subtitleStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find(function(e){return e.default})||this.audioStreams[0]),!this.currentSubtitleStream&&this.subtitleStreams.length&&(this.currentSubtitleStream=this.subtitleStreams.find(function(e){return e.default})||this.subtitleStreams[0]))}},{key:"updateSubtitle",value:function(t){var r=this;if(t&&this.currentSubtitleStream&&Array.isArray(t.segments)){var e=this._updateSegments(t,this.currentSubtitleStream),i=this.currentSubtitleStream.segments;if(i.length>100&&(this.currentSubtitleStream.segments=i.slice(100)),!!e)return e.map(function(s){return{sn:s.sn,url:s.url,duration:s.duration,start:s.start,end:s.end,lang:r.currentSubtitleStream.lang}})}}},{key:"switchSubtitle",value:function(t){var r=this.subtitleStreams.find(function(i){return i.lang===t}),e=this.currentSubtitleStream;r&&(this.currentSubtitleStream=r,e.segments=[])}},{key:"_setLLPlaybackPoint",value:function(t){if(!t.lowLatency||!t.segments.length)return t;for(var r=t.totalDuration-t.partHoldBack,e=t.segments,i=0,s=0,o=e.length;s<o;s++)e[s].start<=r&&e[s].independent&&(i=s);var l=e.slice(i),u=0;return l.forEach(function(c){c.start=u,u=c.end}),t.segments=l,t.totalDuration=u,t.startSN=l[0].sn,t.startCC=l[0].cc,Kr.log("set ll-hls playback point: SN=".concat(t.startSN," partIndex=").concat(l[0].partIndex,", duration=").concat(u)),t}},{key:"_clearSegments",value:function(t,r){for(var e=0,i=this.segments,s=0,o=i.length;s<o;s++)if(i[s].end>=t){e=s;break}return e>r&&(e=r),e&&(this.segments=this.segments.slice(e),this.currentAudioStream&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(e))),r-e}},{key:"_updateSegments",value:function(t,r){var e=r.segments;if(this.live){var i,s=t.lowLatency,o=e[e.length-1],l=(i=o==null?void 0:o.sn)!==null&&i!==void 0?i:-1,u=(o==null?void 0:o.partIndex)||0,c=l<t.endSN&&t.segments.length;if(s&&(c=c||u<t.endPartIndex),c){Kr.log("update segments: endSN:".concat(l,", partIndex:").concat(u," --> endSN:").concat(t.endSN,", partIndex:").concat(t.endPartIndex));var d=t.segments.findIndex(function(b){return b.sn===l&&b.partIndex===u}),h=d<0?t.segments:t.segments.slice(d+1);if(e.length&&h.length){var p=o.end,v=p;h.forEach(function(b){b.start=p,p=b.end}),Kr.log("liveEdge: ".concat(v," -> ").concat(p));var g=(o==null?void 0:o.cc)||-1;g>h[0].cc&&h.forEach(function(b){return b.cc+=g})}return r.endSN=t.endSN,r.segments=e.concat(h),h}}else r.segments=t.segments}}]),n}(),wo=function(){function n(a){Se(this,n),x(this,"streams",[]),x(this,"currentStream",null),x(this,"dvrWindow",0),x(this,"_segmentPointer",-1),this.hls=a}return Le(n,[{key:"lowLatency",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.lowLatency}},{key:"lastSegment",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.lastSegment}},{key:"currentSegment",get:function(){var t;return(t=this.currentSegments)===null||t===void 0?void 0:t[this._segmentPointer]}},{key:"nextSegment",get:function(){var t;return(t=this.currentSegments)===null||t===void 0?void 0:t[this._segmentPointer+1]}},{key:"currentSegments",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.segments}},{key:"currentSubtitleEndSn",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.currentSubtitleEndSn}},{key:"liveEdge",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.liveEdge},set:function(t){this.currentStream&&(this.currentStream.liveEdge=t)}},{key:"totalDuration",get:function(){var t;return((t=this.currentStream)===null||t===void 0?void 0:t.totalDuration)||0}},{key:"seekRange",get:function(){var t=this.currentSegments;if(!(!t||!t.length))return[t[0].start,t[t.length-1].end]}},{key:"nbSegments",get:function(){var t;return((t=this.currentSegments)===null||t===void 0?void 0:t.length)||0}},{key:"isEmpty",get:function(){var t;return!((t=this.currentSegments)!==null&&t!==void 0&&t.length)}},{key:"isLive",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.live}},{key:"hadSegmentLoaded",get:function(){return this._segmentPointer!==-1}},{key:"hasSubtitle",get:function(){var t;return!!((t=this.currentStream)!==null&&t!==void 0&&t.currentSubtitleStream)}},{key:"getAudioSegment",value:function(t){var r;return(r=this.currentStream)===null||r===void 0?void 0:r.getAudioSegment(t)}},{key:"moveSegmentPointer",value:function(t){var r;t==null&&(t=this._segmentPointer+1),this._segmentPointer=us(t,-1,(r=this.currentSegments)===null||r===void 0?void 0:r.length)}},{key:"reset",value:function(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1}},{key:"getSegmentByIndex",value:function(t){var r;return(r=this.currentSegments)===null||r===void 0?void 0:r[t]}},{key:"setNextSegmentByIndex",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this._segmentPointer=t-1}},{key:"setNextSegmentBySN",value:function(){var t,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=(t=this.currentSegments)===null||t===void 0?void 0:t.findIndex(function(i){return i.sn===r});return e!==-1&&this.setNextSegmentByIndex(e+1),e}},{key:"findSegmentIndexByTime",value:function(t){var r=this.currentSegments;if(r){for(var e=0,i=r.length,s;e<i;e++)if(s=r[e],t>=s.start&&t<s.end)return e;var o=r[r.length-1];if(Math.abs(t-(o==null?void 0:o.end))<.2)return r.length-1}}},{key:"upsertPlaylist",value:function(t,r,e){var i=this;if(t){if(t.isMaster)this.streams.length=t.streams.length,t.streams.filter(function(u){return u.url}).forEach(function(u,c){i.streams[c]?i.streams[c].update(u):i.streams[c]=new nn(u)}),this.currentStream=this.streams[0];else if(Array.isArray(t.segments)){var s=this.currentStream;if(s){s.update(t,r,e);var o=s.updateSubtitle(e);o&&this.hls.emit(te.SUBTITLE_SEGMENTS,{list:o})}else this.reset(),this.currentStream=this.streams[0]=new nn(t,r,e)}var l=this.currentStream;l&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce(function(u,c){return u+=c.duration,u},0))}}},{key:"updateSegmentsRanges",value:function(t,r){var e,i=(e=this.currentSegments)===null||e===void 0?void 0:e.filter(function(s){return s.sn>=t});i.forEach(function(s){s.start=r,r=s.end})}},{key:"switchSubtitle",value:function(t){var r;(r=this.currentStream)===null||r===void 0||r.switchSubtitle(t)}},{key:"clearOldSegment",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=this.currentStream;if(!(!this.dvrWindow||!r)){var e=r.endTime-this.dvrWindow;if(!(e<=0)){var i=r.segments;i.length<=t||(this._segmentPointer=r.clearOldSegment(e,this._segmentPointer))}}}},{key:"checkSegmentTrackChange",value:function(t,r){var e=this.findSegmentIndexByTime(t),i=this.getSegmentByIndex(e);if(i&&!(!i.hasAudio&&!i.hasVideo)){if(r!==2&&i.hasAudio&&i.hasVideo)return i;if(!(i.end-t>.3)){var s=this.getSegmentByIndex(e+1);if(s&&!(!s.hasAudio&&!s.hasVideo)&&(s.hasAudio!==i.hasAudio||s.hasVideo!==i.hasVideo))return s}}}},{key:"feedbackLiveEdge",value:function(t,r){var e,i=this.currentSegments;if(i){var s=((e=this.lastSegment)===null||e===void 0?void 0:e.sn)===t.sn;if(s){this.liveEdge=r;return}this.updateSegmentsRanges(t.sn+1,r)}}}]),n}(),To=function(){function n(a){var t=this;Se(this,n),x(this,"error",null),x(this,"_emitOnLoaded",function(l,u){var c=l.data,d=l.response,h=l.options,p=h||{},v=p.firstByteTime,g=p.startTime,b=p.endTime,L=p.contentLength,G=b-g;t._bandwidthService.addRecord(L||c.byteLength,G),t.hls.emit(P.SPEED,{time:G,byteLength:L,url:u}),t.hls.emit(P.LOAD_COMPLETE,{url:u,elapsed:G||0}),t.hls.emit(P.TTFB,{url:u,responseUrl:d.url,elapsed:v-g}),t.hls.emit(P.LOAD_RESPONSE_HEADERS,{headers:d.headers,url:u})}),x(this,"_onLoaderRetry",function(l,u){t.hls.emit(P.LOAD_RETRY,{error:ce.network(l),retryTime:u})}),this.hls=a,this._bandwidthService=new Mn,this._mapCache={},this._keyCache={};var r=this.hls.config,e=r.retryCount,i=r.retryDelay,s=r.loadTimeout,o=r.fetchOptions;this._segmentLoader=new yt(se(se({},o),{},{responseType:"arraybuffer",retry:e,retryDelay:i,timeout:s,onRetryError:this._onLoaderRetry})),this._audioSegmentLoader=new yt(se(se({},o),{},{responseType:"arraybuffer",retry:e,retryDelay:i,timeout:s,onRetryError:this._onLoaderRetry})),this._keyLoader=new yt(se(se({},o),{},{responseType:"arraybuffer",retry:e,retryDelay:i,timeout:s,onRetryError:this._onLoaderRetry}))}return Le(n,[{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"load",value:function(t,r,e){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:e,s=[];return t&&(s[0]=this.loadVideoSegment(t,e)),r&&(s[1]=this.loadAudioSegment(r,i)),Promise.all(s)}},{key:"loadVideoSegment",value:function(t,r){return this._loadSegment(this._segmentLoader,t,r)}},{key:"loadAudioSegment",value:function(t,r){return this._loadSegment(this._audioSegmentLoader,t,r)}},{key:"_loadSegment",value:function(){var a=ie(z().mark(function r(e,i,s){var o=this,l,u,c,d,h,p,v,g,b,L,G,V,W,S,T;return z().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return v=[],this.hls.emit(P.LOAD_START,{url:i.url}),v[0]=e.load(i.url),s&&i.initSegment&&(b=i.initSegment.url,u=this._mapCache[b],u||(this.hls.emit(P.LOAD_START,{url:b}),v[1]=e.load(b).then(function(M){if(M){var I=Object.keys(o._mapCache);I>30&&(o._mapCache={}),u=o._mapCache[b]=M.data,o._emitOnLoaded(M,b)}})),L=(g=i.initSegment.key)===null||g===void 0?void 0:g.url,L&&(p=i.initSegment.key.iv,h=this._keyCache[L],h||(this.hls.emit(P.LOAD_START,{url:L}),v[2]=this._keyLoader.load(L).then(function(M){M&&(h=o._keyCache[L]=M.data,o._emitOnLoaded(M,L))})))),G=(l=i.key)===null||l===void 0?void 0:l.url,G&&i.key.isSegmentEncrypted()&&(d=i.key.iv,c=this._keyCache[G],c||(this.hls.emit(P.LOAD_START,{url:G}),v[3]=this._keyLoader.load(G).then(function(M){M&&(c=o._keyCache[G]=M.data,o._emitOnLoaded(M,G))}))),w.next=8,Promise.all(v);case 8:if(V=w.sent,W=ft(V,1),S=W[0],S){w.next=13;break}return w.abrupt("return");case 13:return T=S.data,this._emitOnLoaded(S,i.url),w.abrupt("return",{data:T,map:u,key:c,mapKey:h,keyIv:d,mapKeyIv:p});case 16:case"end":return w.stop()}},r,this)}));function t(r,e,i){return a.apply(this,arguments)}return t}()},{key:"reset",value:function(){this.error=null,this._mapCache={},this._keyCache={},this._bandwidthService.reset()}},{key:"cancel",value:function(){var a=ie(z().mark(function r(){return z().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()]);case 2:case"end":return i.stop()}},r,this)}));function t(){return a.apply(this,arguments)}return t}()}]),n}(),Re=new Me("hls"),Nt=function(n){Gr(t,n);var a=Wr(t);function t(r){var e;return Se(this,t),e=a.call(this),x(q(e),"version",t.version),x(q(e),"media",null),x(q(e),"config",null),x(q(e),"_manifestLoader",null),x(q(e),"_segmentLoader",null),x(q(e),"_playlist",null),x(q(e),"_bufferService",null),x(q(e),"_gapService",null),x(q(e),"_seiService",null),x(q(e),"_stats",null),x(q(e),"_prevSegSn",null),x(q(e),"_prevSegCc",null),x(q(e),"_tickTimer",null),x(q(e),"_tickInterval",500),x(q(e),"_segmentProcessing",!1),x(q(e),"_reloadOnPlay",!1),x(q(e),"_switchUrlOpts",null),x(q(e),"_isProcessQuotaExceeded",!1),x(q(e),"_loadSegment",ie(z().mark(function i(){var s,o,l,u,c,d,h,p,v;return z().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!(e._segmentProcessing||!e.media)){b.next=2;break}return b.abrupt("return");case 2:if(s=e._playlist,o=s.nextSegment,l=s.lastSegment,u=q(e),c=u.config,d=.016,h=Math.min(Math.max((l==null?void 0:l.duration)-d/2||0,d),.1),o){b.next=8;break}return b.abrupt("return");case 8:if(e.isLive){b.next=18;break}if(p=e.bufferInfo(),e.media.paused&&!e.media.currentTime&&(p=e.bufferInfo(p.nextStart||.5)),v=Math.abs(p.end-e.media.duration)<h,!(p.remaining>=c.preloadTime||v)){b.next=15;break}return e._tryEos(),b.abrupt("return");case 15:if(!(c.preferMMSStreaming&&!e._bufferService.msStreaming)){b.next=17;break}return b.abrupt("return");case 17:!e._urlSwitching&&e._prevSegSn!==o.sn-1&&p.end&&Math.abs(o.start-p.end)>1&&e._playlist.setNextSegmentByIndex(e._playlist.findSegmentIndexByTime(p.end+.1));case 18:return b.abrupt("return",e._loadSegmentDirect());case 19:case"end":return b.stop()}},i)}))),x(q(e),"_onLoadeddata",function(){e.isLive&&!e.config.mseLowLatency&&e.media.duration!==1/0&&e._bufferService.updateDuration(1/0).catch(function(i){})}),x(q(e),"_onPlay",ie(z().mark(function i(){return z().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(e.media.seeking&&e.media.currentTime===0)){o.next=3;break}return Re.debug("replay currentTime 0, return"),o.abrupt("return");case 3:if(clearTimeout(e._disconnectTimer),!e._reloadOnPlay){o.next=9;break}e._reloadOnPlay=!1,e.replay(!0),o.next=12;break;case 9:return o.next=11,e._loadSegment();case 11:e._startTick();case 12:case"end":return o.stop()}},i)}))),x(q(e),"_onPause",function(){if(e.isLive){if(!e._reloadOnPlay){var i=e.config.disconnectTime;if(i==null&&(i=e._playlist.dvrWindow),!Number.isFinite(i))return;clearTimeout(e._disconnectTimer),e._disconnectTimer=setTimeout(function(){e._reloadOnPlay=!0,e._clear()},i||0)}}else e._stopTick()}),x(q(e),"_onSeeking",ie(z().mark(function i(){var s,o,l,u,c,d,h;return z().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(e.media){v.next=2;break}return v.abrupt("return");case 2:if(e._onCheckQuotaExceeded(),s=e.media.currentTime,o=e._playlist.seekRange,!o){v.next=10;break}if(l=us(s,o[0],e.isLive?o[1]:e.media.duration),!(l>=0&&Math.abs(s-l)>=.1)){v.next=10;break}return e.media.currentTime=l,v.abrupt("return");case 10:if(u=e._playlist.currentSegment,c=fe.info(fe.get(e.media),s,.1),!u){v.next=17;break}if(!(c.end&&Math.abs(c.end-u.end)<.2)){v.next=15;break}return v.abrupt("return");case 15:if(!(e.isLive&&c.end)){v.next=17;break}return v.abrupt("return");case 17:if(d=e._playlist.findSegmentIndexByTime(s),h=e._playlist.getSegmentByIndex(d),!(d==null||!h||e._segmentProcessing&&h===e._playlist.nextSegment)){v.next=21;break}return v.abrupt("return");case 21:return Re.debug("seek to",s,h),e._playlist.setNextSegmentByIndex(d),e._stopTick(),v.next=26,e._segmentLoader.cancel();case 26:if(e._segmentProcessing=!1,!(!c.end||e.isLive)){v.next=30;break}return v.next=30,e._loadSegmentDirect(!0);case 30:e._startTick();case 31:case"end":return v.stop()}},i)}))),x(q(e),"_onTimeupdate",function(){if(e.media){var i=e.config;if(i.isLive&&i.maxLatency&&i.targetLatency&&e.media){var s=e._playlist.liveEdge;if(!s)return;var o=s-e.media.currentTime;o>=i.maxLatency&&(Re.debug("latency jump, currentTime:".concat(e.media.currentTime,", liveEdge:").concat(s,",  latency=").concat(o)),e.media.currentTime=s-i.targetLatency)}if(i.seiInTime){var l;(l=e._seiService)===null||l===void 0||l.throw(e.media.currentTime)}e.config.allowedStreamTrackChange&&!e.config.softDecode&&e._checkStreamTrackChange(e.media.currentTime)}}),x(q(e),"_tick",function(){if(e.media){e._startTick();var i=e.media,s=fe.get(i),o=e._segmentLoader.error;if(e._onCheckQuotaExceeded(),e._isProcessQuotaExceeded&&(e._bufferService.isFull()||(e._isProcessQuotaExceeded=!1,e._segmentProcessing=!1)),o){var l=.5;(!i.readyState||e.bufferInfo(l).remaining<1)&&(o.fatal=!0,e._emitError(ce.network(o)));return}fe.end(s)>=.1&&i.readyState&&(kn(i)?(e._loadSegment(),e._gapService&&e._gapService.do(i,e.config.maxJumpDistance,e.isLive)):i.readyState<2&&e._gapService&&e._gapService.do(i,e.config.maxJumpDistance,i.currentTime?e.isLive:!0)),e.isLive||e._tryEos()}}),e.config=r=lo(r),e.media=e.config.media,e._manifestLoader=new Wo(q(e)),e._segmentLoader=new To(q(e)),e._playlist=new wo(q(e)),e._bufferService=new oo(q(e)),r.seiInTime&&(e._seiService=new Yn(q(e))),r.softDecode||(e._gapService=new xn),e._stats=new In(q(e),9e4),e.media.addEventListener("loadeddata",e._onLoadeddata),e.media.addEventListener("play",e._onPlay),e.media.addEventListener("pause",e._onPause),e.media.addEventListener("seeking",e._onSeeking),e.media.addEventListener("timeupdate",e._onTimeupdate),e}return Le(t,[{key:"isLive",get:function(){return this._playlist.isLive}},{key:"streams",get:function(){return this._playlist.streams}},{key:"currentStream",get:function(){return this._playlist.currentStream}},{key:"hasSubtitle",get:function(){return this._playlist.hasSubtitle}},{key:"totalDuration",get:function(){return this._playlist.totalDuration}},{key:"baseDts",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.baseDts}},{key:"abrSwitchPoint",get:function(){var e=this._urlSwitching?this._playlist.currentSegment:this._playlist.nextSegment;return e?e.start+e.duration/2:null}},{key:"speedInfo",value:function(){return this._segmentLoader.speedInfo()}},{key:"bufferInfo",value:function(){var e,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1;return fe.info(fe.get(this.media),(e=this.media)===null||e===void 0?void 0:e.currentTime,i)}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"playbackQuality",value:function(){return Rn(this.media)}},{key:"load",value:function(){var r=ie(z().mark(function i(){var s,o,l,u=arguments;return z().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s=u.length>0&&u[0]!==void 0?u[0]:"",o=u.length>1&&u[1]!==void 0?u[1]:{},l=typeof o=="boolean"?o:!!(o!=null&&o.reuseMse),At(o)==="object"&&o!==null&&o!==void 0&&o.clearSwitchStatus&&(this._urlSwitching=!1,this._switchUrlOpts=null,this.config.startTime=void 0),s&&(this.config.url=s),s=this.config.url,d.next=8,this._reset(l);case 8:return d.next=10,this._loadData(s);case 10:this._startTick();case 11:case"end":return d.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_loadData",value:function(){var r=ie(z().mark(function i(s){var o,l,u,c,d,h,p,v,g,b,L,G,V;return z().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:try{s&&(s=s.trim())}catch{}if(s){S.next=3;break}throw this._emitError(new ce(U.OTHER,U.SUB_TYPES.OPTION,null,null,"m3u8 url is missing"));case 3:return S.next=5,this._loadM3U8(s);case 5:if(o=S.sent,l=this._playlist.currentStream,!this._urlSwitching){S.next=23;break}if(!this.isLive){S.next=14;break}u=this._playlist.setNextSegmentBySN(this._prevSegSn),Re.log("segment nb=".concat(this._prevSegSn," index of ").concat(u," in the new playlist")),u===-1&&(this._prevSegCc=null,this._prevSegSn=null),S.next=23;break;case 14:if(l.bitrate===0&&(c=this._switchUrlOpts)!==null&&c!==void 0&&c.bitrate&&(l.bitrate=(p=this._switchUrlOpts)===null||p===void 0?void 0:p.bitrate),v=typeof((d=this._switchUrlOpts)===null||d===void 0?void 0:d.startTime)=="number"?(h=this._switchUrlOpts)===null||h===void 0?void 0:h.startTime:this._getSeamlessSwitchPoint(),this.config.startTime=v,g=this._playlist.findSegmentIndexByTime(v),b=this._playlist.getSegmentByIndex(g+1),!b){S.next=23;break}return L=b.start,S.next=23,this._bufferService.removeBuffer(L);case 23:if(o){S.next=25;break}return S.abrupt("return");case 25:if(!this.isLive){S.next=36;break}if(this._bufferService.setLiveSeekableRange(0,4294967295),Re.log("totalDuration first time got:",this._playlist.totalDuration),Re.log("nb segments got:",this._playlist.nbSegments),this.config.targetLatency<this._playlist.totalDuration&&(this.config.targetLatency=this._playlist.totalDuration,this.config.maxLatency=1.5*this.config.targetLatency),o.isMaster||this._pollM3U8(s),!(this._playlist.nbSegments<this.config.minSegmentsStartPlay)){S.next=33;break}return S.abrupt("return");case 33:return S.next=35,this._loadSegment();case 35:return S.abrupt("return");case 36:return S.next=38,this._bufferService.updateDuration(l.totalDuration);case 38:return G=this.config.startTime,G&&((V=this._switchUrlOpts)!==null&&V!==void 0&&V.seamless||(this.media.currentTime=G),this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(G)||0)),S.next=42,this._loadSegment();case 42:case"end":return S.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"replay",value:function(){var r=ie(z().mark(function i(s){return z().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.config.startTime=0,this._urlSwitching=!1,this._switchUrlOpts=null,l.next=5,this.load();case 5:return this._reloadOnPlay=!1,l.abrupt("return",this.media.play(!s));case 7:case"end":return l.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"switchURL",value:function(){var r=ie(z().mark(function i(s){var o,l,u,c,d,h,p,v=arguments;return z().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:o=v.length>1&&v[1]!==void 0?v[1]:{},l={seamless:!1,startTime:0,bitrate:0},b.t0=At(o),b.next=b.t0==="number"?5:b.t0==="boolean"?7:b.t0==="object"?9:11;break;case 5:return o={startTime:o},b.abrupt("break",12);case 7:return o={seamless:o},b.abrupt("break",12);case 9:for(u in o)(o[u]===void 0||o[u]===null)&&delete o[u];return b.abrupt("break",12);case 11:throw"unsupported switchURL args: ".concat(o);case 12:if(o=Object.assign({},l,o),c=o,d=c.seamless,h=c.startTime,this.config.url=s,this.config.startTime=h,this._switchUrlOpts=o,d){b.next=38;break}if(b.prev=18,!this.config.softDecode){b.next=23;break}b.t1=this.load(s),b.next=26;break;case 23:return b.next=25,this.load(s);case 25:b.t1=b.sent;case 26:p=b.t1,b.next=33;break;case 29:throw b.prev=29,b.t2=b.catch(18),this.emit(te.SWITCH_URL_FAILED,b.t2),b.t2;case 33:return this._reloadOnPlay=!1,p&&this.emit(te.SWITCH_URL_SUCCESS,{url:s}),b.abrupt("return",this.media.play(!0));case 38:return this._urlSwitching=!0,this.isLive||(this._prevSegSn=null,this._prevSegCc=null),this._playlist.reset(),this._bufferService.seamlessSwitch(),b.next=44,this._clear();case 44:return b.next=46,this._loadData(s);case 46:this._startTick();case 47:this._switchUrlOpts=null;case 48:case"end":return b.stop()}},i,this,[[18,29]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"switchStream",value:function(){var r=ie(z().mark(function i(s){var o,l,u,c,d,h=arguments;return z().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(o=h.length>1&&h[1]!==void 0?h[1]:!0,l=this.currentStream,u=this.streams,!(!l||l.id===s||!u||u.length<2)){v.next=5;break}return v.abrupt("return");case 5:if(c=u.find(function(g){return g.id===s}),c){v.next=8;break}return v.abrupt("return");case 8:return v.prev=8,v.next=11,this._clear();case 11:if(!o){v.next=14;break}return v.next=14,this._bufferService.clearAllBuffer();case 14:v.next=19;break;case 16:throw v.prev=16,v.t0=v.catch(8),this._emitError(ce.create(v.t0));case 19:if(l.currentAudioStream&&c.audioStreams.length>2&&(d=l.currentAudioStream.id,c.currentAudioStream=c.audioStreams.find(function(g){return g.id===d})||c.currentAudioStream),this._playlist.currentStream=c,v.prev=21,!(this.isLive||!c.segments.length)){v.next=25;break}return v.next=25,this._refreshM3U8();case 25:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,v.next=29,this._loadSegmentDirect();case 29:v.next=35;break;case 31:throw v.prev=31,v.t1=v.catch(21),this._playlist.currentStream=l,v.t1;case 35:return this._startTick(),v.abrupt("return",c);case 37:case"end":return v.stop()}},i,this,[[8,16],[21,31]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"switchAudioStream",value:function(){var r=ie(z().mark(function i(s){var o,l,u,c,d=arguments;return z().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(o=d.length>1&&d[1]!==void 0?d[1]:!0,l=this.currentStream,l){p.next=4;break}return p.abrupt("return");case 4:if(u=l.currentAudioStream,!(!u||u.id===s||l.audioStreams.length<2)){p.next=7;break}return p.abrupt("return");case 7:if(c=l.audioStreams.find(function(v){return v.id===s}),c){p.next=10;break}return p.abrupt("return");case 10:return p.prev=10,p.next=13,this._clear();case 13:if(!o){p.next=16;break}return p.next=16,this._bufferService.clearAllBuffer();case 16:p.next=21;break;case 18:throw p.prev=18,p.t0=p.catch(10),this._emitError(ce.create(p.t0));case 21:if(l.currentAudioStream=c,p.prev=22,!(this.isLive||!c.segments.length)){p.next=26;break}return p.next=26,this._refreshM3U8();case 26:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,p.next=30,this._loadSegmentDirect();case 30:p.next=36;break;case 32:throw p.prev=32,p.t1=p.catch(22),l.currentAudioStream=u,p.t1;case 36:return this._startTick(),p.abrupt("return",c);case 38:case"end":return p.stop()}},i,this,[[10,18],[22,32]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"switchSubtitleStream",value:function(){var r=ie(z().mark(function i(s){return z().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this._playlist.switchSubtitle(s),l.next=3,this._manifestLoader.stopPoll();case 3:return l.next=5,this._refreshM3U8();case 5:case"end":return l.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"detachMedia",value:function(){var r=ie(z().mark(function i(){return z().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this._bufferService){o.next=3;break}return o.next=3,this._bufferService.detachMedia();case 3:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var r=ie(z().mark(function i(){var s;return z().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.media){l.next=2;break}return l.abrupt("return");case 2:return this.removeAllListeners(),this._playlist.reset(),this._segmentLoader.reset(),(s=this._seiService)===null||s===void 0||s.reset(),this.media.removeEventListener("loadeddata",this._onLoadeddata),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("pause",this._onPause),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),l.next=13,Promise.all([this._clear(),this._bufferService.destroy()]);case 13:this.media=null;case 14:case"end":return l.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_loadM3U8",value:function(){var r=ie(z().mark(function i(s){var o,l,u,c,d,h,p;return z().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(g.prev=0,c=(l=this.config.manifestList)===null||l===void 0||(u=l.filter(function(b){return b.url===s})[0])===null||u===void 0?void 0:u.manifest,!c){g.next=6;break}g.t0=this._manifestLoader.parseText(c,s),g.next=9;break;case 6:return g.next=8,this._manifestLoader.load(s);case 8:g.t0=g.sent;case 9:d=g.t0,h=ft(d,1),o=h[0],g.next=17;break;case 14:throw g.prev=14,g.t1=g.catch(0),this._emitError(ce.create(g.t1));case 17:if(o){g.next=19;break}return g.abrupt("return");case 19:if(this._playlist.upsertPlaylist(o),!o.isMaster){g.next=24;break}return(p=this._playlist.currentStream.subtitleStreams)!==null&&p!==void 0&&p.length&&this.emit(te.SUBTITLE_PLAYLIST,{list:this._playlist.currentStream.subtitleStreams}),g.next=24,this._refreshM3U8();case 24:return this.emit(te.STREAM_PARSED),g.abrupt("return",o);case 26:case"end":return g.stop()}},i,this,[[0,14]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"_refreshM3U8",value:function(){var e,i,s=this,o=this._playlist.currentStream;if(!o||!o.url)throw this._emitError(ce.create(null,null,new Error("m3u8 url is not defined")));var l=o.url,u=(e=o.currentAudioStream)===null||e===void 0?void 0:e.url,c=(i=o.currentSubtitleStream)===null||i===void 0?void 0:i.url;return this._manifestLoader.load(l,u,c).then(function(d){var h=ft(d,3),p=h[0],v=h[1],g=h[2];p&&(s._playlist.upsertPlaylist(p,v,g),s.isLive&&s._pollM3U8(l,u,c))}).catch(function(d){throw s._emitError(ce.create(d))})}},{key:"_pollM3U8",value:function(e,i,s){var o=this,l=this._playlist.isEmpty,u;if(this._playlist.lowLatency)u=(this._playlist.currentStream.partTargetDuration||0)*1e3;else{var c;u=(((c=this._playlist.lastSegment)===null||c===void 0?void 0:c.duration)||0)*1e3}this._manifestLoader.poll(e,i,s,function(d,h,p){o._playlist.upsertPlaylist(d,h,p),o._playlist.clearOldSegment();var v=d&&l&&!o._playlist.isEmpty;(v||!o._playlist.hadSegmentLoaded&&o._playlist.nbSegments>=o.config.minSegmentsStartPlay)&&o._loadSegment(),l&&(l=o._playlist.isEmpty)},function(d){o._emitError(ce.create(d))},u)}},{key:"_loadSegmentDirect",value:function(){var r=ie(z().mark(function i(s){var o,l,u,c,d,h;return z().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(o=this._playlist.nextSegment,o){v.next=3;break}return v.abrupt("return");case 3:return l=!1,u=null,v.prev=5,this._segmentProcessing=!0,Re.log("load segment, sn:".concat(o.sn,", [").concat(o.start,", ").concat(o.end,"], partIndex:").concat(o.partIndex)),v.next=10,this._reqAndBufferSegment(o,this._playlist.getAudioSegment(o));case 10:l=v.sent,v.next=16;break;case 13:v.prev=13,v.t0=v.catch(5),u=v.t0;case 16:return v.prev=16,this._segmentProcessing=!1,v.finish(16);case 19:if(!u){v.next=26;break}if(!this._bufferService.isFull()){v.next=25;break}return Re.log("load segment, sn:".concat(o.sn,", partIndex:").concat(o.partIndex)),this._segmentProcessing=!0,this._isProcessQuotaExceeded=!0,v.abrupt("return",!1);case 25:return v.abrupt("return",this._emitError(ce.create(u)));case 26:return l&&(d=this.bufferInfo().end,this.isLive&&!this.media.seeking&&d&&Math.abs(o.end-d)>1&&(Re.warn("segment: ".concat(o.sn," expected end=").concat(o.end,", real end=").concat(d)),this._playlist.feedbackLiveEdge(o,d)),h=((c=this._playlist.currentStream)===null||c===void 0?void 0:c.url)===o.parentUrl,this._urlSwitching&&!h&&(Re.warn("pre playlist segment appended!"),this._bufferService.seamlessSwitch()),this.isLive&&this._urlSwitching&&h&&(this._urlSwitching=!1,this.emit(te.SWITCH_URL_SUCCESS,{url:this.config.url})),this._playlist.moveSegmentPointer(),o.isLast?this._end():s||this._loadSegment()),v.abrupt("return",l);case 28:case"end":return v.stop()}},i,this,[[5,13,16,19]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"_reqAndBufferSegment",value:function(){var r=ie(z().mark(function i(s,o){var l,u,c,d,h,p,v,g,b,L,G;return z().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return u=s?s.cc:o.cc,c=this._prevSegCc!==u,d=[],W.prev=3,W.next=6,this._segmentLoader.load(s,o,c);case 6:d=W.sent,W.next=14;break;case 9:throw W.prev=9,W.t0=W.catch(3),W.t0.fatal=!1,this._segmentLoader.error=W.t0,W.t0;case 14:if(d[0]){W.next=16;break}return W.abrupt("return");case 16:return W.next=18,(l=this._bufferService).decryptBuffer.apply(l,Qa(d));case 18:if(h=W.sent,h){W.next=21;break}return W.abrupt("return");case 21:return p=s?s.sn:o.sn,v=s?s.start:o.start,g=this._playlist.currentStream,this._bufferService.createSource(h[0],h[1],g==null?void 0:g.videoCodec,g==null?void 0:g.audioCodec),b=Date.now(),L=this._prevSegSn===p-1,this.isLive&&this._urlSwitching&&(G=this.bufferInfo().end,this._playlist.updateSegmentsRanges(p,G),Re.warn("update the new playlist liveEdge, segment id=".concat(p,", buffer start=").concat(G,", liveEdge=").concat(this._playlist.liveEdge)),v=G),W.next=30,this._bufferService.appendBuffer(s,o,h[0],h[1],c,L,v);case 30:return this.emit(te.APPEND_COST,{elapsed:Date.now()-b,url:s.url}),W.next=33,this._bufferService.evictBuffer(this.config.bufferBehind);case 33:return this._prevSegCc=u,this._prevSegSn=p,W.abrupt("return",!0);case 36:case"end":return W.stop()}},i,this,[[3,9]])}));function e(i,s){return r.apply(this,arguments)}return e}()},{key:"_onCheckQuotaExceeded",value:function(){var r=ie(z().mark(function i(){var s,o,l,u,c,d;return z().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:s=this.media.currentTime,o=this.media.buffered,l=!1,u=0;case 4:if(!(u<o.length)){p.next=11;break}if(!(o.start(0)>=s&&s<o.end(u))){p.next=8;break}return l=!0,p.abrupt("break",11);case 8:u++,p.next=4;break;case 11:if(!this._bufferService.isFull()){p.next=17;break}if(c=l?this.config.bufferBehind:5,d=this.media.currentTime,!(d-c>0)){p.next=17;break}return p.next=17,this._bufferService.removeBuffer(0,d-c);case 17:case"end":return p.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_checkStreamTrackChange",value:function(e){var i=this._playlist.checkSegmentTrackChange(e,this._bufferService.nbSb);i&&this.switchURL(this.config.url,i.start+.2)}},{key:"_clear",value:function(){var r=ie(z().mark(function i(){return z().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return clearTimeout(this._disconnectTimer),this._stopTick(),o.next=4,Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]);case 4:this._segmentProcessing=!1;case 5:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_reset",value:function(){var r=ie(z().mark(function i(){var s,o,l=arguments;return z().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=l.length>0&&l[0]!==void 0?l[0]:!1,this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._switchUrlOpts=null,this._playlist.reset(),this._segmentLoader.reset(),(s=this._seiService)===null||s===void 0||s.reset(),this._stats.reset(),c.next=11,this._clear();case 11:return c.abrupt("return",this._bufferService.reset(o));case 12:case"end":return c.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_end",value:function(){this._clear(),this._bufferService.endOfStream(),(this.media.readyState<=2||this.media.buffered.length>1)&&this._startTick()}},{key:"_stopTick",value:function(){this._tickTimer&&clearTimeout(this._tickTimer),this._tickTimer=null}},{key:"_startTick",value:function(){this._stopTick(),this._tickTimer=setTimeout(this._tick,this._tickInterval)}},{key:"_emitError",value:function(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(((i=e.originError)===null||i===void 0?void 0:i.fatal)===!1)Re.warn(e);else{var o,l,u;Re.table(e),Re.error(e),Re.error((o=this.media)===null||o===void 0?void 0:o.error),(l=this.media)!==null&&l!==void 0&&l.readyState&&this.media.pause(),this._stopTick(),this._urlSwitching&&(this._urlSwitching=!1,this.emit(te.SWITCH_URL_FAILED,e)),this.emit(te.ERROR,e),s&&this._end(),(u=this._seiService)===null||u===void 0||u.reset()}return e}},{key:"_getSeamlessSwitchPoint",value:function(){var e=this.media,i=e.currentTime;if(!e.paused){var s,o=this._playlist.findSegmentIndexByTime(e.currentTime),l=this._playlist.getSegmentByIndex(o),u=(s=this._stats)===null||s===void 0?void 0:s.getStats().downloadSpeed;if(u&&l){var c=l.duration*this._playlist.currentStream.bitrate/u+1;i+=c}else i+=5}return i}},{key:"_tryEos",value:function(){var e,i,s=this.media,o=this._playlist,l=o.nextSegment,u=o.lastSegment,c=(!l||u&&fe.isBuffered(s,u.start+u.duration/2))&&s.readyState&&s.duration>0&&((e=this._bufferService)===null||e===void 0?void 0:e.msIsOpened)&&!((i=this._bufferService)!==null&&i!==void 0&&i.msHasOpTasks);if(c){var d=this.bufferInfo();s.paused&&!s.currentTime&&(d=this.bufferInfo(d.nextStart||.5));var h=Math.abs(d.end-s.duration)<.1||!this.isLive&&u&&d.end>=u.start+u.duration;h&&this._bufferService.endOfStream()}}}],[{key:"isSupported",value:function(e){return!e||e==="video"||e==="audio"?he.isSupported():typeof WebAssembly<"u"}},{key:"enableLogger",value:function(){Me.enable(),kt.enable()}},{key:"disableLogger",value:function(){Me.disable(),kt.disable()}}]),t}(gt);x(Nt,"version","3.0.20");try{localStorage.getItem("xgd")?Nt.enableLogger():Nt.disableLogger()}catch{}var Vo=function(){function n(a,t){var r=this;Se(this,n),x(this,"_opts",null),x(this,"_plugin",null),x(this,"_onLowDecode",function(){var e,i,s,o,l=r._opts,u=l.media,c=l.innerDegrade;(e=r._plugin)===null||e===void 0||(i=e.player)===null||i===void 0||i.emit("lowdecode",u.degradeInfo),(s=r._plugin)===null||s===void 0||(o=s.player)===null||o===void 0||o.emit("core_event",se(se({},u.degradeInfo),{},{eventName:te.LOWDECODE})),c===1&&r._degrade(u.src)}),x(this,"_degrade",function(e){var i=r._plugin.player,s=i.video;if(!(s&&s.TAG!=="MVideo")){var o=i.video.degradeVideo;i.video=o,s.degrade(e),e&&(i.config.url=e);var l=i.root.firstChild;l.TAG==="MVideo"&&i.root.replaceChild(o,l);var u=r._plugin.constructor.pluginName.toLowerCase();i.unRegisterPlugin(u),i.once("canplay",function(){i.play()})}}),x(this,"forceDegradeToVideo",function(e){var i=r._opts.innerDegrade;i===1&&r._degrade(e)}),this._opts=a,this._plugin=t,this._init()}return Le(n,[{key:"_init",value:function(){var t=this._opts,r=t.media,e=t.preloadTime,i=t.innerDegrade,s=t.isLive;if(r){if(!s&&r.setPlayMode){r.setPlayMode("VOD");return}i&&r.setAttribute("innerdegrade",i),e&&r.setAttribute("preloadtime",e),this._bindEvents()}}},{key:"_bindEvents",value:function(){var t=this._opts.media;t.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var t,r;(t=this._opts)===null||t===void 0||(r=t.media)===null||r===void 0||r.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),n}(),ko=["currentTime"];function Ro(n,a){var t=a.player,r=t.currentTime,e={startTime:r};switch(At(n)){case"boolean":e.seamless=n;break;case"object":{var i=n.currentTime,s=si(n,ko);Object.assign(e,s),typeof i=="number"&&(e.startTime=i);break}}return e}var cs=function(n){Gr(t,n);var a=Wr(t);function t(){var r;Se(this,t);for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return r=a.call.apply(a,[this].concat(i)),x(q(r),"logger",Re),x(q(r),"hls",null),x(q(r),"pluginExtension",null),x(q(r),"getStats",function(){var o;return(o=r.hls)===null||o===void 0?void 0:o.getStats()}),x(q(r),"_onSwitchSubtitle",function(o){var l,u=o.lang;(l=r.hls)===null||l===void 0||l.switchSubtitleStream(u)}),x(q(r),"_keepPauseStatus",function(){var o=r.player.paused;o&&r.player.once("canplay",function(){r.player.pause()})}),r}return Le(t,[{key:"core",get:function(){return this.hls}},{key:"version",get:function(){var e;return(e=this.hls)===null||e===void 0?void 0:e.version}},{key:"softDecode",get:function(){var e,i,s=(e=this.player)===null||e===void 0||(i=e.config)===null||i===void 0?void 0:i.mediaType;return!!s&&s!=="video"&&s!=="audio"}},{key:"beforePlayerInit",value:function(){var e=this,i=this.player.config,s=this.player.media||this.player.video,o=i.hls||{};if(!(!i.url&&!i.__allowHlsEmptyUrl__||!o.preferMMS&&he.isMMSOnly())){this.hls&&this.hls.destroy();var l=Object.getOwnPropertyDescriptor(this.player,"switchURL");(!l||l.writable)&&(this.player.switchURL=function(d,h){return new Promise(function(p,v){var g=e.player,b=e.hls;if(b){var L,G,V=Ro(h,e);g.config.url=d,b.switchURL(d,V).then(function(){return p(!0)}).catch(v),!V.seamless&&(L=e.player.config)!==null&&L!==void 0&&(G=L.hls)!==null&&G!==void 0&&G.keepStatusAfterSwitch&&e._keepPauseStatus()}else v()})});var u=this.player.switchURL;if(this.player.handleSource=!1,o.innerDegrade=o.innerDegrade||i.innerDegrade,(o.disconnectTime===null||o.disconnectTime===void 0)&&(o.disconnectTime=0),this.hls=new Nt(se({softDecode:this.softDecode,isLive:i.isLive,media:s,startTime:i.startTime,url:i.url},o)),this.softDecode||Ct.defineGetterOrSetter(this.player,{url:{get:function(){var h,p;return(h=e.hls)===null||h===void 0||(p=h.media)===null||p===void 0?void 0:p.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new Vo(se({isLive:i.isLive,media:s},o),this),this.player.forceDegradeToVideo=function(){for(var d,h=arguments.length,p=new Array(h),v=0;v<h;v++)p[v]=arguments[v];return(d=e.pluginExtension)===null||d===void 0?void 0:d.forceDegradeToVideo.apply(d,p)}),i.isLive){var c;(c=this.player)===null||c===void 0||c.useHooks("replay",function(){var d;return(d=e.hls)===null||d===void 0?void 0:d.replay()})}this.on(Ht,u),this.on(bs,this._onSwitchSubtitle),this.on(bn,this.destroy.bind(this)),this._transError(),this._transCoreEvent(P.TTFB),this._transCoreEvent(P.LOAD_START),this._transCoreEvent(P.LOAD_RESPONSE_HEADERS),this._transCoreEvent(P.LOAD_COMPLETE),this._transCoreEvent(P.LOAD_RETRY),this._transCoreEvent(P.SOURCEBUFFER_CREATED),this._transCoreEvent(P.MEDIASOURCE_OPENED),this._transCoreEvent(P.APPEND_BUFFER),this._transCoreEvent(P.REMOVE_BUFFER),this._transCoreEvent(P.BUFFEREOS),this._transCoreEvent(P.KEYFRAME),this._transCoreEvent(P.METADATA_PARSED),this._transCoreEvent(P.DEMUXED_TRACK),this._transCoreEvent(P.SEI),this._transCoreEvent(P.SEI_IN_TIME),this._transCoreEvent(P.SPEED),this._transCoreEvent(P.HLS_MANIFEST_LOADED),this._transCoreEvent(P.HLS_LEVEL_LOADED),this._transCoreEvent(P.STREAM_EXCEPTION),this._transCoreEvent(P.SWITCH_URL_SUCCESS),this._transCoreEvent(P.SWITCH_URL_FAILED),this._transCoreEvent(te.NO_AUDIO_TRACK),this._transCoreEvent(te.STREAM_PARSED),this._transCoreEvent(te.SUBTITLE_SEGMENTS),this._transCoreEvent(te.SUBTITLE_PLAYLIST),this._transCoreEvent(te.APPEND_COST),i.url&&this.hls.load(i.url,{reuseMse:!0}).catch(function(d){})}}},{key:"destroy",value:function(){var e;this.hls&&(this.hls.destroy(),this.hls=null),(e=this.pluginExtension)===null||e===void 0||e.destroy(),this.pluginExtension=null}},{key:"_transError",value:function(){var e=this;this.hls.on(te.ERROR,function(i){e.player&&e.player.emit(gn,new Gt(e.player,i))})}},{key:"_transCoreEvent",value:function(e){var i=this;this.hls.on(e,function(s){i.player&&(i.player.emit("core_event",se(se({},s),{},{eventName:e})),e===P.SEI_IN_TIME&&i.hls.hasSubtitle&&i._emitSeiPaylodTime(s))})}},{key:"_emitSeiPaylodTime",value:function(e){try{var i=JSON.parse(Array.from(e.data.payload).map(function(s){return String.fromCharCode(s)}).join("").slice(0,-1));if(!i.rtmp_dts)return;this.player.emit("core_event",{eventName:te.SEI_PAYLOAD_TIME,time:i.rtmp_dts})}catch{}}}],[{key:"pluginName",get:function(){return"hls"}},{key:"isSupported",value:function(e,i){return Nt.isSupported(e,i)}}]),t}(Ct);x(cs,"Hls",Nt);x(cs,"EVENT",te);function sn(n,a){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,r)}return t}function vt(n){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?sn(Object(t),!0).forEach(function(r){Je(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):sn(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function ne(){ne=function(){return n};var n={},a=Object.prototype,t=a.hasOwnProperty,r=Object.defineProperty||function(f,m,y){f[m]=y.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",s=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function l(f,m,y){return Object.defineProperty(f,m,{value:y,enumerable:!0,configurable:!0,writable:!0}),f[m]}try{l({},"")}catch{l=function(m,y,X){return m[y]=X}}function u(f,m,y,X){var Z=m&&m.prototype instanceof h?m:h,R=Object.create(Z.prototype),Y=new M(X||[]);return r(R,"_invoke",{value:S(f,y,Y)}),R}function c(f,m,y){try{return{type:"normal",arg:f.call(m,y)}}catch(X){return{type:"throw",arg:X}}}n.wrap=u;var d={};function h(){}function p(){}function v(){}var g={};l(g,i,function(){return this});var b=Object.getPrototypeOf,L=b&&b(b(I([])));L&&L!==a&&t.call(L,i)&&(g=L);var G=v.prototype=h.prototype=Object.create(g);function V(f){["next","throw","return"].forEach(function(m){l(f,m,function(y){return this._invoke(m,y)})})}function W(f,m){function y(Z,R,Y,N){var _=c(f[Z],f,R);if(_.type!=="throw"){var K=_.arg,j=K.value;return j&&typeof j=="object"&&t.call(j,"__await")?m.resolve(j.__await).then(function(H){y("next",H,Y,N)},function(H){y("throw",H,Y,N)}):m.resolve(j).then(function(H){K.value=H,Y(K)},function(H){return y("throw",H,Y,N)})}N(_.arg)}var X;r(this,"_invoke",{value:function(Z,R){function Y(){return new m(function(N,_){y(Z,R,N,_)})}return X=X?X.then(Y,Y):Y()}})}function S(f,m,y){var X="suspendedStart";return function(Z,R){if(X==="executing")throw new Error("Generator is already running");if(X==="completed"){if(Z==="throw")throw R;return D()}for(y.method=Z,y.arg=R;;){var Y=y.delegate;if(Y){var N=T(Y,y);if(N){if(N===d)continue;return N}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(X==="suspendedStart")throw X="completed",y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);X="executing";var _=c(f,m,y);if(_.type==="normal"){if(X=y.done?"completed":"suspendedYield",_.arg===d)continue;return{value:_.arg,done:y.done}}_.type==="throw"&&(X="completed",y.method="throw",y.arg=_.arg)}}}function T(f,m){var y=m.method,X=f.iterator[y];if(X===void 0)return m.delegate=null,y==="throw"&&f.iterator.return&&(m.method="return",m.arg=void 0,T(f,m),m.method==="throw")||y!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+y+"' method")),d;var Z=c(X,f.iterator,m.arg);if(Z.type==="throw")return m.method="throw",m.arg=Z.arg,m.delegate=null,d;var R=Z.arg;return R?R.done?(m[f.resultName]=R.value,m.next=f.nextLoc,m.method!=="return"&&(m.method="next",m.arg=void 0),m.delegate=null,d):R:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,d)}function k(f){var m={tryLoc:f[0]};1 in f&&(m.catchLoc=f[1]),2 in f&&(m.finallyLoc=f[2],m.afterLoc=f[3]),this.tryEntries.push(m)}function w(f){var m=f.completion||{};m.type="normal",delete m.arg,f.completion=m}function M(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(k,this),this.reset(!0)}function I(f){if(f){var m=f[i];if(m)return m.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var y=-1,X=function Z(){for(;++y<f.length;)if(t.call(f,y))return Z.value=f[y],Z.done=!1,Z;return Z.value=void 0,Z.done=!0,Z};return X.next=X}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=v,r(G,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=l(v,o,"GeneratorFunction"),n.isGeneratorFunction=function(f){var m=typeof f=="function"&&f.constructor;return!!m&&(m===p||(m.displayName||m.name)==="GeneratorFunction")},n.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,v):(f.__proto__=v,l(f,o,"GeneratorFunction")),f.prototype=Object.create(G),f},n.awrap=function(f){return{__await:f}},V(W.prototype),l(W.prototype,s,function(){return this}),n.AsyncIterator=W,n.async=function(f,m,y,X,Z){Z===void 0&&(Z=Promise);var R=new W(u(f,m,y,X),Z);return n.isGeneratorFunction(m)?R:R.next().then(function(Y){return Y.done?Y.value:R.next()})},V(G),l(G,o,"Generator"),l(G,i,function(){return this}),l(G,"toString",function(){return"[object Generator]"}),n.keys=function(f){var m=Object(f),y=[];for(var X in m)y.push(X);return y.reverse(),function Z(){for(;y.length;){var R=y.pop();if(R in m)return Z.value=R,Z.done=!1,Z}return Z.done=!0,Z}},n.values=I,M.prototype={constructor:M,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!f)for(var m in this)m.charAt(0)==="t"&&t.call(this,m)&&!isNaN(+m.slice(1))&&(this[m]=void 0)},stop:function(){this.done=!0;var f=this.tryEntries[0].completion;if(f.type==="throw")throw f.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var m=this;function y(_,K){return R.type="throw",R.arg=f,m.next=_,K&&(m.method="next",m.arg=void 0),!!K}for(var X=this.tryEntries.length-1;X>=0;--X){var Z=this.tryEntries[X],R=Z.completion;if(Z.tryLoc==="root")return y("end");if(Z.tryLoc<=this.prev){var Y=t.call(Z,"catchLoc"),N=t.call(Z,"finallyLoc");if(Y&&N){if(this.prev<Z.catchLoc)return y(Z.catchLoc,!0);if(this.prev<Z.finallyLoc)return y(Z.finallyLoc)}else if(Y){if(this.prev<Z.catchLoc)return y(Z.catchLoc,!0)}else{if(!N)throw new Error("try statement without catch or finally");if(this.prev<Z.finallyLoc)return y(Z.finallyLoc)}}}},abrupt:function(f,m){for(var y=this.tryEntries.length-1;y>=0;--y){var X=this.tryEntries[y];if(X.tryLoc<=this.prev&&t.call(X,"finallyLoc")&&this.prev<X.finallyLoc){var Z=X;break}}Z&&(f==="break"||f==="continue")&&Z.tryLoc<=m&&m<=Z.finallyLoc&&(Z=null);var R=Z?Z.completion:{};return R.type=f,R.arg=m,Z?(this.method="next",this.next=Z.finallyLoc,d):this.complete(R)},complete:function(f,m){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&m&&(this.next=m),d},finish:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.finallyLoc===f)return this.complete(y.completion,y.afterLoc),w(y),d}},catch:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc===f){var X=y.completion;if(X.type==="throw"){var Z=X.arg;w(y)}return Z}}throw new Error("illegal catch attempt")},delegateYield:function(f,m,y){return this.delegate={iterator:I(f),resultName:m,nextLoc:y},this.method==="next"&&(this.arg=void 0),d}},n}function an(n,a,t,r,e,i,s){try{var o=n[i](s),l=o.value}catch(u){t(u);return}o.done?a(l):Promise.resolve(l).then(r,e)}function xe(n){return function(){var a=this,t=arguments;return new Promise(function(r,e){var i=n.apply(a,t);function s(l){an(i,r,e,s,o,"next",l)}function o(l){an(i,r,e,s,o,"throw",l)}s(void 0)})}}function Rt(n,a){if(!(n instanceof a))throw new TypeError("Cannot call a class as a function")}function on(n,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,ds(r.key),r)}}function xt(n,a,t){return a&&on(n.prototype,a),t&&on(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function Je(n,a,t){return a=ds(a),a in n?Object.defineProperty(n,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[a]=t,n}function vi(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),a&&oi(n,a)}function yr(n){return yr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},yr(n)}function oi(n,a){return oi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},oi(n,a)}function xo(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ge(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Yo(n,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ge(n)}function yi(n){var a=xo();return function(){var r=yr(n),e;if(a){var i=yr(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Yo(this,e)}}function Mo(n,a){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,a||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(n)}function ds(n){var a=Mo(n,"string");return typeof a=="symbol"?a:String(a)}var bi={};Object.defineProperty(bi,"__esModule",{value:!0});bi.default=function(n){for(var a=0,t=arguments.length,r=Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];var i=!0,s=!1,o=void 0;try{for(var l=r[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var c=u.value;a+=c.length}}catch(V){s=!0,o=V}finally{try{!i&&l.return&&l.return()}finally{if(s)throw o}}var d=new n(a),h=0,p=!0,v=!1,g=void 0;try{for(var b=r[Symbol.iterator](),L;!(p=(L=b.next()).done);p=!0){var G=L.value;d.set(G,h),h+=G.length}}catch(V){v=!0,g=V}finally{try{!p&&b.return&&b.return()}finally{if(v)throw g}}return d};var Io=bi,Eo=_o(Io);function _o(n){return n&&n.__esModule?n:{default:n}}var Co=Eo.default;const Po=Ls(Co);var hs="3.0.20",et={416:ve[U.NETWROK_RANGE_NOT_SATISFIABLE],403:ve[U.NETWORK_FORBIDDEN],404:ve[U.NETWORK_NOTFOUND],timeout:ve[U.NETWORK_TIMEOUT],"4xx":"".concat(ve[U.NETWORK],"4XX"),"5xx":"".concat(ve[U.NETWORK],"5XX"),networkError:ve[U.NETWORK],contentError:"".concat(ve[U.NETWORK],"contentError"),mse:ve[U.MEDIA][U.SUB_TYPES.MSE_OTHER],mseOpen:ve[U.MEDIA][U.SUB_TYPES.MSE_ADD_SB],mseAppend:ve[U.MEDIA][U.SUB_TYPES.MSE_APPEND_BUFFER],mse_hijack:ve[U.MEDIA][U.SUB_TYPES.MSE_HIJACK],eme_hijack:ve[U.MEDIA][U.SUB_TYPES.EME_HIJACK],metaError:ve[U.DEMUX][U.SUB_TYPES.MP4],muxError:ve[U.REMUX][U.SUB_TYPES.FMP4],other:ve[U.OTHER],waitTimeout:ve[U.RUNTIME][U.SUB_TYPES.BUFFERBREAK_ERROR],waitTimeoutWithHidden:ve[U.RUNTIME][U.SUB_TYPES.WAITING_TIMEOUT_ERROR],drm:ve[U.DRM][U.SUB_TYPES.LICENSE]},It=U;function No(n){return et[n]||n}var Ko=xt(function n(a,t,r){Rt(this,n);var e=0,i=0;r&&r.range&&r.range.length>1&&(e=r.range[0],i=r.range[1]);var s=No(t);return{errorCode:s,errorType:a,errorMessage:(r==null?void 0:r.httpText)||(r==null?void 0:r.message),url:r==null?void 0:r.url,httpCode:t,version:hs,rangeStart:e,rangeEnd:i,ext:r,mediaError:{code:s,message:(r==null?void 0:r.httpText)||(r==null?void 0:r.message)}}}),Do=xt(function n(a,t,r){return Rt(this,n),{errorCode:t,errorType:a,version:hs,errorMessage:r.msg,ext:r,mediaError:{code:t,message:r.msg}}}),st={};st.nowTime=function(){try{return parseInt(performance.now(),10)}catch{return new Date().getTime()}};st.concatData=function(n,a){var t=[],r=0;n&&t.push(n),a&&t.push(a),t.every(function(s){return s&&(r+=s.byteLength),!0});var e=new Uint8Array(r),i=0;return t.every(function(s){return s&&(e.set(s,i),i+=s.byteLength),!0}),e};function Ho(n,a){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,e,i,s,o=[],l=!0,u=!1;try{if(i=(t=t.call(n)).next,a!==0)for(;!(l=(r=i.call(t)).done)&&(o.push(r.value),o.length!==a);l=!0);}catch(c){u=!0,e=c}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(u)throw e}}return o}}function ln(n,a){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,r)}return t}function li(n){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?ln(Object(t),!0).forEach(function(r){De(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ln(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function ue(){ue=function(){return n};var n={},a=Object.prototype,t=a.hasOwnProperty,r=Object.defineProperty||function(f,m,y){f[m]=y.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",s=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function l(f,m,y){return Object.defineProperty(f,m,{value:y,enumerable:!0,configurable:!0,writable:!0}),f[m]}try{l({},"")}catch{l=function(m,y,X){return m[y]=X}}function u(f,m,y,X){var Z=m&&m.prototype instanceof h?m:h,R=Object.create(Z.prototype),Y=new M(X||[]);return r(R,"_invoke",{value:S(f,y,Y)}),R}function c(f,m,y){try{return{type:"normal",arg:f.call(m,y)}}catch(X){return{type:"throw",arg:X}}}n.wrap=u;var d={};function h(){}function p(){}function v(){}var g={};l(g,i,function(){return this});var b=Object.getPrototypeOf,L=b&&b(b(I([])));L&&L!==a&&t.call(L,i)&&(g=L);var G=v.prototype=h.prototype=Object.create(g);function V(f){["next","throw","return"].forEach(function(m){l(f,m,function(y){return this._invoke(m,y)})})}function W(f,m){function y(Z,R,Y,N){var _=c(f[Z],f,R);if(_.type!=="throw"){var K=_.arg,j=K.value;return j&&typeof j=="object"&&t.call(j,"__await")?m.resolve(j.__await).then(function(H){y("next",H,Y,N)},function(H){y("throw",H,Y,N)}):m.resolve(j).then(function(H){K.value=H,Y(K)},function(H){return y("throw",H,Y,N)})}N(_.arg)}var X;r(this,"_invoke",{value:function(Z,R){function Y(){return new m(function(N,_){y(Z,R,N,_)})}return X=X?X.then(Y,Y):Y()}})}function S(f,m,y){var X="suspendedStart";return function(Z,R){if(X==="executing")throw new Error("Generator is already running");if(X==="completed"){if(Z==="throw")throw R;return D()}for(y.method=Z,y.arg=R;;){var Y=y.delegate;if(Y){var N=T(Y,y);if(N){if(N===d)continue;return N}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(X==="suspendedStart")throw X="completed",y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);X="executing";var _=c(f,m,y);if(_.type==="normal"){if(X=y.done?"completed":"suspendedYield",_.arg===d)continue;return{value:_.arg,done:y.done}}_.type==="throw"&&(X="completed",y.method="throw",y.arg=_.arg)}}}function T(f,m){var y=m.method,X=f.iterator[y];if(X===void 0)return m.delegate=null,y==="throw"&&f.iterator.return&&(m.method="return",m.arg=void 0,T(f,m),m.method==="throw")||y!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+y+"' method")),d;var Z=c(X,f.iterator,m.arg);if(Z.type==="throw")return m.method="throw",m.arg=Z.arg,m.delegate=null,d;var R=Z.arg;return R?R.done?(m[f.resultName]=R.value,m.next=f.nextLoc,m.method!=="return"&&(m.method="next",m.arg=void 0),m.delegate=null,d):R:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,d)}function k(f){var m={tryLoc:f[0]};1 in f&&(m.catchLoc=f[1]),2 in f&&(m.finallyLoc=f[2],m.afterLoc=f[3]),this.tryEntries.push(m)}function w(f){var m=f.completion||{};m.type="normal",delete m.arg,f.completion=m}function M(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(k,this),this.reset(!0)}function I(f){if(f){var m=f[i];if(m)return m.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var y=-1,X=function Z(){for(;++y<f.length;)if(t.call(f,y))return Z.value=f[y],Z.done=!1,Z;return Z.value=void 0,Z.done=!0,Z};return X.next=X}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=v,r(G,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=l(v,o,"GeneratorFunction"),n.isGeneratorFunction=function(f){var m=typeof f=="function"&&f.constructor;return!!m&&(m===p||(m.displayName||m.name)==="GeneratorFunction")},n.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,v):(f.__proto__=v,l(f,o,"GeneratorFunction")),f.prototype=Object.create(G),f},n.awrap=function(f){return{__await:f}},V(W.prototype),l(W.prototype,s,function(){return this}),n.AsyncIterator=W,n.async=function(f,m,y,X,Z){Z===void 0&&(Z=Promise);var R=new W(u(f,m,y,X),Z);return n.isGeneratorFunction(m)?R:R.next().then(function(Y){return Y.done?Y.value:R.next()})},V(G),l(G,o,"Generator"),l(G,i,function(){return this}),l(G,"toString",function(){return"[object Generator]"}),n.keys=function(f){var m=Object(f),y=[];for(var X in m)y.push(X);return y.reverse(),function Z(){for(;y.length;){var R=y.pop();if(R in m)return Z.value=R,Z.done=!1,Z}return Z.done=!0,Z}},n.values=I,M.prototype={constructor:M,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!f)for(var m in this)m.charAt(0)==="t"&&t.call(this,m)&&!isNaN(+m.slice(1))&&(this[m]=void 0)},stop:function(){this.done=!0;var f=this.tryEntries[0].completion;if(f.type==="throw")throw f.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var m=this;function y(_,K){return R.type="throw",R.arg=f,m.next=_,K&&(m.method="next",m.arg=void 0),!!K}for(var X=this.tryEntries.length-1;X>=0;--X){var Z=this.tryEntries[X],R=Z.completion;if(Z.tryLoc==="root")return y("end");if(Z.tryLoc<=this.prev){var Y=t.call(Z,"catchLoc"),N=t.call(Z,"finallyLoc");if(Y&&N){if(this.prev<Z.catchLoc)return y(Z.catchLoc,!0);if(this.prev<Z.finallyLoc)return y(Z.finallyLoc)}else if(Y){if(this.prev<Z.catchLoc)return y(Z.catchLoc,!0)}else{if(!N)throw new Error("try statement without catch or finally");if(this.prev<Z.finallyLoc)return y(Z.finallyLoc)}}}},abrupt:function(f,m){for(var y=this.tryEntries.length-1;y>=0;--y){var X=this.tryEntries[y];if(X.tryLoc<=this.prev&&t.call(X,"finallyLoc")&&this.prev<X.finallyLoc){var Z=X;break}}Z&&(f==="break"||f==="continue")&&Z.tryLoc<=m&&m<=Z.finallyLoc&&(Z=null);var R=Z?Z.completion:{};return R.type=f,R.arg=m,Z?(this.method="next",this.next=Z.finallyLoc,d):this.complete(R)},complete:function(f,m){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&m&&(this.next=m),d},finish:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.finallyLoc===f)return this.complete(y.completion,y.afterLoc),w(y),d}},catch:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc===f){var X=y.completion;if(X.type==="throw"){var Z=X.arg;w(y)}return Z}}throw new Error("illegal catch attempt")},delegateYield:function(f,m,y){return this.delegate={iterator:I(f),resultName:m,nextLoc:y},this.method==="next"&&(this.arg=void 0),d}},n}function un(n,a,t,r,e,i,s){try{var o=n[i](s),l=o.value}catch(u){t(u);return}o.done?a(l):Promise.resolve(l).then(r,e)}function Ne(n){return function(){var a=this,t=arguments;return new Promise(function(r,e){var i=n.apply(a,t);function s(l){un(i,r,e,s,o,"next",l)}function o(l){un(i,r,e,s,o,"throw",l)}s(void 0)})}}function gi(n,a){if(!(n instanceof a))throw new TypeError("Cannot call a class as a function")}function Fo(n,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,fs(r.key),r)}}function Zi(n,a,t){return a&&Fo(n.prototype,a),Object.defineProperty(n,"prototype",{writable:!1}),n}function De(n,a,t){return a=fs(a),a in n?Object.defineProperty(n,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[a]=t,n}function Uo(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),a&&ui(n,a)}function br(n){return br=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},br(n)}function ui(n,a){return ui=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},ui(n,a)}function zo(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Jo(n,a){if(n==null)return{};var t={},r=Object.keys(n),e,i;for(i=0;i<r.length;i++)e=r[i],!(a.indexOf(e)>=0)&&(t[e]=n[e]);return t}function Oo(n,a){if(n==null)return{};var t=Jo(n,a),r,e;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(e=0;e<i.length;e++)r=i[e],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function ze(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Bo(n,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ze(n)}function Ao(n){var a=zo();return function(){var r=br(n),e;if(a){var i=br(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Bo(this,e)}}function jo(n,a){return qo(n)||Ho(n,a)||ms(n,a)||rl()}function Qo(n){return $o(n)||el(n)||ms(n)||tl()}function $o(n){if(Array.isArray(n))return ci(n)}function qo(n){if(Array.isArray(n))return n}function el(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function ms(n,a){if(n){if(typeof n=="string")return ci(n,a);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ci(n,a)}}function ci(n,a){(a==null||a>n.length)&&(a=n.length);for(var t=0,r=new Array(a);t<a;t++)r[t]=n[t];return r}function tl(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rl(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function il(n,a){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,a||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(n)}function fs(n){var a=il(n,"string");return typeof a=="symbol"?a:String(a)}function nl(n){return li({vid:"",moovEnd:8e4,segmentDuration:2,maxDownloadInfoSize:30,responseType:"arraybuffer",cache:null},n)}var ur=Zi(function n(a,t){gi(this,n),this.type="file",this.message=a,this.data=t}),sl=function(){function n(){gi(this,n),De(this,"_data",Object.create(null))}return Zi(n,[{key:"set",value:function(t,r){this._data[t]=r}},{key:"get",value:function(t){return this._data[t]}},{key:"clear",value:function(){this._data=Object.create(null)}}]),n}();function cn(n,a){var t=n.trak;if(!(!t||!t.length)){var r=t.find(function(p){var v,g;return((v=p.mdia)===null||v===void 0||(g=v.hdlr)===null||g===void 0?void 0:g.handlerType)==="vide"}),e=t.find(function(p){var v,g;return((v=p.mdia)===null||v===void 0||(g=v.hdlr)===null||g===void 0?void 0:g.handlerType)==="soun"});if(!(!r&&!e)){var i=[],s=[];if(a){var o=[],l=0,u=a.start+a.size;a.references.forEach(function(p,v){o.push({index:v,startTime:l,endTime:l+p.subsegment_duration/a.timescale,duration:p.subsegment_duration/a.timescale,range:[u,u+p.referenced_size],frames:[]}),l+=p.subsegment_duration/a.timescale,u+=p.referenced_size}),i=o,s=o}else{var c,d,h=function(v){return v?[{index:0,startTime:0,endTime:v.duration/v.timescale,duration:v.duration/v.timescale,range:[n.start+n.size,""],frames:[]}]:[]};s=h(n.mvhd.duration?n.mvhd:(c=r.mdia)===null||c===void 0?void 0:c.mdhd),i=h(n.mvhd.duration?n.mvhd:(d=e.mdia)===null||d===void 0?void 0:d.mdhd)}return{videoSegments:s,audioSegments:i}}}}function Dr(n,a){var t=n.trak;if(!(!t||!t.length)){var r=t.find(function(f){var m,y;return((m=f.mdia)===null||m===void 0||(y=m.hdlr)===null||y===void 0?void 0:y.handlerType)==="vide"}),e=t.find(function(f){var m,y;return((m=f.mdia)===null||m===void 0||(y=m.hdlr)===null||y===void 0?void 0:y.handlerType)==="soun"});if(!(!r&&!e)){var i=[],s=[],o;if(r){var l,u,c,d=(l=r.mdia)===null||l===void 0||(u=l.minf)===null||u===void 0?void 0:u.stbl;if(!d)return;var h=(c=r.mdia.mdhd)===null||c===void 0?void 0:c.timescale,p=d.stts,v=d.stsc,g=d.stsz,b=d.stco,L=d.stss,G=d.ctts;if(!h||!p||!v||!g||!b||!L)return;i=dn(a,h,p,v,g,b,L,G),o=i.map(function(f){return f.duration})}if(e){var V,W,S,T=(V=e.mdia)===null||V===void 0||(W=V.minf)===null||W===void 0?void 0:W.stbl;if(!T)return;var k=(S=e.mdia.mdhd)===null||S===void 0?void 0:S.timescale,w=T.stts,M=T.stsc,I=T.stsz,D=T.stco;if(!k||!w||!M||!I||!D)return;s=dn(a,k,w,M,I,D,null,null,o)}return{videoSegments:i,audioSegments:s}}}}function dn(n,a,t,r,e,i,s,o,l){var u,c=[],d=[],h=[],p=r.entries,v=i.entries,g=e.entrySizes,b=s==null?void 0:s.entries,L=o==null?void 0:o.entries,G;L&&(G=[],L.forEach(function(ae){for(var lt=ae.count,Be=ae.offset,ut=0;ut<lt;ut++)G.push(Be)}));var V;b&&(V={},b.forEach(function(ae){V[ae-1]=!0}));var W,S,T=0,k=0,w=0,M=0,I=0,D=(u=p[0])===null||u===void 0?void 0:u.samplesPerChunk,f=p[1]?p[1].firstChunk-1:1/0,m=0,y=-1;t.entries.forEach(function(ae){var lt=ae.count,Be=ae.delta;S=Be;for(var ut=0;ut<lt;ut++)W={dts:m,startTime:T,duration:S,size:g[k]||e.sampleSize,offset:v[w]+I,index:k},b&&(W.keyframe=V[k],W.keyframe?(y++,d.push([W]),h.push(W.duration)):(d[d.length-1].push(W),h[d.length-1]+=W.duration),W.gopId=y),G&&k<G.length&&(W.pts=m+G[k]),k===0&&(W.pts=0),c.push(W),T+=S,m+=Be,k++,k<D?I+=W.size:(w++,I=0,w>=f&&(M++,f=p[M+1]?p[M+1].firstChunk-1:1/0),D+=p[M].samplesPerChunk)});var X=c.length;if(!X||s&&!c[0].keyframe)return[];var Z=[],R=[],Y=0,N,_=0,K=function(lt){var Be;N=R[R.length-1],Z.push({index:Z.length,startTime:((Be=Z[Z.length-1])===null||Be===void 0?void 0:Be.endTime)||R[0].startTime/a,endTime:(N.startTime+N.duration)/a,duration:lt,range:[R[0].offset,N.offset+N.size],frames:R}),Y=0,R=[]};if(s)for(var j=n*a,H=0,be=d.length;H<be;H++){var ge;Y+=h[H],(ge=R).push.apply(ge,Qo(d[H])),H+1<be?(H===0||Y>j)&&K(Y/a):K(Y/a)}else{l=l||[];for(var Oe=l[0]||n,me=0;me<X;me++){R.push(c[me]),Y+=c[me].duration;var pt=Y/a;(me+1>=X||pt+_>=Oe)&&(_+=pt-Oe,K(pt),Oe=l[Z.length]||n)}}return Z}function hn(n,a){var t="",r="",e=0,i=0,s=0,o=0,l=0,u=0,c=0;n.mvhd&&(l=n.mvhd.duration/n.mvhd.timescale);var d=n.trak;if(d){var h=d.find(function(Z){var R,Y;return((R=Z.mdia)===null||R===void 0||(Y=R.hdlr)===null||Y===void 0?void 0:Y.handlerType)==="vide"}),p=d.find(function(Z){var R,Y;return((R=Z.mdia)===null||R===void 0||(Y=R.hdlr)===null||Y===void 0?void 0:Y.handlerType)==="soun"}),v=null,g;if(h){var b,L,G;if(v=(b=h.mdia)===null||b===void 0||(L=b.minf)===null||L===void 0||(G=L.stbl)===null||G===void 0?void 0:G.stsd.entries[0],v){var V,W,S;if(e=v.width,i=v.height,u=(V=h.mdia)===null||V===void 0||(W=V.mdhd)===null||W===void 0?void 0:W.timescale,t=(S=v.avcC||v.hvcC||v.av1C)===null||S===void 0?void 0:S.codec,v.type==="encv"){var T,k;g=(T=v.sinf)===null||T===void 0||(k=T.schi)===null||k===void 0?void 0:k.tenc.default_KID}}}if(p){var w,M,I;if(v=(w=p.mdia)===null||w===void 0||(M=w.minf)===null||M===void 0||(I=M.stbl)===null||I===void 0?void 0:I.stsd.entries[0],v){var D,f,m;if(s=v.channelCount,o=v.sampleRate,r=(D=v.esds)===null||D===void 0?void 0:D.codec,c=(f=p.mdia)===null||f===void 0||(m=f.mdhd)===null||m===void 0?void 0:m.timescale,v.type==="enca"){var y,X;g=g||((y=v.sinf)===null||y===void 0||(X=y.schi)===null||X===void 0?void 0:X.tenc.default_KID)}}}return{kid:g?g.join(""):null,videoCodec:t,audioCodec:r,width:e,height:i,videoTimescale:u,audioChannelCount:s,audioSampleRate:o,duration:l,audioTimescale:c,moov:n,isFragmentMP4:a}}}function mn(n){return typeof n=="number"&&!Number.isNaN(n)}var al=["vid","cache"],ol=function(n){Uo(t,n);var a=Ao(t);function t(r){var e;gi(this,t),e=a.call(this),De(ze(e),"vid",""),De(ze(e),"url",""),De(ze(e),"meta",{}),De(ze(e),"downloadInfo",[]),De(ze(e),"videoSegments",[]),De(ze(e),"audioSegments",[]),De(ze(e),"cache",null),De(ze(e),"_currentSegmentIndex",-1),De(ze(e),"_currentLoadingSegmentIndex",-1),De(ze(e),"buffer",void 0),De(ze(e),"_error",void 0),De(ze(e),"_transformError",function(u){return u}),e._config=nl(r);var i=e._config,s=i.vid,o=i.cache,l=Oo(i,al);return e.cache=o||new sl,e.vid=s||l.url,e.url=l.url,l.transformError=e._transformError,e.logger=new Me("MP4Loader_"+e.vid),r.openLog&&Me.enable(),l.logger=e.logger,e._loader=new yt(l),e._loader.on(P.REAL_TIME_SPEED,function(u){e.emit(P.REAL_TIME_SPEED,u)}),e}return Zi(t,[{key:"isMetaLoaded",get:function(){return this.videoSegments.length||this.audioSegments.length}},{key:"setCurrentSegment",value:function(e){mn(e)&&(this._currentSegmentIndex=e)}},{key:"isLastSegment",value:function(e){if(mn(e)){var i,s,o=((i=this.videoSegments[this.videoSegments.length-1])===null||i===void 0?void 0:i.index)||((s=this.audioSegments[this.audioSegments.length-1])===null||s===void 0?void 0:s.index)||0;return e>=o}return!1}},{key:"isSegmentLoading",value:function(e){return e===this._currentLoadingSegmentIndex}},{key:"changeUrl",value:function(){var r=Ne(ue().mark(function i(s){var o,l,u,c=arguments;return ue().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return o=c.length>1&&c[1]!==void 0?c[1]:s,l=c.length>2?c[2]:void 0,u=c.length>3?c[3]:void 0,h.next=5,this.reset(u);case 5:s&&(this.url=s),o&&(this.vid=o),l&&(this._config.moovEnd=l);case 8:case"end":return h.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"getOrLoadMeta",value:function(){var r=Ne(ue().mark(function i(s){return ue().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.isMetaLoaded){l.next=3;break}return l.next=3,this.loadMeta(s);case 3:return l.abrupt("return",this.meta);case 4:case"end":return l.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"loadMetaProcess",value:function(){var r=Ne(ue().mark(function i(s,o,l,u){var c=this,d,h,p,v;return ue().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return d=jo(o,2),h=d[0],p=d[1],this._error=!1,this.logger.debug("[loadMetaProcess start], range,",[h,p]),v=function(){var L=Ne(ue().mark(function G(V,W,S){var T,k,w,M,I,D,f,m,y,X,Z,R,Y;return ue().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(c.meta&&S!==null&&S!==void 0&&S.range&&S.range.length>0&&S.range[1]>=p&&(W=!0,c.logger.debug("[loadMetaProcess],data done,setstate true,[",h,p,"]")),W&&S!==null&&S!==void 0&&S.range&&S.range.length>0&&S.range[1]<p&&(W=!1,c.logger.debug("[loadMetaProcess],data not done,setstate false,[",h,p,"]")),c.logger.debug("[loadMetaProcess],task,[",h,p,"], range,",S.range,",dataLen,",V?V.byteLength:void 0,", state,",W,",err,",c._error),!c._error&&V&&V.byteLength>0&&l(V,W,S),!(c.meta.moov||c._error)){_.next=6;break}return _.abrupt("return");case 6:if(!(V&&V.byteLength>0)){_.next=51;break}if(c.buffer=wt(c.buffer,V),T=Q.findBox(c.buffer,["moov"])[0],T){_.next=23;break}if(k=Q.findBox(c.buffer,["mdat"])[0],!W){_.next=23;break}if(k){_.next=18;break}return c._error=!0,l(null,W,S,{err:"cannot find moov or mdat box"}),_.abrupt("return");case 18:return w=k.start+k.size,_.next=21,c.loadData([w,""],s,u);case 21:M=_.sent,M&&(T=Q.findBox(M.data,["moov"])[0]);case 23:if(!(T&&W&&T.size>T.data.length)){_.next=27;break}return c.logger.debug("[loadMetaProcess],moov not all, range,",S.range[1],",dataLen,",c.buffer.byteLength,", state,",W),_.next=27,c.loadMetaProcess(s,[S.range[1],T.start+T.size-1],l);case 27:if(!(T&&T.size<=T.data.length&&!c.meta.moov)){_.next=51;break}if(I=Q.moov(T),I){_.next=33;break}return c._error=!0,l(null,W,S,{err:"cannot parse moov box"}),_.abrupt("return");case 33:if(D=Dr(I,c._config.segmentDuration),f=function(){var K=Ne(ue().mark(function j(H){var be,ge;return ue().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(be=Q.findBox(c.buffer,[H])[0],!be){me.next=11;break}if(!(be.size>be.data.length)){me.next=10;break}return me.next=5,c.loadData([be.start,be.start+be.size-1],s,u);case 5:if(ge=me.sent,!ge){me.next=8;break}return me.abrupt("return",Q.findBox(ge.data,[H])[0]);case 8:me.next=11;break;case 10:return me.abrupt("return",be);case 11:case"end":return me.stop()}},j)}));return function(H){return K.apply(this,arguments)}}(),m=!1,D&&D.videoSegments.length&&D.audioSegments.length){_.next=41;break}return _.next=39,f("sidx");case 39:y=_.sent,y&&(X=Q.sidx(y),X&&(D=cn(I,X),m=!0));case 41:if(D){_.next=45;break}return c._error=!0,l(null,W,S,{err:"cannot parse segments"}),_.abrupt("return");case 45:c.meta=hn(I,m),Z=D,R=Z.videoSegments,Y=Z.audioSegments,c.videoSegments=R,c.audioSegments=Y,c.logger.debug("[loadMetaProcess] moov ok"),l(void 0,W,{meta:{meta:c.meta,videoSegments:R,audioSegments:Y}});case 51:case"end":return _.stop()}},G)}));return function(V,W,S){return L.apply(this,arguments)}}(),b.next=6,this.loadData([h,p||this._config.moovEnd],s,li({onProgress:v},u));case 6:case"end":return b.stop()}},i,this)}));function e(i,s,o,l){return r.apply(this,arguments)}return e}()},{key:"loadMeta",value:function(){var r=Ne(ue().mark(function i(s,o,l){var u,c,d,h,p,v,g,b,L,G,V,W,S,T;return ue().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return u=[],this.logger.debug("[loadMeta start]"),w.next=4,this.loadData([0,o||this._config.moovEnd],s,l);case 4:if(c=w.sent,c){w.next=7;break}return w.abrupt("return");case 7:if(u.push(c),d=Q.findBox(c.data,["moov"])[0],d){w.next=23;break}if(h=Q.findBox(c.data,["mdat"])[0],h){w.next=13;break}throw new ur("cannot find moov or mdat box",c.data);case 13:return p=h.start+h.size,w.next=16,this.loadData([p],s,l);case 16:if(c=w.sent,c){w.next=19;break}return w.abrupt("return");case 19:if(u.push(c),d=Q.findBox(c.data,["moov"],p)[0],d){w.next=23;break}throw new ur("cannot find moov box",c.data);case 23:if(!(d.size>d.data.length)){w.next=31;break}return w.next=26,this.loadData([c.data.length,d.start+d.size-1],s,l);case 26:if(c=w.sent,c){w.next=29;break}return w.abrupt("return");case 29:u.push(c),d.data=wt(d.data,c.data);case 31:if(v=Q.moov(d),v){w.next=34;break}throw new ur("cannot parse moov box",d.data);case 34:if(g=Dr(v,this._config.segmentDuration),g){w.next=37;break}throw new ur("cannot parse segments",d.data);case 37:return g.videoSegments.length&&g.audioSegments.length||(L=Q.findBox(this.buffer,["moof"])[0],G=Q.findBox(this.buffer,["sidx"])[0],L&&L.size<=L.data.length&&G&&(V=Q.moof(L),b=Q.sidx(G),V&&b&&(g=cn(v,b)))),this.meta=hn(v,b),W=g,S=W.videoSegments,T=W.audioSegments,this.videoSegments=S,this.audioSegments=T,this.logger.debug("[load moov end!!!!!]"),w.abrupt("return",{meta:this.meta,videoSegments:S,audioSegments:T,responses:u});case 44:case"end":return w.stop()}},i,this)}));function e(i,s,o){return r.apply(this,arguments)}return e}()},{key:"loadCacheMeta",value:function(e,i){var s=e.moov,o=Dr(s,this._config.segmentDuration),l=o.videoSegments,u=o.audioSegments;this.videoSegments=l,this.audioSegments=u,this._currentSegmentIndex=i,this.meta=e}},{key:"getSegmentByTime",value:function(e){var i,s;return this.videoSegments.length?(i=this.videoSegments.find(function(o){return o.startTime<=e&&o.endTime>e}),i&&(s=this.audioSegments[i.index])):s=this.audioSegments.find(function(o){return o.startTime<=e&&o.endTime>e}),{video:i,audio:s}}},{key:"loadSegmentByTime",value:function(){var r=Ne(ue().mark(function i(s,o){var l,u,c,d,h,p=arguments;return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(l=p.length>2&&p[2]!==void 0?p[2]:!0,u=p.length>3&&p[3]!==void 0?p[3]:{},this.isMetaLoaded){g.next=5;break}return g.next=5,this.loadMeta(o);case 5:return c=this.getSegmentByTime(s),d=c.video,h=c.audio,g.abrupt("return",this._loadSegment(d,h,o,l,u));case 7:case"end":return g.stop()}},i,this)}));function e(i,s){return r.apply(this,arguments)}return e}()},{key:"loadNextSegment",value:function(){var r=Ne(ue().mark(function i(s){var o,l,u,c,d=arguments;return ue().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(o=d.length>1&&d[1]!==void 0?d[1]:!0,l=d.length>2&&d[2]!==void 0?d[2]:{},this.isMetaLoaded){p.next=5;break}return p.next=5,this.loadMeta();case 5:return u=this.videoSegments[this._currentSegmentIndex+1],c=this.audioSegments[this._currentSegmentIndex+1],p.abrupt("return",this._loadSegment(u,c,s,o,l));case 8:case"end":return p.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"preload",value:function(){var r=Ne(ue().mark(function i(s){var o=this,l,u,c,d,h,p,v;return ue().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(this.isMetaLoaded){b.next=3;break}return b.next=3,this.loadMeta(!0);case 3:if(!(!s||s<0)){b.next=5;break}return b.abrupt("return");case 5:if(l=this.getSegmentByTime(s),u=l.video,c=l.audio,d=Math.max((u==null?void 0:u.index)||0,(c==null?void 0:c.index)||0),d){b.next=9;break}return b.abrupt("return");case 9:return h=this.videoSegments.slice(0,d),p=this.audioSegments.slice(0,d),v=function(){var L=Ne(ue().mark(function G(V){return ue().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(!(V>d)){S.next=2;break}return S.abrupt("return");case 2:return S.next=4,o._loadSegment(h[V],p[V],!0,!1);case 4:return S.next=6,v(V+1);case 6:case"end":return S.stop()}},G)}));return function(V){return L.apply(this,arguments)}}(),b.next=14,v(0);case 14:case"end":return b.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"cancel",value:function(){return this._loader.cancel()}},{key:"reset",value:function(){var r=Ne(ue().mark(function i(){var s,o=arguments;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(s=o.length>0&&o[0]!==void 0?o[0]:!1,s){u.next=5;break}return this.logger.debug("[MP4loader reset func call loader.cancel]"),u.next=5,this._loader.cancel();case 5:this.vid=this.url="",this.meta={},this.downloadInfo=[],this.videoSegments=[],this.audioSegments=[],this._currentSegmentIndex=-1,this._currentLoadingSegmentIndex=-1;case 12:case"end":return u.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var r=Ne(ue().mark(function i(){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.reset();case 2:this.cache.clear();case 3:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_loadSegment",value:function(){var r=Ne(ue().mark(function i(s,o,l,u,c){var d,h;return ue().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(!s&&!o)){v.next=2;break}return v.abrupt("return");case 2:return d=(s==null?void 0:s.index)||(o==null?void 0:o.index)||0,this._currentLoadingSegmentIndex=d,v.prev=4,v.next=7,this.loadData([Math.min((s==null?void 0:s.range[0])||1/0,(o==null?void 0:o.range[0])||1/0),Math.max((s==null?void 0:s.range[1])||0,(o==null?void 0:o.range[1])||0)],l,c);case 7:h=v.sent;case 8:return v.prev=8,this._currentLoadingSegmentIndex=-1,v.finish(8);case 11:if(h){v.next=13;break}return v.abrupt("return");case 13:return u&&(this._currentSegmentIndex=d),h.video=s,h.audio=o,v.abrupt("return",h);case 17:case"end":return v.stop()}},i,this,[[4,,8,11]])}));function e(i,s,o,l,u){return r.apply(this,arguments)}return e}()},{key:"loadData",value:function(){var r=Ne(ue().mark(function i(s,o,l){var u,c,d,h;return ue().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=this._getCacheKey(s),v.next=3,this.cache.get(u);case 3:if(c=v.sent,c){v.next=11;break}return h=l&&l.url?l.url:this.url,v.next=8,this._loader.load(h,li({range:s,vid:this.vid},l));case 8:d=v.sent,v.next=12;break;case 11:d={data:c,state:!0,options:{fromCache:!0,range:s,vid:this.vid}};case 12:if(d){v.next=14;break}return v.abrupt("return");case 14:return c||(d.data&&this.downloadInfo.push({startTime:d.startTime,endTime:d.endTime,size:d.data.byteLength,range:s}),this.downloadInfo&&this.downloadInfo.length>this._config.maxDownloadInfoSize&&(this.downloadInfo=this.downloadInfo.slice(-this._config.maxDownloadInfoSize))),v.abrupt("return",d);case 17:case"end":return v.stop()}},i,this)}));function e(i,s,o){return r.apply(this,arguments)}return e}()},{key:"_getCacheKey",value:function(e){return(this.vid||this.url)+":"+e}}]),t}(gt),ps=dl(),ll=Dt();hl();function ul(){try{return typeof localStorage<"u"&&"setItem"in window.localStorage&&!!window.localStorage.setItem}catch{return!1}}function cl(){var n="_localstorage_support_test";try{return window.localStorage.setItem(n,!0),window.localStorage.removeItem(n),!1}catch{return!0}}function Dt(){if(ps)try{return!!window.localStorage.getItem("playerlog")}catch{return!1}return!1}function dl(){return ul()&&!cl()}function vs(n){for(var a,t=arguments.length,r=new Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];ll&&console.log&&(a=console).log.apply(a,["[logger]",st.nowTime(),n].concat(r))}function hl(){if(ps)try{return!!window.localStorage.getItem("playertestlog")}catch{return!1}return!1}var ys="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIGUoZSx0KXt2YXIgcj1PYmplY3Qua2V5cyhlKTtpZihPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgYT1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpO3QmJihhPWEuZmlsdGVyKChmdW5jdGlvbih0KXtyZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLHQpLmVudW1lcmFibGV9KSkpLHIucHVzaC5hcHBseShyLGEpfXJldHVybiByfWZ1bmN0aW9uIHQodCl7Zm9yKHZhciByPTE7cjxhcmd1bWVudHMubGVuZ3RoO3IrKyl7dmFyIGE9bnVsbCE9YXJndW1lbnRzW3JdP2FyZ3VtZW50c1tyXTp7fTtyJTI/ZShPYmplY3QoYSksITApLmZvckVhY2goKGZ1bmN0aW9uKGUpe2kodCxlLGFbZV0pfSkpOk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzP09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHQsT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoYSkpOmUoT2JqZWN0KGEpKS5mb3JFYWNoKChmdW5jdGlvbihlKXtPYmplY3QuZGVmaW5lUHJvcGVydHkodCxlLE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYSxlKSl9KSl9cmV0dXJuIHR9ZnVuY3Rpb24gcihlLHQpe2lmKCEoZSBpbnN0YW5jZW9mIHQpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIGEoZSx0KXtmb3IodmFyIHI9MDtyPHQubGVuZ3RoO3IrKyl7dmFyIGE9dFtyXTthLmVudW1lcmFibGU9YS5lbnVtZXJhYmxlfHwhMSxhLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gYSYmKGEud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLGsoYS5rZXkpLGEpfX1mdW5jdGlvbiBuKGUsdCxyKXtyZXR1cm4gdCYmYShlLnByb3RvdHlwZSx0KSxyJiZhKGUsciksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsInByb3RvdHlwZSIse3dyaXRhYmxlOiExfSksZX1mdW5jdGlvbiBpKGUsdCxyKXtyZXR1cm4odD1rKHQpKWluIGU/T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdCx7dmFsdWU6cixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pOmVbdF09cixlfWZ1bmN0aW9uIHMoZSx0KXtpZigiZnVuY3Rpb24iIT10eXBlb2YgdCYmbnVsbCE9PXQpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTtlLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKHQmJnQucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6ZSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsInByb3RvdHlwZSIse3dyaXRhYmxlOiExfSksdCYmdShlLHQpfWZ1bmN0aW9uIG8oZSl7cmV0dXJuKG89T2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5nZXRQcm90b3R5cGVPZi5iaW5kKCk6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSl9KShlKX1mdW5jdGlvbiB1KGUsdCl7cmV0dXJuKHU9T2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZi5iaW5kKCk6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5fX3Byb3RvX189dCxlfSkoZSx0KX1mdW5jdGlvbiBjKCl7aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBSZWZsZWN0fHwhUmVmbGVjdC5jb25zdHJ1Y3QpcmV0dXJuITE7aWYoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSlyZXR1cm4hMTtpZigiZnVuY3Rpb24iPT10eXBlb2YgUHJveHkpcmV0dXJuITA7dHJ5e3JldHVybiBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbixbXSwoZnVuY3Rpb24oKXt9KSkpLCEwfWNhdGNoKGUpe3JldHVybiExfX1mdW5jdGlvbiBsKGUsdCxyKXtyZXR1cm4obD1jKCk/UmVmbGVjdC5jb25zdHJ1Y3QuYmluZCgpOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYT1bbnVsbF07YS5wdXNoLmFwcGx5KGEsdCk7dmFyIG49bmV3KEZ1bmN0aW9uLmJpbmQuYXBwbHkoZSxhKSk7cmV0dXJuIHImJnUobixyLnByb3RvdHlwZSksbn0pLmFwcGx5KG51bGwsYXJndW1lbnRzKX1mdW5jdGlvbiBmKGUsdCl7aWYodCYmKCJvYmplY3QiPT10eXBlb2YgdHx8ImZ1bmN0aW9uIj09dHlwZW9mIHQpKXJldHVybiB0O2lmKHZvaWQgMCE9PXQpdGhyb3cgbmV3IFR5cGVFcnJvcigiRGVyaXZlZCBjb25zdHJ1Y3RvcnMgbWF5IG9ubHkgcmV0dXJuIG9iamVjdCBvciB1bmRlZmluZWQiKTtyZXR1cm4gZnVuY3Rpb24oZSl7aWYodm9pZCAwPT09ZSl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiBlfShlKX1mdW5jdGlvbiBkKGUpe3ZhciB0PWMoKTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgcixhPW8oZSk7aWYodCl7dmFyIG49byh0aGlzKS5jb25zdHJ1Y3RvcjtyPVJlZmxlY3QuY29uc3RydWN0KGEsYXJndW1lbnRzLG4pfWVsc2Ugcj1hLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gZih0aGlzLHIpfX1mdW5jdGlvbiBoKGUsdCl7Zm9yKDshT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsdCkmJm51bGwhPT0oZT1vKGUpKTspO3JldHVybiBlfWZ1bmN0aW9uIHAoKXtyZXR1cm4gcD0idW5kZWZpbmVkIiE9dHlwZW9mIFJlZmxlY3QmJlJlZmxlY3QuZ2V0P1JlZmxlY3QuZ2V0LmJpbmQoKTpmdW5jdGlvbihlLHQscil7dmFyIGE9aChlLHQpO2lmKGEpe3ZhciBuPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYSx0KTtyZXR1cm4gbi5nZXQ/bi5nZXQuY2FsbChhcmd1bWVudHMubGVuZ3RoPDM/ZTpyKTpuLnZhbHVlfX0scC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9ZnVuY3Rpb24gdihlLHQpe3JldHVybiBmdW5jdGlvbihlKXtpZihBcnJheS5pc0FycmF5KGUpKXJldHVybiBlfShlKXx8ZnVuY3Rpb24oZSx0KXt2YXIgcj1udWxsPT1lP251bGw6InVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJmVbU3ltYm9sLml0ZXJhdG9yXXx8ZVsiQEBpdGVyYXRvciJdO2lmKG51bGwhPXIpe3ZhciBhLG4saSxzLG89W10sdT0hMCxjPSExO3RyeXtpZihpPShyPXIuY2FsbChlKSkubmV4dCwwPT09dCl7aWYoT2JqZWN0KHIpIT09cilyZXR1cm47dT0hMX1lbHNlIGZvcig7ISh1PShhPWkuY2FsbChyKSkuZG9uZSkmJihvLnB1c2goYS52YWx1ZSksby5sZW5ndGghPT10KTt1PSEwKTt9Y2F0Y2gobCl7Yz0hMCxuPWx9ZmluYWxseXt0cnl7aWYoIXUmJm51bGwhPXIucmV0dXJuJiYocz1yLnJldHVybigpLE9iamVjdChzKSE9PXMpKXJldHVybn1maW5hbGx5e2lmKGMpdGhyb3cgbn19cmV0dXJuIG99fShlLHQpfHxtKGUsdCl8fGZ1bmN0aW9uKCl7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKX0oKX1mdW5jdGlvbiB5KGUpe3JldHVybiBmdW5jdGlvbihlKXtpZihBcnJheS5pc0FycmF5KGUpKXJldHVybiBnKGUpfShlKXx8ZnVuY3Rpb24oZSl7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJm51bGwhPWVbU3ltYm9sLml0ZXJhdG9yXXx8bnVsbCE9ZVsiQEBpdGVyYXRvciJdKXJldHVybiBBcnJheS5mcm9tKGUpfShlKXx8bShlKXx8ZnVuY3Rpb24oKXt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKX0oKX1mdW5jdGlvbiBtKGUsdCl7aWYoZSl7aWYoInN0cmluZyI9PXR5cGVvZiBlKXJldHVybiBnKGUsdCk7dmFyIHI9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGUpLnNsaWNlKDgsLTEpO3JldHVybiJPYmplY3QiPT09ciYmZS5jb25zdHJ1Y3RvciYmKHI9ZS5jb25zdHJ1Y3Rvci5uYW1lKSwiTWFwIj09PXJ8fCJTZXQiPT09cj9BcnJheS5mcm9tKGUpOiJBcmd1bWVudHMiPT09cnx8L14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3Qocik/ZyhlLHQpOnZvaWQgMH19ZnVuY3Rpb24gZyhlLHQpeyhudWxsPT10fHx0PmUubGVuZ3RoKSYmKHQ9ZS5sZW5ndGgpO2Zvcih2YXIgcj0wLGE9bmV3IEFycmF5KHQpO3I8dDtyKyspYVtyXT1lW3JdO3JldHVybiBhfWZ1bmN0aW9uIGsoZSl7dmFyIHQ9ZnVuY3Rpb24oZSx0KXtpZigib2JqZWN0IiE9dHlwZW9mIGV8fG51bGw9PT1lKXJldHVybiBlO3ZhciByPWVbU3ltYm9sLnRvUHJpbWl0aXZlXTtpZih2b2lkIDAhPT1yKXt2YXIgYT1yLmNhbGwoZSx0fHwiZGVmYXVsdCIpO2lmKCJvYmplY3QiIT10eXBlb2YgYSlyZXR1cm4gYTt0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpfXJldHVybigic3RyaW5nIj09PXQ/U3RyaW5nOk51bWJlcikoZSl9KGUsInN0cmluZyIpO3JldHVybiJzeW1ib2wiPT10eXBlb2YgdD90OlN0cmluZyh0KX12YXIgYj0idmlkZW8iLF89ImF1ZGlvIix3PSJtZXRhZGF0YSIseD0iYXYxIixTPSJhdmMiLEQ9ImhldmMiLEE9ImFhYyIsVD0iZzcxMTBhIixCPSJnNzExMG0iLEU9Im9wdXMiLFU9IkxBUkdFX0FWX1NISUZUIixDPSJMQVJHRV9WSURFT19HQVAiLFA9IkxBUkdFX1ZJREVPX0dBUF9CRVRXRUVOX0NIVU5LIixJPSJMQVJHRV9BVURJT19HQVAiLE09IkFVRElPX0ZJTExFRCIsej0iQVVESU9fRFJPUFBFRCIsTz1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSksaSh0aGlzLCJpZCIsMSksaSh0aGlzLCJ0eXBlIixiKSxpKHRoaXMsImNvZGVjVHlwZSIsUyksaSh0aGlzLCJwaWQiLC0xKSxpKHRoaXMsImh2Y0MiLHZvaWQgMCksaSh0aGlzLCJjb2RlYyIsIiIpLGkodGhpcywidGltZXNjYWxlIiwwKSxpKHRoaXMsImZvcm1hdFRpbWVzY2FsZSIsMCksaSh0aGlzLCJzZXF1ZW5jZU51bWJlciIsMCksaSh0aGlzLCJiYXNlTWVkaWFEZWNvZGVUaW1lIiwwKSxpKHRoaXMsImJhc2VEdHMiLDApLGkodGhpcywiZHVyYXRpb24iLDApLGkodGhpcywid2FybmluZ3MiLFtdKSxpKHRoaXMsInNhbXBsZXMiLFtdKSxpKHRoaXMsInBwcyIsW10pLGkodGhpcywic3BzIixbXSksaSh0aGlzLCJ2cHMiLFtdKSxpKHRoaXMsImZwc051bSIsMCksaSh0aGlzLCJmcHNEZW4iLDApLGkodGhpcywic2FyUmF0aW8iLFtdKSxpKHRoaXMsIndpZHRoIiwwKSxpKHRoaXMsImhlaWdodCIsMCksaSh0aGlzLCJuYWxVbml0U2l6ZSIsNCksaSh0aGlzLCJwcmVzZW50IiwhMSksaSh0aGlzLCJpc1ZpZGVvRW5jcnlwdGlvbiIsITEpLGkodGhpcywiaXNBdWRpb0VuY3J5cHRpb24iLCExKSxpKHRoaXMsImlzVmlkZW8iLCEwKSxpKHRoaXMsImxhc3RLZXlGcmFtZUR0cyIsMCksaSh0aGlzLCJraWQiLG51bGwpLGkodGhpcywicHNzaCIsbnVsbCksaSh0aGlzLCJleHQiLHZvaWQgMCl9cmV0dXJuIG4oZSxbe2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5zZXF1ZW5jZU51bWJlcj10aGlzLndpZHRoPXRoaXMuaGVpZ2h0PXRoaXMuZnBzRGVuPXRoaXMuZnBzTnVtPXRoaXMuZHVyYXRpb249dGhpcy5iYXNlTWVkaWFEZWNvZGVUaW1lPXRoaXMudGltZXNjYWxlPTAsdGhpcy5jb2RlYz0iIix0aGlzLnByZXNlbnQ9ITEsdGhpcy5waWQ9LTEsdGhpcy5wcHM9W10sdGhpcy5zcHM9W10sdGhpcy52cHM9W10sdGhpcy5zYXJSYXRpbz1bXSx0aGlzLnNhbXBsZXM9W10sdGhpcy53YXJuaW5ncz1bXSx0aGlzLmh2Y0M9bnVsbH19LHtrZXk6ImZpcnN0RHRzIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zYW1wbGVzLmxlbmd0aD90aGlzLnNhbXBsZXNbMF0uZHRzOm51bGx9fSx7a2V5OiJmaXJzdFB0cyIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2FtcGxlcy5sZW5ndGg/dGhpcy5zYW1wbGVzWzBdLnB0czpudWxsfX0se2tleToic2FtcGxlc0R1cmF0aW9uIixnZXQ6ZnVuY3Rpb24oKXtpZih0aGlzLnNhbXBsZXMubGVuZ3RoPjApe3ZhciBlPXRoaXMuc2FtcGxlc1swXSx0PXRoaXMuc2FtcGxlc1t0aGlzLnNhbXBsZXMubGVuZ3RoLTFdO3JldHVybiB0LmR0cy1lLmR0cyt0LmR1cmF0aW9ufXJldHVybiAwfX0se2tleToiZXhpc3QiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuISEvYXYwMS8udGVzdCh0aGlzLmNvZGVjKXx8ISEodGhpcy5wcHMubGVuZ3RoJiZ0aGlzLnNwcy5sZW5ndGgmJnRoaXMuY29kZWMpfX0se2tleToiaGFzU2FtcGxlIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiEhdGhpcy5zYW1wbGVzLmxlbmd0aH19LHtrZXk6ImlzRW5jcnlwdGlvbiIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXNWaWRlb0VuY3J5cHRpb259fV0pLGV9KCksUj1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSksaSh0aGlzLCJpZCIsMiksaSh0aGlzLCJ0eXBlIixfKSxpKHRoaXMsImNvZGVjVHlwZSIsQSksaSh0aGlzLCJwaWQiLC0xKSxpKHRoaXMsImNvZGVjIiwiIiksaSh0aGlzLCJzZXF1ZW5jZU51bWJlciIsMCksaSh0aGlzLCJzYW1wbGVEdXJhdGlvbiIsMCksaSh0aGlzLCJ0aW1lc2NhbGUiLDApLGkodGhpcywiZm9ybWF0VGltZXNjYWxlIiwwKSxpKHRoaXMsImJhc2VNZWRpYURlY29kZVRpbWUiLDApLGkodGhpcywiZHVyYXRpb24iLDApLGkodGhpcywid2FybmluZ3MiLFtdKSxpKHRoaXMsInNhbXBsZXMiLFtdKSxpKHRoaXMsImJhc2VEdHMiLDApLGkodGhpcywic2FtcGxlU2l6ZSIsMTYpLGkodGhpcywic2FtcGxlUmF0ZSIsMCksaSh0aGlzLCJjaGFubmVsQ291bnQiLDApLGkodGhpcywib2JqZWN0VHlwZSIsMCksaSh0aGlzLCJzYW1wbGVSYXRlSW5kZXgiLDApLGkodGhpcywiY29uZmlnIixbXSksaSh0aGlzLCJwcmVzZW50IiwhMSksaSh0aGlzLCJpc1ZpZGVvRW5jcnlwdGlvbiIsITEpLGkodGhpcywiaXNBdWRpb0VuY3J5cHRpb24iLCExKSxpKHRoaXMsImtpZCIsbnVsbCksaSh0aGlzLCJleHQiLHZvaWQgMCl9cmV0dXJuIG4oZSxbe2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5zZXF1ZW5jZU51bWJlcj0wLHRoaXMudGltZXNjYWxlPTAsdGhpcy5zYW1wbGVEdXJhdGlvbj0wLHRoaXMuc2FtcGxlUmF0ZT0wLHRoaXMuY2hhbm5lbENvdW50PTAsdGhpcy5iYXNlTWVkaWFEZWNvZGVUaW1lPTAsdGhpcy5wcmVzZW50PSExLHRoaXMucGlkPS0xLHRoaXMuY29kZWM9IiIsdGhpcy5zYW1wbGVzPVtdLHRoaXMuY29uZmlnPVtdLHRoaXMud2FybmluZ3M9W119fSx7a2V5OiJleGlzdCIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4hKCEodGhpcy5zYW1wbGVSYXRlJiZ0aGlzLmNoYW5uZWxDb3VudCYmdGhpcy5jb2RlYyl8fHRoaXMuY29kZWNUeXBlIT09QSYmdGhpcy5jb2RlY1R5cGUhPT1UJiZ0aGlzLmNvZGVjVHlwZSE9PUImJnRoaXMuY29kZWNUeXBlIT09RSl9fSx7a2V5OiJoYXNTYW1wbGUiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuISF0aGlzLnNhbXBsZXMubGVuZ3RofX0se2tleToiaXNFbmNyeXB0aW9uIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pc0F1ZGlvRW5jcnlwdGlvbn19LHtrZXk6ImZpcnN0RHRzIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zYW1wbGVzLmxlbmd0aD90aGlzLnNhbXBsZXNbMF0uZHRzOm51bGx9fSx7a2V5OiJmaXJzdFB0cyIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2FtcGxlcy5sZW5ndGg/dGhpcy5zYW1wbGVzWzBdLnB0czpudWxsfX0se2tleToic2FtcGxlc0R1cmF0aW9uIixnZXQ6ZnVuY3Rpb24oKXtpZih0aGlzLnNhbXBsZXMubGVuZ3RoPjApe3ZhciBlPXRoaXMuc2FtcGxlc1swXSx0PXRoaXMuc2FtcGxlc1t0aGlzLnNhbXBsZXMubGVuZ3RoLTFdO3JldHVybiB0LmR0cy1lLmR0cyt0LmR1cmF0aW9ufXJldHVybiAwfX1dKSxlfSgpLEw9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQsYSxuKXtyKHRoaXMsZSksaSh0aGlzLCJmbGFnIix7fSksaSh0aGlzLCJrZXlmcmFtZSIsITEpLGkodGhpcywiZ29wSWQiLDApLGkodGhpcywiZHVyYXRpb24iLDApLGkodGhpcywic2l6ZSIsMCksaSh0aGlzLCJ1bml0cyIsW10pLGkodGhpcywiY2hyb21hRm9ybWF0Iiw0MjApLHRoaXMub3JpZ2luUHRzPXRoaXMucHRzPXQsdGhpcy5vcmlnaW5EdHM9dGhpcy5kdHM9YSxuJiYodGhpcy51bml0cz1uKX1yZXR1cm4gbihlLFt7a2V5OiJjdHMiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnB0cy10aGlzLmR0c319LHtrZXk6InNldFRvS2V5ZnJhbWUiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5rZXlmcmFtZT0hMCx0aGlzLmZsYWcuZGVwZW5kc09uPTIsdGhpcy5mbGFnLmlzTm9uU3luY1NhbXBsZT0wfX1dKSxlfSgpLFY9bigoZnVuY3Rpb24gZSh0LGEsbixzKXtyKHRoaXMsZSksaSh0aGlzLCJkdXJhdGlvbiIsMTAyNCksaSh0aGlzLCJmbGFnIix7ZGVwZW5kc09uOjIsaXNOb25TeW5jU2FtcGxlOjB9KSxpKHRoaXMsImtleWZyYW1lIiwhMCksdGhpcy5vcmlnaW5QdHM9dGhpcy5wdHM9dGhpcy5kdHM9dCx0aGlzLmRhdGE9YSx0aGlzLnNpemU9YS5ieXRlTGVuZ3RoLHRoaXMuc2FtcGxlT2Zmc2V0PXMsbiYmKHRoaXMuZHVyYXRpb249bil9KSksRj1uKChmdW5jdGlvbiBlKHQsYSl7cih0aGlzLGUpLGkodGhpcywidGltZSIsMCksdGhpcy5kYXRhPXQsdGhpcy5vcmlnaW5QdHM9dGhpcy5wdHM9YX0pKSxOPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEpfShGKSxqPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEpfShGKSxHPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3IodGhpcyxlKSxpKHRoaXMsImlkIiwzKSxpKHRoaXMsInR5cGUiLHcpLGkodGhpcywidGltZXNjYWxlIiwwKSxpKHRoaXMsImZsdlNjcmlwdFNhbXBsZXMiLFtdKSxpKHRoaXMsInNlaVNhbXBsZXMiLFtdKX1yZXR1cm4gbihlLFt7a2V5OiJleGlzdCIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4hKCF0aGlzLmZsdlNjcmlwdFNhbXBsZXMubGVuZ3RoJiYhdGhpcy5zZWlTYW1wbGVzLmxlbmd0aHx8IXRoaXMudGltZXNjYWxlKX19LHtrZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMudGltZXNjYWxlPTAsdGhpcy5mbHZTY3JpcHRTYW1wbGVzPVtdLHRoaXMuc2VpU2FtcGxlcz1bXX19LHtrZXk6Imhhc1NhbXBsZSIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4hKCF0aGlzLmZsdlNjcmlwdFNhbXBsZXMubGVuZ3RoJiYhdGhpcy5zZWlTYW1wbGVzLmxlbmd0aCl9fV0pLGV9KCksSD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUodCl7aWYocih0aGlzLGUpLGkodGhpcywiX2J5dGVzQXZhaWxhYmxlIix2b2lkIDApLGkodGhpcywiX2JpdHNBdmFpbGFibGUiLDApLGkodGhpcywiX3dvcmQiLDApLCF0KXRocm93IG5ldyBFcnJvcigiRXhwR29sb21iIGRhdGEgcGFyYW1zIGlzIHJlcXVpcmVkIik7dGhpcy5fZGF0YT10LHRoaXMuX2J5dGVzQXZhaWxhYmxlPXQuYnl0ZUxlbmd0aCx0aGlzLl9ieXRlc0F2YWlsYWJsZSYmdGhpcy5fbG9hZFdvcmQoKX1yZXR1cm4gbihlLFt7a2V5OiJiaXRzQXZhaWxhYmxlIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fYml0c0F2YWlsYWJsZX19LHtrZXk6Il9sb2FkV29yZCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLl9kYXRhLmJ5dGVMZW5ndGgtdGhpcy5fYnl0ZXNBdmFpbGFibGUsdD1NYXRoLm1pbig0LHRoaXMuX2J5dGVzQXZhaWxhYmxlKTtpZigwPT09dCl0aHJvdyBuZXcgRXJyb3IoIk5vIGJ5dGVzIGF2YWlsYWJsZSIpO3ZhciByPW5ldyBVaW50OEFycmF5KDQpO3Iuc2V0KHRoaXMuX2RhdGEuc3ViYXJyYXkoZSxlK3QpKSx0aGlzLl93b3JkPW5ldyBEYXRhVmlldyhyLmJ1ZmZlcikuZ2V0VWludDMyKDApLHRoaXMuX2JpdHNBdmFpbGFibGU9OCp0LHRoaXMuX2J5dGVzQXZhaWxhYmxlLT10fX0se2tleToic2tpcEJpdHMiLHZhbHVlOmZ1bmN0aW9uKGUpe2lmKHRoaXMuX2JpdHNBdmFpbGFibGU+ZSl0aGlzLl93b3JkPDw9ZSx0aGlzLl9iaXRzQXZhaWxhYmxlLT1lO2Vsc2V7ZS09dGhpcy5fYml0c0F2YWlsYWJsZTt2YXIgdD1NYXRoLmZsb29yKGUvOCk7ZS09OCp0LHRoaXMuX2J5dGVzQXZhaWxhYmxlLT10LHRoaXMuX2xvYWRXb3JkKCksdGhpcy5fd29yZDw8PWUsdGhpcy5fYml0c0F2YWlsYWJsZS09ZX19fSx7a2V5OiJyZWFkQml0cyIsdmFsdWU6ZnVuY3Rpb24oZSl7aWYoZT4zMil0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCByZWFkIG1vcmUgdGhhbiAzMiBiaXRzIik7dmFyIHQ9TWF0aC5taW4odGhpcy5fYml0c0F2YWlsYWJsZSxlKSxyPXRoaXMuX3dvcmQ+Pj4zMi10O3JldHVybiB0aGlzLl9iaXRzQXZhaWxhYmxlLT10LHRoaXMuX2JpdHNBdmFpbGFibGU+MD90aGlzLl93b3JkPDw9dDp0aGlzLl9ieXRlc0F2YWlsYWJsZT4wJiZ0aGlzLl9sb2FkV29yZCgpLCh0PWUtdCk+MCYmdGhpcy5fYml0c0F2YWlsYWJsZT9yPDx0fHRoaXMucmVhZEJpdHModCk6cn19LHtrZXk6InNraXBMWiIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZTtmb3IoZT0wO2U8dGhpcy5fYml0c0F2YWlsYWJsZTsrK2UpaWYoMCE9KHRoaXMuX3dvcmQmMjE0NzQ4MzY0OD4+PmUpKXJldHVybiB0aGlzLl93b3JkPDw9ZSx0aGlzLl9iaXRzQXZhaWxhYmxlLT1lLGU7cmV0dXJuIHRoaXMuX2xvYWRXb3JkKCksZSt0aGlzLnNraXBMWigpfX0se2tleToic2tpcFVFRyIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnNraXBCaXRzKDErdGhpcy5za2lwTFooKSl9fSx7a2V5OiJyZWFkVUVHIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMuc2tpcExaKCk7cmV0dXJuIHRoaXMucmVhZEJpdHMoZSsxKS0xfX0se2tleToicmVhZEVHIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMucmVhZFVFRygpO3JldHVybiAxJmU/MStlPj4+MTotMSooZT4+PjEpfX0se2tleToicmVhZEJvb2wiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIDE9PT10aGlzLnJlYWRCaXRzKDEpfX0se2tleToicmVhZFVCeXRlIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLnJlYWRCaXRzKDgpfX0se2tleToic2tpcFNjYWxpbmdMaXN0Iix2YWx1ZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9OCxyPTgsYT0wO2E8ZTthKyspMCE9PXImJihyPSh0K3RoaXMucmVhZEVHKCkrMjU2KSUyNTYpLHQ9MD09PXI/dDpyfX1dKSxlfSgpLEs9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQpe3IodGhpcyxlKSx0aGlzLm5hbWU9dHx8IiIsdGhpcy5fcHJlZml4PSJbIi5jb25jYXQodGhpcy5uYW1lLCJdIil9cmV0dXJuIG4oZSxbe2tleToid2FybiIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdDtpZighZS5kaXNhYmxlZCl7Zm9yKHZhciByPWFyZ3VtZW50cy5sZW5ndGgsYT1uZXcgQXJyYXkociksbj0wO248cjtuKyspYVtuXT1hcmd1bWVudHNbbl07KHQ9Y29uc29sZSkud2Fybi5hcHBseSh0LFt0aGlzLl9wcmVmaXhdLmNvbmNhdChhKSl9fX1dLFt7a2V5OiJlbmFibGUiLHZhbHVlOmZ1bmN0aW9uKCl7ZS5kaXNhYmxlZD0hMX19LHtrZXk6ImRpc2FibGUiLHZhbHVlOmZ1bmN0aW9uKCl7ZS5kaXNhYmxlZD0hMH19XSksZX0oKTtpKEssImRpc2FibGVkIiwhMCk7dmFyIHE9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpfXJldHVybiBuKGUsbnVsbCxbe2tleToiZGVjb2RlIix2YWx1ZTpmdW5jdGlvbih0KXtmb3IodmFyIHI9W10sYT10LG49MCxpPXQubGVuZ3RoO248aTspaWYoYVtuXTwxMjgpci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoYVtuXSkpLCsrbjtlbHNle2lmKGFbbl08MTkyKTtlbHNlIGlmKGFbbl08MjI0KXtpZihlLl9jaGVja0NvbnRpbnVhdGlvbihhLG4sMSkpe3ZhciBzPSgzMSZhW25dKTw8Nnw2MyZhW24rMV07aWYocz49MTI4KXtyLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSg2NTUzNSZzKSksbis9Mjtjb250aW51ZX19fWVsc2UgaWYoYVtuXTwyNDApe2lmKGUuX2NoZWNrQ29udGludWF0aW9uKGEsbiwyKSl7dmFyIG89KDE1JmFbbl0pPDwxMnwoNjMmYVtuKzFdKTw8Nnw2MyZhW24rMl07aWYobz49MjA0OCYmNTUyOTYhPSg2MzQ4OCZvKSl7ci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoNjU1MzUmbykpLG4rPTM7Y29udGludWV9fX1lbHNlIGlmKGFbbl08MjQ4JiZlLl9jaGVja0NvbnRpbnVhdGlvbihhLG4sMykpe3ZhciB1PSg3JmFbbl0pPDwxOHwoNjMmYVtuKzFdKTw8MTJ8KDYzJmFbbisyXSk8PDZ8NjMmYVtuKzNdO2lmKHU+NjU1MzYmJnU8MTExNDExMil7dS09NjU1MzYsci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUodT4+PjEwfDU1Mjk2KSksci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoMTAyMyZ1fDU2MzIwKSksbis9NDtjb250aW51ZX19ci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoNjU1MzMpKSwrK259cmV0dXJuIHIuam9pbigiIil9fSx7a2V5OiJfY2hlY2tDb250aW51YXRpb24iLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYT1lO2lmKHQrcjxhLmxlbmd0aCl7Zm9yKDtyLS07KWlmKDEyOCE9KDE5MiZhWysrdF0pKXJldHVybiExO3JldHVybiEwfXJldHVybiExfX1dKSxlfSgpLFc9InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3csWD1XJiZuYXZpZ2F0b3IudXNlckFnZW50LnRvTG9jYWxlTG93ZXJDYXNlKCksWT1XJiYvXigoPyFjaHJvbWV8YW5kcm9pZCkuKSpzYWZhcmkvLnRlc3QoWCksWj1XJiZYLmluY2x1ZGVzKCJmaXJlZm94IiksUT1XJiZYLmluY2x1ZGVzKCJhbmRyb2lkIik7ZnVuY3Rpb24gSigpe2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoLHQ9bmV3IEFycmF5KGUpLHI9MDtyPGU7cisrKXRbcl09YXJndW1lbnRzW3JdO3Q9dC5maWx0ZXIoQm9vbGVhbik7dmFyIGE9bmV3IFVpbnQ4QXJyYXkodC5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC5ieXRlTGVuZ3RofSksMCkpLG49MDtyZXR1cm4gdC5mb3JFYWNoKChmdW5jdGlvbihlKXthLnNldChlLG4pLG4rPWUuYnl0ZUxlbmd0aH0pKSxhfXZhciAkPU1hdGgucG93KDIsMzIpO2Z1bmN0aW9uIGVlKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTowO3JldHVybihlW3RdPDw4KSsoZVt0KzFdfHwwKX1mdW5jdGlvbiB0ZShlKXt2YXIgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06MDtyZXR1cm4oZVt0XTw8MjQ+Pj4wKSsoZVt0KzFdPDwxNikrKGVbdCsyXTw8OCkrKGVbdCszXXx8MCl9ZnVuY3Rpb24gcmUoZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjA7cmV0dXJuIHRlKGUsdCkqJCt0ZShlLHQrNCl9ZnVuY3Rpb24gYWUoZSl7Zm9yKHZhciB0LHI9ImF2YzEuIixhPTA7YTwzO2ErKykodD1lW2FdLnRvU3RyaW5nKDE2KSkubGVuZ3RoPDImJih0PSIwIi5jb25jYXQodCkpLHIrPXQ7cmV0dXJuIHJ9ZnVuY3Rpb24gbmUoZSl7dmFyIHQ9IiI7aWYoZS5mb3JFYWNoKChmdW5jdGlvbihlKXt0Kz1mdW5jdGlvbihlKXtyZXR1cm4oIjAiK051bWJlcihlKS50b1N0cmluZygxNikpLnNsaWNlKC0yKS50b1VwcGVyQ2FzZSgpfShlKX0pKSx0Lmxlbmd0aDw9MzIpZm9yKHZhciByPTMyLXQubGVuZ3RoLGE9MDthPHI7YSsrKXQrPSIwIjtyZXR1cm4gdH1mdW5jdGlvbiBpZShlKXtpZighQXJyYXkuaXNBcnJheShlKSl7Zm9yKHZhciB0PVtdLHI9IiIsYT0wO2E8ZS5sZW5ndGg7YSsrKWElMiYmKHI9ZVthLTFdK2VbYV0sdC5wdXNoKHBhcnNlSW50KHIsMTYpKSxyPSIiKTtyZXR1cm4gdH1yZXR1cm4gZS5tYXAoKGZ1bmN0aW9uKGUpe3JldHVybiBwYXJzZUludChlLDE2KX0pKX1mdW5jdGlvbiBzZShlLHQpe3JldHVybiBOdW1iZXIoZSsiLiIrdCl9dmFyIG9lPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3IodGhpcyxlKX1yZXR1cm4gbihlLG51bGwsW3trZXk6ImdldFJhdGVJbmRleEJ5UmF0ZSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuRlJFUS5pbmRleE9mKHQpfX0se2tleToicGFyc2VBRFRTIix2YWx1ZTpmdW5jdGlvbih0LHIpe2Zvcih2YXIgYT10Lmxlbmd0aCxuPTA7bisyPGEmJigyNTUhPT10W25dfHwyNDAhPSgyNDYmdFtuKzFdKSk7KW4rKztpZighKG4+PWEpKXt2YXIgaT1uLHM9W10sbz0oNjAmdFtuKzJdKT4+PjIsdT1lLkZSRVFbb107aWYoIXUpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHNhbXBsaW5nIGluZGV4OiAiLmNvbmNhdChvKSk7Zm9yKHZhciBjLGwsZj0xKygoMTkyJnRbbisyXSk+Pj42KSxkPSgxJnRbbisyXSk8PDJ8KDE5MiZ0W24rM10pPj4+NixoPWUuX2dldENvbmZpZyhvLGQsZikscD1oLmNvbmZpZyx2PWguY29kZWMseT0wLG09ZS5nZXRGcmFtZUR1cmF0aW9uKHUpO24rNzxhOylpZigyNTU9PT10W25dJiYyNDA9PSgyNDYmdFtuKzFdKSl7aWYoIShsPSgzJnRbbiszXSk8PDExfHRbbis0XTw8M3woMjI0JnRbbis1XSk+PjUpfHxhLW48bClicmVhaztjPTIqKDEmfnRbbisxXSkscy5wdXNoKHtwdHM6cit5Km0sZGF0YTp0LnN1YmFycmF5KG4rNytjLG4rbCl9KSx5Kyssbis9bH1lbHNlIG4rKztyZXR1cm57c2tpcDppLHJlbWFpbmluZzpuPj1hP3ZvaWQgMDp0LnN1YmFycmF5KG4pLGZyYW1lczpzLHNhbXBsaW5nRnJlcXVlbmN5SW5kZXg6byxzYW1wbGVSYXRlOnUsb2JqZWN0VHlwZTpmLGNoYW5uZWxDb3VudDpkLGNvZGVjOnYsY29uZmlnOnAsb3JpZ2luQ29kZWM6Im1wNGEuNDAuIi5jb25jYXQoZil9fX19LHtrZXk6InBhcnNlQXVkaW9TcGVjaWZpY0NvbmZpZyIsdmFsdWU6ZnVuY3Rpb24odCl7aWYodC5sZW5ndGgpe3ZhciByPXRbMF0+Pj4zLGE9KDcmdFswXSk8PDF8dFsxXT4+Pjcsbj0oMTIwJnRbMV0pPj4+MyxpPWUuRlJFUVthXTtpZihpKXt2YXIgcz1lLl9nZXRDb25maWcoYSxuLHIpO3JldHVybntzYW1wbGluZ0ZyZXF1ZW5jeUluZGV4OmEsc2FtcGxlUmF0ZTppLG9iamVjdFR5cGU6cixjaGFubmVsQ291bnQ6bixjb25maWc6cy5jb25maWcsY29kZWM6cy5jb2RlYyxvcmlnaW5Db2RlYzoibXA0YS40MC4iLmNvbmNhdChyKX19fX19LHtrZXk6ImdldEZyYW1lRHVyYXRpb24iLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTo5ZTQ7cmV0dXJuIDEwMjQqdC9lfX0se2tleToiX2dldENvbmZpZyIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIpe3ZhciBhLG4saT1bXTtyZXR1cm4gWj9lPj02PyhhPTUsbj1lLTMpOihhPTIsbj1lKTpRPyhhPTIsbj1lKTooYT0yPT09cnx8NT09PXI/cjo1LG49ZSxlPj02P249ZS0zOjE9PT10JiYoYT0yLG49ZSkpLGlbMF09YTw8MyxpWzBdfD0oMTQmZSk+PjEsaVsxXT0oMSZlKTw8NyxpWzFdfD10PDwzLDU9PT1hJiYoaVsxXXw9KDE0Jm4pPj4xLGlbMl09KDEmbik8PDcsaVsyXXw9OCxpWzNdPTApLHtjb25maWc6aSxjb2RlYzoibXA0YS40MC4iLmNvbmNhdChhKX19fSx7a2V5OiJnZXRTaWxlbnRGcmFtZSIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtpZigibXA0YS40MC4yIj09PWUpe2lmKDE9PT10KXJldHVybiBuZXcgVWludDhBcnJheShbMCwyMDAsMCwxMjgsMzUsMTI4XSk7aWYoMj09PXQpcmV0dXJuIG5ldyBVaW50OEFycmF5KFszMywwLDczLDE0NCwyLDI1LDAsMzUsMTI4XSk7aWYoMz09PXQpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzMiwxMzIsMSwzOCw2NCw4LDEwMCwwLDE0Ml0pO2lmKDQ9PT10KXJldHVybiBuZXcgVWludDhBcnJheShbMCwyMDAsMCwxMjgsMzIsMTMyLDEsMzgsNjQsOCwxMDAsMCwxMjgsNDQsMTI4LDgsMiw1Nl0pO2lmKDU9PT10KXJldHVybiBuZXcgVWludDhBcnJheShbMCwyMDAsMCwxMjgsMzIsMTMyLDEsMzgsNjQsOCwxMDAsMCwxMzAsNDgsNCwxNTMsMCwzMywxNDQsMiw1Nl0pO2lmKDY9PT10KXJldHVybiBuZXcgVWludDhBcnJheShbMCwyMDAsMCwxMjgsMzIsMTMyLDEsMzgsNjQsOCwxMDAsMCwxMzAsNDgsNCwxNTMsMCwzMywxNDQsMiwwLDE3OCwwLDMyLDgsMjI0XSl9ZWxzZXtpZigxPT09dClyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWzEsNjQsMzQsMTI4LDE2Myw3OCwyMzAsMTI4LDE4Niw4LDAsMCwwLDI4LDYsMjQxLDE5MywxMCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5NF0pO2lmKDI9PT10KXJldHVybiBuZXcgVWludDhBcnJheShbMSw2NCwzNCwxMjgsMTYzLDk0LDIzMCwxMjgsMTg2LDgsMCwwLDAsMCwxNDksMCw2LDI0MSwxNjEsMTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTRdKTtpZigzPT09dClyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWzEsNjQsMzQsMTI4LDE2Myw5NCwyMzAsMTI4LDE4Niw4LDAsMCwwLDAsMTQ5LDAsNiwyNDEsMTYxLDEwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDk0XSl9fX1dKSxlfSgpO2kob2UsIkZSRVEiLFs5NmUzLDg4MjAwLDY0ZTMsNDhlMyw0NDEwMCwzMmUzLDI0ZTMsMjIwNTAsMTZlMywxMmUzLDExMDI1LDhlMyw3MzUwXSk7dmFyIHVlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3IodGhpcyxlKX1yZXR1cm4gbihlLG51bGwsW3trZXk6InBhcnNlQW5uZXhCIix2YWx1ZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9ZS5sZW5ndGgscj0yLGE9MDtudWxsIT09ZVtyXSYmdm9pZCAwIT09ZVtyXSYmMSE9PWVbcl07KXIrKztpZigoYT0rK3IrMik+PXQpcmV0dXJuW107Zm9yKHZhciBuPVtdO2E8dDspc3dpdGNoKGVbYV0pe2Nhc2UgMDppZigwIT09ZVthLTFdKXthKz0yO2JyZWFrfWlmKDAhPT1lW2EtMl0pe2ErKzticmVha31yIT09YS0yJiZuLnB1c2goZS5zdWJhcnJheShyLGEtMikpO2Rve2ErK313aGlsZSgxIT09ZVthXSYmYTx0KTthPShyPWErMSkrMjticmVhaztjYXNlIDE6aWYoMCE9PWVbYS0xXXx8MCE9PWVbYS0yXSl7YSs9MzticmVha31yIT09YS0yJiZuLnB1c2goZS5zdWJhcnJheShyLGEtMikpLGE9KHI9YSsxKSsyO2JyZWFrO2RlZmF1bHQ6YSs9M31yZXR1cm4gcjx0JiZuLnB1c2goZS5zdWJhcnJheShyKSksbn19LHtrZXk6InBhcnNlQXZjQyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjQ7aWYoIShlLmxlbmd0aDw0KSl7Zm9yKHZhciByLGE9ZS5sZW5ndGgsbj1bXSxpPTA7aSt0PGE7KWlmKHI9dGUoZSxpKSwzPT09dCYmKHI+Pj49OCksaSs9dCxyKXtpZihpK3I+YSlicmVhaztuLnB1c2goZS5zdWJhcnJheShpLGkrcikpLGkrPXJ9cmV0dXJuIG59fX0se2tleToicGFyc2VTRUkiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPWUubGVuZ3RoLGE9dD8yOjEsbj0wLGk9MCxzPSIiOzI1NT09PWVbYV07KW4rPTI1NSxhKys7Zm9yKG4rPWVbYSsrXTsyNTU9PT1lW2FdOylpKz0yNTUsYSsrO2lmKGkrPWVbYSsrXSw1PT09biYmcj5hKzE2KWZvcih2YXIgbz0wO288MTY7bysrKXMrPWVbYV0udG9TdHJpbmcoMTYpLGErKztyZXR1cm57cGF5bG9hZDplLnN1YmFycmF5KGEsYStpKSx0eXBlOm4sc2l6ZTppLHV1aWQ6c319fSx7a2V5OiJyZW1vdmVFUEIiLHZhbHVlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmJ5dGVMZW5ndGgscj1bXSxhPTE7YTx0LTI7KTA9PT1lW2FdJiYwPT09ZVthKzFdJiYzPT09ZVthKzJdPyhyLnB1c2goYSsyKSxhKz0yKTphKys7aWYoIXIubGVuZ3RoKXJldHVybiBlO3ZhciBuPXQtci5sZW5ndGgsaT1uZXcgVWludDhBcnJheShuKSxzPTA7Zm9yKGE9MDthPG47cysrLGErKylzPT09clswXSYmKHMrKyxyLnNoaWZ0KCkpLGlbYV09ZVtzXTtyZXR1cm4gaX19XSksZX0oKSxjZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSl9cmV0dXJuIG4oZSxudWxsLFt7a2V5OiJwYXJzZUFWQ0RlY29kZXJDb25maWd1cmF0aW9uUmVjb3JkIix2YWx1ZTpmdW5jdGlvbih0KXtpZighKHQubGVuZ3RoPDcpKXtmb3IodmFyIHIsYSxuPTErKDMmdFs0XSksaT1bXSxzPVtdLG89Nix1PTMxJnRbNV0sYz0wO2M8dTtjKyspaWYoYT10W29dPDw4fHRbbysxXSxvKz0yLGEpe3ZhciBsPXQuc3ViYXJyYXkobyxvK2EpO28rPWEsaS5wdXNoKGwpLHJ8fChyPWUucGFyc2VTUFModWUucmVtb3ZlRVBCKGwpKSl9dmFyIGYsZD10W29dO28rKztmb3IodmFyIGg9MDtoPGQ7aCsrKWY9dFtvXTw8OHx0W28rMV0sbys9MixmJiYocy5wdXNoKHQuc3ViYXJyYXkobyxvK2YpKSxvKz1mKTtyZXR1cm57c3BzOnIsc3BzQXJyOmkscHBzQXJyOnMsbmFsVW5pdFNpemU6bn19fX0se2tleToicGFyc2VTUFMiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PW5ldyBIKGUpO3QucmVhZFVCeXRlKCk7dmFyIHI9dC5yZWFkVUJ5dGUoKSxhPXQucmVhZFVCeXRlKCksbj10LnJlYWRVQnl0ZSgpO3Quc2tpcFVFRygpO3ZhciBpPTQyMDtpZigxMDA9PT1yfHwxMTA9PT1yfHwxMjI9PT1yfHwyNDQ9PT1yfHw0ND09PXJ8fDgzPT09cnx8ODY9PT1yfHwxMTg9PT1yfHwxMjg9PT1yfHwxMzg9PT1yfHwxNDQ9PT1yKXt2YXIgcz10LnJlYWRVRUcoKTtpZihzPD0zJiYoaT1bMCw0MjAsNDIyLDQ0NF1bc10pLDM9PT1zJiZ0LnNraXBCaXRzKDEpLHQuc2tpcFVFRygpLHQuc2tpcFVFRygpLHQuc2tpcEJpdHMoMSksdC5yZWFkQm9vbCgpKWZvcih2YXIgbz0zIT09cz84OjEyLHU9MDt1PG87dSsrKXQucmVhZEJvb2woKSYmKHU8Nj90LnNraXBTY2FsaW5nTGlzdCgxNik6dC5za2lwU2NhbGluZ0xpc3QoNjQpKX10LnNraXBVRUcoKTt2YXIgYz10LnJlYWRVRUcoKTtpZigwPT09Yyl0LnJlYWRVRUcoKTtlbHNlIGlmKDE9PT1jKXt0LnNraXBCaXRzKDEpLHQuc2tpcFVFRygpLHQuc2tpcFVFRygpO2Zvcih2YXIgbD10LnJlYWRVRUcoKSxmPTA7ZjxsO2YrKyl0LnNraXBVRUcoKX10LnNraXBVRUcoKSx0LnNraXBCaXRzKDEpO3ZhciBkPXQucmVhZFVFRygpLGg9dC5yZWFkVUVHKCkscD10LnJlYWRCaXRzKDEpOzA9PT1wJiZ0LnNraXBCaXRzKDEpLHQuc2tpcEJpdHMoMSk7dmFyIHYseSxtLGcsayxiPTAsXz0wLHc9MCx4PTA7aWYodC5yZWFkQm9vbCgpJiYoYj10LnJlYWRVRUcoKSxfPXQucmVhZFVFRygpLHc9dC5yZWFkVUVHKCkseD10LnJlYWRVRUcoKSksdC5yZWFkQm9vbCgpKXtpZih0LnJlYWRCb29sKCkpc3dpdGNoKHQucmVhZFVCeXRlKCkpe2Nhc2UgMTp2PVsxLDFdO2JyZWFrO2Nhc2UgMjp2PVsxMiwxMV07YnJlYWs7Y2FzZSAzOnY9WzEwLDExXTticmVhaztjYXNlIDQ6dj1bMTYsMTFdO2JyZWFrO2Nhc2UgNTp2PVs0MCwzM107YnJlYWs7Y2FzZSA2OnY9WzI0LDExXTticmVhaztjYXNlIDc6dj1bMjAsMTFdO2JyZWFrO2Nhc2UgODp2PVszMiwxMV07YnJlYWs7Y2FzZSA5OnY9WzgwLDMzXTticmVhaztjYXNlIDEwOnY9WzE4LDExXTticmVhaztjYXNlIDExOnY9WzE1LDExXTticmVhaztjYXNlIDEyOnY9WzY0LDMzXTticmVhaztjYXNlIDEzOnY9WzE2MCw5OV07YnJlYWs7Y2FzZSAxNDp2PVs0LDNdO2JyZWFrO2Nhc2UgMTU6dj1bMywyXTticmVhaztjYXNlIDE2OnY9WzIsMV07YnJlYWs7Y2FzZSAyNTU6dj1bdC5yZWFkVUJ5dGUoKTw8OHx0LnJlYWRVQnl0ZSgpLHQucmVhZFVCeXRlKCk8PDh8dC5yZWFkVUJ5dGUoKV19aWYodC5yZWFkQm9vbCgpJiZ0LnJlYWRCb29sKCksdC5yZWFkQm9vbCgpJiYodC5yZWFkQml0cyg0KSx0LnJlYWRCb29sKCkmJnQucmVhZEJpdHMoMjQpKSx0LnJlYWRCb29sKCkmJih0LnJlYWRVRUcoKSx0LnJlYWRVRUcoKSksdC5yZWFkQm9vbCgpKXt2YXIgUz10LnJlYWRCaXRzKDMyKSxEPXQucmVhZEJpdHMoMzIpO3k9dC5yZWFkQm9vbCgpLGs9KG09RCkvKGc9MipTKX19cmV0dXJue2NvZGVjOmFlKGUuc3ViYXJyYXkoMSw0KSkscHJvZmlsZUlkYzpyLHByb2ZpbGVDb21wYXRpYmlsaXR5OmEsbGV2ZWxJZGM6bixjaHJvbWFGb3JtYXQ6aSx3aWR0aDpNYXRoLmNlaWwoMTYqKGQrMSktMiooYitfKSksaGVpZ2h0OigyLXApKihoKzEpKjE2LShwPzI6NCkqKHcreCksc2FyUmF0aW86dixmcHNOdW06bSxmcHNEZW46ZyxmcHM6ayxmaXhlZEZyYW1lOnl9fX1dKSxlfSgpLGxlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3IodGhpcyxlKX1yZXR1cm4gbihlLG51bGwsW3trZXk6InBhcnNlSEVWQ0RlY29kZXJDb25maWd1cmF0aW9uUmVjb3JkIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06e307aWYoISh0Lmxlbmd0aDwyMykpe3I9cnx8e307Zm9yKHZhciBhLG4saSxzLG8sdT0xKygzJnRbMjFdKSxjPVtdLGw9W10sZj1bXSxkPTIzLGg9dFsyMl0scD0wO3A8aDtwKyspe2k9NjMmdFtkXSxzPXRbZCsxXTw8OHx0W2QrMl0sZCs9Mztmb3IodmFyIHY9MDt2PHM7disrKWlmKG89dFtkXTw8OHx0W2QrMV0sZCs9MixvKXtzd2l0Y2goaSl7Y2FzZSAzMjp2YXIgeT10LnN1YmFycmF5KGQsZCtvKTthfHwoYT1lLnBhcnNlVlBTKHVlLnJlbW92ZUVQQih5KSxyKSksZi5wdXNoKHkpO2JyZWFrO2Nhc2UgMzM6dmFyIG09dC5zdWJhcnJheShkLGQrbyk7bnx8KG49ZS5wYXJzZVNQUyh1ZS5yZW1vdmVFUEIobSkscikpLGMucHVzaChtKTticmVhaztjYXNlIDM0OmwucHVzaCh0LnN1YmFycmF5KGQsZCtvKSl9ZCs9b319cmV0dXJue2h2Y0M6cixzcHM6bixzcHNBcnI6YyxwcHNBcnI6bCx2cHNBcnI6ZixuYWxVbml0U2l6ZTp1fX19fSx7a2V5OiJwYXJzZVZQUyIsdmFsdWU6ZnVuY3Rpb24odCxyKXtyPXJ8fHt9O3ZhciBhPW5ldyBIKHQpO2EucmVhZFVCeXRlKCksYS5yZWFkVUJ5dGUoKSxhLnJlYWRCaXRzKDEyKTt2YXIgbj1hLnJlYWRCaXRzKDMpO3JldHVybiByLm51bVRlbXBvcmFsTGF5ZXJzPU1hdGgubWF4KHIubnVtVGVtcG9yYWxMYXllcnN8fDAsbisxKSxhLnJlYWRCaXRzKDE3KSxlLl9wYXJzZVByb2ZpbGVUaWVyTGV2ZWwoYSxuLHIpLHJ9fSx7a2V5OiJwYXJzZVNQUyIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOnt9O3I9cnx8e307dmFyIGE9bmV3IEgodCk7YS5yZWFkVUJ5dGUoKSxhLnJlYWRVQnl0ZSgpLGEucmVhZEJpdHMoNCk7dmFyIG49YS5yZWFkQml0cygzKTtyLm51bVRlbXBvcmFsTGF5ZXJzPU1hdGgubWF4KG4rMSxyLm51bVRlbXBvcmFsTGF5ZXJzfHwwKSxyLnRlbXBvcmFsSWROZXN0ZWQ9YS5yZWFkQml0cygxKSxlLl9wYXJzZVByb2ZpbGVUaWVyTGV2ZWwoYSxuLHIpLGEucmVhZFVFRygpO3ZhciBpPXIuY2hyb21hRm9ybWF0SWRjPWEucmVhZFVFRygpLHM9NDIwO2k8PTMmJihzPVswLDQyMCw0MjIsNDQ0XVtpXSk7dmFyIG89MDszPT09aSYmKG89YS5yZWFkQml0cygxKSk7dmFyIHUsYyxsLGYsZD1hLnJlYWRVRUcoKSxoPWEucmVhZFVFRygpLHA9YS5yZWFkQml0cygxKTtpZigxPT09cCYmKHU9YS5yZWFkVUVHKCksYz1hLnJlYWRVRUcoKSxsPWEucmVhZFVFRygpLGY9YS5yZWFkVUVHKCkpLHIuYml0RGVwdGhMdW1hTWludXM4PWEucmVhZFVFRygpLHIuYml0RGVwdGhDaHJvbWFNaW51czg9YS5yZWFkVUVHKCksMT09PXApe3ZhciB2PTEhPT1pJiYyIT09aXx8MCE9PW8/MToyLHk9MT09PWkmJjA9PT1vPzI6MTtkLT12KihjK3UpLGgtPXkqKGYrbCl9cmV0dXJue2NvZGVjOiJoZXYxLjEuNi5MOTMuQjAiLHdpZHRoOmQsaGVpZ2h0OmgsY2hyb21hRm9ybWF0OnMsaHZjQzpyfX19LHtrZXk6Il9wYXJzZVByb2ZpbGVUaWVyTGV2ZWwiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYT1yLmdlbmVyYWxUaWVyRmxhZ3x8MDtyLmdlbmVyYWxQcm9maWxlU3BhY2U9ZS5yZWFkQml0cygyKSxyLmdlbmVyYWxUaWVyRmxhZz1NYXRoLm1heChlLnJlYWRCaXRzKDEpLGEpLHIuZ2VuZXJhbFByb2ZpbGVJZGM9TWF0aC5tYXgoZS5yZWFkQml0cyg1KSxyLmdlbmVyYWxQcm9maWxlSWRjfHwwKSxyLmdlbmVyYWxQcm9maWxlQ29tcGF0aWJpbGl0eUZsYWdzPWUucmVhZEJpdHMoMzIpLHIuZ2VuZXJhbENvbnN0cmFpbnRJbmRpY2F0b3JGbGFncz1bZS5yZWFkQml0cyg4KSxlLnJlYWRCaXRzKDgpLGUucmVhZEJpdHMoOCksZS5yZWFkQml0cyg4KSxlLnJlYWRCaXRzKDgpLGUucmVhZEJpdHMoOCldO3ZhciBuPWUucmVhZEJpdHMoOCk7YTxyLmdlbmVyYWxUaWVyRmxhZz9yLmdlbmVyYWxMZXZlbElkYz1uOnIuZ2VuZXJhbExldmVsSWRjPU1hdGgubWF4KG4sci5nZW5lcmFsTGV2ZWxJZGN8fDApO3ZhciBpPVtdLHM9W107aWYodD5lLmJpdHNBdmFpbGFibGUpdGhyb3cgbmV3IEVycm9yKCJtYXhTdWJMYXllcnNNaW51cyBpbmF2bGlkIHNpemUgIi5jb25jYXQodCkpO2Zvcih2YXIgbz0wO288dDtvKyspaVtvXT1lLnJlYWRCaXRzKDEpLHNbb109ZS5yZWFkQml0cygxKTt0PjAmJmUucmVhZEJpdHMoMiooOC10KSk7Zm9yKHZhciB1PTA7dTx0O3UrKykwIT09aVt1XSYmKGUucmVhZEJpdHMoMiksZS5yZWFkQml0cygxKSxlLnJlYWRCaXRzKDUpLGUucmVhZEJpdHMoMTYpLGUucmVhZEJpdHMoMTYpLGUucmVhZEJpdHMoNCksZS5yZWFkQml0cygxNiksZS5yZWFkQml0cygxNiksZS5yZWFkQml0cygxMikpLDAhPT1zW3VdJiZlLnJlYWRCaXRzKDgpfX1dKSxlfSgpLGZlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3IodGhpcyxlKX1yZXR1cm4gbihlLG51bGwsW3trZXk6ImdldEZyYW1lRHVyYXRpb24iLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiAyMH19LHtrZXk6InBhcnNlSGVhZGVyUGFja2V0cyIsdmFsdWU6ZnVuY3Rpb24oZSl7aWYoZS5sZW5ndGgpe2Zvcih2YXIgdD1uZXcgRGF0YVZpZXcoZS5idWZmZXIsZS5ieXRlT2Zmc2V0LGUuYnl0ZUxlbmd0aCkscj0iIixhPTA7YTw4O2ErKylyKz1TdHJpbmcuZnJvbUNvZGVQb2ludChlW2FdKTtpZigiT3B1c0hlYWQiIT09cil0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgT3B1cyBNYWdpY1NpZ25hdHVyZSIpO3ZhciBuPWVbOV07Y29uc29sZS5sb2coIlByZS1za2lwIixlWzEwXSxlWzExXSk7dmFyIGk9dC5nZXRVaW50MzIoMTIsITApLHM9dC5nZXRJbnQxNigxNiwhMCk7aWYoaSl7cmV0dXJue291dHB1dEdhaW46cyxzYW1wbGVSYXRlOmksY2hhbm5lbENvdW50Om4sY29uZmlnOm5ldyBVaW50OEFycmF5KGUuYnVmZmVyLGUuYnl0ZU9mZnNldCs4LGUuYnl0ZUxlbmd0aC04KSxjb2RlYzoib3B1cyIsb3JpZ2luQ29kZWM6Im9wdXMifX19fX1dKSxlfSgpLGRlPTFlMyxoZT01ZTMscGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQsYSxuKXtyKHRoaXMsZSksdGhpcy52aWRlb1RyYWNrPXQsdGhpcy5hdWRpb1RyYWNrPWEsdGhpcy5tZXRhZGF0YVRyYWNrPW4sdGhpcy5fYmFzZUR0cz0tMSx0aGlzLl9iYXNlRHRzSW5pdGVkPSExLHRoaXMuX2F1ZGlvTmV4dFB0cz12b2lkIDAsdGhpcy5fdmlkZW9OZXh0RHRzPXZvaWQgMCx0aGlzLl9hdWRpb1RpbWVzdGFtcEJyZWFrPTAsdGhpcy5fdmlkZW9UaW1lc3RhbXBCcmVhaz0wLHRoaXMuX2xhc3RWaWRlb0R1cmF0aW9uPTAsdGhpcy5fa2V5RnJhbWVJbk5leHRDaHVuaz0hMSx0aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25HYXBEb3Q9LTEvMCx0aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25PdmVybGFwRG90PS0xLzAsdGhpcy5fbGFzdEF1ZGlvRXhjZXB0aW9uTGFyZ2VHYXBEb3Q9LTEvMCx0aGlzLl9sYXN0VmlkZW9FeGNlcHRpb25MYXJnZUdhcERvdD0tMS8wLHRoaXMuX2xhc3RWaWRlb0V4Y2VwdGlvbkNodW5rRmlyc3REdHNEb3Q9LTEvMH1yZXR1cm4gbihlLFt7a2V5OiJmaXgiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcyx0PWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTowLHI9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0mJmFyZ3VtZW50c1sxXSxhPSEoYXJndW1lbnRzLmxlbmd0aD4yJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0pfHxhcmd1bWVudHNbMl07dD1NYXRoLnJvdW5kKDFlMyp0KTt2YXIgbj10aGlzLnZpZGVvVHJhY2ssaT10aGlzLmF1ZGlvVHJhY2s7IXImJmF8fCh0aGlzLl92aWRlb0xhc3RTYW1wbGU9bnVsbCx0aGlzLl9hdWRpb05leHRQdHM9dm9pZCAwLHRoaXMuX3ZpZGVvTmV4dER0cz12b2lkIDAsdGhpcy5fYXVkaW9UaW1lc3RhbXBCcmVhaz0wLHRoaXMuX3ZpZGVvVGltZXN0YW1wQnJlYWs9MCx0aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25HYXBEb3Q9LTEvMCx0aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25PdmVybGFwRG90PS0xLzAsdGhpcy5fbGFzdEF1ZGlvRXhjZXB0aW9uTGFyZ2VHYXBEb3Q9LTEvMCx0aGlzLl9sYXN0VmlkZW9FeGNlcHRpb25MYXJnZUdhcERvdD0tMS8wLHRoaXMuX2xhc3RWaWRlb0V4Y2VwdGlvbkNodW5rRmlyc3REdHNEb3Q9LTEvMCksciYmIWEmJih0aGlzLl9iYXNlRHRzSW5pdGVkPSExKSx0aGlzLl9iYXNlRHRzSW5pdGVkfHx0aGlzLl9jYWxjdWxhdGVCYXNlRHRzKGksbiksIWEmJnQmJih0aGlzLl9hdWRpb05leHRQdHM9dGhpcy5fdmlkZW9OZXh0RHRzPXQpO3ZhciBzPXRoaXMuX2Jhc2VEdHNJbml0ZWQmJih0aGlzLl92aWRlb1RpbWVzdGFtcEJyZWFrfHwhdGhpcy52aWRlb1RyYWNrLmV4aXN0KCkpJiYodGhpcy5fYXVkaW9UaW1lc3RhbXBCcmVha3x8IXRoaXMuYXVkaW9UcmFjay5leGlzdCgpKTtpZihzJiZ0aGlzLl9yZXNldEJhc2VEdHNXaGVuU3RyZWFtQnJlYWtlZCgpLHRoaXMuX2ZpeEF1ZGlvKGkpLHRoaXMuX2tleUZyYW1lSW5OZXh0Q2h1bms9ITEsdGhpcy5fZml4VmlkZW8obiksdGhpcy5tZXRhZGF0YVRyYWNrLmV4aXN0KCkpe3ZhciBvPXRoaXMubWV0YWRhdGFUcmFjay50aW1lc2NhbGU7dGhpcy5tZXRhZGF0YVRyYWNrLnNlaVNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24odCl7dC5wdHM9dC5vcmlnaW5QdHMtZS5fYmFzZUR0cyx0LnRpbWU9TWF0aC5tYXgoMCx0LnB0cykvb30pKSx0aGlzLm1ldGFkYXRhVHJhY2suZmx2U2NyaXB0U2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbih0KXt0LnB0cz10Lm9yaWdpblB0cy1lLl9iYXNlRHRzLHQudGltZT1NYXRoLm1heCgwLHQucHRzKS9vfSkpfW4uc2FtcGxlcy5sZW5ndGgmJihuLmJhc2VNZWRpYURlY29kZVRpbWU9bi5zYW1wbGVzWzBdLmR0cyksaS5zYW1wbGVzLmxlbmd0aCYmKGkuYmFzZU1lZGlhRGVjb2RlVGltZT1pLnNhbXBsZXNbMF0ucHRzKmkudGltZXNjYWxlLzFlMyl9fSx7a2V5OiJfZml4VmlkZW8iLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMscj1lLnNhbXBsZXM7aWYoci5sZW5ndGgpe3ZhciBhO2lmKHIuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ZS5kdHMtPXQuX2Jhc2VEdHMsZS5wdHMtPXQuX2Jhc2VEdHMsZS5rZXlmcmFtZSYmKHQuX2tleUZyYW1lSW5OZXh0Q2h1bms9ITApfSkpLGUuZnBzTnVtJiZlLmZwc0RlbilhPWUudGltZXNjYWxlKihlLmZwc0Rlbi9lLmZwc051bSk7ZWxzZSBpZihlLmxlbmd0aD4xKXt2YXIgbj1lLnNhbXBsZXNbMF0saT1lLnNhbXBsZXNbci5sZW5ndGgtMV07YT1NYXRoLmZsb29yKChpLmR0cy1uLmR0cykvKHIubGVuZ3RoLTEpKX1lbHNlIGE9dGhpcy5fbGFzdFZpZGVvRHVyYXRpb258fDQwO3ZhciBzPXIucG9wKCk7aWYodGhpcy5fdmlkZW9MYXN0U2FtcGxlJiZyLnVuc2hpZnQodGhpcy5fdmlkZW9MYXN0U2FtcGxlKSx0aGlzLl92aWRlb0xhc3RTYW1wbGU9cyxyLmxlbmd0aCl7aWYodm9pZCAwPT09dGhpcy5fdmlkZW9OZXh0RHRzKXt2YXIgbz1yWzBdO3RoaXMuX3ZpZGVvTmV4dER0cz1vLmR0c312YXIgdT1yLmxlbmd0aCxjPTAsbD1yWzBdLGY9dGhpcy5fdmlkZW9OZXh0RHRzLWwuZHRzO2lmKE1hdGguYWJzKGYpPjIwMCl7dmFyIGQ7aWYoTWF0aC5hYnMobC5kdHMtdGhpcy5fbGFzdFZpZGVvRXhjZXB0aW9uQ2h1bmtGaXJzdER0c0RvdCk+NWUzKXRoaXMuX2xhc3RWaWRlb0V4Y2VwdGlvbkNodW5rRmlyc3REdHNEb3Q9bC5kdHMsZS53YXJuaW5ncy5wdXNoKHt0eXBlOlAsbmV4dER0czp0aGlzLl92aWRlb05leHREdHMsZmlyc3RTYW1wbGVEdHM6bC5kdHMsbmV4dFNhbXBsZUR0czpudWxsPT09KGQ9clsxXSl8fHZvaWQgMD09PWQ/dm9pZCAwOmQuZHRzLHNhbXBsZUR1cmF0aW9uOmZ9KTt0aGlzLl92aWRlb1RpbWVzdGFtcEJyZWFrPj01Pyh0aGlzLl92aWRlb05leHREdHM9bC5kdHMsdGhpcy5fdmlkZW9UaW1lc3RhbXBCcmVhaz0wKToobC5kdHMrPWYsbC5wdHMrPWYsdGhpcy5hdWRpb1RyYWNrLmV4aXN0KCl8fCh0aGlzLl92aWRlb1RpbWVzdGFtcEJyZWFrPTEpKX1mb3IodmFyIGg9MDtoPHU7aCsrKXt2YXIgcD1yW2hdLmR0cyx2PXJbaCsxXTsoKGM9aDx1LTE/di5kdHMtcDpzP3MuZHRzLXA6YSk+MWUzfHxjPDApJiYodGhpcy5fdmlkZW9UaW1lc3RhbXBCcmVhaysrLE1hdGguYWJzKHAtdGhpcy5fbGFzdFZpZGVvRXhjZXB0aW9uTGFyZ2VHYXBEb3QpPjVlMyYmKHRoaXMuX2xhc3RWaWRlb0V4Y2VwdGlvbkxhcmdlR2FwRG90PXAsZS53YXJuaW5ncy5wdXNoKHt0eXBlOkMsdGltZTpwL2UudGltZXNjYWxlLGR0czpwLG9yaWdpbkR0czpyW2hdLm9yaWdpbkR0cyxuZXh0RHRzOnRoaXMuX3ZpZGVvTmV4dER0cyxzYW1wbGVEdXJhdGlvbjpjLHJlZlNhbXBsZUR1cmF0aW9uOmF9KSksYz1hKSxyW2hdLmR1cmF0aW9uPWMsdGhpcy5fdmlkZW9OZXh0RHRzKz1jLHRoaXMuX2xhc3RWaWRlb0R1cmF0aW9uPWN9fX19fSx7a2V5OiJfZml4QXVkaW8iLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMscj1lLnNhbXBsZXM7ci5sZW5ndGgmJihyLmZvckVhY2goKGZ1bmN0aW9uKGUpe2UuZHRzPWUucHRzLT10Ll9iYXNlRHRzfSkpLHRoaXMuX2RvRml4QXVkaW9JbnRlcm5hbChlLHIsMWUzKSl9fSx7a2V5OiJfY2FsY3VsYXRlQmFzZUR0cyIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt2YXIgcj1lLnNhbXBsZXMsYT10LnNhbXBsZXM7aWYoIXIubGVuZ3RoJiYhYS5sZW5ndGgpcmV0dXJuITE7dmFyIG49MS8wLGk9MS8wO3IubGVuZ3RoJiYoZS5iYXNlRHRzPW49clswXS5wdHMpLGEubGVuZ3RoJiYodC5iYXNlRHRzPWk9YVswXS5kdHMpLHRoaXMuX2Jhc2VEdHM9TWF0aC5taW4obixpKTt2YXIgcz1pLW47cmV0dXJuIE51bWJlci5pc0Zpbml0ZShzKSYmTWF0aC5hYnMocyk+NTAwJiZ0Lndhcm5pbmdzLnB1c2goe3R5cGU6VSx2aWRlb0Jhc2VEdHM6aSxhdWRpb0Jhc2VQdHM6bixiYXNlRHRzOnRoaXMuX2Jhc2VEdHMsZGVsdGE6c30pLHRoaXMuX2Jhc2VEdHNJbml0ZWQ9ITAsITB9fSx7a2V5OiJfcmVzZXRCYXNlRHRzV2hlblN0cmVhbUJyZWFrZWQiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5fY2FsY3VsYXRlQmFzZUR0cyh0aGlzLmF1ZGlvVHJhY2ssdGhpcy52aWRlb1RyYWNrKSYmKHRoaXMuYXVkaW9UcmFjay5leGlzdCgpP3RoaXMudmlkZW9UcmFjay5leGlzdCgpP3RoaXMuX2Jhc2VEdHMtPU1hdGgubWluKHRoaXMuX2F1ZGlvTmV4dFB0cyx0aGlzLl92aWRlb05leHREdHMpOnRoaXMuX2Jhc2VEdHMtPXRoaXMuX2F1ZGlvTmV4dFB0czp0aGlzLl9iYXNlRHRzLT10aGlzLl92aWRlb05leHREdHMsdGhpcy5fdmlkZW9UaW1lc3RhbXBCcmVhaz0wLHRoaXMuX2F1ZGlvVGltZXN0YW1wQnJlYWs9MCl9fSx7a2V5OiJfZG9GaXhBdWRpb0ludGVybmFsIix2YWx1ZTpmdW5jdGlvbihlLHQscil7aWYoIWUuc2FtcGxlRHVyYXRpb24pc3dpdGNoKGUuY29kZWNUeXBlKXtjYXNlIEE6ZS5zYW1wbGVEdXJhdGlvbj1vZS5nZXRGcmFtZUR1cmF0aW9uKGUudGltZXNjYWxlLHIpO2JyZWFrO2Nhc2UgRTplLnNhbXBsZUR1cmF0aW9uPWZlLmdldEZyYW1lRHVyYXRpb24oZS5zYW1wbGVzLHIpO2JyZWFrO2Nhc2UgVDpjYXNlIEI6ZS5zYW1wbGVEdXJhdGlvbj10aGlzLl9nZXRHNzExRHVyYXRpb24oZSk7YnJlYWs7ZGVmYXVsdDpjb25zb2xlLmVycm9yKCJjYW4ndCBmaXggYXVkaW8gY29kZWNUeXBlOiIsZS5jb2RlY1R5cGUpfXZhciBhPWUuc2FtcGxlRHVyYXRpb24sbj1lLmNvZGVjVHlwZT09PUU/MjA6ZS5jb2RlY1R5cGU9PT1BPzEwMjQ6YSplLnRpbWVzY2FsZS8xZTM7aWYodm9pZCAwPT09dGhpcy5fYXVkaW9OZXh0UHRzKXt2YXIgaT10WzBdO3RoaXMuX2F1ZGlvTmV4dFB0cz1pLnB0c31mb3IodmFyIHM9MDtzPHQubGVuZ3RoO3MrKyl7dmFyIG89dGhpcy5fYXVkaW9OZXh0UHRzLHU9dFtzXSxjPXUucHRzLW87aWYoMD09PXMmJnRoaXMuX2F1ZGlvVGltZXN0YW1wQnJlYWs+PTUmJnRoaXMuX2tleUZyYW1lSW5OZXh0Q2h1bmsmJihvPXRoaXMuX2F1ZGlvTmV4dFB0cz11LmR0cyxjPTAsdGhpcy5fYXVkaW9UaW1lc3RhbXBCcmVhaz0wKSwhdGhpcy5fYXVkaW9UaW1lc3RhbXBCcmVhayYmYz49MyphJiZjPD1kZSYmIVkpe3ZhciBsPXRoaXMuX2dldFNpbGVudEZyYW1lKGUpfHx0WzBdLmRhdGEuc3ViYXJyYXkoKSxmPU1hdGguZmxvb3IoYy9hKTtNYXRoLmFicyh1LnB0cy10aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25HYXBEb3QpPmhlJiYodGhpcy5fbGFzdEF1ZGlvRXhjZXB0aW9uR2FwRG90PXUucHRzLGUud2FybmluZ3MucHVzaCh7dHlwZTpNLHB0czp1LnB0cyxvcmlnaW5QdHM6dS5vcmlnaW5QdHMsY291bnQ6ZixuZXh0UHRzOm8scmVmU2FtcGxlRHVyYXRpb246YX0pKTtmb3IodmFyIGQ9MDtkPGY7ZCsrKXt2YXIgaD1uZXcgVihNYXRoLmZsb29yKHRoaXMuX2F1ZGlvTmV4dFB0cythKS1NYXRoLmZsb29yKHRoaXMuX2F1ZGlvTmV4dFB0cyksbCxuKTtoLm9yaWdpblB0cz1NYXRoLmZsb29yKHRoaXMuX2Jhc2VEdHMrbyksdC5zcGxpY2UocywwLGgpLHRoaXMuX2F1ZGlvTmV4dFB0cys9YSxzKyt9cy0tfWVsc2UgaWYoYzw9LTMqYSYmYz49LTFlMylNYXRoLmFicyh1LnB0cy10aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25PdmVybGFwRG90KT5oZSYmKHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbk92ZXJsYXBEb3Q9dS5wdHMsZS53YXJuaW5ncy5wdXNoKHt0eXBlOnoscHRzOnUucHRzLG9yaWdpblB0czp1Lm9yaWdpblB0cyxuZXh0UHRzOm8scmVmU2FtcGxlRHVyYXRpb246YX0pKSx0LnNwbGljZShzLDEpLHMtLTtlbHNle2lmKE1hdGguYWJzKGMpPmRlJiYodGhpcy5fYXVkaW9UaW1lc3RhbXBCcmVhaysrLE1hdGguYWJzKHUucHRzLXRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbkxhcmdlR2FwRG90KT5oZSYmKHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbkxhcmdlR2FwRG90PXUucHRzLGUud2FybmluZ3MucHVzaCh7dHlwZTpJLHRpbWU6dS5wdHMvMWUzLHB0czp1LnB0cyxvcmlnaW5QdHM6dS5vcmlnaW5QdHMsbmV4dFB0czpvLHNhbXBsZUR1cmF0aW9uOmMscmVmU2FtcGxlRHVyYXRpb246YX0pKSksZS5jb2RlY1R5cGU9PT1FKXt2YXIgcD10W3QubGVuZ3RoLTFdO3AmJihwLmR1cmF0aW9uPXUucHRzLXAucHRzKX1lbHNlIHUuZHRzPXUucHRzPW8sdS5kdXJhdGlvbj1uO3RoaXMuX2F1ZGlvTmV4dFB0cys9YX19fX0se2tleToiX2dldEc3MTFEdXJhdGlvbiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5zYW1wbGVTaXplLHI9ZS5jaGFubmVsQ291bnQsYT1lLnNhbXBsZVJhdGUsbj1lLnNhbXBsZXNbMF07aWYobilyZXR1cm4gMipuLmRhdGEuYnl0ZUxlbmd0aC9yLyh0LzgpL2EqMWUzfX0se2tleToiX2dldFNpbGVudEZyYW1lIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gZS5jb2RlY1R5cGU9PT1BP29lLmdldFNpbGVudEZyYW1lKGUuY29kZWMsZS5jaGFubmVsQ291bnQpOm5ldyBVaW50OEFycmF5KDgqZS5zYW1wbGVEdXJhdGlvbiplLmNoYW5uZWxDb3VudCl9fV0pLGV9KCksdmU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpfXJldHVybiBuKGUsbnVsbCxbe2tleToicGFyc2UiLHZhbHVlOmZ1bmN0aW9uKHQpe2lmKCEodC5sZW5ndGg8Mykpe3ZhciByPXt9LGE9ZS5fcGFyc2VWYWx1ZShuZXcgRGF0YVZpZXcodC5idWZmZXIsdC5ieXRlT2Zmc2V0LHQuYnl0ZUxlbmd0aCkpLG49ZS5fcGFyc2VWYWx1ZShuZXcgRGF0YVZpZXcodC5idWZmZXIsdC5ieXRlT2Zmc2V0K2Euc2l6ZSx0LmJ5dGVMZW5ndGgtYS5zaXplKSk7cmV0dXJuIHJbYS5kYXRhXT1uLmRhdGEscn19fSx7a2V5OiJfcGFyc2VWYWx1ZSIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHIsYT10LmJ5dGVMZW5ndGgsbj0xLGk9ITE7c3dpdGNoKHQuZ2V0VWludDgoMCkpe2Nhc2UgMDpyPXQuZ2V0RmxvYXQ2NCgxKSxuKz04O2JyZWFrO2Nhc2UgMTpyPSEhdC5nZXRVaW50OCgxKSxuKz0xO2JyZWFrO2Nhc2UgMjp2YXIgcz1lLl9wYXJzZVN0cmluZyhuZXcgRGF0YVZpZXcodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sdC5ieXRlTGVuZ3RoLW4pKTtyPXMuZGF0YSxuKz1zLnNpemU7YnJlYWs7Y2FzZSAzOnI9e307dmFyIG89MDtmb3IoOT09KDE2Nzc3MjE1JnQuZ2V0VWludDMyKGEtNCkpJiYobz0zKTtuPGEtNDspe3ZhciB1PWUuX3BhcnNlT2JqZWN0KG5ldyBEYXRhVmlldyh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbix0LmJ5dGVMZW5ndGgtbi1vKSksYz11LnNpemUsbD11LmRhdGE7aWYodS5pc0VuZClicmVhaztyW2wubmFtZV09bC52YWx1ZSxuKz1jfWlmKG48PWEtMyk5PT09KDE2Nzc3MjE1JnQuZ2V0VWludDMyKG4tMSkpJiYobis9Myk7YnJlYWs7Y2FzZSA4OnI9e30sbis9NDt2YXIgZj0wO2Zvcig5PT0oMTY3NzcyMTUmdC5nZXRVaW50MzIoYS00KSkmJihmPTMpO248YS04Oyl7dmFyIGQ9ZS5fcGFyc2VPYmplY3QobmV3IERhdGFWaWV3KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCtuLHQuYnl0ZUxlbmd0aC1uLWYpKSxoPWQuc2l6ZSxwPWQuZGF0YTtpZihkLmlzRW5kKWJyZWFrO3JbcC5uYW1lXT1wLnZhbHVlLG4rPWh9aWYobjw9YS0zKTk9PT0oMTY3NzcyMTUmdC5nZXRVaW50MzIobi0xKSkmJihuKz0zKTticmVhaztjYXNlIDk6cj12b2lkIDAsbj0xLGk9ITA7YnJlYWs7Y2FzZSAxMDpyPVtdO3ZhciB2PXQuZ2V0VWludDMyKDEpO24rPTQ7Zm9yKHZhciB5PTA7eTx2O3krKyl7dmFyIG09ZS5fcGFyc2VWYWx1ZShuZXcgRGF0YVZpZXcodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sdC5ieXRlTGVuZ3RoLW4pKSxnPW0uZGF0YSxrPW0uc2l6ZTtyLnB1c2goZyksbis9a31icmVhaztjYXNlIDExOnZhciBiPXQuZ2V0RmxvYXQ2NChuKSs2ZTQqdC5nZXRJbnQxNihuKzgpO3I9bmV3IERhdGUoYiksbis9MTA7YnJlYWs7Y2FzZSAxMjp2YXIgXz10LmdldFVpbnQzMigxKTtuKz00LHI9IiIsXz4wJiYocj1xLmRlY29kZShuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixfKSkpLG4rPV87YnJlYWs7ZGVmYXVsdDpuPWF9cmV0dXJue2RhdGE6cixzaXplOm4saXNFbmQ6aX19fSx7a2V5OiJfcGFyc2VTdHJpbmciLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PWUuZ2V0VWludDE2KDApLHI9IiI7cmV0dXJuIHQ+MCYmKHI9cS5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoZS5idWZmZXIsZS5ieXRlT2Zmc2V0KzIsdCkpKSx7ZGF0YTpyLHNpemU6Mit0fX19LHtrZXk6Il9wYXJzZU9iamVjdCIsdmFsdWU6ZnVuY3Rpb24odCl7aWYoISh0LmJ5dGVMZW5ndGg8Mykpe3ZhciByPWUuX3BhcnNlU3RyaW5nKHQpLGE9ZS5fcGFyc2VWYWx1ZShuZXcgRGF0YVZpZXcodC5idWZmZXIsdC5ieXRlT2Zmc2V0K3Iuc2l6ZSx0LmJ5dGVMZW5ndGgtci5zaXplKSk7cmV0dXJue2RhdGE6e25hbWU6ci5kYXRhLHZhbHVlOmEuZGF0YX0sc2l6ZTpyLnNpemUrYS5zaXplLGlzRW5kOmEuaXNFbmR9fX19XSksZX0oKSx5ZT03LG1lPTgsZ2U9MTAsa2U9MTMsYmU9bmV3IEsoIkZsdkRlbXV4ZXIiKSxfZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUodCxhLG4pe3IodGhpcyxlKSxpKHRoaXMsIl9oZWFkZXJQYXJzZWQiLCExKSxpKHRoaXMsIl9yZW1haW5pbmdEYXRhIixudWxsKSxpKHRoaXMsIl9nb3BJZCIsMCksaSh0aGlzLCJfbmVlZEFkZE1ldGFCZWZvcmVLZXlGcmFtZU5hbCIsITApLHRoaXMudmlkZW9UcmFjaz10fHxuZXcgTyx0aGlzLmF1ZGlvVHJhY2s9YXx8bmV3IFIsdGhpcy5tZXRhZGF0YVRyYWNrPW58fG5ldyBHLHRoaXMuX2ZpeGVyPW5ldyBwZSh0aGlzLnZpZGVvVHJhY2ssdGhpcy5hdWRpb1RyYWNrLHRoaXMubWV0YWRhdGFUcmFjayl9cmV0dXJuIG4oZSxbe2tleToiZGVtdXgiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByLGE9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0mJmFyZ3VtZW50c1sxXSxuPSEoYXJndW1lbnRzLmxlbmd0aD4yJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0pfHxhcmd1bWVudHNbMl0saT1hcmd1bWVudHMubGVuZ3RoPjM/YXJndW1lbnRzWzNdOnZvaWQgMCxzPXRoaXMuYXVkaW9UcmFjayxvPXRoaXMudmlkZW9UcmFjayx1PXRoaXMubWV0YWRhdGFUcmFjaztpZighYSYmbnx8KHRoaXMuX3JlbWFpbmluZ0RhdGE9bnVsbCksYSYmKHRoaXMuX2hlYWRlclBhcnNlZD0hMSksYT8oby5yZXNldCgpLHMucmVzZXQoKSx1LnJlc2V0KCkpOihvLnNhbXBsZXM9W10scy5zYW1wbGVzPVtdLHUuc2VpU2FtcGxlcz1bXSx1LmZsdlNjcmlwdFNhbXBsZXM9W10sby53YXJuaW5ncz1bXSxzLndhcm5pbmdzPVtdLHRoaXMuX3JlbWFpbmluZ0RhdGEmJih0PUoodGhpcy5fcmVtYWluaW5nRGF0YSx0KSx0aGlzLl9yZW1haW5pbmdEYXRhPW51bGwpKSwhdC5sZW5ndGgpcmV0dXJue3ZpZGVvVHJhY2s6byxhdWRpb1RyYWNrOnMsbWV0YWRhdGFUcmFjazp1fTt2YXIgYz0wO2lmKCF0aGlzLl9oZWFkZXJQYXJzZWQpe2lmKCFlLnByb2JlKHQpKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBmbHYgZmlsZSIpO3MucHJlc2VudD0oNCZ0WzRdKT4+PjIhPTAsby5wcmVzZW50PTAhPSgxJnRbNF0pLHRoaXMuX2hlYWRlclBhcnNlZD0hMCxjPXRlKHQsNSkrNH1mb3IodmFyIGwsZixkLGgscCx2PXQubGVuZ3RoO2MrMTU8diYmKGw9dFtjXSwhKGMrMTUrKGY9dFtjKzFdPDwxNnx0W2MrMl08PDh8dFtjKzNdKT52KSk7KWQ9KHRbYys3XTw8MjQ+Pj4wKSsodFtjKzRdPDwxNikrKHRbYys1XTw8OCkrdFtjKzZdLGMrPTExLGg9dC5zdWJhcnJheShjLGMrZiksOD09PWw/dGhpcy5fcGFyc2VBdWRpbyhoLGQpOjk9PT1sPyhpJiYodGhpcy5zZWFtbGVzc0xvYWRpbmdTd2l0Y2hpbmc9ITApLHRoaXMuX3BhcnNlVmlkZW8oaCxkKSk6MTg9PT1sP3RoaXMuX3BhcnNlU2NyaXB0KGgsZCk6YmUud2FybigiSW52YWxpZCB0YWcgdHlwZTogIi5jb25jYXQobCkpLChwPXRlKHQsYys9ZikpIT09MTErZiYmYmUud2FybigiSW52YWxpZCBQcmV2VGFnU2l6ZSAiLmNvbmNhdChwLCIgKCIpLmNvbmNhdCgxMStmLCIpIikpLGMrPTQ7Yzx2JiYodGhpcy5fcmVtYWluaW5nRGF0YT10LnN1YmFycmF5KGMpKSxzLmZvcm1hdFRpbWVzY2FsZT1vLmZvcm1hdFRpbWVzY2FsZT1vLnRpbWVzY2FsZT11LnRpbWVzY2FsZT0xZTMscy50aW1lc2NhbGU9cy5jb2RlY1R5cGU9PT1FPzFlMzpzLnNhbXBsZVJhdGV8fDAsIXMuZXhpc3QoKSYmcy5oYXNTYW1wbGUoKSYmcy5yZXNldCgpLCFvLmV4aXN0KCkmJm8uaGFzU2FtcGxlKCkmJm8ucmVzZXQoKTt2YXIgeT11LmZsdlNjcmlwdFNhbXBsZXNbdS5mbHZTY3JpcHRTYW1wbGVzLmxlbmd0aC0xXSxtPW51bGw9PXl8fG51bGw9PT0ocj15LmRhdGEpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLm9uTWV0YURhdGE7cmV0dXJuIG0mJihudWxsIT1vJiZvLmV4aXN0KCkmJihtLmhhc093blByb3BlcnR5KCJkdXJhdGlvbiIpJiYoby5kdXJhdGlvbj0xZTMqbS5kdXJhdGlvbiksbS5oYXNPd25Qcm9wZXJ0eSgid2lkdGgiKSYmbS5oYXNPd25Qcm9wZXJ0eSgiaGVpZ2h0IikmJihvLndpZHRoPW0ud2lkdGgsby5oZWlnaHQ9bS5oZWlnaHQpKSxudWxsIT1zJiZzLmV4aXN0KCkmJm0uaGFzT3duUHJvcGVydHkoImR1cmF0aW9uIikmJihzLmR1cmF0aW9uPTFlMyptLmR1cmF0aW9uKSkse3ZpZGVvVHJhY2s6byxhdWRpb1RyYWNrOnMsbWV0YWRhdGFUcmFjazp1fX19LHtrZXk6ImZpeCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiB0aGlzLl9maXhlci5maXgoZSx0LHIpLHt2aWRlb1RyYWNrOnRoaXMudmlkZW9UcmFjayxhdWRpb1RyYWNrOnRoaXMuYXVkaW9UcmFjayxtZXRhZGF0YVRyYWNrOnRoaXMubWV0YWRhdGFUcmFja319fSx7a2V5OiJkZW11eEFuZEZpeCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsYSxuKXtyZXR1cm4gdGhpcy5kZW11eChlLHQscixuKSx0aGlzLmZpeChhLHQscil9fSx7a2V5OiJfcGFyc2VBdWRpbyIsdmFsdWU6ZnVuY3Rpb24odCxyKXtpZih0Lmxlbmd0aCl7dmFyIGE9KDI0MCZ0WzBdKT4+PjQsbj10aGlzLmF1ZGlvVHJhY2s7aWYoYSE9PWdlJiZhIT09eWUmJmEhPT1tZSYmYSE9PWtlKXJldHVybiBiZS53YXJuKCJVbnN1cHBvcnRlZCBzb3VuZCBmb3JtYXQ6ICIuY29uY2F0KGEpKSx2b2lkIG4ucmVzZXQoKTtpZihhIT09Z2UmJmEhPT1rZSl7dmFyIGk9KDEyJnRbMF0pPj4yLHM9KDImdFswXSk+PjEsbz0xJnRbMF07bi5zYW1wbGVSYXRlPWUuQVVESU9fUkFURVtpXSxuLnNhbXBsZVNpemU9cz8xNjo4LG4uY2hhbm5lbENvdW50PW8rMX1zd2l0Y2goYSl7Y2FzZSB5ZTpjYXNlIG1lOnRoaXMuX3BhcnNlRzcxMSh0LHIsYSk7YnJlYWs7Y2FzZSBnZTp0aGlzLl9wYXJzZUFhYyh0LHIpO2JyZWFrO2Nhc2Uga2U6dGhpcy5fcGFyc2VPcHVzKHQscil9fX19LHtrZXk6Il9wYXJzZU9wdXMiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9dGhpcy5hdWRpb1RyYWNrLGE9ZVsxXTtzd2l0Y2goci5jb2RlY1R5cGU9RSxhKXtjYXNlIDA6dmFyIG49ZmUucGFyc2VIZWFkZXJQYWNrZXRzKGUuc3ViYXJyYXkoMikpO24/KHIuY29kZWM9bi5jb2RlYyxyLmNoYW5uZWxDb3VudD1uLmNoYW5uZWxDb3VudCxyLnNhbXBsZVJhdGU9bi5zYW1wbGVSYXRlLHIuY29uZmlnPW4uY29uZmlnLHIuc2FtcGxlRHVyYXRpb249ZmUuZ2V0RnJhbWVEdXJhdGlvbihbXSxyLnRpbWVzY2FsZSkpOihyLnJlc2V0KCksYmUud2FybigiQ2Fubm90IHBhcnNlIEF1ZGlvU3BlY2lmaWNDb25maWciLGUpKTticmVhaztjYXNlIDE6aWYobnVsbD09dClyZXR1cm47dmFyIGk9bmV3IFYodCxlLnN1YmFycmF5KDIpLHIuc2FtcGxlRHVyYXRpb24pO3Iuc2FtcGxlcy5wdXNoKGkpO2JyZWFrO2RlZmF1bHQ6YmUud2FybigiVW5rbm93biBPcHVzUGFja2V0VHlwZTogIi5jb25jYXQoYSkpfX19LHtrZXk6Il9wYXJzZUc3MTEiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYT10aGlzLmF1ZGlvVHJhY2s7YS5jb2RlY1R5cGU9Nz09PXI/VDpCLGEuc2FtcGxlUmF0ZT04ZTMsYS5jb2RlYz1hLmNvZGVjVHlwZSxhLnNhbXBsZXMucHVzaChuZXcgVih0LGUuc3ViYXJyYXkoMSkpKX19LHtrZXk6Il9wYXJzZUFhYyIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt2YXIgcj10aGlzLmF1ZGlvVHJhY2s7aWYoci5jb2RlY1R5cGU9QSwwPT09ZVsxXSl7dmFyIGE9b2UucGFyc2VBdWRpb1NwZWNpZmljQ29uZmlnKGUuc3ViYXJyYXkoMikpO2E/KHIuY29kZWM9YS5jb2RlYyxyLmNoYW5uZWxDb3VudD1hLmNoYW5uZWxDb3VudCxyLnNhbXBsZVJhdGU9YS5zYW1wbGVSYXRlLHIuY29uZmlnPWEuY29uZmlnLHIub2JqZWN0VHlwZT1hLm9iamVjdFR5cGUsci5zYW1wbGVSYXRlSW5kZXg9YS5zYW1wbGluZ0ZyZXF1ZW5jeUluZGV4KTooci5yZXNldCgpLGJlLndhcm4oIkNhbm5vdCBwYXJzZSBBdWRpb1NwZWNpZmljQ29uZmlnIixlKSl9ZWxzZSBpZigxPT09ZVsxXSl7aWYobnVsbD09dClyZXR1cm47ci5zYW1wbGVzLnB1c2gobmV3IFYodCxlLnN1YmFycmF5KDIpKSl9ZWxzZSBiZS53YXJuKCJVbmtub3duIEFBQ1BhY2tldFR5cGU6ICIuY29uY2F0KGVbMV0pKX19LHtrZXk6Il9wYXJzZVZpZGVvIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPXRoaXM7aWYoIShlLmxlbmd0aDw2KSl7dmFyIGE9KDI0MCZlWzBdKT4+PjQsbj0xNSZlWzBdLGk9dGhpcy52aWRlb1RyYWNrO2lmKDchPT1uJiYxMiE9PW4pcmV0dXJuIGkucmVzZXQoKSx2b2lkIGJlLndhcm4oIlVuc3VwcG9ydGVkIGNvZGVjSWQ6ICIuY29uY2F0KG4pKTt2YXIgcz0xMj09PW47aS5jb2RlY1R5cGU9cz9EOlM7dmFyIG89ZVsxXSx1PShlWzJdPDwxNnxlWzNdPDw4fGVbNF0pPDw4Pj44O2lmKDA9PT1vKXt2YXIgYz1lLnN1YmFycmF5KDUpLGw9cz9sZS5wYXJzZUhFVkNEZWNvZGVyQ29uZmlndXJhdGlvblJlY29yZChjKTpjZS5wYXJzZUFWQ0RlY29kZXJDb25maWd1cmF0aW9uUmVjb3JkKGMpO2lmKGwpe3ZhciBmPWwuaHZjQyxkPWwuc3BzLGg9bC5wcHNBcnIscD1sLnNwc0Fycix2PWwudnBzQXJyLHk9bC5uYWxVbml0U2l6ZTtmJiYoaS5odmNDPWkuaHZjQ3x8ZiksZCYmKGkuY29kZWM9ZC5jb2RlYyxpLndpZHRoPWQud2lkdGgsaS5oZWlnaHQ9ZC5oZWlnaHQsaS5zYXJSYXRpbz1kLnNhclJhdGlvLGkuZnBzTnVtPWQuZnBzTnVtLGkuZnBzRGVuPWQuZnBzRGVuKSxwLmxlbmd0aCYmKGkuc3BzPXApLGgubGVuZ3RoJiYoaS5wcHM9aCksdiYmdi5sZW5ndGgmJihpLnZwcz12KSx5JiYoaS5uYWxVbml0U2l6ZT15KX1lbHNlIGJlLndhcm4oIkNhbm5vdCBwYXJzZSAiLmNvbmNhdChzPyJIRVZDIjoiQVZDIiwiRGVjb2RlckNvbmZpZ3VyYXRpb25SZWNvcmQiKSxlKX1lbHNlIGlmKDE9PT1vKXt2YXIgbT11ZS5wYXJzZUF2Y0MoZS5zdWJhcnJheSg1KSxpLm5hbFVuaXRTaXplKTtpZigobT10aGlzLl9jaGVja0FkZE1ldGFOYWxUb1VuaXRzKHMsbSxpKSkmJm0ubGVuZ3RoKXt2YXIgZz1uZXcgTCh0K3UsdCxtKTtpZih0aGlzLnNlYW1sZXNzTG9hZGluZ1N3aXRjaGluZyYmdDxpLmxhc3RLZXlGcmFtZUR0cylyZXR1cm47dGhpcy5zZWFtbGVzc0xvYWRpbmdTd2l0Y2hpbmc9ITEsMT09PWEmJihnLnNldFRvS2V5ZnJhbWUoKSxpLmxhc3RLZXlGcmFtZUR0cz10KSxpLnNhbXBsZXMucHVzaChnKSxtLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciBhPXM/ZVswXT4+PjEmNjM6MzEmZVswXTtzd2l0Y2goYSl7Y2FzZSA1OmNhc2UgMTY6Y2FzZSAxNzpjYXNlIDE4OmNhc2UgMTk6Y2FzZSAyMDpjYXNlIDIxOmNhc2UgMjI6Y2FzZSAyMzppZighcyYmNSE9PWF8fHMmJjU9PT1hKWJyZWFrO2cuc2V0VG9LZXlmcmFtZSgpO2JyZWFrO2Nhc2UgNjpjYXNlIDM5OmNhc2UgNDA6aWYoIXMmJjYhPT1hfHxzJiY2PT09YSlicmVhaztyLm1ldGFkYXRhVHJhY2suc2VpU2FtcGxlcy5wdXNoKG5ldyBqKHVlLnBhcnNlU0VJKHVlLnJlbW92ZUVQQihlKSxzKSx0K3UpKX19KSksZy5rZXlmcmFtZSYmdGhpcy5fZ29wSWQrKyxnLmdvcElkPXRoaXMuX2dvcElkfWVsc2UgYmUud2FybigiQ2Fubm90IHBhcnNlIE5BTFVzIixlKX1lbHNlIDI9PT1vfHxiZS53YXJuKCJVbmtub3duIEFWQ1BhY2tldFR5cGU6ICIuY29uY2F0KG8pKX19fSx7a2V5OiJfY2hlY2tBZGRNZXRhTmFsVG9Vbml0cyIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlJiZ0aGlzLl9uZWVkQWRkTWV0YUJlZm9yZUtleUZyYW1lTmFsP3QubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gZVswXT4+PjEmNjN9KSkuaW5jbHVkZXMoMzIpPyh0aGlzLl9uZWVkQWRkTWV0YUJlZm9yZUtleUZyYW1lTmFsPSExLHQpOih0LnVuc2hpZnQoci5wcHNbMF0pLHQudW5zaGlmdChyLnNwc1swXSksdC51bnNoaWZ0KHIudnBzWzBdKSx0LmZpbHRlcihCb29sZWFuKSk6KHRoaXMuX25lZWRBZGRNZXRhQmVmb3JlS2V5RnJhbWVOYWw9ITEsdCl9fSx7a2V5OiJfcGFyc2VTY3JpcHQiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dGhpcy5tZXRhZGF0YVRyYWNrLmZsdlNjcmlwdFNhbXBsZXMucHVzaChuZXcgTih2ZS5wYXJzZShlKSx0KSl9fV0sW3trZXk6InByb2JlIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gNzA9PT1lWzBdJiY3Nj09PWVbMV0mJjg2PT09ZVsyXSYmMT09PWVbM10mJnRlKGUsNSk+PTl9fV0pLGV9KCk7aShfZSwiQVVESU9fUkFURSIsWzU1MDAsMTFlMywyMmUzLDQ0ZTNdKSxuZXcgSygiVHNEZW11eGVyIik7dmFyIHdlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LGEsbil7cih0aGlzLGUpLHRoaXMuZHY9bmV3IERhdGFWaWV3KHQpLHRoaXMuc3RhcnQ9dGhpcy5vZmZzZXQ9YXx8dGhpcy5kdi5ieXRlT2Zmc2V0LHRoaXMuZW5kPW4/dGhpcy5zdGFydCtuOnRoaXMuc3RhcnQrdGhpcy5kdi5ieXRlTGVuZ3RofXJldHVybiBuKGUsW3trZXk6ImJ1ZmZlciIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZHYuYnVmZmVyfX0se2tleToidW5yZWFkTGVuZ3RoIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gTWF0aC5tYXgodGhpcy5lbmQtdGhpcy5vZmZzZXQsMCl9fSx7a2V5OiJzaXplIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbmQtdGhpcy5zdGFydH19LHtrZXk6InJlYWRGbG9hdCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9MDtzd2l0Y2goZSl7Y2FzZSA0OnQ9dGhpcy5kdi5nZXRGbG9hdDMyKHRoaXMub2Zmc2V0KTticmVhaztjYXNlIDg6dD10aGlzLmR2LmdldEZsb2F0NjQodGhpcy5vZmZzZXQpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJyZWFkICIuY29uY2F0KGUsIi1ieXRlIGZsb2F0IGlzIG5vdCBzdXBwb3J0ZWQiKSl9cmV0dXJuIHRoaXMub2Zmc2V0Kz1lLHR9fSx7a2V5OiJiYWNrIix2YWx1ZTpmdW5jdGlvbihlKXt0aGlzLm9mZnNldC09ZX19LHtrZXk6InNraXAiLHZhbHVlOmZ1bmN0aW9uKGUpe3RoaXMub2Zmc2V0Kz1lfX0se2tleToicmVhZEludCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5vZmZzZXQ7c3dpdGNoKHRoaXMub2Zmc2V0Kz1lLGUpe2Nhc2UgMTpyZXR1cm4gdGhpcy5kdi5nZXRJbnQ4KHQpO2Nhc2UgMjpyZXR1cm4gdGhpcy5kdi5nZXRJbnQxNih0KTtjYXNlIDQ6cmV0dXJuIHRoaXMuZHYuZ2V0SW50MzIodCk7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoInJlYWQgIi5jb25jYXQoZSwiLWJ5dGUgaW50ZWdlcnMgaXMgbm90IHN1cHBvcnRlZCIpKX19fSx7a2V5OiJyZWFkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLm9mZnNldDtzd2l0Y2godGhpcy5vZmZzZXQrPWUsZSl7Y2FzZSAxOnJldHVybiB0aGlzLmR2LmdldFVpbnQ4KHQpO2Nhc2UgMjpyZXR1cm4gdGhpcy5kdi5nZXRVaW50MTYodCk7Y2FzZSAzOnJldHVybih0aGlzLmR2LmdldFVpbnQxNih0KTw8OCkrdGhpcy5kdi5nZXRVaW50OCh0KzIpO2Nhc2UgNDpyZXR1cm4gdGhpcy5kdi5nZXRVaW50MzIodCk7ZGVmYXVsdDpyZXR1cm4gdGhpcy5iYWNrKGUtNCksdGhpcy5yZWFkKGUtNCkrdGhpcy5kdi5nZXRVaW50MzIodCkqTWF0aC5wb3coMjU2LGUtNCl9fX0se2tleToid3JpdGUiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9dGhpcy5vZmZzZXQ7c3dpdGNoKHRoaXMub2Zmc2V0Kz1lLGUpe2Nhc2UgMTpyZXR1cm4gdGhpcy5kdi5zZXRVaW50OChyLHQpO2Nhc2UgMjpyZXR1cm4gdGhpcy5kdi5zZXRVaW50MTYocix0KTtjYXNlIDM6cmV0dXJuIHRoaXMuZHYuc2V0VWludDgocix0Pj4+MTYpLHRoaXMuZHYuc2V0VWludDE2KHIrMSw2NTUzNSZ0KTtjYXNlIDQ6cmV0dXJuIHRoaXMuZHYuc2V0VWludDMyKHIsdCk7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoIndyaXRlICIuY29uY2F0KGUsIi1ieXRlIGludGVnZXJzIGlzIG5vdCBzdXBwb3J0ZWQiKSl9fX0se2tleToicmVhZFRvQnVmZmVyIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdDtyZXR1cm4gdD10aGlzLm9mZnNldHx8ZT90aGlzLmR2LmJ1ZmZlci5zbGljZSh0aGlzLm9mZnNldCxlP3RoaXMub2Zmc2V0K2U6dGhpcy5lbmQpOnRoaXMuZHYuYnVmZmVyLHRoaXMub2Zmc2V0Kz10LmJ5dGVMZW5ndGgsdH19LHtrZXk6InJlYWRUb1VpbnQ4Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD1uZXcgVWludDhBcnJheSh0aGlzLmR2LmJ1ZmZlcix0aGlzLm9mZnNldCxlfHx0aGlzLnVucmVhZExlbmd0aCk7cmV0dXJuIHRoaXMub2Zmc2V0Kz10LmJ5dGVMZW5ndGgsdH19LHtrZXk6InJlYWRTdHJpbmciLHZhbHVlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0wLHI9IiI7dDxlO3QrKylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHRoaXMuZHYuZ2V0VWludDgodGhpcy5vZmZzZXQpKSx0aGlzLm9mZnNldCsrO3JldHVybiByfX1dLFt7a2V5OiJmcm9tVWludDgiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQsdC5ieXRlTGVuZ3RoKX19LHtrZXk6ImNvbmNhdFVpbnQ4cyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IFVpbnQ4QXJyYXkoZS5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC5ieXRlTGVuZ3RofSksMCkpLHI9MDtyZXR1cm4gZS5mb3JFYWNoKChmdW5jdGlvbihlKXt0LnNldChlLHIpLHIrPWUuYnl0ZUxlbmd0aH0pKSx0fX0se2tleToiY29uY2F0VWludDgiLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgsdD1uZXcgQXJyYXkoZSkscj0wO3I8ZTtyKyspdFtyXT1hcmd1bWVudHNbcl07cmV0dXJuIHRoaXMuY29uY2F0VWludDhzKHQpfX1dKSxlfSgpLHhlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LGEpe3IodGhpcyxlKSx0aGlzLm9mZnNldD0wLHRoaXMudmFsPXQsdGhpcy5zaXplPWF9cmV0dXJuIG4oZSxbe2tleToic2tpcCIsdmFsdWU6ZnVuY3Rpb24oZSl7dGhpcy5vZmZzZXQrPWV9fSx7a2V5OiJyZWFkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLnNpemUtdGhpcy5vZmZzZXQtZTtpZih0Pj0wKXt2YXIgcj0wLGE9MDtpZih0aGlzLm9mZnNldCs9ZSx0aGlzLnNpemU+MzEpe2Zvcig7YTxlO2ErKylyKz1NYXRoLnBvdygyLGEpO3JldHVybiB0aGlzLnZhbC9NYXRoLnBvdygyLHQpJnJ9Zm9yKDthPGU7YSsrKXIrPTE8PGE7cmV0dXJuIHRoaXMudmFsPj4+dCZyfXRocm93IG5ldyBFcnJvcigidGhlIG51bWJlciBvZiB0aGUgcmVhZCBvcGVyYXRpb24gZXhjZWVkcyB0aGUgdG90YWwgbGVuZ3RoIGxpbWl0IG9mIGJpdHMiKX19XSxbe2tleToiZnJvbUJ5dGUiLHZhbHVlOmZ1bmN0aW9uKHQscil7cmV0dXJuIG5ldyBlKHQucmVhZChyKSxyPDwzKX19XSksZX0oKSxTZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSl9cmV0dXJuIG4oZSxudWxsLFt7a2V5OiJmaW5kQm94Iix2YWx1ZTpmdW5jdGlvbih0LHIpe3ZhciBhPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTowLG49W107aWYoIXQpcmV0dXJuIG47Zm9yKHZhciBpPTAscz0iIixvPTA7dC5sZW5ndGg+Nzspe2lmKGk9dGUodCkscz1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsdC5zdWJhcnJheSg0LDgpKSxvPTgsMT09PWk/KGk9cmUodCw4KSxvKz04KTppfHwoaT10Lmxlbmd0aCksIXJbMF18fHM9PT1yWzBdKXt2YXIgdT10LnN1YmFycmF5KDAsaSk7aWYoIShyLmxlbmd0aDwyKSlyZXR1cm4gZS5maW5kQm94KHUuc3ViYXJyYXkobyksci5zbGljZSgxKSxhK28pO24ucHVzaCh7c3RhcnQ6YSxzaXplOmksaGVhZGVyU2l6ZTpvLHR5cGU6cyxkYXRhOnV9KX1hKz1pLHQ9dC5zdWJhcnJheShpKX1yZXR1cm4gbn19LHtrZXk6InRmaGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBCZShlLCEwLChmdW5jdGlvbihlLHQpe2UudHJhY2tJZD10ZSh0KTt2YXIgcj00LGE9MSZlLmZsYWdzLG49MiZlLmZsYWdzLGk9OCZlLmZsYWdzLHM9MTYmZS5mbGFncyxvPTMyJmUuZmxhZ3M7YSYmKHIrPTQsZS5iYXNlRGF0YU9mZnNldD10ZSh0LHIpLHIrPTQpLG4mJihlLnNhbXBsZURlc2NyaXB0aW9uSW5kZXg9dGUodCxyKSxyKz00KSxpJiYoZS5kZWZhdWx0U2FtcGxlRHVyYXRpb249dGUodCxyKSxyKz00KSxzJiYoZS5kZWZhdWx0U2FtcGxlU2l6ZT10ZSh0LHIpLHIrPTQpLG8mJihlLmRlZmF1bHRTYW1wbGVGbGFncz10ZSh0LHIpKX0pKX19LHtrZXk6InNpZHgiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBCZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPTA7ZS5yZWZlcmVuY2VfSUQ9dGUodCxyKSxyKz00LGUudGltZXNjYWxlPXRlKHQscikscis9NCwwPT09ZS52ZXJzaW9uPyhlLmVhcmxpZXN0X3ByZXNlbnRhdGlvbl90aW1lPXRlKHQscikscis9NCxlLmZpcnN0X29mZnNldD10ZSh0LHIpLHIrPTQpOihlLmVhcmxpZXN0X3ByZXNlbnRhdGlvbl90aW1lPXJlKHQscikscis9OCxlLmZpcnN0X29mZnNldD1yZSh0LHIpLHIrPTgpLHIrPTIsZS5yZWZlcmVuY2VzPVtdO3ZhciBhPWVlKHQscik7cis9Mjtmb3IodmFyIG49MDtuPGE7bisrKXt2YXIgaT17fTtlLnJlZmVyZW5jZXMucHVzaChpKTt2YXIgcz10ZSh0LHIpO3IrPTQsaS5yZWZlcmVuY2VfdHlwZT1zPj4zMSYxLGkucmVmZXJlbmNlZF9zaXplPTIxNDc0ODM2NDcmcyxpLnN1YnNlZ21lbnRfZHVyYXRpb249dGUodCxyKSxzPXRlKHQscis9NCkscis9NCxpLnN0YXJ0c193aXRoX1NBUD1zPj4zMSYxLGkuU0FQX3R5cGU9cz4+MjgmNyxpLlNBUF9kZWx0YV90aW1lPTI2ODQzNTQ1NSZzfX0pKX19LHtrZXk6Im1vb3YiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBCZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dC5tdmhkPWUubXZoZChlLmZpbmRCb3gocixbIm12aGQiXSxhKVswXSksdC50cmFrPWUuZmluZEJveChyLFsidHJhayJdLGEpLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuIGUudHJhayh0KX0pKSx0LnBzc2g9ZS5wc3NoKGUuZmluZEJveChyLFsicHNzaCJdLGEpWzBdKX0pKX19LHtrZXk6Im12aGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBCZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPTA7MT09PWUudmVyc2lvbj8oZS50aW1lc2NhbGU9dGUodCwxNiksZS5kdXJhdGlvbj1yZSh0LDIwKSxyKz0yOCk6KGUudGltZXNjYWxlPXRlKHQsOCksZS5kdXJhdGlvbj10ZSh0LDEyKSxyKz0xNiksZS5uZXh0VHJhY2tJZD10ZSh0LHIrNzYpfSkpfX0se2tleToidHJhayIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIEJlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0LnRraGQ9ZS50a2hkKGUuZmluZEJveChyLFsidGtoZCJdLGEpWzBdKSx0Lm1kaWE9ZS5tZGlhKGUuZmluZEJveChyLFsibWRpYSJdLGEpWzBdKX0pKX19LHtrZXk6InRraGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBCZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPXdlLmZyb21VaW50OCh0KTsxPT09ZS52ZXJzaW9uPyhyLnJlYWQoOCksci5yZWFkKDgpLGUudHJhY2tJZD1yLnJlYWQoNCksci5yZWFkKDQpLGUuZHVyYXRpb249ci5yZWFkKDgpKTooci5yZWFkKDQpLHIucmVhZCg0KSxlLnRyYWNrSWQ9ci5yZWFkKDQpLHIucmVhZCg0KSxlLmR1cmF0aW9uPXIucmVhZCg0KSksci5za2lwKDE2KSxlLm1hdHJpeD1bXTtmb3IodmFyIGE9MDthPDM2O2ErKyllLm1hdHJpeC5wdXNoKHIucmVhZCgxKSk7ci5iYWNrKDM2KTtmb3IodmFyIG4saT1bXSxzPTA7czwzO3MrKylpLnB1c2goc2Uoci5yZWFkSW50KDIpLHIucmVhZEludCgyKSkpLGkucHVzaChzZShyLnJlYWRJbnQoMiksci5yZWFkSW50KDIpKSksbj1yLnJlYWRJbnQoNCksaS5wdXNoKHNlKG4+PjMwLDEwNzM3NDE4MjMmbikpO2Uucm90YXRpb249ZnVuY3Rpb24oZSl7aWYoZS5sZW5ndGg8NSlyZXR1cm4gMDt2YXIgdD1NYXRoLmh5cG90KGVbMF0sZVszXSkscj1NYXRoLmh5cG90KGVbMV0sZVs0XSk7cmV0dXJuIDA9PT10fHwwPT09cj8wOjE4MCpNYXRoLmF0YW4yKGVbMV0vcixlWzBdL3QpL01hdGguUEl9KGkpLGUud2lkdGg9ci5yZWFkKDQpLGUuaGVpZ2h0PXIucmVhZCg0KX0pKX19LHtrZXk6Im1kaWEiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBCZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dC5tZGhkPWUubWRoZChlLmZpbmRCb3gocixbIm1kaGQiXSxhKVswXSksdC5oZGxyPWUuaGRscihlLmZpbmRCb3gocixbImhkbHIiXSxhKVswXSksdC5taW5mPWUubWluZihlLmZpbmRCb3gocixbIm1pbmYiXSxhKVswXSl9KSl9fSx7a2V5OiJtZGhkIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gQmUoZSwhMCwoZnVuY3Rpb24oZSx0KXt2YXIgcj0wOzE9PT1lLnZlcnNpb24/KGUudGltZXNjYWxlPXRlKHQsMTYpLGUuZHVyYXRpb249cmUodCwyMCkscis9MjgpOihlLnRpbWVzY2FsZT10ZSh0LDgpLGUuZHVyYXRpb249dGUodCwxMikscis9MTYpO3ZhciBhPWVlKHQscik7ZS5sYW5ndWFnZT1TdHJpbmcuZnJvbUNoYXJDb2RlKDk2KyhhPj4xMCYzMSksOTYrKGE+PjUmMzEpLDk2KygzMSZhKSl9KSl9fSx7a2V5OiJoZGxyIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gQmUoZSwhMCwoZnVuY3Rpb24oZSx0KXswPT09ZS52ZXJzaW9uJiYoZS5oYW5kbGVyVHlwZT1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsdC5zdWJhcnJheSg0LDgpKSl9KSl9fSx7a2V5OiJtaW5mIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gQmUodCwhMSwoZnVuY3Rpb24odCxyLGEpe3Qudm1oZD1lLnZtaGQoZS5maW5kQm94KHIsWyJ2bWhkIl0sYSlbMF0pLHQuc21oZD1lLnNtaGQoZS5maW5kQm94KHIsWyJzbWhkIl0sYSlbMF0pLHQuc3RibD1lLnN0YmwoZS5maW5kQm94KHIsWyJzdGJsIl0sYSlbMF0pfSkpfX0se2tleToidm1oZCIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIEJlKGUsITAsKGZ1bmN0aW9uKGUsdCl7ZS5ncmFwaGljc21vZGU9ZWUodCksZS5vcGNvbG9yPVtlZSh0LDIpLGVlKHQsNCksZWUodCw2KV19KSl9fSx7a2V5OiJzbWhkIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gQmUoZSwhMCwoZnVuY3Rpb24oZSx0KXtlLmJhbGFuY2U9ZWUodCl9KSl9fSx7a2V5OiJzdGJsIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gQmUodCwhMSwoZnVuY3Rpb24odCxyLGEpe3ZhciBuLGksczt0LnN0c2Q9ZS5zdHNkKGUuZmluZEJveChyLFsic3RzZCJdLGEpWzBdKSx0LnN0dHM9ZS5zdHRzKGUuZmluZEJveChyLFsic3R0cyJdLGEpWzBdKSx0LmN0dHM9ZS5jdHRzKGUuZmluZEJveChyLFsiY3R0cyJdLGEpWzBdKSx0LnN0c2M9ZS5zdHNjKGUuZmluZEJveChyLFsic3RzYyJdLGEpWzBdKSx0LnN0c3o9ZS5zdHN6KGUuZmluZEJveChyLFsic3RzeiJdLGEpWzBdKSx0LnN0Y289ZS5zdGNvKGUuZmluZEJveChyLFsic3RjbyJdLGEpWzBdKSx0LnN0Y298fCh0LmNvNjQ9ZS5jbzY0KGUuZmluZEJveChyLFsiY282NCJdLGEpWzBdKSx0LnN0Y289dC5jbzY0KTt2YXIgbz1udWxsPT09KG49dC5zdHNkLmVudHJpZXNbMF0pfHx2b2lkIDA9PT1ufHxudWxsPT09KGk9bi5zaW5mKXx8dm9pZCAwPT09aXx8bnVsbD09PShzPWkuc2NoaSl8fHZvaWQgMD09PXM/dm9pZCAwOnMudGVuYy5kZWZhdWx0X0lWX3NpemU7dC5zdHNzPWUuc3RzcyhlLmZpbmRCb3gocixbInN0c3MiXSxhKVswXSksdC5zZW5jPWUuc2VuYyhlLmZpbmRCb3gocixbInNlbmMiXSxhKVswXSxvKX0pKX19LHtrZXk6InNlbmMiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTo4O3JldHVybiBCZShlLCEwLChmdW5jdGlvbihlLHIpe3ZhciBhPTAsbj10ZShyLGEpO2ErPTQsZS5zYW1wbGVzPVtdO2Zvcih2YXIgaT0wO2k8bjtpKyspe2Zvcih2YXIgcz17SW5pdGlhbGl6YXRpb25WZWN0b3I6W119LG89MDtvPHQ7bysrKXMuSW5pdGlhbGl6YXRpb25WZWN0b3Jbb109clthK29dO2lmKGErPXQsMiZlLmZsYWdzKXtzLnN1YnNhbXBsZXM9W107dmFyIHU9ZWUocixhKTthKz0yO2Zvcih2YXIgYz0wO2M8dTtjKyspe3ZhciBsPXt9O2wuQnl0ZXNPZkNsZWFyRGF0YT1lZShyLGEpLGErPTIsbC5CeXRlc09mUHJvdGVjdGVkRGF0YT10ZShyLGEpLGErPTQscy5zdWJzYW1wbGVzLnB1c2gobCl9fWUuc2FtcGxlcy5wdXNoKHMpfX0pKX19LHtrZXk6InBzc2giLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBCZShlLCEwLChmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj1bXSxhPVtdLG49MCxpPTA7aTwxNjtpKyspYS5wdXNoKFVlKHRbbitpXSkpO2lmKG4rPTE2LGUudmVyc2lvbj4wKXt2YXIgcz10ZSh0LG4pO24rPTQ7Zm9yKHZhciBvPTA7bzwoIiIrcykubGVuZ3RoO28rKylmb3IodmFyIHU9MDt1PDE2O3UrKyl7dmFyIGM9dFtuXTtuKz0xLHIucHVzaChVZShjKSl9fXZhciBsPXRlKHQsbik7ZS5kYXRhX3NpemU9bCxuKz00LGUua2lkPXIsZS5zeXN0ZW1faWQ9YSxlLmJ1ZmZlcj10fSkpfX0se2tleToic3RzZCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIEJlKHQsITAsKGZ1bmN0aW9uKHQscixhKXt0LmVudHJ5Q291bnQ9dGUociksdC5lbnRyaWVzPWUuZmluZEJveChyLnN1YmFycmF5KDQpLFtdLGErNCkubWFwKChmdW5jdGlvbih0KXtzd2l0Y2godC50eXBlKXtjYXNlImF2MDEiOnJldHVybiBlLmF2MDEodCk7Y2FzZSJhdmMxIjpjYXNlImF2YzIiOmNhc2UiYXZjMyI6Y2FzZSJhdmM0IjpyZXR1cm4gZS5hdmMxKHQpO2Nhc2UiaHZjMSI6Y2FzZSJoZXYxIjpyZXR1cm4gZS5odmMxKHQpO2Nhc2UibXA0YSI6cmV0dXJuIGUubXA0YSh0KTtjYXNlImFsYXciOmNhc2UidWxhdyI6cmV0dXJuIGUuYWxhdyh0KTtjYXNlImVuY2EiOnJldHVybiBCZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dC5jaGFubmVsQ291bnQ9ZWUociwxNiksdC5zYW1wbGVzaXplPWVlKHIsMTgpLHQuc2FtcGxlUmF0ZT10ZShyLDI0KS82NTUzNixyPXIuc3ViYXJyYXkoMjgpLHQuc2luZj1lLnNpbmYoZS5maW5kQm94KHIsWyJzaW5mIl0sYSlbMF0pLHQuZXNkcz1lLmVzZHMoZS5maW5kQm94KHIsWyJlc2RzIl0sYSlbMF0pfSkpO2Nhc2UiZW5jdiI6cmV0dXJuIEJlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0LndpZHRoPWVlKHIsMjQpLHQuaGVpZ2h0PWVlKHIsMjYpLHQuaG9yaXpyZXNvbHV0aW9uPXRlKHIsMjgpLHQudmVydHJlc29sdXRpb249dGUociwzMikscj1yLnN1YmFycmF5KDc4KSx0LnNpbmY9ZS5zaW5mKGUuZmluZEJveChyLFsic2luZiJdLGEpWzBdKSx0LmF2Y0M9ZS5hdmNDKGUuZmluZEJveChyLFsiYXZjQyJdLGEpWzBdKSx0Lmh2Y0M9ZS5odmNDKGUuZmluZEJveChyLFsiaHZjQyJdLGEpWzBdKSx0LnBhc3A9ZS5wYXNwKGUuZmluZEJveChyLFsicGFzcCJdLGEpWzBdKX0pKX19KSkuZmlsdGVyKEJvb2xlYW4pfSkpfX0se2tleToidGVuYyIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIEJlKGUsITEsKGZ1bmN0aW9uKGUsdCl7dmFyIHI9NjtlLmRlZmF1bHRfSXNFbmNyeXB0ZWQ9dFtyXSxyKz0xLGUuZGVmYXVsdF9JVl9zaXplPXRbcl0scis9MSxlLmRlZmF1bHRfS0lEPVtdO2Zvcih2YXIgYT0wO2E8MTY7YSsrKWUuZGVmYXVsdF9LSUQucHVzaChVZSh0W3JdKSkscis9MX0pKX19LHtrZXk6InNjaGkiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBCZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dC50ZW5jPWUudGVuYyhlLmZpbmRCb3gocixbInRlbmMiXSxhKVswXSl9KSl9fSx7a2V5OiJzaW5mIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gQmUodCwhMSwoZnVuY3Rpb24odCxyLGEpe3Quc2NoaT1lLnNjaGkoZS5maW5kQm94KHIsWyJzY2hpIl0sYSlbMF0pLHQuZnJtYT1lLmZybWEoZS5maW5kQm94KHIsWyJmcm1hIl0sYSlbMF0pfSkpfX0se2tleToiZnJtYSIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIEJlKGUsITEsKGZ1bmN0aW9uKGUsdCl7ZS5kYXRhX2Zvcm1hdD0iIjtmb3IodmFyIHI9MDtyPDQ7cisrKWUuZGF0YV9mb3JtYXQrPVN0cmluZy5mcm9tQ2hhckNvZGUodFtyXSl9KSl9fSx7a2V5OiJjb2xyIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gQmUoZSwhMSwoZnVuY3Rpb24odCxyKXt2YXIgYT13ZS5mcm9tVWludDgocik7dC5kYXRhPWUuZGF0YSx0LmNvbG9yVHlwZT1hLnJlYWRTdHJpbmcoNCksIm5jbHgiPT09dC5jb2xvclR5cGU/KHQuY29sb3JQcmltYXJpZXM9YS5yZWFkKDIpLHQudHJhbnNmZXJDaGFyYWN0ZXJpc3RpY3M9YS5yZWFkKDIpLHQubWF0cml4Q29lZmZpY2llbnRzPWEucmVhZCgyKSx0LmZ1bGxSYW5nZUZsYWc9YS5yZWFkKDEpPj43KToicklDQyIhPT10LmNvbG9yVHlwZSYmInByb2YiIT09dC5jb2xvclR5cGV8fCh0LmljY1Byb2ZpbGU9ci5yZWFkVG9VaW50OCgpKX0pKX19LHtrZXk6ImF2MDEiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBCZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dmFyIG49QWUodCxyKSxpPXIuc3ViYXJyYXkobik7YSs9bix0LmF2MUM9ZS5hdjFDKGUuZmluZEJveChpLFsiYXYxQyJdLGEpWzBdKSx0LmNvbHI9ZS5jb2xyKGUuZmluZEJveChpLFsiY29sciJdLGEpWzBdKX0pKX19LHtrZXk6ImF2MUMiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBCZShlLCExLChmdW5jdGlvbih0LHIpe3QuZGF0YT1lLmRhdGE7dmFyIGEsbj13ZS5mcm9tVWludDgociksaT14ZS5mcm9tQnl0ZShuLDQpO3QubWFya2VyPWkucmVhZCgxKSx0LnZlcnNpb249aS5yZWFkKDcpLHQuc2VxUHJvZmlsZT1pLnJlYWQoMyksdC5zZXFMZXZlbElkeDA9aS5yZWFkKDUpLHQuc2VxVGllcjA9aS5yZWFkKDEpLHQuaGlnaEJpdGRlcHRoPWkucmVhZCgxKSx0LnR3ZWx2ZUJpdD1pLnJlYWQoMSksdC5tb25vY2hyb21lPWkucmVhZCgxKSx0LmNocm9tYVN1YnNhbXBsaW5nWD1pLnJlYWQoMSksdC5jaHJvbWFTdWJzYW1wbGluZ1k9aS5yZWFkKDEpLHQuY2hyb21hU2FtcGxlUG9zaXRpb249aS5yZWFkKDIpLHQucmVzZXJ2ZWQ9aS5yZWFkKDMpLHQuaW5pdGlhbFByZXNlbnRhdGlvbkRlbGF5UHJlc2VudD1pLnJlYWQoMSksdC5pbml0aWFsUHJlc2VudGF0aW9uRGVsYXlQcmVzZW50P3QuaW5pdGlhbFByZXNlbnRhdGlvbkRlbGF5TWludXNPbmU9aS5yZWFkKDQpOnQuaW5pdGlhbFByZXNlbnRhdGlvbkRlbGF5TWludXNPbmU9MCx0LmNvbmZpZ09CVXM9bi5yZWFkVG9VaW50OCgpLDI9PT10LnNlcUxldmVsSWR4MCYmMT09PXQuaGlnaEJpdGRlcHRoP2E9MT09PXQudHdlbHZlQml0PyIxMiI6IjEwIjp0LnNlcVByb2ZpbGU8PTImJihhPTE9PT10LmhpZ2hCaXRkZXB0aD8iMTAiOiIwOCIpLHQuY29kZWM9WyJhdjAxIix0LnNlcVByb2ZpbGUsKHQuc2VxTGV2ZWxJZHgwPDEwPyIwIit0LnNlcUxldmVsSWR4MDp0LnNlcUxldmVsSWR4MCkrKHQuc2VxVGllcjA/IkgiOiJNIiksYV0uam9pbigiLiIpfSkpfX0se2tleToiYXZjMSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIEJlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt2YXIgbj1BZSh0LHIpLGk9ci5zdWJhcnJheShuKTthKz1uLHQuYXZjQz1lLmF2Y0MoZS5maW5kQm94KGksWyJhdmNDIl0sYSlbMF0pLHQucGFzcD1lLnBhc3AoZS5maW5kQm94KGksWyJwYXNwIl0sYSlbMF0pfSkpfX0se2tleToiYXZjQyIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIEJlKGUsITEsKGZ1bmN0aW9uKHQscil7dC5kYXRhPWUuZGF0YSx0LmNvbmZpZ3VyYXRpb25WZXJzaW9uPXJbMF0sdC5BVkNQcm9maWxlSW5kaWNhdGlvbj1yWzFdLHQucHJvZmlsZUNvbXBhdGliaWxpdHk9clsyXSx0LkFWQ0xldmVsSW5kaWNhdGlvbj1yWzNdLHQuY29kZWM9YWUoW3JbMV0sclsyXSxyWzNdXSksdC5sZW5ndGhTaXplTWludXNPbmU9MyZyWzRdLHQuc3BzTGVuZ3RoPTMxJnJbNV0sdC5zcHM9W107Zm9yKHZhciBhPTYsbj0wO248dC5zcHNMZW5ndGg7bisrKXt2YXIgaT1lZShyLGEpO2ErPTIsdC5zcHMucHVzaChyLnN1YmFycmF5KGEsYStpKSksYSs9aX10LnBwc0xlbmd0aD1yW2FdLGErPTEsdC5wcHM9W107Zm9yKHZhciBzPTA7czx0LnBwc0xlbmd0aDtzKyspe3ZhciBvPWVlKHIsYSk7YSs9Mix0LnBwcy5wdXNoKHIuc3ViYXJyYXkoYSxhKz1vKSksYSs9b319KSl9fSx7a2V5OiJodmMxIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gQmUodCwhMSwoZnVuY3Rpb24odCxyLGEpe3ZhciBuPUFlKHQsciksaT1yLnN1YmFycmF5KG4pO2ErPW4sdC5odmNDPWUuaHZjQyhlLmZpbmRCb3goaSxbImh2Y0MiXSxhKVswXSksdC5wYXNwPWUucGFzcChlLmZpbmRCb3goaSxbInBhc3AiXSxhKVswXSl9KSl9fSx7a2V5OiJodmNDIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gQmUoZSwhMSwoZnVuY3Rpb24odCxyKXt0LmRhdGE9ZS5kYXRhLHQuY29kZWM9ImhldjEuMS42Lkw5My5CMCIsdC5jb25maWd1cmF0aW9uVmVyc2lvbj1yWzBdO3ZhciBhPXJbMV07dC5nZW5lcmFsUHJvZmlsZVNwYWNlPWE+PjYsdC5nZW5lcmFsVGllckZsYWc9KDMyJmEpPj41LHQuZ2VuZXJhbFByb2ZpbGVJZGM9MzEmYSx0LmdlbmVyYWxQcm9maWxlQ29tcGF0aWJpbGl0eT10ZShyLDIpLHQuZ2VuZXJhbENvbnN0cmFpbnRJbmRpY2F0b3JGbGFncz1yLnN1YmFycmF5KDYsMTIpLHQuZ2VuZXJhbExldmVsSWRjPXJbMTJdLHQuYXZnRnJhbWVSYXRlPWVlKHIsMTkpLHQubnVtT2ZBcnJheXM9clsyMl0sdC52cHM9W10sdC5zcHM9W10sdC5wcHM9W107Zm9yKHZhciBuPTIzLGk9MCxzPTAsbz0wLHU9MDt1PHQubnVtT2ZBcnJheXM7dSsrKXtpPTYzJnJbbl0scz1lZShyLG4rMSksbis9Mztmb3IodmFyIGMsbD1bXSxmPTA7ZjxzO2YrKylvPWVlKHIsbiksbis9MixsLnB1c2goci5zdWJhcnJheShuLG4rbykpLG4rPW87aWYoMzI9PT1pKShjPXQudnBzKS5wdXNoLmFwcGx5KGMsbCk7ZWxzZSBpZigzMz09PWkpe3ZhciBkOyhkPXQuc3BzKS5wdXNoLmFwcGx5KGQsbCl9ZWxzZSBpZigzND09PWkpe3ZhciBoOyhoPXQucHBzKS5wdXNoLmFwcGx5KGgsbCl9fX0pKX19LHtrZXk6InBhc3AiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBCZShlLCExLChmdW5jdGlvbihlLHQpe2UuaFNwYWNpbmc9dGUodCksZS52U3BhY2luZz10ZSh0LDQpfSkpfX0se2tleToibXA0YSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIEJlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt2YXIgbj1UZSh0LHIpO3QuZXNkcz1lLmVzZHMoZS5maW5kQm94KHIuc3ViYXJyYXkobiksWyJlc2RzIl0sYStuKVswXSl9KSl9fSx7a2V5OiJlc2RzIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gQmUoZSwhMCwoZnVuY3Rpb24oZSx0KXtlLmNvZGVjPSJtcDRhLiI7Zm9yKHZhciByPTAsYT0wLG49MCxpPTA7dC5sZW5ndGg7KXtmb3IoaT10W3I9MF0sYT10W3IrMV0scis9MjsxMjgmYTspbj0oMTI3JmEpPDw3LGE9dFtyXSxyKz0xO2lmKG4rPTEyNyZhLDM9PT1pKXQ9dC5zdWJhcnJheShyKzMpO2Vsc2V7aWYoNCE9PWkpe2lmKDU9PT1pKXt2YXIgcz1lLmNvbmZpZz10LnN1YmFycmF5KHIscituKSxvPSgyNDgmc1swXSk+PjM7cmV0dXJuIDMxPT09byYmcy5sZW5ndGg+PTImJihvPTMyKygoNyZzWzBdKTw8MykrKCgyMjQmc1sxXSk+PjUpKSxlLm9iamVjdFR5cGU9byxlLmNvZGVjKz1vLnRvU3RyaW5nKDE2KSx2b2lkKCIuIj09PWUuY29kZWNbZS5jb2RlYy5sZW5ndGgtMV0mJihlLmNvZGVjPWUuY29kZWMuc3Vic3RyaW5nKDAsZS5jb2RlYy5sZW5ndGgtMSkpKX1yZXR1cm4gdm9pZCgiLiI9PT1lLmNvZGVjW2UuY29kZWMubGVuZ3RoLTFdJiYoZS5jb2RlYz1lLmNvZGVjLnN1YnN0cmluZygwLGUuY29kZWMubGVuZ3RoLTEpKSl9ZS5jb2RlYys9KHRbcl0udG9TdHJpbmcoMTYpKyIuIikucGFkU3RhcnQoMywiMCIpLHQ9dC5zdWJhcnJheShyKzEzKX19fSkpfX0se2tleToiYWxhdyIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIEJlKGUsITEsKGZ1bmN0aW9uKGUsdCl7VGUoZSx0KX0pKX19LHtrZXk6InN0dHMiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBCZShlLCEwLChmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj10ZSh0KSxhPVtdLG49NCxpPTA7aTxyO2krKylhLnB1c2goe2NvdW50OnRlKHQsbiksZGVsdGE6dGUodCxuKzQpfSksbis9ODtlLmVudHJ5Q291bnQ9cixlLmVudHJpZXM9YX0pKX19LHtrZXk6ImN0dHMiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBCZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPXRlKHQpLGE9W10sbj00O2lmKDE9PT1lLnZlcnNpb24pZm9yKHZhciBpPTA7aTxyO2krKylhLnB1c2goe2NvdW50OnRlKHQsbiksb2Zmc2V0OnRlKHQsbis0KX0pLG4rPTg7ZWxzZSBmb3IodmFyIHM9MDtzPHI7cysrKWEucHVzaCh7Y291bnQ6dGUodCxuKSxvZmZzZXQ6LSgxK350ZSh0LG4rNCkpfSksbis9ODtlLmVudHJ5Q291bnQ9cixlLmVudHJpZXM9YX0pKX19LHtrZXk6InN0c2MiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBCZShlLCEwLChmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj10ZSh0KSxhPVtdLG49NCxpPTA7aTxyO2krKylhLnB1c2goe2ZpcnN0Q2h1bms6dGUodCxuKSxzYW1wbGVzUGVyQ2h1bms6dGUodCxuKzQpLHNhbXBsZURlc2NyaXB0aW9uSW5kZXg6dGUodCxuKzgpfSksbis9MTI7ZS5lbnRyeUNvdW50PXIsZS5lbnRyaWVzPWF9KSl9fSx7a2V5OiJzdHN6Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gQmUoZSwhMCwoZnVuY3Rpb24oZSx0KXt2YXIgcj10ZSh0KSxhPXRlKHQsNCksbj1bXTtpZighcilmb3IodmFyIGk9OCxzPTA7czxhO3MrKyluLnB1c2godGUodCxpKSksaSs9NDtlLnNhbXBsZVNpemU9cixlLnNhbXBsZUNvdW50PWEsZS5lbnRyeVNpemVzPW59KSl9fSx7a2V5OiJzdGNvIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gQmUoZSwhMCwoZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9dGUodCksYT1bXSxuPTQsaT0wO2k8cjtpKyspYS5wdXNoKHRlKHQsbikpLG4rPTQ7ZS5lbnRyeUNvdW50PXIsZS5lbnRyaWVzPWF9KSl9fSx7a2V5OiJjbzY0Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gQmUoZSwhMCwoZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9dGUodCksYT1bXSxuPTQsaT0wO2k8cjtpKyspYS5wdXNoKHJlKHQsbikpLG4rPTg7ZS5lbnRyeUNvdW50PXIsZS5lbnRyaWVzPWF9KSl9fSx7a2V5OiJzdHNzIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gQmUoZSwhMCwoZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9dGUodCksYT1bXSxuPTQsaT0wO2k8cjtpKyspYS5wdXNoKHRlKHQsbikpLG4rPTQ7ZS5lbnRyeUNvdW50PXIsZS5lbnRyaWVzPWF9KSl9fSx7a2V5OiJtb29mIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gQmUodCwhMSwoZnVuY3Rpb24odCxyLGEpe3QubWZoZD1lLm1maGQoZS5maW5kQm94KHIsWyJtZmhkIl0sYSlbMF0pLHQudHJhZj1lLmZpbmRCb3gocixbInRyYWYiXSxhKS5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiBlLnRyYWYodCl9KSl9KSl9fSx7a2V5OiJtZmhkIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gQmUoZSwhMCwoZnVuY3Rpb24oZSx0KXtlLnNlcXVlbmNlTnVtYmVyPXRlKHQpfSkpfX0se2tleToidHJhZiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIEJlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0LnRmaGQ9ZS50ZmhkKGUuZmluZEJveChyLFsidGZoZCJdLGEpWzBdKSx0LnRmZHQ9ZS50ZmR0KGUuZmluZEJveChyLFsidGZkdCJdLGEpWzBdKSx0LnRydW49ZS50cnVuKGUuZmluZEJveChyLFsidHJ1biJdLGEpWzBdKX0pKX19LHtrZXk6InRydW4iLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBCZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPWUudmVyc2lvbixhPWUuZmxhZ3Msbj10Lmxlbmd0aCxpPWUuc2FtcGxlQ291bnQ9dGUodCkscz00O2lmKG4+cyYmMSZhJiYoZS5kYXRhT2Zmc2V0PS0oMSt+dGUodCxzKSkscys9NCksbj5zJiY0JmEmJihlLmZpcnN0U2FtcGxlRmxhZ3M9dGUodCxzKSxzKz00KSxlLnNhbXBsZXM9W10sbj5zKWZvcih2YXIgbyx1PTA7dTxpO3UrKylvPXt9LDI1NiZhJiYoby5kdXJhdGlvbj10ZSh0LHMpLHMrPTQpLDUxMiZhJiYoby5zaXplPXRlKHQscykscys9NCksMTAyNCZhJiYoby5mbGFncz10ZSh0LHMpLHMrPTQpLDIwNDgmYSYmKG8uY3RzPXI/LSgxK350ZSh0LHMrNCkpOnRlKHQscykscys9NCksZS5zYW1wbGVzLnB1c2gobyl9KSl9fSx7a2V5OiJ0ZmR0Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gQmUoZSwhMCwoZnVuY3Rpb24oZSx0KXsxPT09ZS52ZXJzaW9uP2UuYmFzZU1lZGlhRGVjb2RlVGltZT1yZSh0KTplLmJhc2VNZWRpYURlY29kZVRpbWU9dGUodCl9KSl9fSx7a2V5OiJwcm9iZSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuISFlLmZpbmRCb3godCxbImZ0eXAiXSl9fSx7a2V5OiJwYXJzZVNhbXBsZUZsYWdzIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm57aXNMZWFkaW5nOigxMiZlWzBdKT4+PjIsZGVwZW5kc09uOjMmZVswXSxpc0RlcGVuZGVkT246KDE5MiZlWzFdKT4+PjYsaGFzUmVkdW5kYW5jeTooNDgmZVsxXSk+Pj40LHBhZGRpbmdWYWx1ZTooMTQmZVsxXSk+Pj4xLGlzTm9uU3luY1NhbXBsZToxJmVbMV0sZGVncmFkYXRpb25Qcmlvcml0eTplWzJdPDw4fGVbM119fX0se2tleToibW9vdlRvVHJhY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYSxuLGk9ZS50cmFrO2lmKGkmJmkubGVuZ3RoKXt2YXIgcz1pLmZpbmQoKGZ1bmN0aW9uKGUpe3ZhciB0LHI7cmV0dXJuInZpZGUiPT09KG51bGw9PT0odD1lLm1kaWEpfHx2b2lkIDA9PT10fHxudWxsPT09KHI9dC5oZGxyKXx8dm9pZCAwPT09cj92b2lkIDA6ci5oYW5kbGVyVHlwZSl9KSksbz1pLmZpbmQoKGZ1bmN0aW9uKGUpe3ZhciB0LHI7cmV0dXJuInNvdW4iPT09KG51bGw9PT0odD1lLm1kaWEpfHx2b2lkIDA9PT10fHxudWxsPT09KHI9dC5oZGxyKXx8dm9pZCAwPT09cj92b2lkIDA6ci5oYW5kbGVyVHlwZSl9KSk7aWYocyYmdCl7dmFyIHUsYyxsLGYsZCxoLHAsdj10LHk9bnVsbD09PSh1PXMudGtoZCl8fHZvaWQgMD09PXU/dm9pZCAwOnUudHJhY2tJZDtudWxsIT15JiYodi5pZD1zLnRraGQudHJhY2tJZCksdi50a2hkRHVyYXRpb249cy50a2hkLmR1cmF0aW9uLHYubXZoZER1cnRpb249ZS5tdmhkLmR1cmF0aW9uLHYubXZoZFRpbWVjYWxlPWUubXZoZC50aW1lc2NhbGUsdi50aW1lc2NhbGU9di5mb3JtYXRUaW1lc2NhbGU9cy5tZGlhLm1kaGQudGltZXNjYWxlLHYuZHVyYXRpb249cy5tZGlhLm1kaGQuZHVyYXRpb258fHYubXZoZER1cnRpb24vdi5tdmhkVGltZWNhbGUqdi50aW1lc2NhbGUsdi5yb3RhdGlvbj1zLnRraGQucm90YXRpb24sdi5tYXRyaXg9cy50a2hkLm1hdHJpeDt2YXIgbSxnLGssYixfLHcsUyxBLEU9cy5tZGlhLm1pbmYuc3RibC5zdHNkLmVudHJpZXNbMF07aWYodi53aWR0aD1FLndpZHRoLHYuaGVpZ2h0PUUuaGVpZ2h0LEUucGFzcCYmKHYuc2FyUmF0aW89W0UucGFzcC5oU3BhY2luZyxFLnBhc3AudlNwYWNpbmddKSxFLmF2MUMpdi5jb2RlY1R5cGU9eCx2LmNvZGVjPUUuYXYxQy5jb2RlYyx2LmF2MUM9RS5hdjFDLmRhdGEsdi5jb2xyPUUuY29sci5kYXRhO2Vsc2UgaWYoRS5odmNDKXYuY29kZWNUeXBlPUQsdi5jb2RlYz1FLmh2Y0MuY29kZWMsdi52cHM9RS5odmNDLnZwcyx2LnNwcz1FLmh2Y0Muc3BzLHYucHBzPUUuaHZjQy5wcHMsdi5odmNDPUUuaHZjQy5kYXRhO2Vsc2V7aWYoIUUuYXZjQyl0aHJvdyBuZXcgRXJyb3IoInVua25vd24gdmlkZW8gc3RzZCBlbnRyeSIpO3YuY29kZWM9RS5hdmNDLmNvZGVjLHYuc3BzPUUuYXZjQy5zcHMsdi5wcHM9RS5hdmNDLnBwc31pZih2LnByZXNlbnQ9ITAsdi5leHQ9e30sdi5leHQuc3Rzcz1udWxsPT09KGM9cy5tZGlhKXx8dm9pZCAwPT09Y3x8bnVsbD09PShsPWMubWluZil8fHZvaWQgMD09PWx8fG51bGw9PT0oZj1sLnN0YmwpfHx2b2lkIDA9PT1mP3ZvaWQgMDpmLnN0c3Msdi5leHQuY3R0cz1udWxsPT09KGQ9cy5tZGlhKXx8dm9pZCAwPT09ZHx8bnVsbD09PShoPWQubWluZil8fHZvaWQgMD09PWh8fG51bGw9PT0ocD1oLnN0YmwpfHx2b2lkIDA9PT1wP3ZvaWQgMDpwLmN0dHMsRSYmImVuY3YiPT09RS50eXBlKXYuaXNWaWRlb0VuY3J5cHRpb249ITAsRS5kZWZhdWx0X0tJRD1udWxsPT09KG09RS5zaW5mKXx8dm9pZCAwPT09bXx8bnVsbD09PShnPW0uc2NoaSl8fHZvaWQgMD09PWc/dm9pZCAwOmcudGVuYy5kZWZhdWx0X0tJRCxFLmRlZmF1bHRfSXNFbmNyeXB0ZWQ9bnVsbD09PShrPUUuc2luZil8fHZvaWQgMD09PWt8fG51bGw9PT0oYj1rLnNjaGkpfHx2b2lkIDA9PT1iP3ZvaWQgMDpiLnRlbmMuZGVmYXVsdF9Jc0VuY3J5cHRlZCxFLmRlZmF1bHRfSVZfc2l6ZT1udWxsPT09KF89RS5zaW5mKXx8dm9pZCAwPT09X3x8bnVsbD09PSh3PV8uc2NoaSl8fHZvaWQgMD09PXc/dm9pZCAwOncudGVuYy5kZWZhdWx0X0lWX3NpemUsdi52aWRlb1NlbmM9cy5tZGlhLm1pbmYuc3RibC5zZW5jJiZzLm1kaWEubWluZi5zdGJsLnNlbmMuc2FtcGxlcyxFLmRhdGFfZm9ybWF0PW51bGw9PT0oUz1FLnNpbmYpfHx2b2lkIDA9PT1TfHxudWxsPT09KEE9Uy5mcm1hKXx8dm9pZCAwPT09QT92b2lkIDA6QS5kYXRhX2Zvcm1hdCx2LnVzZUVNRT1lLnVzZUVNRSx2LmtpZFZhbHVlPWUua2lkVmFsdWUsdi5wc3NoPWUucHNzaCx2LmVuY3Y9RX1pZihvJiZyKXt2YXIgVSxDLFAsSSxNLHosTyxSLEwsVj1yLEY9bnVsbD09PShVPW8udGtoZCl8fHZvaWQgMD09PVU/dm9pZCAwOlUudHJhY2tJZDtudWxsIT1GJiYoVi5pZD1vLnRraGQudHJhY2tJZCksVi50a2hkRHVyYXRpb249by50a2hkLmR1cmF0aW9uLFYubXZoZER1cnRpb249ZS5tdmhkLmR1cmF0aW9uLFYubXZoZFRpbWVjYWxlPWUubXZoZC50aW1lc2NhbGUsVi50aW1lc2NhbGU9Vi5mb3JtYXRUaW1lc2NhbGU9by5tZGlhLm1kaGQudGltZXNjYWxlLFYuZHVyYXRpb249by5tZGlhLm1kaGQuZHVyYXRpb258fFYubXZoZER1cnRpb24vVi5tdmhkVGltZWNhbGUqVi50aW1lc2NhbGU7dmFyIE4saixHLEgsSyxxLFcsWCxZPW8ubWRpYS5taW5mLnN0Ymwuc3RzZC5lbnRyaWVzWzBdO3N3aXRjaChWLnNhbXBsZVNpemU9WS5zYW1wbGVTaXplLFYuc2FtcGxlUmF0ZT1ZLnNhbXBsZVJhdGUsVi5jaGFubmVsQ291bnQ9WS5jaGFubmVsQ291bnQsVi5wcmVzZW50PSEwLFkudHlwZSl7Y2FzZSJhbGF3IjpWLmNvZGVjVHlwZT1WLmNvZGVjPVQsVi5zYW1wbGVSYXRlPThlMzticmVhaztjYXNlInVsYXciOlYuY29kZWNUeXBlPVYuY29kZWM9QixWLnNhbXBsZVJhdGU9OGUzO2JyZWFrO2RlZmF1bHQ6Vi5zYW1wbGVEdXJhdGlvbj1vZS5nZXRGcmFtZUR1cmF0aW9uKFYuc2FtcGxlUmF0ZSxWLnRpbWVzY2FsZSksVi5zYW1wbGVSYXRlSW5kZXg9b2UuZ2V0UmF0ZUluZGV4QnlSYXRlKFYuc2FtcGxlUmF0ZSksVi5vYmplY3RUeXBlPShudWxsPT09KGE9WS5lc2RzKXx8dm9pZCAwPT09YT92b2lkIDA6YS5vYmplY3RUeXBlKXx8MixZLmVzZHMmJihWLmNvbmZpZz1BcnJheS5mcm9tKFkuZXNkcy5jb25maWcpKSxWLmNvZGVjPShudWxsPT09KG49WS5lc2RzKXx8dm9pZCAwPT09bj92b2lkIDA6bi5jb2RlYyl8fCJtcDRhLjQwLjIifWlmKFYuc2FtcGxlRHVyYXRpb249b2UuZ2V0RnJhbWVEdXJhdGlvbihWLnNhbXBsZVJhdGUsVi50aW1lc2NhbGUpLFYub2JqZWN0VHlwZT0obnVsbD09PShDPVkuZXNkcyl8fHZvaWQgMD09PUM/dm9pZCAwOkMub2JqZWN0VHlwZSl8fDIsWS5lc2RzJiYoWS5lc2RzLmNvbmZpZz9WLmNvbmZpZz1BcnJheS5mcm9tKFkuZXNkcy5jb25maWcpOmNvbnNvbGUud2FybigiZXNkcyBjb25maWcgaXMgbnVsbCIpKSxWLmNvZGVjPShudWxsPT09KFA9WS5lc2RzKXx8dm9pZCAwPT09UD92b2lkIDA6UC5jb2RlYyl8fCJtcDRhLjQwLjIiLFYuc2FtcGxlUmF0ZUluZGV4PW9lLmdldFJhdGVJbmRleEJ5UmF0ZShWLnNhbXBsZVJhdGUpLFYuZXh0PXt9LFYuZXh0LnN0c3M9bnVsbD09PShJPW8ubWRpYSl8fHZvaWQgMD09PUl8fG51bGw9PT0oTT1JLm1pbmYpfHx2b2lkIDA9PT1NfHxudWxsPT09KHo9TS5zdGJsKXx8dm9pZCAwPT09ej92b2lkIDA6ei5zdHNzLFYuZXh0LmN0dHM9bnVsbD09PShPPW8ubWRpYSl8fHZvaWQgMD09PU98fG51bGw9PT0oUj1PLm1pbmYpfHx2b2lkIDA9PT1SfHxudWxsPT09KEw9Ui5zdGJsKXx8dm9pZCAwPT09TD92b2lkIDA6TC5jdHRzLFYucHJlc2VudD0hMCxZJiYiZW5jYSI9PT1ZLnR5cGUpVi5pc0F1ZGlvRW5jcnlwdGlvbj0hMCxZLmRhdGFfZm9ybWF0PW51bGw9PT0oTj1ZLnNpbmYpfHx2b2lkIDA9PT1OfHxudWxsPT09KGo9Ti5mcm1hKXx8dm9pZCAwPT09aj92b2lkIDA6ai5kYXRhX2Zvcm1hdCxZLmRlZmF1bHRfS0lEPW51bGw9PT0oRz1ZLnNpbmYpfHx2b2lkIDA9PT1HfHxudWxsPT09KEg9Ry5zY2hpKXx8dm9pZCAwPT09SD92b2lkIDA6SC50ZW5jLmRlZmF1bHRfS0lELFkuZGVmYXVsdF9Jc0VuY3J5cHRlZD1udWxsPT09KEs9WS5zaW5mKXx8dm9pZCAwPT09S3x8bnVsbD09PShxPUsuc2NoaSl8fHZvaWQgMD09PXE/dm9pZCAwOnEudGVuYy5kZWZhdWx0X0lzRW5jcnlwdGVkLFkuZGVmYXVsdF9JVl9zaXplPW51bGw9PT0oVz1ZLnNpbmYpfHx2b2lkIDA9PT1XfHxudWxsPT09KFg9Vy5zY2hpKXx8dm9pZCAwPT09WD92b2lkIDA6WC50ZW5jLmRlZmF1bHRfSVZfc2l6ZSxWLmF1ZGlvU2VuYz1vLm1kaWEubWluZi5zdGJsLnNlbmMmJm8ubWRpYS5taW5mLnN0Ymwuc2VuYy5zYW1wbGVzLFYudXNlRU1FPWUudXNlRU1FLFYua2lkVmFsdWU9ZS5raWRWYWx1ZSxWLmVuY2E9WX1pZihyJiYoci5pc1ZpZGVvRW5jcnlwdGlvbj0hIXQmJnQuaXNWaWRlb0VuY3J5cHRpb24pLHQmJih0LmlzQXVkaW9FbmNyeXB0aW9uPSEhciYmci5pc0F1ZGlvRW5jcnlwdGlvbiksbnVsbCE9dCYmdC5lbmN2fHxudWxsIT1yJiZyLmVuY2Epe3ZhciBaLFEsSj1udWxsPT10fHxudWxsPT09KFo9dC5lbmN2KXx8dm9pZCAwPT09Wj92b2lkIDA6Wi5kZWZhdWx0X0tJRCwkPW51bGw9PXJ8fG51bGw9PT0oUT1yLmVuY2EpfHx2b2lkIDA9PT1RP3ZvaWQgMDpRLmRlZmF1bHRfS0lELGVlPUp8fCQ/KEp8fCQpLmpvaW4oIiIpOm51bGw7dCYmKHQua2lkPWVlKSxyJiYoci5raWQ9ZWUpfXJldHVybiB0JiYodC5mbGFncz0zODQxKSxyJiYoci5mbGFncz0xNzkzKSx7dmlkZW9UcmFjazp0LGF1ZGlvVHJhY2s6cn19fX0se2tleToiZXZhbHVhdGVEZWZhdWx0RHVyYXRpb24iLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYSxuPW51bGw9PXR8fG51bGw9PT0oYT10LnNhbXBsZXMpfHx2b2lkIDA9PT1hP3ZvaWQgMDphLmxlbmd0aDtyZXR1cm4gbj8xMDI0Km4vdC50aW1lc2NhbGUqZS50aW1lc2NhbGUvcjoxMDI0fX0se2tleToibW9vZlRvU2FtcGxlcyIsdmFsdWU6ZnVuY3Rpb24odCxyLGEpe3ZhciBuPXt9O3JldHVybiB0Lm1maGQmJihyJiYoci5zZXF1ZW5jZU51bWJlcj10Lm1maGQuc2VxdWVuY2VOdW1iZXIpLGEmJihhLnNlcXVlbmNlTnVtYmVyPXQubWZoZC5zZXF1ZW5jZU51bWJlcikpLHQudHJhZi5mb3JFYWNoKChmdW5jdGlvbih0KXt2YXIgaT10LnRmaGQscz10LnRmZHQsbz10LnRydW47aWYoaSYmbyl7cyYmKHImJnIuaWQ9PT1pLnRyYWNrSWQmJihyLmJhc2VNZWRpYURlY29kZVRpbWU9cy5iYXNlTWVkaWFEZWNvZGVUaW1lKSxhJiZhLmlkPT09aS50cmFja0lkJiYoYS5iYXNlTWVkaWFEZWNvZGVUaW1lPXMuYmFzZU1lZGlhRGVjb2RlVGltZSkpO3ZhciB1PWkuZGVmYXVsdFNhbXBsZVNpemV8fDAsYz1pLmRlZmF1bHRTYW1wbGVEdXJhdGlvbnx8ZS5ldmFsdWF0ZURlZmF1bHREdXJhdGlvbihyLGEsby5zYW1wbGVzLmxlbmd0aHx8by5zYW1wbGVDb3VudCksbD1vLmRhdGFPZmZzZXR8fDAsZj0wLGQ9LTE7aWYoIW8uc2FtcGxlcy5sZW5ndGgmJm8uc2FtcGxlQ291bnQpe25baS50cmFja0lkXT1bXTtmb3IodmFyIGg9MDtoPG8uc2FtcGxlQ291bnQ7aCsrKW5baS50cmFja0lkXS5wdXNoKHtvZmZzZXQ6bCxkdHM6ZixkdXJhdGlvbjpjLHNpemU6dX0pLGYrPWMsbCs9dX1lbHNlIG5baS50cmFja0lkXT1vLnNhbXBsZXMubWFwKChmdW5jdGlvbihlLHQpe3JldHVybihlPXtvZmZzZXQ6bCxkdHM6ZixwdHM6ZisoZS5jdHN8fDApLGR1cmF0aW9uOmUuZHVyYXRpb258fGMsc2l6ZTplLnNpemV8fHUsZ29wSWQ6ZCxrZXlmcmFtZTowPT09dHx8bnVsbCE9PWUuZmxhZ3MmJnZvaWQgMCE9PWUuZmxhZ3MmJig2NTUzNiZlLmZsYWdzKT4+PjAhPTY1NTM2fSkua2V5ZnJhbWUmJihkKyssZS5nb3BJZD1kKSxmKz1lLmR1cmF0aW9uLGwrPWUuc2l6ZSxlfSkpfX0pKSxufX0se2tleToibW9vdlRvU2FtcGxlcyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS50cmFrO2lmKHQmJnQubGVuZ3RoKXt2YXIgcj10LmZpbmQoKGZ1bmN0aW9uKGUpe3ZhciB0LHI7cmV0dXJuInZpZGUiPT09KG51bGw9PT0odD1lLm1kaWEpfHx2b2lkIDA9PT10fHxudWxsPT09KHI9dC5oZGxyKXx8dm9pZCAwPT09cj92b2lkIDA6ci5oYW5kbGVyVHlwZSl9KSksYT10LmZpbmQoKGZ1bmN0aW9uKGUpe3ZhciB0LHI7cmV0dXJuInNvdW4iPT09KG51bGw9PT0odD1lLm1kaWEpfHx2b2lkIDA9PT10fHxudWxsPT09KHI9dC5oZGxyKXx8dm9pZCAwPT09cj92b2lkIDA6ci5oYW5kbGVyVHlwZSl9KSk7aWYocnx8YSl7dmFyIG4saTtpZihyKXt2YXIgcyxvLHU9bnVsbD09PShzPXIubWRpYSl8fHZvaWQgMD09PXN8fG51bGw9PT0obz1zLm1pbmYpfHx2b2lkIDA9PT1vP3ZvaWQgMDpvLnN0Ymw7aWYoIXUpcmV0dXJuO3ZhciBjPXUuc3R0cyxsPXUuc3RzYyxmPXUuc3RzeixkPXUuc3RjbyxoPXUuc3RzcyxwPXUuY3R0cztpZighKGMmJmwmJmYmJmQmJmgpKXJldHVybjtuPURlKGMsbCxmLGQscCxoKX1pZihhKXt2YXIgdix5LG0sZz1udWxsPT09KHY9YS5tZGlhKXx8dm9pZCAwPT09dnx8bnVsbD09PSh5PXYubWluZil8fHZvaWQgMD09PXk/dm9pZCAwOnkuc3RibDtpZighZylyZXR1cm47dmFyIGs9bnVsbD09PShtPWEubWRpYS5tZGhkKXx8dm9pZCAwPT09bT92b2lkIDA6bS50aW1lc2NhbGUsYj1nLnN0dHMsXz1nLnN0c2Msdz1nLnN0c3oseD1nLnN0Y287aWYoIShrJiZiJiZfJiZ3JiZ4KSlyZXR1cm47aT1EZShiLF8sdyx4KX1yZXR1cm57dmlkZW9TYW1wbGVzOm4sYXVkaW9TYW1wbGVzOml9fX19fV0pLGV9KCk7ZnVuY3Rpb24gRGUoZSx0LHIsYSxuLGkpe3ZhciBzLG8sdSxjPVtdLGw9bnVsbD09bj92b2lkIDA6bi5lbnRyaWVzLGY9dC5lbnRyaWVzLGQ9YS5lbnRyaWVzLGg9ci5lbnRyeVNpemVzLHA9bnVsbD09aT92b2lkIDA6aS5lbnRyaWVzO3AmJihzPXt9LHAuZm9yRWFjaCgoZnVuY3Rpb24oZSl7c1tlLTFdPSEwfSkpKSxsJiYobz1bXSxsLmZvckVhY2goKGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmNvdW50LHI9ZS5vZmZzZXQsYT0wO2E8dDthKyspby5wdXNoKHIpfSkpKTt2YXIgdj0tMSx5PTAsbT0wLGc9MCxrPTAsYj0wLF89ZlswXS5zYW1wbGVzUGVyQ2h1bmssdz1mWzFdP2ZbMV0uZmlyc3RDaHVuay0xOjEvMDtyZXR1cm4gZS5lbnRyaWVzLmZvckVhY2goKGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmNvdW50LGE9ZS5kZWx0YSxuPTA7bjx0O24rKyl1PXtkdHM6eSxkdXJhdGlvbjphLHNpemU6aFttXXx8ci5zYW1wbGVTaXplLG9mZnNldDpkW2ddK2IsaW5kZXg6bX0scCYmKHUua2V5ZnJhbWU9c1ttXSx1LmtleWZyYW1lJiZ2KyssdS5nb3BJZD12KSxvJiZtPG8ubGVuZ3RoJiYodS5wdHM9dS5kdHMrb1ttXSksYy5wdXNoKHUpLHkrPWEsKyttPF8/Yis9dS5zaXplOihnKyssYj0wLGc+PXcmJihrKyssdz1mW2srMV0/ZltrKzFdLmZpcnN0Q2h1bmstMToxLzApLF8rPWZba10uc2FtcGxlc1BlckNodW5rKX0pKSxjfWZ1bmN0aW9uIEFlKGUsdCl7cmV0dXJuIGUuZGF0YVJlZmVyZW5jZUluZGV4PWVlKHQsNiksZS53aWR0aD1lZSh0LDI0KSxlLmhlaWdodD1lZSh0LDI2KSxlLmhvcml6cmVzb2x1dGlvbj10ZSh0LDI4KSxlLnZlcnRyZXNvbHV0aW9uPXRlKHQsMzIpLGUuZnJhbWVDb3VudD1lZSh0LDQwKSxlLmRlcHRoPWVlKHQsNzQpLDc4fWZ1bmN0aW9uIFRlKGUsdCl7cmV0dXJuIGUuZGF0YVJlZmVyZW5jZUluZGV4PWVlKHQsNiksZS5jaGFubmVsQ291bnQ9ZWUodCwxNiksZS5zYW1wbGVTaXplPWVlKHQsMTgpLGUuc2FtcGxlUmF0ZT10ZSh0LDI0KS82NTUzNiwyOH1mdW5jdGlvbiBCZShlLHQscil7aWYoZSl7aWYoZS5zaXplIT09ZS5kYXRhLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoImJveCAiLmNvbmNhdChlLnR5cGUsIiBzaXplICE9PSBkYXRhLmxlbmd0aCIpKTt2YXIgYT17c3RhcnQ6ZS5zdGFydCxzaXplOmUuc2l6ZSxoZWFkZXJTaXplOmUuaGVhZGVyU2l6ZSx0eXBlOmUudHlwZX07cmV0dXJuIHQmJihhLnZlcnNpb249ZS5kYXRhW2UuaGVhZGVyU2l6ZV0sYS5mbGFncz1mdW5jdGlvbihlKXt2YXIgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06MDtyZXR1cm4oZVt0XTw8MTYpKyhlW3QrMV08PDgpKyhlW3QrMl18fDApfShlLmRhdGEsZS5oZWFkZXJTaXplKzEpLGEuaGVhZGVyU2l6ZSs9NCkscihhLGUuZGF0YS5zdWJhcnJheShhLmhlYWRlclNpemUpLGEuc3RhcnQrYS5oZWFkZXJTaXplKSxhfX12YXIgRWU9ZnVuY3Rpb24oZSx0LHIpe2Zvcih2YXIgYT1TdHJpbmcociksbj10Pj4wLGk9TWF0aC5jZWlsKG4vYS5sZW5ndGgpLHM9W10sbz1TdHJpbmcoZSk7aS0tOylzLnB1c2goYSk7cmV0dXJuIHMuam9pbigiIikuc3Vic3RyaW5nKDAsbi1vLmxlbmd0aCkrb30sVWU9ZnVuY3Rpb24oKXtmb3IodmFyIGU9W10sdD1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KHQpLGE9MDthPHQ7YSsrKXJbYV09YXJndW1lbnRzW2FdO3JldHVybiByLmZvckVhY2goKGZ1bmN0aW9uKHQpe2UucHVzaChFZShOdW1iZXIodCkudG9TdHJpbmcoMTYpLDIsMCkpfSkpLGVbMF19O2Z1bmN0aW9uIENlKGUpe2Zvcih2YXIgdD0wLHI9YXJndW1lbnRzLmxlbmd0aCxhPW5ldyBBcnJheShyPjE/ci0xOjApLG49MTtuPHI7bisrKWFbbi0xXT1hcmd1bWVudHNbbl07YS5mb3JFYWNoKChmdW5jdGlvbihlKXt0Kz1lLmxlbmd0aH0pKTt2YXIgaT1uZXcgZSh0KSxzPTA7cmV0dXJuIGEuZm9yRWFjaCgoZnVuY3Rpb24oZSl7aS5zZXQoZSxzKSxzKz1lLmxlbmd0aH0pKSxpfXZhciBQZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSksdGhpcy5idWZmZXI9bmV3IFVpbnQ4QXJyYXkoMCl9cmV0dXJuIG4oZSxbe2tleToid3JpdGUiLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPXRoaXMsdD1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KHQpLGE9MDthPHQ7YSsrKXJbYV09YXJndW1lbnRzW2FdO3IuZm9yRWFjaCgoZnVuY3Rpb24odCl7dD9lLmJ1ZmZlcj1DZShVaW50OEFycmF5LGUuYnVmZmVyLHQpOndpbmRvdy5jb25zb2xlLndhcm4odCl9KSl9fV0sW3trZXk6IndyaXRlVWludDE2Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoW2U+PjgmMjU1LDI1NSZlXSl9fSx7a2V5OiJ3cml0ZVVpbnQzMiIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBVaW50OEFycmF5KFtlPj4yNCxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmVdKX19XSksZX0oKSxJZT1NYXRoLnBvdygyLDMyKS0xLE1lPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3IodGhpcyxlKX1yZXR1cm4gbihlLG51bGwsW3trZXk6ImJveCIsdmFsdWU6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkodD4xP3QtMTowKSxhPTE7YTx0O2ErKylyW2EtMV09YXJndW1lbnRzW2FdO3ZhciBuPTgrKHI9ci5maWx0ZXIoQm9vbGVhbikpLnJlZHVjZSgoZnVuY3Rpb24oZSx0KXtyZXR1cm4gZSt0LmJ5dGVMZW5ndGh9KSwwKSxpPW5ldyBVaW50OEFycmF5KG4pO2lbMF09bj4+MjQmMjU1LGlbMV09bj4+MTYmMjU1LGlbMl09bj4+OCYyNTUsaVszXT0yNTUmbixpLnNldChlLDQpO3ZhciBzPTg7cmV0dXJuIHIuZm9yRWFjaCgoZnVuY3Rpb24oZSl7aS5zZXQoZSxzKSxzKz1lLmJ5dGVMZW5ndGh9KSksaX19LHtrZXk6ImZ0eXAiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiB0LmZpbmQoKGZ1bmN0aW9uKGUpe3JldHVybiBlLnR5cGU9PT1iJiZlLmNvZGVjVHlwZT09PUR9KSk/ZS5GVFlQSEVWMTplLkZUWVBBVkMxfX0se2tleToiaW5pdFNlZ21lbnQiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBKKGUuZnR5cCh0KSxlLm1vb3YodCkpfX0se2tleToicHNzaCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9bmV3IFVpbnQ4QXJyYXkoWzEsMCwwLDBdLmNvbmNhdChbMTYsMTE5LDIzOSwyMzYsMTkyLDE3OCw3NywyLDE3MiwyMjcsNjAsMzAsODIsMjI2LDI1MSw3NV0sWzAsMCwwLDFdLGllKHQua2lkKSxbMCwwLDAsMF0pKTtyZXR1cm4gZS5ib3goZS50eXBlcy5wc3NoLHIpfX0se2tleToibW9vdiIsdmFsdWU6ZnVuY3Rpb24odCl7aWYodFswXS51c2VFTUUmJih0WzBdLmVuY3Z8fHRbMF0uZW5jYSkpe3RbMF0ucHNzaHx8KHRbMF0ucHNzaD17a2lkOnRbMF0ua2lkfSk7dmFyIHI9dGhpcy5wc3NoKHRbMF0ucHNzaCk7cmV0dXJuIGUuYm94LmFwcGx5KGUsW2UudHlwZXMubW9vdixlLm12aGQodFswXS5tdmhkRHVydGlvbnx8dFswXS5kdXJhdGlvbix0WzBdLm12aGRUaW1lY2FsZXx8dFswXS50aW1lc2NhbGUpLGUubXZleCh0KV0uY29uY2F0KHkodC5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiBlLnRyYWsodCl9KSkpLFtyXSkpfXJldHVybiBlLmJveC5hcHBseShlLFtlLnR5cGVzLm1vb3YsZS5tdmhkKHRbMF0ubXZoZER1cnRpb258fHRbMF0uZHVyYXRpb24sdFswXS5tdmhkVGltZWNhbGV8fHRbMF0udGltZXNjYWxlKV0uY29uY2F0KHkodC5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiBlLnRyYWsodCl9KSkpLFtlLm12ZXgodCldKSl9fSx7a2V5OiJtdmhkIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06OWU0LGE9ZS5ib3goZS50eXBlcy5tdmhkLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCxyPj4yNCYyNTUscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyLHQ+PjI0JjI1NSx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnQsMCwxLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsNjQsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMjU1LDI1NSwyNTUsMjU1XSkpO3JldHVybiBhfX0se2tleToidHJhayIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMudHJhayxlLnRraGQodC5pZCx0LnRraGREdXJhdGlvbnx8MCx0LndpZHRoLHQuaGVpZ2h0KSxlLm1kaWEodCkpfX0se2tleToidGtoZCIsdmFsdWU6ZnVuY3Rpb24odCxyKXt2YXIgYT1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06MCxuPWFyZ3VtZW50cy5sZW5ndGg+MyYmdm9pZCAwIT09YXJndW1lbnRzWzNdP2FyZ3VtZW50c1szXTowLGk9ZS5ib3goZS50eXBlcy50a2hkLG5ldyBVaW50OEFycmF5KFswLDAsMCw3LDAsMCwwLDAsMCwwLDAsMCx0Pj4yNCYyNTUsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0LDAsMCwwLDAscj4+MjQmMjU1LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmciwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCw2NCwwLDAsMCxhPj44JjI1NSwyNTUmYSwwLDAsbj4+OCYyNTUsMjU1Jm4sMCwwXSkpO3JldHVybiBpfX0se2tleToibWRpYSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMubWRpYSxlLm1kaGQodC5kdXJhdGlvbix0LnRpbWVzY2FsZSksZS5oZGxyKHQudHlwZSksZS5taW5mKHQpKX19LHtrZXk6Im1kaGQiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTo5ZTQsYT1lLmJveChlLnR5cGVzLm1kaGQsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLHI+PjI0JjI1NSxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnIsdD4+MjQmMjU1LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdCw4NSwxOTYsMCwwXSkpO3JldHVybiBhfX0se2tleToiaGRsciIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMuaGRscixlLkhETFJfVFlQRVNbdF0pfX0se2tleToibWluZiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMubWluZix0LnR5cGU9PT1iP2UuVk1IRDplLlNNSEQsZS5ESU5GLGUuc3RibCh0KSl9fSx7a2V5OiJzdGJsIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj1bXTtyZXR1cm4gdCYmdC5leHQmJnQuZXh0LnN0c3MmJnIucHVzaChlLnN0c3ModC5leHQuc3Rzcy5lbnRyaWVzKSksZS5ib3goZS50eXBlcy5zdGJsLGUuc3RzZCh0KSxlLlNUVFMsclswXSxlLlNUU0MsZS5TVFNaLGUuU1RDTyl9fSx7a2V5OiJzdHNkIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcjtyZXR1cm4gcj0iYXVkaW8iPT09dC50eXBlP3QudXNlRU1FJiZ0LmVuY2E/ZS5lbmNhKHQpOnQuY29kZWNUeXBlPT09RT9lLm9wdXModCk6ZS5tcDRhKHQpOnQudXNlRU1FJiZ0LmVuY3Y/ZS5lbmN2KHQpOnQuYXYxQz9lLmF2MDEodCk6ZS5hdmMxaGV2MSh0KSxlLmJveChlLnR5cGVzLnN0c2QsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMV0pLHIpfX0se2tleToiZW5jYSIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9dC5lbmNhLmNoYW5uZWxDb3VudCxhPXQuZW5jYS5zYW1wbGVSYXRlLG49bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCxyLDAsMTYsMCwwLDAsMCxhPj44JjI1NSwyNTUmYSwwLDBdKSxpPWUuZXNkcyh0LmNvbmZpZykscz1lLnNpbmYodC5lbmNhKTtyZXR1cm4gZS5ib3goZS50eXBlcy5lbmNhLG4saSxzKX19LHtrZXk6ImVuY3YiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByLGEsbj10LnNwcy5sZW5ndGg+MD90LnNwc1swXTpbXSxpPXQucHBzLmxlbmd0aD4wP3QucHBzWzBdOltdLHM9dC53aWR0aCxvPXQuaGVpZ2h0LHU9dC5zYXJSYXRpb1swXSxjPXQuc2FyUmF0aW9bMV0sbD1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAscz4+OCYyNTUsMjU1JnMsbz4+OCYyNTUsMjU1Jm8sMCw3MiwwLDAsMCw3MiwwLDAsMCwwLDAsMCwwLDEsMTgsMTAwLDk3LDEwNSwxMDgsMTIxLDEwOSwxMTEsMTE2LDEwNSwxMTEsMTEwLDQ3LDEwNCwxMDgsMTE1LDQ2LDEwNiwxMTUsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDI0LDE3LDE3XSksZj1uZXcgVWludDhBcnJheSgocj0oYT1bMSxuWzFdLG5bMl0sblszXSwyNTUsMjI1LG4ubGVuZ3RoPj4+OCYyNTUsMjU1Jm4ubGVuZ3RoXSkuY29uY2F0LmFwcGx5KGEseShuKSkuY29uY2F0KFsxLGkubGVuZ3RoPj4+OCYyNTUsMjU1JmkubGVuZ3RoXSkpLmNvbmNhdC5hcHBseShyLHkoaSkpKSxkPW5ldyBVaW50OEFycmF5KFswLDAsODgsNTcsMCwxNSwyMDAsMTkyLDAsNCw4Niw3Ml0pLGg9ZS5zaW5mKHQuZW5jdikscD1uZXcgVWludDhBcnJheShbdT4+MjQsdT4+MTYmMjU1LHU+PjgmMjU1LDI1NSZ1LGM+PjI0LGM+PjE2JjI1NSxjPj44JjI1NSwyNTUmY10pO3JldHVybiBlLmJveChlLnR5cGVzLmVuY3YsbCxlLmJveChlLnR5cGVzLmF2Y0MsZiksZS5ib3goZS50eXBlcy5idHJ0LGQpLGgsZS5ib3goZS50eXBlcy5wYXNwLHApKX19LHtrZXk6InNjaGkiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPW5ldyBVaW50OEFycmF5KFtdKSxhPWUudGVuYyh0KTtyZXR1cm4gZS5ib3goZS50eXBlcy5zY2hpLHIsYSl9fSx7a2V5OiJ0ZW5jIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMjU1JnQuZGVmYXVsdF9Jc0VuY3J5cHRlZCwyNTUmdC5kZWZhdWx0X0lWX3NpemVdLmNvbmNhdChpZSh0LmRlZmF1bHRfS0lEKSkpO3JldHVybiBlLmJveChlLnR5cGVzLnRlbmMscil9fSx7a2V5OiJzaW5mIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj1uZXcgVWludDhBcnJheShbXSksYT1uZXcgVWludDhBcnJheShbdC5kYXRhX2Zvcm1hdC5jaGFyQ29kZUF0KDApLHQuZGF0YV9mb3JtYXQuY2hhckNvZGVBdCgxKSx0LmRhdGFfZm9ybWF0LmNoYXJDb2RlQXQoMiksdC5kYXRhX2Zvcm1hdC5jaGFyQ29kZUF0KDMpXSksbj1uZXcgVWludDhBcnJheShbMCwwLDAsMCw5OSwxMDEsMTEwLDk5LDAsMSwwLDBdKSxpPWUuc2NoaSh0KTtyZXR1cm4gZS5ib3goZS50eXBlcy5zaW5mLHIsZS5ib3goZS50eXBlcy5mcm1hLGEpLGUuYm94KGUudHlwZXMuc2NobSxuKSxpKX19LHtrZXk6ImF2MDEiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLmF2MDEsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLHQud2lkdGg+PjgmMjU1LDI1NSZ0LndpZHRoLHQuaGVpZ2h0Pj44JjI1NSwyNTUmdC5oZWlnaHQsMCw3MiwwLDAsMCw3MiwwLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMjQsMTcsMTddKSx0LmF2MUMsdC5jb2xyKX19LHtrZXk6ImF2YzFoZXYxIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10LmNvZGVjVHlwZT09PUQsYT1yP2UudHlwZXMuaHZjMTplLnR5cGVzLmF2YzEsbj1yP2UuaHZjQyh0KTplLmF2Y0ModCksaT1bbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLHQud2lkdGg+PjgmMjU1LDI1NSZ0LndpZHRoLHQuaGVpZ2h0Pj44JjI1NSwyNTUmdC5oZWlnaHQsMCw3MiwwLDAsMCw3MiwwLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMjQsMTcsMTddKSxuXTtyZXR1cm4gcj9pLnB1c2goZS5ib3goZS50eXBlcy5maWVsLG5ldyBVaW50OEFycmF5KFsxLDBdKSkpOnQuc2FyUmF0aW8mJnQuc2FyUmF0aW8ubGVuZ3RoPjEmJmkucHVzaChlLnBhc3AodC5zYXJSYXRpbykpLGUuYm94LmFwcGx5KGUsW2FdLmNvbmNhdChpKSl9fSx7a2V5OiJhdmNDIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcixhLG4saT1bXSxzPVtdO3JldHVybiB0LnNwcy5mb3JFYWNoKChmdW5jdGlvbihlKXtuPWUuYnl0ZUxlbmd0aCxpLnB1c2gobj4+PjgmMjU1KSxpLnB1c2goMjU1Jm4pLGkucHVzaC5hcHBseShpLHkoZSkpfSkpLHQucHBzLmZvckVhY2goKGZ1bmN0aW9uKGUpe249ZS5ieXRlTGVuZ3RoLHMucHVzaChuPj4+OCYyNTUpLHMucHVzaCgyNTUmbikscy5wdXNoLmFwcGx5KHMseShlKSl9KSksZS5ib3goZS50eXBlcy5hdmNDLG5ldyBVaW50OEFycmF5KChyPShhPVsxLGlbM10saVs0XSxpWzVdLDI1NSwyMjR8dC5zcHMubGVuZ3RoXSkuY29uY2F0LmFwcGx5KGEsaSkuY29uY2F0KFt0LnBwcy5sZW5ndGhdKSkuY29uY2F0LmFwcGx5KHIscykpKX19LHtrZXk6Imh2Y0MiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQuaHZjQztpZihyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXJ8fHIgaW5zdGFuY2VvZiBVaW50OEFycmF5KXJldHVybiByO3ZhciBhLG49dC52cHMsaT10LnNwcyxzPXQucHBzO2lmKHIpe3ZhciBvPXIuZ2VuZXJhbFByb2ZpbGVDb21wYXRpYmlsaXR5RmxhZ3MsdT1yLmdlbmVyYWxDb25zdHJhaW50SW5kaWNhdG9yRmxhZ3MsYz0obi5sZW5ndGgmJjEpKyhpLmxlbmd0aCYmMSkrKHMubGVuZ3RoJiYxKTthPVsxLHIuZ2VuZXJhbFByb2ZpbGVTcGFjZTw8NnxyLmdlbmVyYWxUaWVyRmxhZzw8NXxyLmdlbmVyYWxQcm9maWxlSWRjLG8+Pj4yNCxvPj4+MTYsbz4+Pjgsbyx1WzBdLHVbMV0sdVsyXSx1WzNdLHVbNF0sdVs1XSxyLmdlbmVyYWxMZXZlbElkYywyNDAsMCwyNTIsMjUyfHIuY2hyb21hRm9ybWF0SWRjLDI0OHxyLmJpdERlcHRoTHVtYU1pbnVzOCwyNDh8ci5iaXREZXB0aENocm9tYU1pbnVzOCwwLDAsci5udW1UZW1wb3JhbExheWVyczw8M3xyLnRlbXBvcmFsSWROZXN0ZWQ8PDJ8MyxjXTt2YXIgbD1mdW5jdGlvbihlKXt2YXIgdDthLnB1c2goZS5sZW5ndGg+PjgsZS5sZW5ndGgpLCh0PWEpLnB1c2guYXBwbHkodCx5KGUpKX07bi5sZW5ndGgmJihhLnB1c2goMTYwLDAsbi5sZW5ndGgpLG4uZm9yRWFjaChsKSksaS5sZW5ndGgmJihhLnB1c2goMTYxLDAsaS5sZW5ndGgpLGkuZm9yRWFjaChsKSkscy5sZW5ndGgmJihhLnB1c2goMTYyLDAscy5sZW5ndGgpLHMuZm9yRWFjaChsKSl9ZWxzZSBhPVsxLDEsOTYsMCwwLDAsMTQ0LDAsMCwwLDAsMCw5MywyNDAsMCwyNTIsMjUzLDI0OCwyNDgsMCwwLDE1LDMsMTYwLDAsMSwwLDI0LDY0LDEsMTIsMSwyNTUsMjU1LDEsOTYsMCwwLDMsMCwxNDQsMCwwLDMsMCwwLDMsMCw5MywxNTMsMTUyLDksMTYxLDAsMSwwLDQ1LDY2LDEsMSwxLDk2LDAsMCwzLDAsMTQ0LDAsMCwzLDAsMCwzLDAsOTMsMTYwLDIsMTI4LDEyOCw0NSwyMiw4OSwxNTMsMTY0LDE0Nyw0MywxNTQsMTI4LDEyOCwxMjgsMTMwLDAsMCwzLDAsMiwwLDAsMywwLDUwLDE2LDE2MiwwLDEsMCw3LDY4LDEsMTkzLDExNCwxODAsOTgsNjRdO3JldHVybiBlLmJveChlLnR5cGVzLmh2Y0MsbmV3IFVpbnQ4QXJyYXkoYSkpfX0se2tleToicGFzcCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9dih0LDIpLGE9clswXSxuPXJbMV07cmV0dXJuIGUuYm94KGUudHlwZXMucGFzcCxuZXcgVWludDhBcnJheShbYT4+MjQsYT4+MTYmMjU1LGE+PjgmMjU1LDI1NSZhLG4+PjI0LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbl0pKX19LHtrZXk6Im1wNGEiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLm1wNGEsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCx0LmNoYW5uZWxDb3VudCwwLDE2LDAsMCwwLDAsdC5zYW1wbGVSYXRlPj44JjI1NSwyNTUmdC5zYW1wbGVSYXRlLDAsMF0pLHQuY29uZmlnLmxlbmd0aD9lLmVzZHModC5jb25maWcpOnZvaWQgMCl9fSx7a2V5OiJlc2RzIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10Lmxlbmd0aDtyZXR1cm4gZS5ib3goZS50eXBlcy5lc2RzLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDMsMjMrciwwLDAsMCw0LDE1K3IsNjQsMjEsMCw2LDAsMCwwLDIxOCwxOTIsMCwwLDIxOCwxOTIsNV0uY29uY2F0KFtyXSkuY29uY2F0KHQpLmNvbmNhdChbNiwxLDJdKSkpfX0se2tleToib3B1cyIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCx0LmNoYW5uZWxDb3VudCwwLDE2LDAsMCwwLDAsdC5zYW1wbGVSYXRlPj44JjI1NSwyNTUmdC5zYW1wbGVSYXRlLDAsMF0pLGE9dC5jb25maWcubGVuZ3RoP2UuZE9wcyh0KTpbXTtyZXR1cm4gZS5ib3goZS50eXBlcy5PcHVzLHIsYSl9fSx7a2V5OiJkT3BzIix2YWx1ZTpmdW5jdGlvbih0KXtpZih0LmNvbmZpZylyZXR1cm4gdC5jb25maWdbNF09dC5zYW1wbGVSYXRlPj4+MjQmMjU1LHQuY29uZmlnWzVdPXQuc2FtcGxlUmF0ZT4+PjE2JjI1NSx0LmNvbmZpZ1s2XT10LnNhbXBsZVJhdGU+Pj44JjI1NSx0LmNvbmZpZ1s3XT0yNTUmdC5zYW1wbGVSYXRlLGUuYm94KGUudHlwZXMuZE9wcyx0LmNvbmZpZyl9fSx7a2V5OiJtdmV4Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3guYXBwbHkoZSxbZS50eXBlcy5tdmV4XS5jb25jYXQoeSh0Lm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuIGUudHJleCh0LmlkKX0pKSkpKX19LHtrZXk6InRyZXgiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLnRyZXgsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsdD4+MjQsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0LDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDFdKSl9fSx7a2V5OiJ0cmV4MSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMudHJleCxuZXcgVWludDhBcnJheShbMCwwLDAsMCx0Pj4yNCx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnQsMCwwLDAsMSwwLDAsMiwwLDAsMCwwLDAsMCwxLDAsMF0pKX19LHtrZXk6InRyZXgyIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy50cmV4LG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHQ+PjI0LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdCwwLDAsMCwxLDAsMCw0LDAsMCwwLDAsMCwyLDAsMCwwXSkpfX0se2tleToibW9vZiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94LmFwcGx5KGUsW2UudHlwZXMubW9vZixlLm1maGQodFswXS5zYW1wbGVzP3RbMF0uc2FtcGxlc1swXS5nb3BJZDowKV0uY29uY2F0KHkodC5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiBlLnRyYWYodCl9KSkpKSl9fSx7a2V5OiJtZmhkIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy5tZmhkLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHQ+PjI0LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdF0pKX19LHtrZXk6InRyYWYiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPWUudGZoZCh0LmlkKSxhPWUudGZkdCh0LHQuYmFzZU1lZGlhRGVjb2RlVGltZSksbj0wO2lmKHQuaXNWaWRlbyYmdC52aWRlb1NlbmMmJnQudmlkZW9TZW5jLmZvckVhY2goKGZ1bmN0aW9uKGUpe24rPTgsZS5zdWJzYW1wbGVzJiZlLnN1YnNhbXBsZXMubGVuZ3RoJiYobis9MixuKz02KmUuc3Vic2FtcGxlcy5sZW5ndGgpfSkpLHQudmlkZW9TZW5jTGVuZ3RoPW4sdC51c2VFTUUmJih0LmlzVmlkZW9FbmNyeXB0aW9ufHx0LmlzQXVkaW9FbmNyeXB0aW9uKSl7aWYodC5pc1ZpZGVvRW5jcnlwdGlvbil7aWYodC5pc1ZpZGVvKXt2YXIgaT1lLnNhaXoodCkscz1lLnNhaW8odCksbz1lLnRydW4xKHQpLHU9ZS5zZW5jKHQpO3JldHVybiBlLmJveChlLnR5cGVzLnRyYWYscixhLGkscyxvLHUpfWlmKHQuaXNBdWRpb0VuY3J5cHRpb24pe3ZhciBjPWUuc2JncCgpLGw9ZS5zYWl6KHQpLGY9ZS5zYWlvKHQpLGQ9ZS5zZW5jKHQpLGg9ZS50cnVuMSh0KTtyZXR1cm4gZS5ib3goZS50eXBlcy50cmFmLHIsYSxjLGwsZixkLGgpfXZhciBwPWUuc2JncCgpLHY9ZS50cnVuMSh0KTtyZXR1cm4gZS5ib3goZS50eXBlcy50cmFmLHIsYSxwLHYpfWlmKHQuaXNWaWRlbyl7dmFyIHk9ZS50cnVuMSh0KTtyZXR1cm4gZS5ib3goZS50eXBlcy50cmFmLHIsYSx5KX12YXIgbT1lLnNiZ3AoKSxnPWUuc2Fpeih0KSxrPWUuc2Fpbyh0KSxiPWUuc2VuYyh0KSxfPWUudHJ1bjEodCk7cmV0dXJuIGUuYm94KGUudHlwZXMudHJhZixyLGEsbSxnLGssYixfKX12YXIgdz1lLnNkdHAodCk7cmV0dXJuIGUuYm94KGUudHlwZXMudHJhZixyLGEsdyxlLnRydW4odC5zYW1wbGVzLHcuYnl0ZUxlbmd0aCs3NikpfX0se2tleToic2R0cCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9bmV3IFBlO3JldHVybiB0LnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ci53cml0ZShuZXcgVWludDhBcnJheSh0LmlzVmlkZW8/W2Uua2V5ZnJhbWU/MzI6MTZdOlsxNl0pKX0pKSxlLmJveChlLnR5cGVzLnNkdHAsdGhpcy5leHRlbnNpb24oMCwwKSxyLmJ1ZmZlcil9fSx7a2V5OiJ0cnVuMSIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9bmV3IFBlLGE9UGUud3JpdGVVaW50MzIodC5zYW1wbGVzLmxlbmd0aCksbj1udWxsO2lmKHQuaXNWaWRlbyl7dmFyIGk9dC52aWRlb1NlbmNMZW5ndGg7bj1QZS53cml0ZVVpbnQzMigxNip0LnNhbXBsZXMubGVuZ3RoK2krMTQ5KSwhdC5pc1ZpZGVvRW5jcnlwdGlvbiYmdC5pc0F1ZGlvRW5jcnlwdGlvbiYmKG49UGUud3JpdGVVaW50MzIoMTYqdC5zYW1wbGVzLmxlbmd0aCs5MikpfWVsc2V7dmFyIHM9MTIqdC5zYW1wbGVzLmxlbmd0aCsxMjQ7dC5pc0F1ZGlvRW5jcnlwdGlvbiYmKHM9MTIqdC5zYW1wbGVzLmxlbmd0aCs4KnQuYXVkaW9TZW5jLmxlbmd0aCsxNzcpLG49UGUud3JpdGVVaW50MzIocyl9cmV0dXJuIHQuc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbihlKXtyLndyaXRlKFBlLndyaXRlVWludDMyKGUuZHVyYXRpb24pKSxyLndyaXRlKFBlLndyaXRlVWludDMyKGUuc2l6ZSkpLHIud3JpdGUoUGUud3JpdGVVaW50MzIoZS5rZXlmcmFtZT8zMzU1NDQzMjo2NTUzNikpLHQuaXNWaWRlbyYmci53cml0ZShQZS53cml0ZVVpbnQzMihlLmN0cz9lLmN0czowKSl9KSksZS5ib3goZS50eXBlcy50cnVuLHRoaXMuZXh0ZW5zaW9uKDAsdC5mbGFncyksYSxuLHIuYnVmZmVyKX19LHtrZXk6InNlbmMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPW5ldyBQZSxhPXQuc2FtcGxlcy5sZW5ndGgsbj10LmlzVmlkZW8/MTY6OCxpPXQuaXNWaWRlbz8yOjAscz1bXSxvPTA7cmV0dXJuIHQuaXNWaWRlbz8ocz10LnZpZGVvU2VuYyxvPXQudmlkZW9TZW5jTGVuZ3RoKTpzPXQuYXVkaW9TZW5jLG89b3x8biphLHIud3JpdGUoUGUud3JpdGVVaW50MzIoMTYrbyksZS50eXBlcy5zZW5jLHRoaXMuZXh0ZW5zaW9uKDAsaSkpLHIud3JpdGUoUGUud3JpdGVVaW50MzIoYSkpLHMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTA7dDxlLkluaXRpYWxpemF0aW9uVmVjdG9yLmxlbmd0aDt0Kyspci53cml0ZShuZXcgVWludDhBcnJheShbZS5Jbml0aWFsaXphdGlvblZlY3Rvclt0XV0pKTtlLnN1YnNhbXBsZXMmJmUuc3Vic2FtcGxlcy5sZW5ndGgmJihyLndyaXRlKFBlLndyaXRlVWludDE2KGUuc3Vic2FtcGxlcy5sZW5ndGgpKSxlLnN1YnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ci53cml0ZShQZS53cml0ZVVpbnQxNihlLkJ5dGVzT2ZDbGVhckRhdGEpKSxyLndyaXRlKFBlLndyaXRlVWludDMyKGUuQnl0ZXNPZlByb3RlY3RlZERhdGEpKX0pKSl9KSksci5idWZmZXJ9fSx7a2V5OiJzYWlvIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj0xMip0LnNhbXBsZXMubGVuZ3RoKzE0MTshdC5pc1ZpZGVvJiZ0LmlzQXVkaW9FbmNyeXB0aW9uJiYocj0xNDkpO3ZhciBhPW5ldyBVaW50OEFycmF5KFsxLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCxyPj4yNCYyNTUscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSk7cmV0dXJuIGUuYm94KGUudHlwZXMuc2FpbyxhKX19LHtrZXk6InNhaXoiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQuc2FtcGxlcy5sZW5ndGgsYT1uZXcgVWludDhBcnJheShbMCwwLDAsMCwxNixyPj4yNCYyNTUscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSk7cmV0dXJuIGUuYm94KGUudHlwZXMuc2FpeixhKX19LHtrZXk6InNiZ3AiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IFVpbnQ4QXJyYXkoWzExNCwxMTEsMTA4LDEwOCwwLDAsMCwxLDAsMCwxLDI1LDAsMCwwLDFdKTtyZXR1cm4gZS5ib3goZS50eXBlcy5zYmdwLHRoaXMuZXh0ZW5zaW9uKDAsMCksdCl9fSx7a2V5OiJleHRlbnNpb24iLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIG5ldyBVaW50OEFycmF5KFtlLHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdF0pfX0se2tleToidGZoZCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMudGZoZCxuZXcgVWludDhBcnJheShbMCwwLDAsMCx0Pj4yNCx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnRdKSl9fSx7a2V5OiJ0ZmR0Iix2YWx1ZTpmdW5jdGlvbih0LHIpe3ZhciBhPU1hdGguZmxvb3Ioci8oSWUrMSkpLG49TWF0aC5mbG9vcihyJShJZSsxKSk7cmV0dXJuIHQudXNlRU1FJiYodC5pc1ZpZGVvRW5jcnlwdGlvbnx8dC5pc0F1ZGlvRW5jcnlwdGlvbik/ZS5ib3goZS50eXBlcy50ZmR0LG5ldyBVaW50OEFycmF5KFswLDAsMCwwLG4+PjI0LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbl0pKTplLmJveChlLnR5cGVzLnRmZHQsbmV3IFVpbnQ4QXJyYXkoWzEsMCwwLDAsYT4+MjQsYT4+MTYmMjU1LGE+PjgmMjU1LDI1NSZhLG4+PjI0LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbl0pKX19LHtrZXk6InRydW4iLHZhbHVlOmZ1bmN0aW9uKHQscil7dmFyIGE9dC5sZW5ndGgsbj0xMisxNiphO3IrPTgrbjt2YXIgaT1uZXcgVWludDhBcnJheShuKTtpLnNldChbMCwwLDE1LDEsYT4+PjI0JjI1NSxhPj4+MTYmMjU1LGE+Pj44JjI1NSwyNTUmYSxyPj4+MjQmMjU1LHI+Pj4xNiYyNTUscj4+PjgmMjU1LDI1NSZyXSwwKTtmb3IodmFyIHM9MDtzPGE7cysrKXt2YXIgbz10W3NdLHU9by5kdXJhdGlvbixjPW8uc2l6ZSxsPW8uZmxhZyxmPXZvaWQgMD09PWw/e306bCxkPW8uY3RzLGg9dm9pZCAwPT09ZD8wOmQ7aS5zZXQoW3U+Pj4yNCYyNTUsdT4+PjE2JjI1NSx1Pj4+OCYyNTUsMjU1JnUsYz4+PjI0JjI1NSxjPj4+MTYmMjU1LGM+Pj44JjI1NSwyNTUmYyxmLmlzTGVhZGluZzw8MnwobnVsbD09PWYuZGVwZW5kc09ufHx2b2lkIDA9PT1mLmRlcGVuZHNPbj8xOmYuZGVwZW5kc09uKSxmLmlzRGVwZW5kZWRPbjw8NnxmLmhhc1JlZHVuZGFuY3k8PDR8Zi5wYWRkaW5nVmFsdWU8PDF8KG51bGw9PT1mLmlzTm9uU3luY1NhbXBsZXx8dm9pZCAwPT09Zi5pc05vblN5bmNTYW1wbGU/MTpmLmlzTm9uU3luY1NhbXBsZSksNjE0NDAmZi5kZWdyYWRhdGlvblByaW9yaXR5LDE1JmYuZGVncmFkYXRpb25Qcmlvcml0eSxoPj4+MjQmMjU1LGg+Pj4xNiYyNTUsaD4+PjgmMjU1LDI1NSZoXSwxMisxNipzKX1yZXR1cm4gZS5ib3goZS50eXBlcy50cnVuLGkpfX0se2tleToibW9vdk1QNCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94LmFwcGx5KGUsW2UudHlwZXMubW9vdixlLm12aGQodFswXS5kdXJhdGlvbix0WzBdLnRpbWVzY2FsZSldLmNvbmNhdCh5KHQubWFwKChmdW5jdGlvbih0KXtyZXR1cm4gZS50cmFja01QNCh0KX0pKSkpKX19LHtrZXk6InRyYWNrTVA0Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy50cmFrLGUudGtoZCh0LmlkLHQuZHVyYXRpb24sdC53aWR0aCx0LmhlaWdodCksZS5tZGlhTVA0KHQpKX19LHtrZXk6Im1kaWFNUDQiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLm1kaWEsZS5tZGhkKHQuZHVyYXRpb24sdC50aW1lc2NhbGUpLGUuaGRscih0LnR5cGUpLGUubWluZk1QNCh0KSl9fSx7a2V5OiJtaW5mTVA0Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy5taW5mLHQudHlwZT09PWI/ZS5WTUhEOmUuU01IRCxlLkRJTkYsZS5zdGJsTVA0KHQpKX19LHtrZXk6InN0YmxNUDQiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQuZXh0LGE9W2Uuc3RzZCh0KSxlLnN0dHMoci5zdHRzKSxlLnN0c2Moci5zdHNjKSxlLnN0c3ooci5zdHN6KSxlLnN0Y28oci5zdGNvKV07cmV0dXJuIHIuc3Rzcy5sZW5ndGgmJmEucHVzaChlLnN0c3Moci5zdHNzKSksci5jdHRzLmxlbmd0aCYmYS5wdXNoKGUuY3R0cyhyLmN0dHMpKSxlLmJveC5hcHBseShlLFtlLnR5cGVzLnN0YmxdLmNvbmNhdChhKSl9fSx7a2V5OiJzdHRzIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10Lmxlbmd0aCxhPW5ldyBVaW50OEFycmF5KDgqciksbj0wO3JldHVybiB0LmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PWUudmFsdWUscj1lLmNvdW50O2Euc2V0KFtyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnIsdD4+MjQsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0XSxuKSxuKz04fSkpLGUuYm94KGUudHlwZXMuc3R0cyxKKG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHI+PjI0LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcl0pLGEpKX19LHtrZXk6InN0c2MiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQubGVuZ3RoLGE9bmV3IFVpbnQ4QXJyYXkoMTIqciksbj0wO3JldHVybiB0LmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PWUuZmlyc3RDaHVuayxyPWUuc2FtcGxlc1BlckNodW5rLGk9ZS5zYW1wbGVEZXNjSW5kZXg7YS5zZXQoW3Q+PjI0LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdCxyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnIsaT4+MjQsaT4+MTYmMjU1LGk+PjgmMjU1LDI1NSZpXSxuKSxuKz0xMn0pKSxlLmJveChlLnR5cGVzLnN0c2MsSihuZXcgVWludDhBcnJheShbMCwwLDAsMCxyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnJdKSxhKSl9fSx7a2V5OiJzdHN6Iix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10Lmxlbmd0aCxhPW5ldyBVaW50OEFycmF5KDQqciksbj0wO3JldHVybiB0LmZvckVhY2goKGZ1bmN0aW9uKGUpe2Euc2V0KFtlPj4yNCxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmVdLG4pLG4rPTR9KSksZS5ib3goZS50eXBlcy5zdHN6LEoobmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCxyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnJdKSxhKSl9fSx7a2V5OiJzdGNvIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10Lmxlbmd0aCxhPW5ldyBVaW50OEFycmF5KDQqciksbj0wO3JldHVybiB0LmZvckVhY2goKGZ1bmN0aW9uKGUpe2Euc2V0KFtlPj4yNCxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmVdLG4pLG4rPTR9KSksZS5ib3goZS50eXBlcy5zdGNvLEoobmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAscj4+MjQscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSksYSkpfX0se2tleToic3RzcyIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9dC5sZW5ndGgsYT1uZXcgVWludDhBcnJheSg0KnIpLG49MDtyZXR1cm4gdC5mb3JFYWNoKChmdW5jdGlvbihlKXthLnNldChbZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlXSxuKSxuKz00fSkpLGUuYm94KGUudHlwZXMuc3RzcyxKKG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHI+PjI0LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcl0pLGEpKX19LHtrZXk6ImN0dHMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQubGVuZ3RoLGE9bmV3IFVpbnQ4QXJyYXkoOCpyKSxuPTA7cmV0dXJuIHQuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9ZS52YWx1ZSxyPWUuY291bnQ7YS5zZXQoW3I+PjI0LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcix0Pj4yNCx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnRdLG4pLG4rPTh9KSksZS5ib3goZS50eXBlcy5jdHRzLEoobmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAscj4+MjQscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSksYSkpfX0se2tleToic3R5cCIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gZS5ib3goZS50eXBlcy5zdHlwLG5ldyBVaW50OEFycmF5KFsxMDksMTE1LDEwMCwxMDQsMCwwLDAsMCwxMDksMTE1LDEwMCwxMDQsMTA5LDExNSwxMDUsMTIwXSkpfX0se2tleToic2lkeCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9dC50aW1lc2NhbGUsYT10LnNhbXBsZXNbMF0uZHVyYXRpb24sbj1hKnQuc2FtcGxlcy5sZW5ndGgsaT10LnNhbXBsZXNbMF0uc2FtcGxlT2Zmc2V0KmEscz04O3Quc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbihlKXtzKz1lLnNpemV9KSk7dmFyIG89MDtpZih0LmlzVmlkZW8pe3ZhciB1LGM9MDt0LnZpZGVvU2VuYyYmKHU9dC52aWRlb1NlbmMpLHQuaXNWaWRlbyYmdS5mb3JFYWNoKChmdW5jdGlvbihlKXtjKz04LGUuc3Vic2FtcGxlcyYmZS5zdWJzYW1wbGVzLmxlbmd0aCYmKGMrPTIsYys9NiplLnN1YnNhbXBsZXMubGVuZ3RoKX0pKSx0LnZpZGVvU2VuY0xlbmd0aD1jLG89cysxNDErMTYqdC5zYW1wbGVzLmxlbmd0aCtjLHQudXNlRU1FJiZ0LmlzQXVkaW9FbmNyeXB0aW9uJiYhdC5pc1ZpZGVvRW5jcnlwdGlvbiYmKG89cysxNip0LnNhbXBsZXMubGVuZ3RoKzg0KX1lbHNlIG89cysxMTYrMTIqdC5zYW1wbGVzLmxlbmd0aCx0LnVzZUVNRSYmdC5pc0F1ZGlvRW5jcnlwdGlvbiYmKG89cysxNjkrMTIqdC5zYW1wbGVzLmxlbmd0aCs4KnQuYXVkaW9TZW5jLmxlbmd0aCk7dmFyIGw9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMjU1JnQuaWQscj4+MjQmMjU1LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcixpPj4yNCYyNTUsaT4+MTYmMjU1LGk+PjgmMjU1LDI1NSZpLDAsMCwwLDAsMCwwLDAsMSwwLG8+PjE2JjI1NSxvPj44JjI1NSwyNTUmbyxuPj4yNCYyNTUsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuLDE0NCwwLDAsMF0pO3JldHVybiBlLmJveChlLnR5cGVzLnNpZHgsbCl9fSx7a2V5OiJtZGF0Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy5tZGF0LHQpfX1dKSxlfSgpO2koTWUsInR5cGVzIixbIk9wdXMiLCJkT3BzIiwiYXYwMSIsImF2MUMiLCJhdmMxIiwiYXZjQyIsImh2YzEiLCJodmNDIiwiZGluZiIsImRyZWYiLCJlc2RzIiwiZnR5cCIsImhkbHIiLCJtZGF0IiwibWRoZCIsIm1kaWEiLCJtZmhkIiwibWluZiIsIm1vb2YiLCJtb292IiwibXA0YSIsIm12ZXgiLCJtdmhkIiwicGFzcCIsInN0YmwiLCJzdGNvIiwic3RzYyIsInN0c2QiLCJzdHN6Iiwic3R0cyIsInRmZHQiLCJ0ZmhkIiwidHJhZiIsInRyYWsiLCJ0cmV4IiwidGtoZCIsInZtaGQiLCJzbWhkIiwiY3R0cyIsInN0c3MiLCJzdHlwIiwicHNzaCIsInNpZHgiLCJzYmdwIiwic2FpeiIsInNhaW8iLCJzZW5jIiwidHJ1biIsImVuY3YiLCJlbmNhIiwic2luZiIsImJ0cnQiLCJmcm1hIiwidGVuYyIsInNjaG0iLCJzY2hpIiwibWVoZCIsImZpZWwiLCJzZHRwIl0ucmVkdWNlKChmdW5jdGlvbihlLHQpe3JldHVybiBlW3RdPVt0LmNoYXJDb2RlQXQoMCksdC5jaGFyQ29kZUF0KDEpLHQuY2hhckNvZGVBdCgyKSx0LmNoYXJDb2RlQXQoMyldLGV9KSxPYmplY3QuY3JlYXRlKG51bGwpKSksaShNZSwiSERMUl9UWVBFUyIse3ZpZGVvOm5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMTE4LDEwNSwxMDAsMTAxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDg2LDEwNSwxMDAsMTAxLDExMSw3Miw5NywxMTAsMTAwLDEwOCwxMDEsMTE0LDBdKSxhdWRpbzpuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDExNSwxMTEsMTE3LDExMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCw4MywxMTEsMTE3LDExMCwxMDAsNzIsOTcsMTEwLDEwMCwxMDgsMTAxLDExNCwwXSl9KSxpKE1lLCJGVFlQQVZDMSIsTWUuYm94KE1lLnR5cGVzLmZ0eXAsbmV3IFVpbnQ4QXJyYXkoWzEwNSwxMTUsMTExLDEwOSwwLDAsMCwxLDEwNSwxMTUsMTExLDEwOSw5NywxMTgsOTksNDldKSkpLGkoTWUsIkZUWVBIRVYxIixNZS5ib3goTWUudHlwZXMuZnR5cCxuZXcgVWludDhBcnJheShbMTA1LDExNSwxMTEsMTA5LDAsMCwwLDEsMTA1LDExNSwxMTEsMTA5LDEwNCwxMDEsMTE4LDQ5XSkpKSxpKE1lLCJESU5GIixNZS5ib3goTWUudHlwZXMuZGluZixNZS5ib3goTWUudHlwZXMuZHJlZixuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDEyLDExNywxMTQsMTA4LDMyLDAsMCwwLDFdKSkpKSxpKE1lLCJWTUhEIixNZS5ib3goTWUudHlwZXMudm1oZCxuZXcgVWludDhBcnJheShbMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDBdKSkpLGkoTWUsIlNNSEQiLE1lLmJveChNZS50eXBlcy5zbWhkLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDBdKSkpLGkoTWUsIlN0YmxUYWJsZSIsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMF0pKSxpKE1lLCJTVFRTIixNZS5ib3goTWUudHlwZXMuc3R0cyxNZS5TdGJsVGFibGUpKSxpKE1lLCJTVFNDIixNZS5ib3goTWUudHlwZXMuc3RzYyxNZS5TdGJsVGFibGUpKSxpKE1lLCJTVFNaIixNZS5ib3goTWUudHlwZXMuc3RzeixuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDBdKSkpLGkoTWUsIlNUQ08iLE1lLmJveChNZS50eXBlcy5zdGNvLE1lLlN0YmxUYWJsZSkpO3ZhciB6ZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUodCxhKXtyKHRoaXMsZSksdGhpcy5uYW1lPXR8fCIiLHRoaXMuX3ByZWZpeD0iWyIuY29uY2F0KHRoaXMubmFtZSwiXSIpLGUuZGlzYWJsZWQ9YX1yZXR1cm4gbihlLFt7a2V5OiJkZWJ1ZyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdDtpZighZS5kaXNhYmxlZCl7Zm9yKHZhciByPWFyZ3VtZW50cy5sZW5ndGgsYT1uZXcgQXJyYXkociksbj0wO248cjtuKyspYVtuXT1hcmd1bWVudHNbbl07KHQ9Y29uc29sZSkuZGVidWcuYXBwbHkodCxbdGhpcy5fcHJlZml4XS5jb25jYXQoYSkpfX19LHtrZXk6ImxvZyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdDtpZighZS5kaXNhYmxlZCl7Zm9yKHZhciByPWFyZ3VtZW50cy5sZW5ndGgsYT1uZXcgQXJyYXkociksbj0wO248cjtuKyspYVtuXT1hcmd1bWVudHNbbl07KHQ9Y29uc29sZSkubG9nLmFwcGx5KHQsW3RoaXMuX3ByZWZpeF0uY29uY2F0KGEpKX19fSx7a2V5OiJ3YXJuIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0O2lmKCFlLmRpc2FibGVkKXtmb3IodmFyIHI9YXJndW1lbnRzLmxlbmd0aCxhPW5ldyBBcnJheShyKSxuPTA7bjxyO24rKylhW25dPWFyZ3VtZW50c1tuXTsodD1jb25zb2xlKS53YXJuLmFwcGx5KHQsW3RoaXMuX3ByZWZpeF0uY29uY2F0KGEpKX19fSx7a2V5OiJlcnJvciIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdDtpZighZS5kaXNhYmxlZCl7Zm9yKHZhciByPWFyZ3VtZW50cy5sZW5ndGgsYT1uZXcgQXJyYXkociksbj0wO248cjtuKyspYVtuXT1hcmd1bWVudHNbbl07KHQ9Y29uc29sZSkuZXJyb3IuYXBwbHkodCxbdGhpcy5fcHJlZml4XS5jb25jYXQoYSkpfX19LHtrZXk6InRhYmxlIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0O2UuZGlzYWJsZWR8fChjb25zb2xlLmdyb3VwKHRoaXMuX3ByZWZpeCksKHQ9Y29uc29sZSkudGFibGUuYXBwbHkodCxhcmd1bWVudHMpLGNvbnNvbGUuZ3JvdXBFbmQoKSl9fV0sW3trZXk6ImVuYWJsZSIsdmFsdWU6ZnVuY3Rpb24oKXtlLmRpc2FibGVkPSExfX0se2tleToiZGlzYWJsZSIsdmFsdWU6ZnVuY3Rpb24oKXtlLmRpc2FibGVkPSEwfX1dKSxlfSgpO2koemUsImRpc2FibGVkIiwhMCk7Zm9yKHZhciBPZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUodCxhLG4pe3IodGhpcyxlKSx0aGlzLnZpZGVvVHJhY2s9dCx0aGlzLmF1ZGlvVHJhY2s9YTt2YXIgaT0vQ2hyb21lXC8oW14uXSspLy5leGVjKG5hdmlnYXRvci51c2VyQWdlbnQpO3RoaXMuZm9yY2VGaXJzdElEUj1pJiZOdW1iZXIoaVsxXSk8NTAsdGhpcy5sb2c9bmV3IHplKCJGTVA0UmVtdXhlciIsIW58fCFuLm9wZW5Mb2d8fCFuLm9wZW5Mb2cpfXJldHVybiBuKGUsW3trZXk6InJlbXV4Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlLHQscixhLG4saT1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXSYmYXJndW1lbnRzWzBdLHM9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOnt9LG89dGhpcy52aWRlb1RyYWNrLHU9dGhpcy5hdWRpb1RyYWNrLGM9by5leGlzdCgpLGw9dS5leGlzdCgpLGY9W107cmV0dXJuIGkmJihzJiZzLmluaXRNZXJnZT8oYyYmZi5wdXNoKHRoaXMudmlkZW9UcmFjayksbCYmZi5wdXNoKHRoaXMuYXVkaW9UcmFjaykscj1NZS5pbml0U2VnbWVudChmKSk6KGMmJihlPU1lLmluaXRTZWdtZW50KFt0aGlzLnZpZGVvVHJhY2tdKSksbCYmKHQ9TWUuaW5pdFNlZ21lbnQoW3RoaXMuYXVkaW9UcmFja10pKSkpLGMmJm8uaGFzU2FtcGxlKCkmJihhPXRoaXMuX3JlbXV4VmlkZW8oKSksbCYmdS5oYXNTYW1wbGUoKSYmKG49dGhpcy5fcmVtdXhBdWRpbygpKSxvLnNhbXBsZXM9W10sdS5zYW1wbGVzPVtdLHtpbml0U2VnbWVudDpyLHZpZGVvSW5pdFNlZ21lbnQ6ZSxhdWRpb0luaXRTZWdtZW50OnQsdmlkZW9TZWdtZW50OmEsYXVkaW9TZWdtZW50Om59fX0se2tleToiX3JlbXV4VmlkZW8iLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy52aWRlb1RyYWNrO3RoaXMuZm9yY2VGaXJzdElEUiYmKGUuc2FtcGxlc1swXS5mbGFnPXtkZXBlbmRzT246Mixpc05vblN5bmNTYW1wbGU6MH0pO3ZhciB0PWUuc2FtcGxlcyxyPS9hdjAxLy50ZXN0KGUuY29kZWMpLGE9MDtyP3QuZm9yRWFjaCgoZnVuY3Rpb24oZSl7YSs9ZS5kYXRhLmJ5dGVMZW5ndGh9KSk6dC5mb3JFYWNoKChmdW5jdGlvbihlKXthKz1lLnVuaXRzLnJlZHVjZSgoZnVuY3Rpb24oZSx0KXtyZXR1cm4gZSt0LmJ5dGVMZW5ndGh9KSwwKSxhKz00KmUudW5pdHMubGVuZ3RofSkpO3ZhciBuPW5ldyBVaW50OEFycmF5KGEpO2lmKHIpZm9yKHZhciBpLHM9MCxvPXQubGVuZ3RoLHU9MDtzPG87cysrKWk9dFtzXSxuLnNldChpLmRhdGEsdSksaS5zaXplPWkuZGF0YS5ieXRlTGVuZ3RoLHUrPWkuc2l6ZTtlbHNlIGZvcih2YXIgYyxsPW5ldyBEYXRhVmlldyhuLmJ1ZmZlciksZj1mdW5jdGlvbihlLHIpe3I9dFtkXTt2YXIgYT0wO3IudW5pdHMuZm9yRWFjaCgoZnVuY3Rpb24odCl7bC5zZXRVaW50MzIoZSx0LmJ5dGVMZW5ndGgpLGUrPTQsbi5zZXQodCxlKSxlKz10LmJ5dGVMZW5ndGgsYSs9NCt0LmJ5dGVMZW5ndGh9KSksci5zaXplPWEscD1lLGM9cn0sZD0wLGg9dC5sZW5ndGgscD0wO2Q8aDtkKyspZihwLGMpO3ZhciB2PU1lLm1kYXQobik7cmV0dXJuIEooTWUubW9vZihbZV0pLHYpfX0se2tleToiX3JlbXV4QXVkaW8iLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5hdWRpb1RyYWNrLHQ9bmV3IFVpbnQ4QXJyYXkoZS5zYW1wbGVzLnJlZHVjZSgoZnVuY3Rpb24oZSx0KXtyZXR1cm4gZSt0LnNpemV9KSwwKSk7ZS5zYW1wbGVzLnJlZHVjZSgoZnVuY3Rpb24oZSxyKXtyZXR1cm4gdC5zZXQoci5kYXRhLGUpLGUrci5zaXplfSksMCk7dmFyIHI9TWUubWRhdCh0KTtyZXR1cm4gSihNZS5tb29mKFtlXSkscil9fSx7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnZpZGVvVHJhY2sucmVzZXQoKSx0aGlzLmF1ZGlvVHJhY2sucmVzZXQoKX19XSksZX0oKSxSZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSl9cmV0dXJuIG4oZSxbe2tleToibWl4SW4iLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBPYmplY3QuYXNzaWduKHRoaXMsZSl9fSx7a2V5OiJjbG9uZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1uZXcgdGhpcy5jb25zdHJ1Y3RvcjtyZXR1cm4gT2JqZWN0LmFzc2lnbihlLHRoaXMpLGV9fV0sW3trZXk6ImNyZWF0ZSIsdmFsdWU6ZnVuY3Rpb24oKXtmb3IodmFyIGU9YXJndW1lbnRzLmxlbmd0aCx0PW5ldyBBcnJheShlKSxyPTA7cjxlO3IrKyl0W3JdPWFyZ3VtZW50c1tyXTtyZXR1cm4gbCh0aGlzLHQpfX1dKSxlfSgpLExlPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXt2YXIgZSxuPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTpbXSxpPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTo0Km4ubGVuZ3RoO3IodGhpcyxhKSxlPXQuY2FsbCh0aGlzKTt2YXIgcz1uO2lmKHMgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmKHM9bmV3IFVpbnQ4QXJyYXkocykpLChzIGluc3RhbmNlb2YgSW50OEFycmF5fHxzIGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXl8fHMgaW5zdGFuY2VvZiBJbnQxNkFycmF5fHxzIGluc3RhbmNlb2YgVWludDE2QXJyYXl8fHMgaW5zdGFuY2VvZiBJbnQzMkFycmF5fHxzIGluc3RhbmNlb2YgVWludDMyQXJyYXl8fHMgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXl8fHMgaW5zdGFuY2VvZiBGbG9hdDY0QXJyYXkpJiYocz1uZXcgVWludDhBcnJheShzLmJ1ZmZlcixzLmJ5dGVPZmZzZXQscy5ieXRlTGVuZ3RoKSkscyBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpe2Zvcih2YXIgbz1zLmJ5dGVMZW5ndGgsdT1bXSxjPTA7YzxvO2MrPTEpdVtjPj4+Ml18PXNbY108PDI0LWMlNCo4O2Uud29yZHM9dSxlLnNpZ0J5dGVzPW99ZWxzZSBlLndvcmRzPW4sZS5zaWdCeXRlcz1pO3JldHVybiBlfXJldHVybiBuKGEsW3trZXk6InRvU3RyaW5nIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTpWZTtyZXR1cm4gZS5zdHJpbmdpZnkodGhpcyl9fSx7a2V5OiJjb25jYXQiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMud29yZHMscj1lLndvcmRzLGE9dGhpcy5zaWdCeXRlcyxuPWUuc2lnQnl0ZXM7aWYodGhpcy5jbGFtcCgpLGElNClmb3IodmFyIGk9MDtpPG47aSs9MSl7dmFyIHM9cltpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7dFthK2k+Pj4yXXw9czw8MjQtKGEraSklNCo4fWVsc2UgZm9yKHZhciBvPTA7bzxuO28rPTQpdFthK28+Pj4yXT1yW28+Pj4yXTtyZXR1cm4gdGhpcy5zaWdCeXRlcys9bix0aGlzfX0se2tleToiY2xhbXAiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy53b3Jkcyx0PXRoaXMuc2lnQnl0ZXM7ZVt0Pj4+Ml0mPTQyOTQ5NjcyOTU8PDMyLXQlNCo4LGUubGVuZ3RoPU1hdGguY2VpbCh0LzQpfX0se2tleToiY2xvbmUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9cChvKGEucHJvdG90eXBlKSwiY2xvbmUiLHRoaXMpLmNhbGwodGhpcyk7cmV0dXJuIGUud29yZHM9dGhpcy53b3Jkcy5zbGljZSgwKSxlfX1dLFt7a2V5OiJyYW5kb20iLHZhbHVlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdCxyPVtdLG49ZnVuY3Rpb24oZSl7dmFyIHQ9ZSxyPTk4NzY1NDMyMSxhPTQyOTQ5NjcyOTU7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGU9KChyPTM2OTY5Kig2NTUzNSZyKSsocj4+MTYpJmEpPDwxNikrKHQ9MThlMyooNjU1MzUmdCkrKHQ+PjE2KSZhKSZhO3JldHVybiBlLz00Mjk0OTY3Mjk2LChlKz0uNSkqKE1hdGgucmFuZG9tKCk+LjU/MTotMSl9fSxpPTA7aTxlO2krPTQpe3ZhciBzPW4oNDI5NDk2NzI5NioodHx8TWF0aC5yYW5kb20oKSkpO3Q9OTg3NjU0MDcxKnMoKSxyLnB1c2goNDI5NDk2NzI5NipzKCl8MCl9cmV0dXJuIG5ldyBhKHIsZSl9fV0pLGF9KFJlKSxWZT17c3RyaW5naWZ5OmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLndvcmRzLHI9ZS5zaWdCeXRlcyxhPVtdLG49MDtuPHI7bis9MSl7dmFyIGk9dFtuPj4+Ml0+Pj4yNC1uJTQqOCYyNTU7YS5wdXNoKChpPj4+NCkudG9TdHJpbmcoMTYpKSxhLnB1c2goKDE1JmkpLnRvU3RyaW5nKDE2KSl9cmV0dXJuIGEuam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmxlbmd0aCxyPVtdLGE9MDthPHQ7YSs9MilyW2E+Pj4zXXw9cGFyc2VJbnQoZS5zdWJzdHIoYSwyKSwxNik8PDI0LWElOCo0O3JldHVybiBuZXcgTGUocix0LzIpfX0sRmU9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWUubGVuZ3RoLHI9W10sYT0wO2E8dDthKz0xKXJbYT4+PjJdfD0oMjU1JmUuY2hhckNvZGVBdChhKSk8PDI0LWElNCo4O3JldHVybiBuZXcgTGUocix0KX0sTmU9ZnVuY3Rpb24oZSl7cmV0dXJuIEZlKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChlKSkpfSxqZT1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7dmFyIGU7cmV0dXJuIHIodGhpcyxhKSwoZT10LmNhbGwodGhpcykpLl9taW5CdWZmZXJTaXplPTAsZX1yZXR1cm4gbihhLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhPW5ldyBMZSx0aGlzLl9uRGF0YUJ5dGVzPTB9fSx7a2V5OiJfYXBwZW5kIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD1lOyJzdHJpbmciPT10eXBlb2YgdCYmKHQ9TmUodCkpLHRoaXMuX2RhdGEuY29uY2F0KHQpLHRoaXMuX25EYXRhQnl0ZXMrPXQuc2lnQnl0ZXN9fSx7a2V5OiJfcHJvY2VzcyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQscj10aGlzLl9kYXRhLGE9dGhpcy5ibG9ja1NpemUsbj1yLndvcmRzLGk9ci5zaWdCeXRlcyxzPWkvKDQqYSksbz0ocz1lP01hdGguY2VpbChzKTpNYXRoLm1heCgoMHxzKS10aGlzLl9taW5CdWZmZXJTaXplLDApKSphLHU9TWF0aC5taW4oNCpvLGkpO2lmKG8pe2Zvcih2YXIgYz0wO2M8bztjKz1hKXRoaXMuX2RvUHJvY2Vzc0Jsb2NrKG4sYyk7dD1uLnNwbGljZSgwLG8pLHIuc2lnQnl0ZXMtPXV9cmV0dXJuIG5ldyBMZSh0LHUpfX0se2tleToiY2xvbmUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9cChvKGEucHJvdG90eXBlKSwiY2xvbmUiLHRoaXMpLmNhbGwodGhpcyk7cmV0dXJuIGUuX2RhdGE9dGhpcy5fZGF0YS5jbG9uZSgpLGV9fV0pLGF9KFJlKSxHZT1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKGUpe3ZhciBuO3JldHVybiByKHRoaXMsYSksKG49dC5jYWxsKHRoaXMpKS5ibG9ja1NpemU9MTYsbi5jZmc9T2JqZWN0LmFzc2lnbihuZXcgUmUsZSksbi5yZXNldCgpLG59cmV0dXJuIG4oYSxbe2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7cChvKGEucHJvdG90eXBlKSwicmVzZXQiLHRoaXMpLmNhbGwodGhpcyksdGhpcy5fZG9SZXNldCgpfX0se2tleToidXBkYXRlIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5fYXBwZW5kKGUpLHRoaXMuX3Byb2Nlc3MoKSx0aGlzfX0se2tleToiZmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBlJiZ0aGlzLl9hcHBlbmQoZSksdGhpcy5fZG9GaW5hbGl6ZSgpfX1dLFt7a2V5OiJfY3JlYXRlSGVscGVyIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCxyKXtyZXR1cm4gbmV3IGUocikuZmluYWxpemUodCl9fX0se2tleToiX2NyZWF0ZUhtYWNIZWxwZXIiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0LHIpe3JldHVybiBuZXcgSGUoZSxyKS5maW5hbGl6ZSh0KX19fV0pLGF9KGplKSxIZT1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKGUsbil7dmFyIGk7cih0aGlzLGEpLGk9dC5jYWxsKHRoaXMpO3ZhciBzPW5ldyBlO2kuX2hhc2hlcj1zO3ZhciBvPW47InN0cmluZyI9PXR5cGVvZiBvJiYobz1OZShvKSk7dmFyIHU9cy5ibG9ja1NpemUsYz00KnU7by5zaWdCeXRlcz5jJiYobz1zLmZpbmFsaXplKG4pKSxvLmNsYW1wKCk7dmFyIGw9by5jbG9uZSgpO2kuX29LZXk9bDt2YXIgZj1vLmNsb25lKCk7aS5faUtleT1mO2Zvcih2YXIgZD1sLndvcmRzLGg9Zi53b3JkcyxwPTA7cDx1O3ArPTEpZFtwXV49MTU0OTU1NjgyOCxoW3BdXj05MDk1MjI0ODY7cmV0dXJuIGwuc2lnQnl0ZXM9YyxmLnNpZ0J5dGVzPWMsaS5yZXNldCgpLGl9cmV0dXJuIG4oYSxbe2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5faGFzaGVyO2UucmVzZXQoKSxlLnVwZGF0ZSh0aGlzLl9pS2V5KX19LHtrZXk6InVwZGF0ZSIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuX2hhc2hlci51cGRhdGUoZSksdGhpc319LHtrZXk6ImZpbmFsaXplIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLl9oYXNoZXIscj10LmZpbmFsaXplKGUpO3JldHVybiB0LnJlc2V0KCksdC5maW5hbGl6ZSh0aGlzLl9vS2V5LmNsb25lKCkuY29uY2F0KHIpKX19XSksYX0oUmUpLEtlPXtzdHJpbmdpZnk6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS53b3JkcyxyPWUuc2lnQnl0ZXMsYT10aGlzLl9tYXA7ZS5jbGFtcCgpO2Zvcih2YXIgbj1bXSxpPTA7aTxyO2krPTMpZm9yKHZhciBzPSh0W2k+Pj4yXT4+PjI0LWklNCo4JjI1NSk8PDE2fCh0W2krMT4+PjJdPj4+MjQtKGkrMSklNCo4JjI1NSk8PDh8dFtpKzI+Pj4yXT4+PjI0LShpKzIpJTQqOCYyNTUsbz0wO288NCYmaSsuNzUqbzxyO28rPTEpbi5wdXNoKGEuY2hhckF0KHM+Pj42KigzLW8pJjYzKSk7dmFyIHU9YS5jaGFyQXQoNjQpO2lmKHUpZm9yKDtuLmxlbmd0aCU0OyluLnB1c2godSk7cmV0dXJuIG4uam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKGUpe3ZhciB0PWUubGVuZ3RoLHI9dGhpcy5fbWFwLGE9dGhpcy5fcmV2ZXJzZU1hcDtpZighYSl7dGhpcy5fcmV2ZXJzZU1hcD1bXSxhPXRoaXMuX3JldmVyc2VNYXA7Zm9yKHZhciBuPTA7bjxyLmxlbmd0aDtuKz0xKWFbci5jaGFyQ29kZUF0KG4pXT1ufXZhciBpPXIuY2hhckF0KDY0KTtpZihpKXt2YXIgcz1lLmluZGV4T2YoaSk7LTEhPT1zJiYodD1zKX1yZXR1cm4gZnVuY3Rpb24oZSx0LHIpe2Zvcih2YXIgYT1bXSxuPTAsaT0wO2k8dDtpKz0xKWlmKGklNCl7dmFyIHM9cltlLmNoYXJDb2RlQXQoaS0xKV08PGklNCoyfHJbZS5jaGFyQ29kZUF0KGkpXT4+PjYtaSU0KjI7YVtuPj4+Ml18PXM8PDI0LW4lNCo4LG4rPTF9cmV0dXJuIExlLmNyZWF0ZShhLG4pfShlLHQsYSl9LF9tYXA6IkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89In0scWU9W10sV2U9MDtXZTw2NDtXZSs9MSlxZVtXZV09NDI5NDk2NzI5NipNYXRoLmFicyhNYXRoLnNpbihXZSsxKSl8MDt2YXIgWGU9ZnVuY3Rpb24oZSx0LHIsYSxuLGkscyl7dmFyIG89ZSsodCZyfH50JmEpK24rcztyZXR1cm4obzw8aXxvPj4+MzItaSkrdH0sWWU9ZnVuY3Rpb24oZSx0LHIsYSxuLGkscyl7dmFyIG89ZSsodCZhfHImfmEpK24rcztyZXR1cm4obzw8aXxvPj4+MzItaSkrdH0sWmU9ZnVuY3Rpb24oZSx0LHIsYSxuLGkscyl7dmFyIG89ZSsodF5yXmEpK24rcztyZXR1cm4obzw8aXxvPj4+MzItaSkrdH0sUWU9ZnVuY3Rpb24oZSx0LHIsYSxuLGkscyl7dmFyIG89ZSsocl4odHx+YSkpK24rcztyZXR1cm4obzw8aXxvPj4+MzItaSkrdH0sSmU9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiByKHRoaXMsYSksdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIG4oYSxbe2tleToiX2RvUmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5faGFzaD1uZXcgTGUoWzE3MzI1ODQxOTMsNDAyMzIzMzQxNywyNTYyMzgzMTAyLDI3MTczMzg3OF0pfX0se2tleToiX2RvUHJvY2Vzc0Jsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj1lLGE9MDthPDE2O2ErPTEpe3ZhciBuPXQrYSxpPWVbbl07cltuXT0xNjcxMTkzNSYoaTw8OHxpPj4+MjQpfDQyNzgyNTUzNjAmKGk8PDI0fGk+Pj44KX12YXIgcz10aGlzLl9oYXNoLndvcmRzLG89clt0KzBdLHU9clt0KzFdLGM9clt0KzJdLGw9clt0KzNdLGY9clt0KzRdLGQ9clt0KzVdLGg9clt0KzZdLHA9clt0KzddLHY9clt0KzhdLHk9clt0KzldLG09clt0KzEwXSxnPXJbdCsxMV0saz1yW3QrMTJdLGI9clt0KzEzXSxfPXJbdCsxNF0sdz1yW3QrMTVdLHg9c1swXSxTPXNbMV0sRD1zWzJdLEE9c1szXTt4PVhlKHgsUyxELEEsbyw3LHFlWzBdKSxBPVhlKEEseCxTLEQsdSwxMixxZVsxXSksRD1YZShELEEseCxTLGMsMTcscWVbMl0pLFM9WGUoUyxELEEseCxsLDIyLHFlWzNdKSx4PVhlKHgsUyxELEEsZiw3LHFlWzRdKSxBPVhlKEEseCxTLEQsZCwxMixxZVs1XSksRD1YZShELEEseCxTLGgsMTcscWVbNl0pLFM9WGUoUyxELEEseCxwLDIyLHFlWzddKSx4PVhlKHgsUyxELEEsdiw3LHFlWzhdKSxBPVhlKEEseCxTLEQseSwxMixxZVs5XSksRD1YZShELEEseCxTLG0sMTcscWVbMTBdKSxTPVhlKFMsRCxBLHgsZywyMixxZVsxMV0pLHg9WGUoeCxTLEQsQSxrLDcscWVbMTJdKSxBPVhlKEEseCxTLEQsYiwxMixxZVsxM10pLEQ9WGUoRCxBLHgsUyxfLDE3LHFlWzE0XSksUz1YZShTLEQsQSx4LHcsMjIscWVbMTVdKSx4PVllKHgsUyxELEEsdSw1LHFlWzE2XSksQT1ZZShBLHgsUyxELGgsOSxxZVsxN10pLEQ9WWUoRCxBLHgsUyxnLDE0LHFlWzE4XSksUz1ZZShTLEQsQSx4LG8sMjAscWVbMTldKSx4PVllKHgsUyxELEEsZCw1LHFlWzIwXSksQT1ZZShBLHgsUyxELG0sOSxxZVsyMV0pLEQ9WWUoRCxBLHgsUyx3LDE0LHFlWzIyXSksUz1ZZShTLEQsQSx4LGYsMjAscWVbMjNdKSx4PVllKHgsUyxELEEseSw1LHFlWzI0XSksQT1ZZShBLHgsUyxELF8sOSxxZVsyNV0pLEQ9WWUoRCxBLHgsUyxsLDE0LHFlWzI2XSksUz1ZZShTLEQsQSx4LHYsMjAscWVbMjddKSx4PVllKHgsUyxELEEsYiw1LHFlWzI4XSksQT1ZZShBLHgsUyxELGMsOSxxZVsyOV0pLEQ9WWUoRCxBLHgsUyxwLDE0LHFlWzMwXSksUz1ZZShTLEQsQSx4LGssMjAscWVbMzFdKSx4PVplKHgsUyxELEEsZCw0LHFlWzMyXSksQT1aZShBLHgsUyxELHYsMTEscWVbMzNdKSxEPVplKEQsQSx4LFMsZywxNixxZVszNF0pLFM9WmUoUyxELEEseCxfLDIzLHFlWzM1XSkseD1aZSh4LFMsRCxBLHUsNCxxZVszNl0pLEE9WmUoQSx4LFMsRCxmLDExLHFlWzM3XSksRD1aZShELEEseCxTLHAsMTYscWVbMzhdKSxTPVplKFMsRCxBLHgsbSwyMyxxZVszOV0pLHg9WmUoeCxTLEQsQSxiLDQscWVbNDBdKSxBPVplKEEseCxTLEQsbywxMSxxZVs0MV0pLEQ9WmUoRCxBLHgsUyxsLDE2LHFlWzQyXSksUz1aZShTLEQsQSx4LGgsMjMscWVbNDNdKSx4PVplKHgsUyxELEEseSw0LHFlWzQ0XSksQT1aZShBLHgsUyxELGssMTEscWVbNDVdKSxEPVplKEQsQSx4LFMsdywxNixxZVs0Nl0pLFM9WmUoUyxELEEseCxjLDIzLHFlWzQ3XSkseD1RZSh4LFMsRCxBLG8sNixxZVs0OF0pLEE9UWUoQSx4LFMsRCxwLDEwLHFlWzQ5XSksRD1RZShELEEseCxTLF8sMTUscWVbNTBdKSxTPVFlKFMsRCxBLHgsZCwyMSxxZVs1MV0pLHg9UWUoeCxTLEQsQSxrLDYscWVbNTJdKSxBPVFlKEEseCxTLEQsbCwxMCxxZVs1M10pLEQ9UWUoRCxBLHgsUyxtLDE1LHFlWzU0XSksUz1RZShTLEQsQSx4LHUsMjEscWVbNTVdKSx4PVFlKHgsUyxELEEsdiw2LHFlWzU2XSksQT1RZShBLHgsUyxELHcsMTAscWVbNTddKSxEPVFlKEQsQSx4LFMsaCwxNSxxZVs1OF0pLFM9UWUoUyxELEEseCxiLDIxLHFlWzU5XSkseD1RZSh4LFMsRCxBLGYsNixxZVs2MF0pLEE9UWUoQSx4LFMsRCxnLDEwLHFlWzYxXSksRD1RZShELEEseCxTLGMsMTUscWVbNjJdKSxTPVFlKFMsRCxBLHgseSwyMSxxZVs2M10pLHNbMF09c1swXSt4fDAsc1sxXT1zWzFdK1N8MCxzWzJdPXNbMl0rRHwwLHNbM109c1szXStBfDB9fSx7a2V5OiJfZG9GaW5hbGl6ZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLl9kYXRhLHQ9ZS53b3JkcyxyPTgqdGhpcy5fbkRhdGFCeXRlcyxhPTgqZS5zaWdCeXRlczt0W2E+Pj41XXw9MTI4PDwyNC1hJTMyO3ZhciBuPU1hdGguZmxvb3Ioci80Mjk0OTY3Mjk2KSxpPXI7dFsxNSsoYSs2ND4+Pjk8PDQpXT0xNjcxMTkzNSYobjw8OHxuPj4+MjQpfDQyNzgyNTUzNjAmKG48PDI0fG4+Pj44KSx0WzE0KyhhKzY0Pj4+OTw8NCldPTE2NzExOTM1JihpPDw4fGk+Pj4yNCl8NDI3ODI1NTM2MCYoaTw8MjR8aT4+PjgpLGUuc2lnQnl0ZXM9NCoodC5sZW5ndGgrMSksdGhpcy5fcHJvY2VzcygpO2Zvcih2YXIgcz10aGlzLl9oYXNoLG89cy53b3Jkcyx1PTA7dTw0O3UrPTEpe3ZhciBjPW9bdV07b1t1XT0xNjcxMTkzNSYoYzw8OHxjPj4+MjQpfDQyNzgyNTUzNjAmKGM8PDI0fGM+Pj44KX1yZXR1cm4gc319LHtrZXk6ImNsb25lIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXAobyhhLnByb3RvdHlwZSksImNsb25lIix0aGlzKS5jYWxsKHRoaXMpO3JldHVybiBlLl9oYXNoPXRoaXMuX2hhc2guY2xvbmUoKSxlfX1dKSxhfShHZSk7R2UuX2NyZWF0ZUhlbHBlcihKZSksR2UuX2NyZWF0ZUhtYWNIZWxwZXIoSmUpO3ZhciAkZT1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKGUpe3ZhciBuO3JldHVybiByKHRoaXMsYSksKG49dC5jYWxsKHRoaXMpKS5jZmc9T2JqZWN0LmFzc2lnbihuZXcgUmUse2tleVNpemU6NCxoYXNoZXI6SmUsaXRlcmF0aW9uczoxfSxlKSxufXJldHVybiBuKGEsW3trZXk6ImNvbXB1dGUiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByLGE9dGhpcy5jZmcsbj1hLmhhc2hlci5jcmVhdGUoKSxpPUxlLmNyZWF0ZSgpLHM9aS53b3JkcyxvPWEua2V5U2l6ZSx1PWEuaXRlcmF0aW9ucztzLmxlbmd0aDxvOyl7ciYmbi51cGRhdGUocikscj1uLnVwZGF0ZShlKS5maW5hbGl6ZSh0KSxuLnJlc2V0KCk7Zm9yKHZhciBjPTE7Yzx1O2MrPTEpcj1uLmZpbmFsaXplKHIpLG4ucmVzZXQoKTtpLmNvbmNhdChyKX1yZXR1cm4gaS5zaWdCeXRlcz00Km8saX19XSksYX0oUmUpLGV0PWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoZSxuLGkpe3ZhciBzO3JldHVybiByKHRoaXMsYSksKHM9dC5jYWxsKHRoaXMpKS5jZmc9T2JqZWN0LmFzc2lnbihuZXcgUmUsaSkscy5feGZvcm1Nb2RlPWUscy5fa2V5PW4scy5yZXNldCgpLHN9cmV0dXJuIG4oYSxbe2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7cChvKGEucHJvdG90eXBlKSwicmVzZXQiLHRoaXMpLmNhbGwodGhpcyksdGhpcy5fZG9SZXNldCgpfX0se2tleToicHJvY2VzcyIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuX2FwcGVuZChlKSx0aGlzLl9wcm9jZXNzKCl9fSx7a2V5OiJmaW5hbGl6ZSIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIGUmJnRoaXMuX2FwcGVuZChlKSx0aGlzLl9kb0ZpbmFsaXplKCl9fV0sW3trZXk6ImNyZWF0ZUVuY3J5cHRvciIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5jcmVhdGUodGhpcy5fRU5DX1hGT1JNX01PREUsZSx0KX19LHtrZXk6ImNyZWF0ZURlY3J5cHRvciIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5jcmVhdGUodGhpcy5fREVDX1hGT1JNX01PREUsZSx0KX19LHtrZXk6Il9jcmVhdGVIZWxwZXIiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PWZ1bmN0aW9uKGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgZT9sdDp1dH07cmV0dXJue2VuY3J5cHQ6ZnVuY3Rpb24ocixhLG4pe3JldHVybiB0KGEpLmVuY3J5cHQoZSxyLGEsbil9LGRlY3J5cHQ6ZnVuY3Rpb24ocixhLG4pe3JldHVybiB0KGEpLmRlY3J5cHQoZSxyLGEsbil9fX19XSksYX0oamUpO2V0Ll9FTkNfWEZPUk1fTU9ERT0xLGV0Ll9ERUNfWEZPUk1fTU9ERT0yLGV0LmtleVNpemU9NCxldC5pdlNpemU9NDt2YXIgdHQ9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYShlLG4pe3ZhciBpO3JldHVybiByKHRoaXMsYSksKGk9dC5jYWxsKHRoaXMpKS5fY2lwaGVyPWUsaS5faXY9bixpfXJldHVybiBuKGEsbnVsbCxbe2tleToiY3JlYXRlRW5jcnlwdG9yIix2YWx1ZTpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLkVuY3J5cHRvci5jcmVhdGUoZSx0KX19LHtrZXk6ImNyZWF0ZURlY3J5cHRvciIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5EZWNyeXB0b3IuY3JlYXRlKGUsdCl9fV0pLGF9KFJlKTtmdW5jdGlvbiBydChlLHQscil7dmFyIGEsbj1lLGk9dGhpcy5faXY7aT8oYT1pLHRoaXMuX2l2PXZvaWQgMCk6YT10aGlzLl9wcmV2QmxvY2s7Zm9yKHZhciBzPTA7czxyO3MrPTEpblt0K3NdXj1hW3NdfXZhciBhdD1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIHIodGhpcyxhKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gbihhKX0odHQpO2F0LkVuY3J5cHRvcj1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIHIodGhpcyxhKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gbihhLFt7a2V5OiJwcm9jZXNzQmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9dGhpcy5fY2lwaGVyLGE9ci5ibG9ja1NpemU7cnQuY2FsbCh0aGlzLGUsdCxhKSxyLmVuY3J5cHRCbG9jayhlLHQpLHRoaXMuX3ByZXZCbG9jaz1lLnNsaWNlKHQsdCthKX19XSksYX0oYXQpLGF0LkRlY3J5cHRvcj1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIHIodGhpcyxhKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gbihhLFt7a2V5OiJwcm9jZXNzQmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9dGhpcy5fY2lwaGVyLGE9ci5ibG9ja1NpemUsbj1lLnNsaWNlKHQsdCthKTtyLmRlY3J5cHRCbG9jayhlLHQpLHJ0LmNhbGwodGhpcyxlLHQsYSksdGhpcy5fcHJldkJsb2NrPW59fV0pLGF9KGF0KTt2YXIgbnQ9e3BhZDpmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj00KnQsYT1yLWUuc2lnQnl0ZXMlcixuPWE8PDI0fGE8PDE2fGE8PDh8YSxpPVtdLHM9MDtzPGE7cys9NClpLnB1c2gobik7dmFyIG89TGUuY3JlYXRlKGksYSk7ZS5jb25jYXQobyl9LHVucGFkOmZ1bmN0aW9uKGUpe3ZhciB0PWUscj0yNTUmdC53b3Jkc1t0LnNpZ0J5dGVzLTE+Pj4yXTt0LnNpZ0J5dGVzLT1yfX0saXQ9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYShlLG4saSl7dmFyIHM7cmV0dXJuIHIodGhpcyxhKSwocz10LmNhbGwodGhpcyxlLG4sT2JqZWN0LmFzc2lnbih7bW9kZTphdCxwYWRkaW5nOm50fSxpKSkpLmJsb2NrU2l6ZT00LHN9cmV0dXJuIG4oYSxbe2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU7cChvKGEucHJvdG90eXBlKSwicmVzZXQiLHRoaXMpLmNhbGwodGhpcyk7dmFyIHQ9dGhpcy5jZmcscj10Lml2LG49dC5tb2RlO3RoaXMuX3hmb3JtTW9kZT09PXRoaXMuY29uc3RydWN0b3IuX0VOQ19YRk9STV9NT0RFP2U9bi5jcmVhdGVFbmNyeXB0b3I6KGU9bi5jcmVhdGVEZWNyeXB0b3IsdGhpcy5fbWluQnVmZmVyU2l6ZT0xKSx0aGlzLl9tb2RlPWUuY2FsbChuLHRoaXMsciYmci53b3JkcyksdGhpcy5fbW9kZS5fX2NyZWF0b3I9ZX19LHtrZXk6Il9kb1Byb2Nlc3NCbG9jayIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt0aGlzLl9tb2RlLnByb2Nlc3NCbG9jayhlLHQpfX0se2tleToiX2RvRmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGUsdD10aGlzLmNmZy5wYWRkaW5nO3JldHVybiB0aGlzLl94Zm9ybU1vZGU9PT10aGlzLmNvbnN0cnVjdG9yLl9FTkNfWEZPUk1fTU9ERT8odC5wYWQodGhpcy5fZGF0YSx0aGlzLmJsb2NrU2l6ZSksZT10aGlzLl9wcm9jZXNzKCEwKSk6KGU9dGhpcy5fcHJvY2VzcyghMCksdC51bnBhZChlKSksZX19XSksYX0oZXQpLHN0PWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoZSl7dmFyIG47cmV0dXJuIHIodGhpcyxhKSwobj10LmNhbGwodGhpcykpLm1peEluKGUpLG59cmV0dXJuIG4oYSxbe2tleToidG9TdHJpbmciLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybihlfHx0aGlzLmZvcm1hdHRlcikuc3RyaW5naWZ5KHRoaXMpfX1dKSxhfShSZSksb3Q9e3N0cmluZ2lmeTpmdW5jdGlvbihlKXt2YXIgdD1lLmNpcGhlcnRleHQscj1lLnNhbHQ7cmV0dXJuKHI/TGUuY3JlYXRlKFsxMzk4ODkzNjg0LDE3MDEwNzY4MzFdKS5jb25jYXQocikuY29uY2F0KHQpOnQpLnRvU3RyaW5nKEtlKX0scGFyc2U6ZnVuY3Rpb24oZSl7dmFyIHQscj1LZS5wYXJzZShlKSxhPXIud29yZHM7cmV0dXJuIDEzOTg4OTM2ODQ9PT1hWzBdJiYxNzAxMDc2ODMxPT09YVsxXSYmKHQ9TGUuY3JlYXRlKGEuc2xpY2UoMiw0KSksYS5zcGxpY2UoMCw0KSxyLnNpZ0J5dGVzLT0xNiksc3QuY3JlYXRlKHtjaXBoZXJ0ZXh0OnIsc2FsdDp0fSl9fSx1dD1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIHIodGhpcyxhKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gbihhLG51bGwsW3trZXk6ImVuY3J5cHQiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyLGEpe3ZhciBuPU9iamVjdC5hc3NpZ24obmV3IFJlLHRoaXMuY2ZnLGEpLGk9ZS5jcmVhdGVFbmNyeXB0b3IocixuKSxzPWkuZmluYWxpemUodCksbz1pLmNmZztyZXR1cm4gc3QuY3JlYXRlKHtjaXBoZXJ0ZXh0OnMsa2V5OnIsaXY6by5pdixhbGdvcml0aG06ZSxtb2RlOm8ubW9kZSxwYWRkaW5nOm8ucGFkZGluZyxibG9ja1NpemU6aS5ibG9ja1NpemUsZm9ybWF0dGVyOm4uZm9ybWF0fSl9fSx7a2V5OiJkZWNyeXB0Iix2YWx1ZTpmdW5jdGlvbihlLHQscixhKXt2YXIgbj10LGk9T2JqZWN0LmFzc2lnbihuZXcgUmUsdGhpcy5jZmcsYSk7cmV0dXJuIG49dGhpcy5fcGFyc2UobixpLmZvcm1hdCksZS5jcmVhdGVEZWNyeXB0b3IocixpKS5maW5hbGl6ZShuLmNpcGhlcnRleHQpfX0se2tleToiX3BhcnNlIix2YWx1ZTpmdW5jdGlvbihlLHQpe3JldHVybiJzdHJpbmciPT10eXBlb2YgZT90LnBhcnNlKGUsdGhpcyk6ZX19XSksYX0oUmUpO3V0LmNmZz1PYmplY3QuYXNzaWduKG5ldyBSZSx7Zm9ybWF0Om90fSk7dmFyIGN0PXtleGVjdXRlOmZ1bmN0aW9uKGUsdCxyLGEpe3ZhciBuPWE7bnx8KG49TGUucmFuZG9tKDgpKTt2YXIgaT0kZS5jcmVhdGUoe2tleVNpemU6dCtyfSkuY29tcHV0ZShlLG4pLHM9TGUuY3JlYXRlKGkud29yZHMuc2xpY2UodCksNCpyKTtyZXR1cm4gaS5zaWdCeXRlcz00KnQsc3QuY3JlYXRlKHtrZXk6aSxpdjpzLHNhbHQ6bn0pfX0sbHQ9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiByKHRoaXMsYSksdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIG4oYSxudWxsLFt7a2V5OiJlbmNyeXB0Iix2YWx1ZTpmdW5jdGlvbihlLHQscixhKXt2YXIgbj1PYmplY3QuYXNzaWduKG5ldyBSZSx0aGlzLmNmZyxhKSxpPW4ua2RmLmV4ZWN1dGUocixlLmtleVNpemUsZS5pdlNpemUpO24uaXY9aS5pdjt2YXIgcz11dC5lbmNyeXB0LmNhbGwodGhpcyxlLHQsaS5rZXksbik7cmV0dXJuIHMubWl4SW4oaSksc319LHtrZXk6ImRlY3J5cHQiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyLGEpe3ZhciBuPXQsaT1PYmplY3QuYXNzaWduKG5ldyBSZSx0aGlzLmNmZyxhKTtuPXRoaXMuX3BhcnNlKG4saS5mb3JtYXQpO3ZhciBzPWkua2RmLmV4ZWN1dGUocixlLmtleVNpemUsZS5pdlNpemUsbi5zYWx0KTtyZXR1cm4gaS5pdj1zLml2LHV0LmRlY3J5cHQuY2FsbCh0aGlzLGUsbixzLmtleSxpKX19XSksYX0odXQpO2x0LmNmZz1PYmplY3QuYXNzaWduKHV0LmNmZyx7a2RmOmN0fSk7Zm9yKHZhciBmdD1bXSxkdD1bXSxodD1bXSxwdD1bXSx2dD1bXSx5dD1bXSxtdD1bXSxndD1bXSxrdD1bXSxidD1bXSxfdD1bXSx3dD0wO3d0PDI1Njt3dCs9MSlfdFt3dF09d3Q8MTI4P3d0PDwxOnd0PDwxXjI4Mztmb3IodmFyIHh0PTAsU3Q9MCxEdD0wO0R0PDI1NjtEdCs9MSl7dmFyIEF0PVN0XlN0PDwxXlN0PDwyXlN0PDwzXlN0PDw0O0F0PUF0Pj4+OF4yNTUmQXReOTksZnRbeHRdPUF0LGR0W0F0XT14dDt2YXIgVHQ9X3RbeHRdLEJ0PV90W1R0XSxFdD1fdFtCdF0sVXQ9MjU3Kl90W0F0XV4xNjg0MzAwOCpBdDtodFt4dF09VXQ8PDI0fFV0Pj4+OCxwdFt4dF09VXQ8PDE2fFV0Pj4+MTYsdnRbeHRdPVV0PDw4fFV0Pj4+MjQseXRbeHRdPVV0LFV0PTE2ODQzMDA5KkV0XjY1NTM3KkJ0XjI1NypUdF4xNjg0MzAwOCp4dCxtdFtBdF09VXQ8PDI0fFV0Pj4+OCxndFtBdF09VXQ8PDE2fFV0Pj4+MTYsa3RbQXRdPVV0PDw4fFV0Pj4+MjQsYnRbQXRdPVV0LHh0Pyh4dD1UdF5fdFtfdFtfdFtFdF5UdF1dXSxTdF49X3RbX3RbU3RdXSk6eHQ9U3Q9MX12YXIgQ3Q9WzAsMSwyLDQsOCwxNiwzMiw2NCwxMjgsMjcsNTRdLFB0PWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEsW3trZXk6Il9kb1Jlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlO2lmKCF0aGlzLl9uUm91bmRzfHx0aGlzLl9rZXlQcmlvclJlc2V0IT09dGhpcy5fa2V5KXt0aGlzLl9rZXlQcmlvclJlc2V0PXRoaXMuX2tleTt2YXIgdD10aGlzLl9rZXlQcmlvclJlc2V0LHI9dC53b3JkcyxhPXQuc2lnQnl0ZXMvNDt0aGlzLl9uUm91bmRzPWErNjt2YXIgbj00Kih0aGlzLl9uUm91bmRzKzEpO3RoaXMuX2tleVNjaGVkdWxlPVtdO2Zvcih2YXIgaT10aGlzLl9rZXlTY2hlZHVsZSxzPTA7czxuO3MrPTEpczxhP2lbc109cltzXTooZT1pW3MtMV0scyVhP2E+NiYmcyVhPT00JiYoZT1mdFtlPj4+MjRdPDwyNHxmdFtlPj4+MTYmMjU1XTw8MTZ8ZnRbZT4+PjgmMjU1XTw8OHxmdFsyNTUmZV0pOihlPWZ0WyhlPWU8PDh8ZT4+PjI0KT4+PjI0XTw8MjR8ZnRbZT4+PjE2JjI1NV08PDE2fGZ0W2U+Pj44JjI1NV08PDh8ZnRbMjU1JmVdLGVePUN0W3MvYXwwXTw8MjQpLGlbc109aVtzLWFdXmUpO3RoaXMuX2ludktleVNjaGVkdWxlPVtdO2Zvcih2YXIgbz10aGlzLl9pbnZLZXlTY2hlZHVsZSx1PTA7dTxuO3UrPTEpe3ZhciBjPW4tdTtlPXUlND9pW2NdOmlbYy00XSxvW3VdPXU8NHx8Yzw9ND9lOm10W2Z0W2U+Pj4yNF1dXmd0W2Z0W2U+Pj4xNiYyNTVdXV5rdFtmdFtlPj4+OCYyNTVdXV5idFtmdFsyNTUmZV1dfX19fSx7a2V5OiJlbmNyeXB0QmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dGhpcy5fZG9DcnlwdEJsb2NrKGUsdCx0aGlzLl9rZXlTY2hlZHVsZSxodCxwdCx2dCx5dCxmdCl9fSx7a2V5OiJkZWNyeXB0QmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9ZSxhPXJbdCsxXTtyW3QrMV09clt0KzNdLHJbdCszXT1hLHRoaXMuX2RvQ3J5cHRCbG9jayhyLHQsdGhpcy5faW52S2V5U2NoZWR1bGUsbXQsZ3Qsa3QsYnQsZHQpLGE9clt0KzFdLHJbdCsxXT1yW3QrM10sclt0KzNdPWF9fSx7a2V5OiJfZG9DcnlwdEJsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQscixhLG4saSxzLG8pe2Zvcih2YXIgdT1lLGM9dGhpcy5fblJvdW5kcyxsPXVbdF1eclswXSxmPXVbdCsxXV5yWzFdLGQ9dVt0KzJdXnJbMl0saD11W3QrM11eclszXSxwPTQsdj0xO3Y8Yzt2Kz0xKXt2YXIgeT1hW2w+Pj4yNF1ebltmPj4+MTYmMjU1XV5pW2Q+Pj44JjI1NV1ec1syNTUmaF1ecltwXTtwKz0xO3ZhciBtPWFbZj4+PjI0XV5uW2Q+Pj4xNiYyNTVdXmlbaD4+PjgmMjU1XV5zWzI1NSZsXV5yW3BdO3ArPTE7dmFyIGc9YVtkPj4+MjRdXm5baD4+PjE2JjI1NV1eaVtsPj4+OCYyNTVdXnNbMjU1JmZdXnJbcF07cCs9MTt2YXIgaz1hW2g+Pj4yNF1ebltsPj4+MTYmMjU1XV5pW2Y+Pj44JjI1NV1ec1syNTUmZF1ecltwXTtwKz0xLGw9eSxmPW0sZD1nLGg9a312YXIgYj0ob1tsPj4+MjRdPDwyNHxvW2Y+Pj4xNiYyNTVdPDwxNnxvW2Q+Pj44JjI1NV08PDh8b1syNTUmaF0pXnJbcF07cCs9MTt2YXIgXz0ob1tmPj4+MjRdPDwyNHxvW2Q+Pj4xNiYyNTVdPDwxNnxvW2g+Pj44JjI1NV08PDh8b1syNTUmbF0pXnJbcF07cCs9MTt2YXIgdz0ob1tkPj4+MjRdPDwyNHxvW2g+Pj4xNiYyNTVdPDwxNnxvW2w+Pj44JjI1NV08PDh8b1syNTUmZl0pXnJbcF07cCs9MTt2YXIgeD0ob1toPj4+MjRdPDwyNHxvW2w+Pj4xNiYyNTVdPDwxNnxvW2Y+Pj44JjI1NV08PDh8b1syNTUmZF0pXnJbcF07cCs9MSx1W3RdPWIsdVt0KzFdPV8sdVt0KzJdPXcsdVt0KzNdPXh9fV0pLGF9KGl0KTtQdC5rZXlTaXplPTg7dmFyIEl0PWl0Ll9jcmVhdGVIZWxwZXIoUHQpLE10PWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEpfSh0dCk7TXQuRW5jcnlwdG9yPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEsW3trZXk6InByb2Nlc3NCbG9jayIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt2YXIgcj1lLGE9dGhpcy5fY2lwaGVyLG49YS5ibG9ja1NpemUsaT10aGlzLl9pdixzPXRoaXMuX2NvdW50ZXI7aSYmKHRoaXMuX2NvdW50ZXI9aS5zbGljZSgwKSxzPXRoaXMuX2NvdW50ZXIsdGhpcy5faXY9dm9pZCAwKTt2YXIgbz1zLnNsaWNlKDApO2EuZW5jcnlwdEJsb2NrKG8sMCksc1tuLTFdPXNbbi0xXSsxfDA7Zm9yKHZhciB1PTA7dTxuO3UrPTEpclt0K3VdXj1vW3VdfX1dKSxhfShNdCksTXQuRGVjcnlwdG9yPU10LkVuY3J5cHRvcjt2YXIgenQ9e3BhZDpmdW5jdGlvbigpe30sdW5wYWQ6ZnVuY3Rpb24oKXt9fSxPdD17ZGVjcnlwdFdvcmRBcnJheTpmdW5jdGlvbihlLHQscil7dmFyIGE9VmUucGFyc2UodCksbj1WZS5wYXJzZShuZShyKSksaT1MZS5jcmVhdGUobmV3IFVpbnQ4QXJyYXkoZSkpLHM9SXQuZGVjcnlwdChzdC5jcmVhdGUoe2NpcGhlcnRleHQ6aX0pLGEse2l2Om4sbW9kZTpNdCxwYWRkaW5nOnp0fSk7cmV0dXJuIE90LndvcmRBcnJheVRvVWludDhBcnJheShzKX0sd29yZEFycmF5VG9VaW50OEFycmF5OmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLnNpZ0J5dGVzLHI9ZS53b3JkcyxhPW5ldyBVaW50OEFycmF5KHQpLG49MCxpPTA7biE9PXQ7KXt2YXIgcz1yW2krK107aWYoYVtuKytdPSg0Mjc4MTkwMDgwJnMpPj4+MjQsbj09PXQpYnJlYWs7aWYoYVtuKytdPSgxNjcxMTY4MCZzKT4+PjE2LG49PT10KWJyZWFrO2lmKGFbbisrXT0oNjUyODAmcyk+Pj44LG49PT10KWJyZWFrO2FbbisrXT0yNTUmc31yZXR1cm4gYX0sZGVjb2RlckFFU0NUUkRhdGE6ZnVuY3Rpb24oZSx0LHIpe2lmKGUudmlkZW9TZW5jKXt2YXIgYT1lLmtpZFZhbHVlLG49ZS52aWRlb1NlbmM7ZS5zYW1wbGVzLmZvckVhY2goKGZ1bmN0aW9uKHQsaSl7dmFyIHM9bltpXSxvPXQuZGF0YSx1PVtdLGM9W10sbD1zLkluaXRpYWxpemF0aW9uVmVjdG9yO2lmKHMuc3Vic2FtcGxlcyYmcy5zdWJzYW1wbGVzLmxlbmd0aClzLnN1YnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9ZS5CeXRlc09mQ2xlYXJEYXRhK2UuQnl0ZXNPZlByb3RlY3RlZERhdGEscj1vLnNsaWNlKDAsdCk7dS5wdXNoKHIuc2xpY2UoMCxlLkJ5dGVzT2ZDbGVhckRhdGEpKSxjLnB1c2goci5zbGljZShlLkJ5dGVzT2ZDbGVhckRhdGEpKSxvPW8uc2xpY2UodCl9KSk7ZWxzZXt2YXIgZj10LnNpemU7dS5wdXNoKG8uc2xpY2UoMCwwKSksYy5wdXNoKG8uc2xpY2UoMCxmKSksbz1vLnNsaWNlKGYpfXZhciBkPW5ldyBQZTtkLndyaXRlLmFwcGx5KGQsYyk7dmFyIGg9cj9yKGQuYnVmZmVyLGEsbCk6T3QuZGVjcnlwdFdvcmRBcnJheShkLmJ1ZmZlcixhLGwpLHA9bmV3IFBlO3UuZm9yRWFjaCgoZnVuY3Rpb24oZSx0KXt2YXIgcj1jW3RdLmxlbmd0aCxhPWguc2xpY2UoMCxyKTtwLndyaXRlKGUpLHAud3JpdGUoYSksaD1oLnNsaWNlKHIpfSkpLGUuc2FtcGxlc1tpXS5kYXRhPXAuYnVmZmVyfSkpfWlmKHQuYXVkaW9TZW5jKXt2YXIgaT10LmtpZFZhbHVlLHM9dC5hdWRpb1NlbmM7dC5zYW1wbGVzLmZvckVhY2goKGZ1bmN0aW9uKGUsYSl7dmFyIG49c1thXSxvPXI/cihlLmRhdGEsaSxuLkluaXRpYWxpemF0aW9uVmVjdG9yKTpPdC5kZWNyeXB0V29yZEFycmF5KGUuZGF0YSxpLG4uSW5pdGlhbGl6YXRpb25WZWN0b3IpO3Quc2FtcGxlc1thXS5kYXRhPW99KSl9fX0sUnQ9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQsYSxuLHMpe3ZhciBvPXRoaXM7cih0aGlzLGUpLGkodGhpcywiX3ZpZGVvU2FtcGxlcyIsW10pLGkodGhpcywiX2F1ZGlvU2FtcGxlcyIsW10pLGkodGhpcywiX2xhc3RSZW1haW5CdWZmZXIiLFtdKSxpKHRoaXMsIl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3MiLDApLHRoaXMudmlkZW9UcmFjaz1uZXcgTyx0aGlzLmF1ZGlvVHJhY2s9bmV3IFIsdGhpcy5tZXRhZGF0YVRyYWNrPW58fG5ldyBHLHRoaXMubG9nPW5ldyB6ZSgiTVA0RGVtdXhlciIsIXN8fCFzLm9wZW5Mb2d8fCFzLm9wZW5Mb2cpLHQmJnQuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ7KHQ9by5fdmlkZW9TYW1wbGVzKS5wdXNoLmFwcGx5KHQseShlLmZyYW1lcykpfSkpLGEmJmEuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ7KHQ9by5fYXVkaW9TYW1wbGVzKS5wdXNoLmFwcGx5KHQseShlLmZyYW1lcykpfSkpfXJldHVybiBuKGUsW3trZXk6InBhcnNlU2FtcGxlcyIsdmFsdWU6ZnVuY3Rpb24oZSl7aWYoIWUpdGhyb3cgbmV3IEVycm9yKCJtb292IGlzIHJlcXVpcmVkIik7aWYodGhpcy52aWRlb1RyYWNrLmNvZGVjfHx0aGlzLmF1ZGlvVHJhY2suY29kZWN8fChTZS5tb292VG9UcmFjayhlLHRoaXMudmlkZW9UcmFjayx0aGlzLmF1ZGlvVHJhY2spLHRoaXMudmlkZW9TZW5jPXRoaXMudmlkZW9UcmFjay52aWRlb1NlbmMsdGhpcy5hdWRpb1NlbmM9dGhpcy5hdWRpb1RyYWNrLmF1ZGlvU2VuYyksIXRoaXMuX2F1ZGlvU2FtcGxlcy5sZW5ndGgmJiF0aGlzLl92aWRlb1NhbXBsZXMubGVuZ3RoKXt2YXIgdD1TZS5tb292VG9TYW1wbGVzKGUpO2lmKCF0KXRocm93IG5ldyBFcnJvcigiY2Fubm90IHBhcnNlIHNhbXBsZXMgZnJvbSBtb292IGJveCIpO3RoaXMuX3ZpZGVvU2FtcGxlcz10LnZpZGVvU2FtcGxlc3x8W10sdGhpcy5fYXVkaW9TYW1wbGVzPXQuYXVkaW9TYW1wbGVzfHxbXX19fSx7a2V5OiJkZW11eCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsYSxuKXt0aGlzLnBhcnNlU2FtcGxlcyhuKTt2YXIgaSxzLG8sdT10aGlzLnZpZGVvVHJhY2ssYz10aGlzLmF1ZGlvVHJhY2s7aWYodS5zYW1wbGVzPVtdLGMuc2FtcGxlcz1bXSxyKXtmb3IodmFyIGwsZj0wLGQ9clswXSxoPXJbMV07ZDw9aDtkKyspe2lmKCEoaT10aGlzLl92aWRlb1NhbXBsZXNbZF0pKXRocm93IG5ldyBFcnJvcigiY2Fubm90IGZvdW5kIHZpZGVvIGZyYW1lICMiLmNvbmNhdChkKSk7bz1pLm9mZnNldC10LHM9ZS5zdWJhcnJheShvLG8raS5zaXplKSwobD1uZXcgTChpLnB0c3x8aS5kdHMsaS5kdHMpKS5kdXJhdGlvbj1pLmR1cmF0aW9uLGwuZ29wSWQ9aS5nb3BJZCxpLmtleWZyYW1lJiZsLnNldFRvS2V5ZnJhbWUoKTtmb3IodmFyIHA9MCx2PXMubGVuZ3RoLTE7cDx2OylmPXRlKHMscCkscCs9NCxsLnVuaXRzLnB1c2gocy5zdWJhcnJheShwLHArZikpLHArPWY7dS5zYW1wbGVzLnB1c2gobCl9dS5iYXNlTWVkaWFEZWNvZGVUaW1lPXUuc2FtcGxlc1swXS5kdHN9aWYoYSl7Zm9yKHZhciB5PWFbMF0sbT1hWzFdO3k8PW07eSsrKXtpZighKGk9dGhpcy5fYXVkaW9TYW1wbGVzW3ldKSl0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBmb3VuZCB2aWRlbyBmcmFtZSAjIi5jb25jYXQoeSkpO289aS5vZmZzZXQtdCxzPWUuc3ViYXJyYXkobyxvK2kuc2l6ZSksYy5zYW1wbGVzLnB1c2gobmV3IFYoaS5kdHMscyxpLmR1cmF0aW9uKSl9Yy5iYXNlTWVkaWFEZWNvZGVUaW1lPWMuc2FtcGxlc1swXS5kdHN9cmV0dXJue3ZpZGVvVHJhY2s6dSxhdWRpb1RyYWNrOmMsbWV0YWRhdGFUcmFjazp0aGlzLm1ldGFkYXRhVHJhY2t9fX0se2tleToiZGVtdXhQYXJ0Iix2YWx1ZTpmdW5jdGlvbihlLHQscixhLG4saSxzLG8pe2lmKHRoaXMucGFyc2VTYW1wbGVzKG4pLHRoaXMudmlkZW9UcmFjay51c2VFTUU9aSx0aGlzLmF1ZGlvVHJhY2sudXNlRU1FPWksdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlciYmdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlci5ieXRlTGVuZ3RoPjAmJnQ+dGhpcy5fbGFzdFJlbWFpbkJ1ZmZlclN0YXJ0UG9zJiZ0PD10aGlzLl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3MrdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlci5ieXRlTGVuZ3RoKWZvcih2YXIgdT0wO3U8MjA7KXRyeXt2YXIgYz10aGlzLl9sYXN0UmVtYWluQnVmZmVyLnN1YmFycmF5KDAsdC10aGlzLl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3MpLGw9bmV3IFVpbnQ4QXJyYXkoZS5ieXRlTGVuZ3RoK2MuYnl0ZUxlbmd0aCk7bC5zZXQoYywwKSxsLnNldChuZXcgVWludDhBcnJheShlKSxjLmJ5dGVMZW5ndGgpLGU9bCx0LT1jLmJ5dGVMZW5ndGgsdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlcj1udWxsLHRoaXMuX2xhc3RSZW1haW5CdWZmZXJTdGFydFBvcz0wO2JyZWFrfWNhdGNoKFQpe2lmKCEodTwyMCkpdGhyb3cgbmV3IEVycm9yKCJuZXcgVWludDhBcnJheSBlcnJvcjosIitULmVycm9yTWVzc2FnZSk7dSsrfXZhciBmLGQsaCxwPXRoaXMudmlkZW9UcmFjayx2PXRoaXMuYXVkaW9UcmFjaztwLnNhbXBsZXM9W10sdi5zYW1wbGVzPVtdLHAudmlkZW9TZW5jPW51bGwsdi5hdWRpb1NlbmM9bnVsbDt2YXIgeT0wLG09MDtpZih0aGlzLl92aWRlb1NhbXBsZXMubGVuZ3RoPjAmJnIubGVuZ3RoPjApe2Zvcih2YXIgZyxrPWUuYnl0ZUxlbmd0aCt0LGI9clswXTtiPD1yWzFdO2IrKyl7aWYoIShmPXRoaXMuX3ZpZGVvU2FtcGxlc1tiXSkpdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgZm91bmQgdmlkZW8gZnJhbWUgIyIuY29uY2F0KGIpKTtmLm9mZnNldD49dCYmZi5vZmZzZXQrZi5zaXplPD1rJiYoeT0oaD1mLm9mZnNldC10KStmLnNpemUsZD1lLnN1YmFycmF5KGgseSksKGc9bmV3IEwoZi5wdHN8fGYuZHRzLGYuZHRzKSkuZHVyYXRpb249Zi5kdXJhdGlvbixnLmdvcElkPWYuZ29wSWQsZy5zYW1wbGVPZmZzZXQ9Zi5pbmRleCxmLmtleWZyYW1lJiZnLnNldFRvS2V5ZnJhbWUoKSxnLmRhdGE9ZCxnLnNpemU9Zi5zaXplLHAuc2FtcGxlcy5wdXNoKGcpKX1wLnNhbXBsZXMubGVuZ3RoPjAmJihwLmdvcElkPXAuc2FtcGxlc1swXS5nb3BJZCxwLmJhc2VNZWRpYURlY29kZVRpbWU9cC5zYW1wbGVzWzBdLmR0cyxwLnN0YXJ0UHRzPXAuc2FtcGxlc1swXS5wdHMvcC50aW1lc2NhbGUscC5lbmRQdHM9cC5zYW1wbGVzW3Auc2FtcGxlcy5sZW5ndGgtMV0ucHRzL3AudGltZXNjYWxlLHRoaXMudmlkZW9TZW5jJiYocC52aWRlb1NlbmM9dGhpcy52aWRlb1NlbmMuc2xpY2UocC5zYW1wbGVzWzBdLnNhbXBsZU9mZnNldCxwLnNhbXBsZXNbMF0uc2FtcGxlT2Zmc2V0K3Auc2FtcGxlcy5sZW5ndGgpLHAua2lkVmFsdWU9cykpfWlmKHRoaXMuX2F1ZGlvU2FtcGxlcy5sZW5ndGg+MCYmYS5sZW5ndGg+MCl7Zm9yKHZhciBfPWFbMF07Xzw9YVsxXTtfKyspe2lmKCEoZj10aGlzLl9hdWRpb1NhbXBsZXNbX10pKXRocm93IG5ldyBFcnJvcigiY2Fubm90IGZvdW5kIHZpZGVvIGZyYW1lICMiLmNvbmNhdChfKSk7Zi5vZmZzZXQ+PXQmJmYub2Zmc2V0K2Yuc2l6ZTw9ZS5ieXRlTGVuZ3RoK3QmJihtPShoPWYub2Zmc2V0LXQpK2Yuc2l6ZSxkPWUuc3ViYXJyYXkoaCxtKSx2LnNhbXBsZXMucHVzaChuZXcgVihmLmR0cyxkLGYuZHVyYXRpb24sZi5pbmRleCkpKX12LnNhbXBsZXMubGVuZ3RoPjAmJih2LmdvcElkPXYuc2FtcGxlc1swXS5nb3BJZHx8cC5nb3BJZCx2LmJhc2VNZWRpYURlY29kZVRpbWU9di5zYW1wbGVzWzBdLmR0cyx2LnN0YXJ0UHRzPXYuc2FtcGxlc1swXS5wdHMvdi50aW1lc2NhbGUsdi5lbmRQdHM9di5zYW1wbGVzW3Yuc2FtcGxlcy5sZW5ndGgtMV0ucHRzL3YudGltZXNjYWxlLHRoaXMuYXVkaW9TZW5jJiYodi5hdWRpb1NlbmM9dGhpcy5hdWRpb1NlbmMuc2xpY2Uodi5zYW1wbGVzWzBdLnNhbXBsZU9mZnNldCx2LnNhbXBsZXNbMF0uc2FtcGxlT2Zmc2V0K3Yuc2FtcGxlcy5sZW5ndGgpLHYua2lkVmFsdWU9cykpfXRoaXMuZGVjb2RlckRhdGEocCx2LG8pO2Zvcih2YXIgdz0wLHg9MDt4PHAuc2FtcGxlcy5sZW5ndGg7eCsrKWZvcih2YXIgUz0wLEQ9cC5zYW1wbGVzW3hdLmRhdGEsQT1ELmxlbmd0aC0xO1M8QTspdz10ZShELFMpLFMrPTQscC5zYW1wbGVzW3hdLnVuaXRzLnB1c2goRC5zdWJhcnJheShTLFMrdykpLFMrPXc7cmV0dXJuIHRoaXMuX2xhc3RSZW1haW5CdWZmZXI9ZS5zdWJhcnJheShNYXRoLm1heCh5LG0pKSx0aGlzLl9sYXN0UmVtYWluQnVmZmVyLmJ5dGVMZW5ndGg+MD90aGlzLl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3M9dCtlLmJ5dGVMZW5ndGgtdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlci5ieXRlTGVuZ3RoOnRoaXMuX2xhc3RSZW1haW5CdWZmZXJTdGFydFBvcz0wLHt2aWRlb1RyYWNrOnAsYXVkaW9UcmFjazp2LG1ldGFkYXRhVHJhY2s6dGhpcy5tZXRhZGF0YVRyYWNrfX19LHtrZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuX3ZpZGVvU2FtcGxlcz1bXSx0aGlzLl9hdWRpb1NhbXBsZXM9W10sdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlcj1udWxsLHRoaXMuX2xhc3RSZW1haW5CdWZmZXJTdGFydFBvcz0wLHRoaXMudmlkZW9UcmFjay5yZXNldCgpLHRoaXMuYXVkaW9UcmFjay5yZXNldCgpLHRoaXMubWV0YWRhdGFUcmFjay5yZXNldCgpfX0se2tleToiZGVjb2RlckRhdGEiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXtlLnVzZUVNRXx8dC51c2VFTUV8fE90LmRlY29kZXJBRVNDVFJEYXRhKGUsdCxyKX19XSxbe2tleToicHJvYmUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBTZS5wcm9iZShlKX19XSksZX0oKSxMdD17bm93VGltZTpmdW5jdGlvbigpe3RyeXtyZXR1cm4gcGFyc2VJbnQocGVyZm9ybWFuY2Uubm93KCksMTApfWNhdGNoKGUpe3JldHVybihuZXcgRGF0ZSkuZ2V0VGltZSgpfX0sY29uY2F0RGF0YTpmdW5jdGlvbihlLHQpe3ZhciByPVtdLGE9MDtlJiZyLnB1c2goZSksdCYmci5wdXNoKHQpLHIuZXZlcnkoKGZ1bmN0aW9uKGUpe3JldHVybiBlJiYoYSs9ZS5ieXRlTGVuZ3RoKSwhMH0pKTt2YXIgbj1uZXcgVWludDhBcnJheShhKSxpPTA7cmV0dXJuIHIuZXZlcnkoKGZ1bmN0aW9uKGUpe3JldHVybiBlJiYobi5zZXQoZSxpKSxpKz1lLmJ5dGVMZW5ndGgpLCEwfSkpLG59fTtvbm1lc3NhZ2U9ZnVuY3Rpb24oZSl7dmFyIHI9ZS5kYXRhO3N3aXRjaChyLm1ldGhvZCl7Y2FzZSJpbml0Ijp0aGlzLmNvZGVjVHlwZT1yLmFyZ3MuY29kZWNUeXBlLHRoaXMub3BlbmxvZz1yLmFyZ3Mub3BlbkxvZyx0aGlzLk1QNERlbXV4ZXI9bnVsbCx0aGlzLkZNUDRSZW11eGVyPW51bGwsdGhpcy5fbmVlZEluaXRTZWdtZW50PSEwLHRoaXMuc3VwcG9ydEhldmM9ci5hcmdzLnN1cHBvcnRIZXZjO2JyZWFrO2Nhc2UidHJhbnNtdXgiOnZhciBhPWUuZGF0YS5hcmdzLG49bmV3IFVpbnQ4QXJyYXkoZS5kYXRhLmJ1ZmZlcik7dGhpcy5NUDREZW11eGVyfHwodGhpcy5NUDREZW11eGVyPW5ldyBSdChudWxsLG51bGwsbnVsbCx7b3BlbmxvZzp0aGlzLm9wZW5sb2d9KSk7dmFyIGkscz10aGlzLk1QNERlbXV4ZXIuZGVtdXhQYXJ0KG4sYS5zdGFydCxhLnZpZGVvSWR4LGEuYXVkaW9JZHgsYS5tb292LGEudXNlRU1FLGEua2lkVmFsdWUpO2lmKHRoaXMuRk1QNFJlbXV4ZXJ8fCJoMjY1Ij09PXRoaXMuY29kZWNUeXBlJiYhdGhpcy5zdXBwb3J0SGV2Y3x8KHRoaXMuRk1QNFJlbXV4ZXI9bmV3IE9lKHRoaXMuTVA0RGVtdXhlci52aWRlb1RyYWNrLHRoaXMuTVA0RGVtdXhlci5hdWRpb1RyYWNrLHtvcGVuTG9nOnRoaXMub3BlbmxvZ30pKSx0aGlzLkZNUDRSZW11eGVyKXt2YXIgbz10aGlzLkZNUDRSZW11eGVyLnJlbXV4KHRoaXMuX25lZWRJbml0U2VnbWVudCx7aW5pdE1lcmdlOiEwfSk7by5pbml0U2VnbWVudCYmKHRoaXMuX25lZWRJbml0U2VnbWVudD0hMSksaT17YnVmZmVyOkx0LmNvbmNhdERhdGEoby5hdWRpb1NlZ21lbnQsby52aWRlb1NlZ21lbnQpLHJhbmdlOmEuY29udGV4dC5yYW5nZSxzdGF0ZTphLmNvbnRleHQuc3RhdGUsY29udGV4dDp7cmFuZ2U6YS5jb250ZXh0LnJhbmdlLGZyYWdJbmRleDphLmNvbnRleHQuZnJhZ0luZGV4LHN0YXJ0UHRzOk1hdGgubWluKHMudmlkZW9UcmFjay5zdGFydFB0cyxzLmF1ZGlvVHJhY2suc3RhcnRQdHMpLGVuZFB0czpNYXRoLm1heChzLnZpZGVvVHJhY2suZW5kUHRzLHMuYXVkaW9UcmFjay5lbmRQdHMpfSxpbml0U2VnOm8uaW5pdFNlZ21lbnR9fXRoaXMucG9zdE1lc3NhZ2Uoe21ldGhvZDoidHJhbnNtdXgiLGlkOmUuZGF0YS5pZCxhcmdzOnQoe30saSl9KTticmVhaztjYXNlInJlc2V0Ijp0aGlzLkZNUDRSZW11eGVyJiZ0aGlzLkZNUDRSZW11eGVyLnJlc2V0KCksdGhpcy5NUDREZW11eGVyJiZ0aGlzLk1QNERlbXV4ZXIucmVzZXQoKSx0aGlzLkZNUDRSZW11eGVyPW51bGwsdGhpcy5NUDREZW11eGVyPW51bGwsdGhpcy5fbmVlZEluaXRTZWdtZW50PSEwfX19KCk7Cg==",fn=typeof window<"u"&&window.Blob&&new Blob([atob(ys)],{type:"text/javascript;charset=utf-8"});function ml(){var n=fn&&(window.URL||window.webkitURL).createObjectURL(fn);try{return n?new Worker(n,{}):new Worker("data:application/javascript;base64,"+ys,{type:"module"})}finally{n&&(window.URL||window.webkitURL).revokeObjectURL(n)}}var fl=function(n){vi(t,n);var a=yi(t);function t(r){var e;return Rt(this,t),e=a.call(this),e.openlog=r.openLog,e.codecType=r.codecType,e.supportHevc=r.supportHevc,e.worker=new ml,e.worker.onmessage=function(i){e.emit(i.data.method,i.data)},e.worker.postMessage({method:"init",id:r.id||0,args:{openlog:e.openlog,supportHevc:e.supportHevc,codecType:e.codecType}}),e}return xt(t,[{key:"transmux",value:function(e,i,s,o,l,u,c,d,h){var p=i.buffer;this.worker&&this.worker.postMessage({method:"transmux",id:e,buffer:p,args:{start:s,videoIdx:o,audioIdx:l,moov:u,useEME:c,kidValue:d,context:h}},[p])}},{key:"reset",value:function(){this.worker&&this.worker.postMessage({method:"reset"})}},{key:"destroy",value:function(){this.worker&&this.worker.terminate()}}]),t}(gt),Ie={ERROR:"error",META_READY:"metaReady",MOOV_REQ_PROGRESS:"moov_request_Progress",UPDATE_LOAD_IDX:"update_load_fragmentIdx"},pl=function(n){vi(t,n);var a=yi(t);function t(r,e){var i;if(Rt(this,t),i=a.call(this),Je(Ge(i),"onprogressDataArrive",function(){var s=xe(ne().mark(function o(l,u,c){var d;return ne().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:l&&l.byteLength>0&&(d=i.timeRange[c.index].range,d&&c.range[1]>=d[1]&&!u&&(u=!0),i.log("[mp4.loadFragment onprogressDataArrive ] receive data, >>> index,",c.index,",range,",JSON.stringify(c.range),", dataLen,",l.byteLength),i._mux(l,c.range[0],c.index,u)),u&&(i.timeRange[c.index].downloaded=!0,i.bufferLoadedPos=-1,i.log("[FragLoadDowned],fragmentIdx,",c.index,",rangeEnd,",c.range[1]));case 2:case"end":return p.stop()}},o)}));return function(o,l,u){return s.apply(this,arguments)}}()),i.url=r,i.options=t.getDefaultConfig(),Object.keys(e).map(function(s){e[s]!==void 0&&e[s]!==null&&(i.options[s]=e[s])}),i.timeRange=[],i.CHUNK_SIZE=i.options.chunkSize,i.bufferLoaded=new Uint8Array(0),i.bufferLoadedPos=0,i.meta=null,i.videoTrak=null,i.audioTrak=null,i.canDownload=!0,i._loadSuccessCallBack=null,i._isPending=!1,i._metaLoading=!1,i.MP4Loader=new ol(vt(vt({segmentDuration:i.options.segmentDuration,url:r,vid:e.vid,retry:i.options.retryCount,retryDelay:i.options.retryDelay,timeout:i.options.timeout},e.reqOptions),{},{openLog:Dt()})),i.fMP4Demuxer=null,i.MP4Demuxer=null,i.FMP4Remuxer=null,i._needInitSegment=!0,i._switchBitRate=!1,i.enableWorker=i.options.enableWorker,i.enableWorker&&typeof Worker<"u")try{i.workerSequence=0,i.transmuxerWorkerControl=new fl({id:i.workerSequence,codecType:e.codecType,supportHevc:i.options.supportHevc,openLog:Dt()}),i.transmuxerWorkerControl.on("transmux",function(s){var o=s.args;i.log("[transmuxerworker end] ,range, ",JSON.stringify(o.range),",dataLen,",o.buffer.byteLength,o.context),i._loadSuccessCallBack&&i._loadSuccessCallBack(o)})}catch(s){i.log("Error in worker:",s),i.enableWorker=!1,i.transmuxerWorkerControl=null}return i.enableWorker||(i.MP4Demuxer=null,i.FMP4Remuxer=null),i.seekTime=-1,i.changeBitRateTime=-1,i}return xt(t,[{key:"changeBitRate",value:function(){var r=xe(ne().mark(function i(s){return ne().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.url=s.url,l.next=3,this.MP4Loader.changeUrl(this.url,this.options.vid+Date.now(),this.CHUNK_SIZE);case 3:this._switchBitRate=!0,this.log("[switchBitrate] changeUrl, bitRate,",this.url);case 5:case"end":return l.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"log",value:function(e){for(var i=this.options,s=i&&i.vid?"[MP4] ".concat(i.vid," ").concat(e):"[MP4] ".concat(e),o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];vs.apply(void 0,[s].concat(l))}},{key:"errorHandler",value:function(){var r=xe(ne().mark(function i(s,o){var l,u,c,d;return ne().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:l=s.response,u=s.message,c=this.options?this.options.vid:"",d=null,this._isPending=!0,l?(d=new Ko("network",l.status,{httpText:l.httpText,message:u,url:l.url}),this.emit(Ie.ERROR,d)):(console.log("[MP4] [".concat(c,"] errorHandler,"),s),d=s,this.emit(Ie.ERROR,d));case 6:case"end":return p.stop()}},i,this)}));function e(i,s){return r.apply(this,arguments)}return e}()},{key:"init",value:function(){var r=xe(ne().mark(function i(){return ne().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this.url){o.next=3;break}return o.next=3,this.MP4Loader.changeUrl(this.url,this.options.vid+Date.now(),this.CHUNK_SIZE);case 3:return o.next=5,this.getMetaInfo();case 5:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"getTimeRange",value:function(){for(var e=[],i=null,s=0;this.videoTrak&&s<this.videoTrak.length;s++)i={startTime:this.videoTrak[s].startTime,endTime:this.videoTrak[s].endTime,downloaded:!1,isLoading:!1},e.push(i);if(this.audioTrak&&this.audioTrak.length>e.length)for(var o=e.length;o<this.audioTrak.length;o++)i={startTime:Math.max(this.audioTrak[o].startTime,i?i.endTime:0),endTime:Math.max(this.audioTrak[o].endTime,i?i.endTime:0),downloaded:!1,isLoading:!1},e.push(i);return e}},{key:"getMetaInfo",value:function(){var r=xe(ne().mark(function i(){var s=this,o,l,u,c=arguments;return ne().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return o=c.length>0&&c[0]!==void 0?c[0]:!0,h.prev=1,this._metaLoading=!0,this.log("getMetaInfo start"),this.bufferLoaded=new Uint8Array(0),l=0,u=function(){var p=xe(ne().mark(function v(g,b,L){var G;return ne().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:s.log("getMetaInfo onProgressHandle, dataLen,",g?g.byteLength:-1,", state,",b,",range,",JSON.stringify(L.range)),g&&L.range[0]===l&&(s.bufferLoaded=Po(Uint8Array,s.bufferLoaded,new Uint8Array(g)),l+=g.byteLength),L.meta&&!s.meta&&(G=L.meta,s.videoTrak=G.videoSegments,s.audioTrak=G.audioSegments,s.timeRange=s.getTimeRange(),s.meta=vt(vt({},G.meta),{},{ext:{videoTrak:s.videoTrak,audioTrak:s.audioTrak}}),G.bufferLoaded=s.bufferLoaded,s.log("meta reach"),o&&s.emit(Ie.META_READY,s.meta)),s.meta&&b&&(s.log("[getMetaInfo req end]"),s._metaLoading=!1),s.meta&&(g||b)&&(s.log("emit moov_req_progress"),s.emit(Ie.MOOV_REQ_PROGRESS));case 5:case"end":return W.stop()}},v)}));return function(g,b,L){return p.apply(this,arguments)}}(),h.next=9,this.MP4Loader.loadMetaProcess(this.MP4Loader.cache,[0,this.CHUNK_SIZE],u);case 9:h.next=15;break;case 11:h.prev=11,h.t0=h.catch(1),console.error("[MP4] trigger errorHandler getMetaInfo",h.t0===null||h.t0===void 0?void 0:h.t0.message),this.loadError(h.t0,"getMetaInfo");case 15:case"end":return h.stop()}},i,this,[[1,11]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"getFragmentIdx",value:function(e){var i,s;if(this.videoTrak.length){if(i=this.videoTrak.find(function(l){return l.startTime<=e&&l.endTime>e}),s=this.audioTrak.find(function(l){return l.startTime<=e&&l.endTime>e}),i&&s)return Math.min(i.index,s.index);if(i||s)return i?i.index:s.index;var o=Number.MAX_VALUE;return this.videoTrak&&this.videoTrak.length>0&&(o=this.videoTrak.length-1),this.audioTrak&&this.audioTrak.length>0&&(o=Math.min(this.audioTrak.length-1,o)),o}else return s=this.audioTrak.find(function(l){return l.startTime<=e&&l.endTime>e}),s?s.index:0}},{key:"_checkHasMeta",value:function(){var r=xe(ne().mark(function i(){var s;return ne().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.log(" loadMeta start"),this._metaLoading=!0,l.next=4,this.MP4Loader.loadMeta(this.MP4Loader.cache,Math.round(this.CHUNK_SIZE/2));case 4:return s=l.sent,this._metaLoading=!1,this.videoTrak=s.videoSegments,this.audioTrak=s.audioSegments,this.meta=vt(vt({},s.meta),{},{ext:{videoTrak:this.videoTrak,audioTrak:this.audioTrak}}),this.timeRange=this.getTimeRange(),this.bufferLoaded=new Uint8Array(0),s.bufferLoaded=this.bufferLoaded,l.abrupt("return",!0);case 13:case"end":return l.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"resetFragmentLoadState",value:function(e){for(var i=0;i<this.timeRange.length;i++)i<e?(this.timeRange[i].downloaded=!0,this.timeRange[i].isLoading=!0):(this.timeRange[i].downloaded=!1,this.timeRange[i].isLoading=!1)}},{key:"getFragRange",value:function(e){var i,s,o,l,u=null;this.videoTrak&&(u=e<this.videoTrak.length?this.videoTrak[e]:this.videoTrak[this.videoTrak.length-1]);var c=null;this.audioTrak&&(c=e<this.audioTrak.length?this.audioTrak[e]:this.audioTrak[this.audioTrak.length-1]);var d=0,h=0;this.videoTrak&&e>=this.videoTrak.length-1&&(d=-1),this.audioTrak&&e>=this.audioTrak.length-1&&(h=-1);var p=[Math.min(((i=u)===null||i===void 0?void 0:i.range[0])||1/0,((s=c)===null||s===void 0?void 0:s.range[0])||1/0),Math.max(((o=u)===null||o===void 0?void 0:o.range[1])+d||0,((l=c)===null||l===void 0?void 0:l.range[1])+h||0)];return e<this.timeRange.length&&(this.timeRange[e].range=p),p}},{key:"load",value:function(){var r=xe(ne().mark(function i(s,o){var l,u,c;return ne().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this._loadSuccessCallBack=o,!(this._switchBitRate&&!this._metaLoading)){h.next=12;break}return this.log("[switchBitrate], switch bitRate start load, time,",s>=this.videoTrak.length?this.audioTrak[s].startTime:this.videoTrak[s].startTime,", fragIndex,",s),h.next=5,this._checkHasMeta();case 5:l=h.sent,this.changeBitRateTime>0&&(this.timeRange[s].startTime<=this.changeBitRateTime&&this.changeBitRateTime<this.timeRange[s].endTime?this.log("[switchBitrate], not need update load fragIndex",s,",stTime,",this.changeBitRateTime):(s=this.getFragmentIdx(this.changeBitRateTime),this.log("[switchBitrate], need update load fragIndex",s,",stTime,",this.changeBitRateTime,",newBitrateTimeRange,",this.timeRange[s].startTime,"-",this.timeRange[s].endTime),this.emit(Ie.UPDATE_LOAD_IDX,s)),this.seekTime=this.changeBitRateTime,this.changeBitRateTime=-1),this.resetFragmentLoadState(s),this.log("[switchBitrate], reset timerange state,",s),this._needInitSegment=!0,this.resetTansmuxer(),l&&(this._switchBitRate=!1);case 12:if(!(this._switchBitRate&&this._metaLoading)){h.next=14;break}return h.abrupt("return");case 14:u=this.getFragRange(s),this.log("loadFragment,",s,",range,",JSON.stringify(u)),this.seekTime>0?(c=this.getSubRange(s,this.seekTime,u),this.loadFragment(s,c),this.seekTime=-1):this.loadFragment(s,u);case 17:case"end":return h.stop()}},i,this)}));function e(i,s){return r.apply(this,arguments)}return e}()},{key:"getSubRange",value:function(e,i,s){var o=s[0],l=s[0],u=1,c=!1;if(this.log(">>>>>getSubRange time,",i,JSON.stringify(s)),this.videoTrak){var d=e<this.videoTrak.length?this.videoTrak[e]:this.videoTrak[this.videoTrak.length-1];if(d.frames.length===0)return this.log(">>>>>getSubRange video, no frames"),s;var h=d.frames.filter(vl),p=this.meta.videoTimescale,v=h[0].startTime/p;this.log(">>>>>getSubRange video, startTime,",d.startTime,",endTime,",d.endTime);for(var g=0;g<h.length;g++)this.log(">>>>>getSubRange video keyFrameList, startTime,",h[g].startTime/p,",range,",h[g].offset);for(;u<h.length;u++){var b=h[u].startTime/p;if(v<=i&&i<b&&s[0]<h[u-1].offset){o=h[u-1].offset,c=!0,this.log(">>>>>getSubRange video end, startTime,",v,",endTime,",b,",startRange,",o,", keyFrameIndex,",u-1);break}v=b}!c&&v<=i&&i<d.endTime+.8&&(o=h[u-1].offset,this.log(">>>>>getSubRange video last, startTime,",v,",endTime,",d.endTime,",startRange,",o))}if(u=1,this.audioTrak){var L=e<this.audioTrak.length?this.audioTrak[e]:this.audioTrak[this.audioTrak.length-1];if(L.frames.length===0)return this.log(">>>>>getSubRange video, no frames"),s;var G=L.frames,V=this.meta.audioTimescale;u=Math.floor((i*V-G[0].startTime)/L.frames[0].duration),u=Math.min(G.length-1,u);for(var W=u>0?G[u-1].startTime/V:G[0].startTime/V;u>=0&&u<G.length;){if(u>0&&W>i){u-=1,W=G[u].startTime/V;continue}var S=(G[u].startTime+G[u].duration)/V;if(W<=i&&i<S&&s[0]<G[u].offset){l=G[u].offset,c=!0,this.log(">>>>>getSubRange audio end, startTime,",W,",endTime,",S,",startRange,",l,", index,",u);break}W=S,u++}}var T=[Math.min(l,o),s[1]];return this.log(">>>>>getSubRange finalRange ",JSON.stringify(T),",oldRange,",JSON.stringify(s)),T}},{key:"_mux",value:function(e,i,s,o){var l=this.getSamplesRange(s,"video"),u=this.getSamplesRange(s,"audio"),c=[i,i+e.byteLength];if(this.transmuxerWorkerControl&&!this.meta.isFragmentMP4){var d={range:c,state:o,fragIndex:s};this.log("[transmuxerworker start] ,range, ",JSON.stringify(c),",dataLen,",e.byteLength,d),this.transmuxerWorkerControl.transmux(this.workerSequence,e,i,l,u,this.meta.moov,this.useEME,this.kidValue,d)}else try{var h;this.meta.isFragmentMP4?(this.fMP4Demuxer||(this.fMP4Demuxer=new zn),h=this.fMP4Demuxer.demuxPart(e,i,this.meta.moov)):(this.MP4Demuxer||(this.MP4Demuxer=new Ka(this.videoTrak,this.audioTrak,null,{openLog:Dt()})),h=this.MP4Demuxer.demuxPart(e,i,l,u,this.meta.moov,this.useEME,this.kidValue)),!this.FMP4Remuxer&&(!this.checkCodecH265()||this.options.supportHevc)&&(this.FMP4Remuxer=new fi(h.videoTrack,h.audioTrack,{openLog:Dt()}));var p;this.log("[mux], videoTimeRange,",h.videoTrack?[h.videoTrack.startPts,h.videoTrack.endPts]:null,",audioTimeRange,",h.audioTrack?[h.audioTrack.startPts,h.audioTrack.endPts]:null);var v=Math.min(h.videoTrack.startPts,h.audioTrack.startPts),g=Math.max(h.videoTrack.endPts,h.audioTrack.endPts),b=[v,g];if(this.FMP4Remuxer){var L=this.FMP4Remuxer.remux(this._needInitSegment,{initMerge:!0,range:c});L.initSegment&&(this._needInitSegment=!1);var G=st.concatData(L.audioSegment,L.videoSegment);p={buffer:G,range:c,state:o,context:{range:c,fragIndex:s,timeRange:b},initSeg:L.initSegment}}else p={videoTrack:h.videoTrack,audioTrack:h.audioTrack,buffer:null,range:c,state:o,context:{range:c,fragIndex:s,timeRange:b}};this._loadSuccessCallBack&&this._loadSuccessCallBack(p)}catch(W){console.error("mux err:",W);var V=new Do(It.remux,et.muxError,{msg:JSON.stringify(W)});this.errorHandler(V,"mux",{fragIndex:s,range:[i,i+e.byteLength]})}}},{key:"getSamplesRange",value:function(e,i){var s=[];switch(i){case"video":if(this.videoTrak&&e<this.videoTrak.length){var o=this.videoTrak[e].frames;if(!o.length)break;s.push(o[0].index),s.push(o[o.length-1].index)}break;case"audio":if(this.audioTrak&&e<this.audioTrak.length){var l=this.audioTrak[e].frames;if(!l.length)break;s.push(l[0].index),s.push(l[l.length-1].index)}break;default:console.warn("[getSamplesRange] type ",i," is invalid");break}return s}},{key:"loadFragment",value:function(){var r=xe(ne().mark(function i(s,o){var l,u,c,d;return ne().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(this._isPending||o.length>0&&o[0]===0&&o[1]===0||this.timeRange[s].isLoading)){p.next=2;break}return p.abrupt("return");case 2:if(this.log("[MP4.loadFragment] ,fragIndex,",s,",range ",o,",len ,",o[1]-o[0],", bufferLoaded_Len,",this.bufferLoaded.byteLength),!(o.length>=2&&o[1]&&o[1]>0&&o[1]<=this.bufferLoaded.byteLength)){p.next=13;break}this.timeRange[s].isLoading=!0,l=Math.max(o[0],this.bufferLoadedPos),u=new Uint8Array(this.bufferLoaded.slice(l,o[1])),this.log("[mp4.loadFragment] has all data: ",l,o[1]),this.timeRange[s].downloaded=!0,this.bufferLoadedPos=-1,this._mux(u,l,s,!0),p.next=34;break;case 13:if(!(o.length>=2&&o[0]&&o[0]<=this.bufferLoaded.byteLength)){p.next=29;break}if(this.timeRange[s].isLoading){p.next=27;break}if(c=Math.max(o[0],this.bufferLoadedPos),d=new Uint8Array(this.bufferLoaded.slice(c,o[1])),!(d.byteLength>0)){p.next=22;break}return this.bufferLoadedPos=c+d.byteLength,this.log("[mp4.loadFragment] has part data: ",c,c+d.byteLength),this._mux(d,c,s,o[1]<=this.bufferLoadedPos),p.abrupt("return");case 22:if(!(!this._metaLoading&&!this.timeRange[s].isLoading)){p.next=27;break}return this.log("[mp4.loadFragment] ready to load part data >>> ",this.bufferLoaded.byteLength,o[1]),this.timeRange[s].isLoading=!0,p.next=27,this.startLoad([this.bufferLoaded.byteLength,o[1]],s);case 27:p.next=34;break;case 29:if(!((!this._metaLoading||o[0]>=this.CHUNK_SIZE)&&!this.timeRange[s].isLoading)){p.next=34;break}return this.timeRange[s].isLoading=!0,this.log("[mp4.loadFragment],ready to load all data ,segmentIdx, ",s,",range >>> ",JSON.stringify(o)),p.next=34,this.startLoad(o,s);case 34:case"end":return p.stop()}},i,this)}));function e(i,s){return r.apply(this,arguments)}return e}()},{key:"startLoad",value:function(){var r=xe(ne().mark(function i(s,o){return ne().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,this.MP4Loader.loadData(s,this.MP4Loader.cache,{index:o,onProgress:this.onprogressDataArrive,onProcessMinLen:this.options.onProcessMinLen});case 3:u.next=9;break;case 5:u.prev=5,u.t0=u.catch(0),console.error("[MP4] trigger errorHandler getMetaInfo",u.t0===null||u.t0===void 0?void 0:u.t0.message),this.loadError(u.t0,"loadFragment",{range:s,fragIndex:o});case 9:case"end":return u.stop()}},i,this,[[0,5]])}));function e(i,s){return r.apply(this,arguments)}return e}()},{key:"loadError",value:function(e,i,s){var o;!e.response&&(e.response={}),e.isTimeout?e.response.status="timeout":e!=null&&(o=e.response)!==null&&o!==void 0&&o.status||(e.response.status="networkError"),this.errorHandler(e,i,s)}},{key:"cancelLoading",value:function(){var r=xe(ne().mark(function i(){return ne().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.MP4Loader;case 2:if(o.t0=o.sent,!o.t0){o.next=5;break}this.MP4Loader.cancel();case 5:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"update",value:function(e){this.url=e}},{key:"checkCodecH265",value:function(){var e=this.meta&&(this.meta.videoCodec.indexOf("hvc1")>-1||this.meta.videoCodec.indexOf("hev1")>-1);return e}},{key:"destroy",value:function(){this.hasDestroyed||(this.resetTansmuxer(),this.transmuxerWorkerControl&&this.transmuxerWorkerControl.destroy(),this._isPending=!1,this._metaLoading=!1,this.bufferLoadedPos=0,this.bufferLoaded=new Uint8Array(0),this.MP4Loader&&(this.MP4Loader.cancel(),this.MP4Loader.destroy()),this.hasDestroyed=!0)}},{key:"resetTansmuxer",value:function(){this.MP4Demuxer&&this.MP4Demuxer.reset(),this.MP4Demuxer=null,this.FMP4Remuxer&&this.FMP4Remuxer.reset(),this.FMP4Remuxer=null,this.transmuxerWorkerControl&&this.transmuxerWorkerControl.reset()}}],[{key:"getDefaultConfig",value:function(){return{segmentDuration:5,onProcessMinLen:1024,chunkSize:8e5,retryCount:3,retryDelay:1e3,timeout:3e3,enableWorker:!1,playerId:"",vid:"",ext:{}}}}]),t}(gt);function vl(n){if(n.keyframe)return n}var yl=function(){function n(a){Rt(this,n),this.onTick_=a,this.cancelPending_=null}return xt(n,[{key:"tickAfter",value:function(t){var r=this,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;this.stop();var i=!0,s=null;this.cancelPending_=function(){window.clearTimeout(s),i=!1};var o=function(){i&&(r.onTick_(),e&&e())};return s=window.setTimeout(o,t*1e3),this}},{key:"tickEvery",value:function(t){var r=this;this.tickAfter(t,function(){r.tickEvery(t)})}},{key:"stop",value:function(){this.cancelPending_&&(this.cancelPending_(),this.cancelPending_=null)}}]),n}(),bl=function(){function n(){Rt(this,n);var a,t,r=new Promise(function(i,s){a=i,t=s}),e=r;return e.resolve=function(i){a(i),e.state="fulfilled"},e.reject=function(i){t(i),e.state="rejected",e.isBreak=i==="DESTROYED"},e.state="pending",e}return xt(n,[{key:"resolve",value:function(t){}},{key:"reject",value:function(t){}}]),n}(),gl="DESTROYED",pn=null,Hr=null,vn=null,yn=null,Ll=function(n){vi(t,n);var a=yi(t);function t(r){var e;return Rt(this,t),e=a.call(this,r),Je(Ge(e),"_onMp4DataCallBack",function(){e._isMseInit&&e._onTimeUpdate()}),Je(Ge(e),"_onMp4MetaReady",function(i){var s=Ge(e),o=s.config,l=e.mp4.checkCodecH265();try{if(l&&!e.config.supportHevc){var u="browser not support HEVC",c=new Gt(e.player,{errorType:"runtime",errorTypeCode:It.runtime,errorCode:et.h265Error,errorMessage:u,vid:o.vid,mediaError:{code:et.h265Error,message:u}});e._errorHandler(c)}else e._initMse(i),e._initPromise.resolve()}catch(h){var d=new Gt(e.player,{errorType:"runtime",errorTypeCode:It.runtime,errorCode:et.mse,errorMessage:h==null?void 0:h.message,vid:o.vid,mediaError:{code:et.other1,message:h==null?void 0:h.message}});e._errorHandler(d);return}e._loadData()}),Je(Ge(e),"_onMp4Error",function(i){var s=e.playerConfig.vid;console.error("[Index] _onMp4Error",s,i),e._errorHandler(i)}),Je(Ge(e),"_loadDataSuccess",function(i){if(!(e.isDestroy||!e.mse)){e.log("[loadFragment] _loadDataSuccess ",JSON.stringify(i.context.range),",dataLen,",i.buffer?i.buffer.byteLength:0,i.state);try{i.initSeg&&(e._appendInitSeg(i.initSeg),(!i.buffer||i.buffer.byteLength<1)&&(e.log("no data, must load data"),e._onTimeUpdate()));var s=i.buffer,o=i.state,l=i.context;if(e.mse&&o&&(!s||s.byteLength<=0)&&l.fragIndex===e.mp4.timeRange.length-1){var u=e.player.buffered;u&&u.length>0&&(e.bufferEndTime=u.end(u.length-1)),e._isEnded(),e.log("loaded ended !!!==>>>",JSON.stringify(l.range),", fragIndex,",l.fragIndex,", bufferEndTime,",e.bufferEndTime,",meta_duration,",e.mp4.meta.duration)}if(e.mse&&o&&l.fragIndex===e.mp4.timeRange.length-1&&(!s||s.byteLength<=0)){var c=e.player.buffered;c&&c.length>0&&(e.bufferEndTime=c.end(c.length-1)),e._isEnded(),e.log("load ended !!!==>>>",e.playerConfig.vid,JSON.stringify(l.range),", fragIndex,",l.fragIndex,", bufferEndTime,",e.bufferEndTime,",meta_duration,",e.mp4.meta.duration)}s&&e.mse&&s&&s.byteLength>0&&e._appendBuffer(he.VIDEO,s,l,o)}catch(h){e.log("appendBuffer error",h);var d=new Gt(e.player,{errorType:"runtime",errorTypeCode:It.runtime,errorCode:et.mse,vid:e.player.config.vid,errorMessage:h.message,mediaError:{code:et.mse,message:h.message}});e._errorHandler(d)}i!=null&&i.state&&e._onTimeUpdate()}}),Je(Ge(e),"_onWaiting",function(){var i=Ge(e),s=i.player,o=i.config;clearTimeout(e._waitInBufferTimer),e._waitInBufferTimer=null;var l=s.currentTime,u=s.bufferedPoint;u.end>0&&u.end-s.currentTime>=2&&e._waitAdjustTimeCnt<o.waitJampBufferMaxCnt&&(e._waitInBufferTimer=setTimeout(function(){e._waitAdjustTimeCnt++,s.currentTime=s.currentTime+.5,e.log("[waitInBufferTimeout], waitAdjustTimeCnt,",e._waitAdjustTimeCnt,",curtime,",l,st.nowTime())},o.waitingInBufferTimeOut))}),Je(Ge(e),"_onSeeking",xe(ne().mark(function i(){var s,o,l,u,c,d,h,p,v,g,b;return ne().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(s=Ge(e),o=s.player,l=s.mp4,u=o.currentTime,e.log("[seekTime], curTime,",u,",buffer,",o.buffered2.bufferedList),!(!l||!l.meta)){G.next=5;break}return G.abrupt("return");case 5:if(e.endofstream=!1,l.bufferLoadedPos=-1,l._metaLoading=!1,c=o.bufferedPoint,d=!1,h=0,!(c.end>0)){G.next=25;break}if(d=!0,!(l.meta.duration-c.end<.5)){G.next=17;break}return e._startProgress(),e.log("[seeking in buffered range], buffer end,",c.end,", duration,",l.meta.duration),G.abrupt("return");case 17:if(h=l.getFragmentIdx(c.end),e._curLoadSegmentIdx!==h){G.next=22;break}return e._startProgress(),e.log("[seeking in buffered range], seek fragIndex is current load segmentIdx",h),G.abrupt("return");case 22:l.seekTime=c.end,h<0&&(h=e._curLoadSegmentIdx),e.log("[seeking in buffered range], seekTime ",u,",bufferRange,",c.start,"-",c.end,", fragIndex,",h);case 25:return d||(l.seekTime=u,h=l.getFragmentIdx(u),h<0&&(h=e._curLoadSegmentIdx),e.log("[seekTime out buffer range], curTime,",u,", Idx,",h),p=Ge(e),v=p.mse,v&&v.isFull()&&(g=o.buffered2.bufferedList,b=g[g.length-1],v.clearOpQueues(he.VIDEO),e._checkRemoveSourceBuffer([b.start,b.end],o.currentTime,!0,!0))),G.next=28,l.cancelLoading();case 28:l.resetFragmentLoadState(h),e._curLoadSegmentIdx=h,e._onTimeUpdate(),e._startProgress(),e._isEnded();case 33:case"end":return G.stop()}},i)}))),Je(Ge(e),"changeDefineCanPlay",function(i,s,o,l){var u=Ge(e),c=u.player;if(c.ended){c.currentTime=0;return}e.log("[oldChangeDefinition],this._changeDefState,",e._changeDefState),c.currentTime=e._changeDefState?e._changeDefState.currentTime:i;var d=e._changeDefState?e._changeDefState.paused:s;d?c.pause():c.play(),e._changeDefState=null,c.emit(Zs,{from:o,to:l})}),Je(Ge(e),"changeDefinition",function(){var i=xe(ne().mark(function s(o,l){var u,c,d,h,p,v,g;return ne().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(u=Ge(e),c=u.player,d=u.config,h=u.mp4,l||(l=c.curDefinition),e._MSEError=!1,!d.witchBitRateWay){L.next=6;break}return e.oldChangeDefinition(o,l),L.abrupt("return");case 6:if(c.emit(Ss,{from:l,to:o}),p=c.currentTime,v=h.getFragmentIdx(p),v<0&&(v=e._curLoadSegmentIdx),e.log("switchBitrate:point,fragIndex,",v,",startTime,",h.timeRange[v].startTime,",currentTime,",c.currentTime),!h){L.next=16;break}return e.mp4.changeBitRateTime=p,L.next=15,h.cancelLoading();case 15:h._metaLoading&&(h._metaLoading=!1);case 16:return e._removeBuffeEndTime=h.timeRange[v].startTime,e._isChangeDefinition=!0,g=c.getBufferedRange(c.buffered),g[1]>0&&g[1]-c.currentTime>5&&(e.mse.clearOpQueues(he.VIDEO),e.mse.remove(he.VIDEO,c.currentTime+5,g[1])),e.log("switchBitrate: resetFragmentLoadState,",v),h.resetFragmentLoadState(v),e._curLoadSegmentIdx=v,L.next=25,e.mp4.changeBitRate(o);case 25:e._onTimeUpdate(),c.emit("RESOLUTION_UPDATE",o);case 27:case"end":return L.stop()}},s)}));return function(s,o){return i.apply(this,arguments)}}()),Je(Ge(e),"_replayHook",function(){var i;return(i=e.player)===null||i===void 0||i.play(),!1}),Je(Ge(e),"_retryHook",function(){return e.beforePlayerInit(),!1}),e.mp4=null,e.mse=null,e._waitAdjustTimeCnt=0,e._lastCheckTime=st.nowTime(),e._removeBuffeEndTime=0,e._pendingPromises=[],e}return xt(t,[{key:"afterCreate",value:function(){var e=this;window.__mp4player=this;try{Ct.defineGetterOrSetter(this.player,{__url:{get:function(){try{return e.mse?e.mse.url:e.config.url}catch{return null}}}})}catch{}this._proxyPlayer()}},{key:"attachEvents",value:function(){this.off(Vr,this._onSeeking),this.on(Vr,this._onSeeking),this.on(Gi,this._onWaiting),this.off(Ht,this.switchURL),this.on(Ht,this.switchURL)}},{key:"detachEvents",value:function(){this.off(Vr,this._onSeeking),this.off(Gi,this._onWaiting),this.off(Ht,this.switchURL)}},{key:"_proxyPlayer",value:function(){var e=this;typeof this.player.playNext=="function"&&(pn=this.player.playNext),this.player.playNext=function(){e.playNext.apply(e,arguments)},Hr=this.player._startInit,yn=this.player.switchURL,vn=this.player.changeDefinition,this.player._startInit=this._playerStartInit.bind(this),this.player.switchURL=this.switchURL.bind(this),this.player.changeDefinition=this.changeDefinition.bind(this),this.player.removeHooks("replay",this._replayHook),this.player.removeHooks("retry",this._retryHook)}},{key:"_playerStartInit",value:function(e){var i=this,s=this.config,o=this.playerConfig;s.supportHevc===void 0&&tr!==null&&tr!==void 0&&tr.isHevcSupported&&tr.isHevcSupported()&&(s.supportHevc=!0);var l=this.initMp4();this._initPromise=l,this._addPendingPromise(this._initPromise),this.mse&&gs.typeOf(e)==="String"&&/^blob/.test(e)&&e!==this.mse.url&&(e=o.url),l.then(function(){i.mse&&(e=i.mse.url),i.attachEvents(),i._startProgress()}).catch(function(u){var c=i._initPromise?i._initPromise.isBreak:!1;if(!(i.isDestroy||c)){var d=u;d.errorCode||(d=new Gt(i.player,{errorType:It.RUNTIME,errorCode:(u==null?void 0:u.errorCode)||et.other,vid:i.playerConfig.vid,errorMessage:(u==null?void 0:u.errorMessage)||(u==null?void 0:u.message),mediaError:{code:(u==null?void 0:u.httpCode)||et.other,message:(u==null?void 0:u.errorMessage)||(u==null?void 0:u.message),errorType:u==null?void 0:u.errorType}}),d.url=e),i.useVideoLoad=!0,i.player.vtype="MP4_1",i.player.emit("playCatch",i.player.vtype,d)}}).finally(function(){if(i._initPromise){var u=i._initPromise.isBreak;u||(i._initPromise&&i._removePendingPromise(i._initPromise),i._initPromise=null,!i.isDestroy&&!u&&Hr.call(i.player,e))}})}},{key:"initMp4",value:function(){var e=this,i=this.player;i.config.vid||(i.config.vid=Date.now());var s=new bl;return this.mp4&&(this.mp4.off(Ie.META_READY,this._onMp4MetaReady),this.mp4.off(Ie.ERROR,this._onMp4Error),this.mp4.off(Ie.MOOV_REQ_PROGRESS,this._onMp4DataCallBack),this.mp4.destroy(),this.mp4=null),this.mp4=new pl(i.config.url,vt(vt({},this.config),{},{vid:i.config.vid})),this.mp4.on(Ie.META_READY,this._onMp4MetaReady),this.mp4.on(Ie.ERROR,this._onMp4Error),this.mp4.on(Ie.MOOV_REQ_PROGRESS,this._onMp4DataCallBack),this.mp4.on(Ie.UPDATE_LOAD_IDX,function(o){e._curLoadSegmentIdx=o,e.log("[update curLoadSegmentIdx]",o)}),this.mp4.init(),s}},{key:"setConfig",value:function(e){this.config=Object.assign(this.config,e)}},{key:"playNext",value:function(e){var i=this.player;this._defInited=!1,i.resetState(),i._currentTime=0,i._duration=0,i.isPlaying=!1,this._MSEError=!1,i.pause(),this._reset(),i.setConfig(e),this.log("[Index] playNext",e),i.play(),this.emit("playnext")}},{key:"checkDegrade",value:function(e){var i=this.config.closeDowngrade;return!i||e.httpCode==="networkError"}},{key:"_errorHandler",value:function(e){var i,s=this.player,o=this.config;if(!(!s||this.useVideoLoad)){!e.url&&(i=this.mp4)!==null&&i!==void 0&&i.url&&(e.url=this.mp4.url);var l=s.paused;console.error("final error !!!!, ",o.vid,e),this.player.vtype="MP4_2",this.player.emit("playCatch",this.player.vtype,e);var u=this.checkDegrade(e);if(u)this._initPromise?this._removeAndRejectInitPromise(e):this._startDegradedPlayback(e,l);else{this.player.pause(),this._reset();var c=s.currentTime;this.destroyMSE(),s.currentTime=c,this.emit("error",e)}}}},{key:"_startDegradedPlayback",value:function(e,i){var s=this;console.log(">>>_startDegradedPlayback");var o=this.player,l=this.playerConfig;this.useVideoLoad=!0,this.destroyMSE(),this._currentTime=o.currentTime,this.__onmetadataHandle=function(){s._currentTime&&(o.currentTime=s._currentTime),i?s.player.pause():s.player.play(),o.media.removeEventListener("loadedmetadata",s.__onmetadataHandle),s.__onmetadataHandle=null},o.media.addEventListener("loadedmetadata",this.__onmetadataHandle);var u=l.url;o.media.src=u}},{key:"_addPendingPromise",value:function(e){this._pendingPromises.push(e)}},{key:"_removePendingPromise",value:function(e){var i=this._pendingPromises.indexOf(e);i>-1&&this._pendingPromises.splice(i,1)}},{key:"_cancelPendingPromises",value:function(){this._pendingPromises.length>0&&this._pendingPromises.forEach(function(e){e.reject(gl)}),this._pendingPromises=[]}},{key:"_removeAndRejectInitPromise",value:function(e){this._initPromise&&(this._removePendingPromise(this._initPromise),this._initPromise.reject(e))}},{key:"_initMse",value:function(){var r=xe(ne().mark(function i(s){var o=this,l,u,c,d,h;return ne().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!this.mse){v.next=4;break}return v.next=3,this.mse.unbindMedia();case 3:this.mse=null;case 4:l=!!s.videoCodec,u=!!s.audioCodec,l&&u?c='video/mp4; codecs="'.concat(s.videoCodec,', mp4a.40.5"'):l?c='video/mp4; codecs="'.concat(s.videoCodec,'"'):c='video/mp4; codecs="mp4a.40.5"',d=Je({},he.VIDEO,{mimeType:"video/mp4",codec:c}),this.mse=new he,h=this.mse.bindMedia(this.player.video),h.then(function(){var g=Object.keys(d);try{for(var b=0;b<g.length;b++){var L=g[b];o.mse.createSource(L,d[L].codec)}}catch(G){console.error("MSE error: ",G),o._errorHandler(G)}o._isMseInit=!0,o._onTimeUpdate()});case 11:case"end":return v.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"destroyMSE",value:function(){var r=xe(ne().mark(function i(){var s;return ne().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,(s=this.mse)===null||s===void 0?void 0:s.unbindMedia();case 2:this.mse=null;case 3:case"end":return l.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_onTimeUpdate",value:function(){var e=this,i=this.mse,s=this.mp4,o=this.player,l=this.config;if(s){var u=s.timeRange,c=o.getBufferedRange(o.buffered2);if(i&&s&&s.canDownload){st.nowTime()-this._lastCheckTime>1e3&&(this._lastCheckTime=st.nowTime(),this._loadStuckCheck(),this._checkRemoveSourceBuffer(c,o.currentTime));var d=o.paused?o.currentTime+l.minBufferLength:o.currentTime+l.maxBufferLength;c[1]-d<0&&u.every(function(h,p){if(h.downloaded)return!0;if(!e._isChangeDefinition&&h.endTime-h.startTime>1&&e._isInBuffer(h))return h.downloaded=!0,h.isLoading=!0,e.log("onTimeUpdate, ".concat(p," download segment, has buffer"),h.startTime,h.endTime),!0;h.startTime-o.currentTime<l.maxBufferLength&&(e._curLoadSegmentIdx=p,e.log("[onTimeUpdate],load index==>>>, ",p,",IdxTimeRange, ",h.startTime,"-",h.endTime,",buffEnd, ",c[1],",playCurTime,",o.currentTime,", bufferLen,",c[1]-o.currentTime,",bufferRangeList,",e.player.buffered2?e.player.buffered2.bufferedList:null),e._loadData())}),this._isEnded()}this.checkRemoveOldBitrateBuffer()}}},{key:"checkRemoveOldBitrateBuffer",value:function(){var e=this.mse,i=this.player;e&&this._removeBuffeEndTime>0&&i.currentTime>this._removeBuffeEndTime+1&&(this.log("remove old bitrate buffer",this._removeBuffeEndTime),e.remove(he.VIDEO,0,this._removeBuffeEndTime-1),this._removeBuffeEndTime=0)}},{key:"_isInBuffer",value:function(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=!1,o=this.player.video.buffered,l=0;l<o.length;l++){var u=o.start(l)-i,c=o.end(l)+i;if(u<=e.startTime&&e.endTime<=c){s=!0;break}}return s}},{key:"_loadData",value:function(){var r=xe(ne().mark(function i(){return ne().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(!this.mp4||!this._isMseInit)){o.next=3;break}return this.log("loadData, player.mp4 null",this._isMseInit),o.abrupt("return");case 3:return o.prev=3,o.next=6,this.mp4.load(this._curLoadSegmentIdx,this._loadDataSuccess);case 6:o.next=11;break;case 8:o.prev=8,o.t0=o.catch(3),console.error("[Index] _loadData error",this.playerConfig.vid,o.t0);case 11:case"end":return o.stop()}},i,this,[[3,8]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"_appendInitSeg",value:function(e){var i=this;!this.mp4||!this.mse||this.mse.append(he.VIDEO,e,{vid:this.playerConfig.vid,range:null,dataLen:e.byteLength,isinit:!0}).then(function(s){i.log("appendInitSeg end ==>>>",s.context?s.context:null,", costTime,",s.costtime)})}},{key:"_appendBuffer",value:function(e,i){var s=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},l=arguments.length>3?arguments[3]:void 0,u=this.mse,c=this.config;u.append(e,i,{vid:c.vid,fragIndex:o.fragIndex,range:o.range,dataLen:i.byteLength,state:l}).then(function(d){if(s.log("player appendBuffer end ==>>>",d.context?d.context:null,", costTime,",d.costtime,", opt,",d.name,",bufferRange,",s.player.getBufferedRange()),s.mse&&o.state&&o.fragIndex===s.mp4.timeRange.length-1){var h=s.player.buffered;h&&h.length>0&&(s.bufferEndTime=h.end(h.length-1)),s._isEnded(),s.log("loaded ended !!!==>>>",o.range,", fragIndex,",o.fragIndex,", bufferEndTime,",s.bufferEndTime,",meta_duration,",s.mp4.meta.duration)}}).catch(function(d){if(console.log("[MSE error]",d),d&&u!==null&&u!==void 0&&u.isFull()){var h=s.player.getBufferedRange(s.player.buffered2);s._checkRemoveSourceBuffer(h,s.player.currentTime,!0)}})}},{key:"_checkRemoveSourceBuffer",value:function(e,i,s){var o=this,l=this.mse,u=this.mp4,c=this.player;if(!(!l||!u||!c)&&(s&&(clearTimeout(this._removeBufferTimer),this._removeBufferTimer=null),e||(e=c.getBufferedRange(c.buffered2)),i||(i=c.currentTime),!(!s&&st.nowTime()-this._checkRemoveBufferLastTime<=this.config.removeBufferLen||this.endofstream)&&(this._checkRemoveBufferLastTime=st.nowTime(),e&&e[0]>=0&&(i-e[0]>this.config.removeBufferLen||l.isFull())))){var d=e[1],h=u.getFragmentIdx(d);if(h>=0&&u.timeRange[h].startTime<i){var p=Math.floor(Math.min(u.timeRange[h].startTime,e[1]));e[0]<p?(this.log("[checkremoveSourceBuffer], remove range==>>>",e[0],p),l.remove(he.VIDEO,e[0],p)):l.isFull()&&!this._removeBufferTimer&&(this._removeBufferTimer=setTimeout(function(){o._checkRemoveSourceBuffer(null,null,!0)},10*1e3))}}}},{key:"_isEnded",value:function(){var e=this.player,i=this.mp4,s=e.bufferedPoint,o=s?s.end:0;return!this.endofstream&&this.mse&&i.meta.duration-e.currentTime<.5&&(this.log("[check player isEnded],deal mse.endOfStream, currentTime,",e.currentTime,", bufferend,",o,", duration,",i.meta.duration),this.endofstream=!0,this.mse.endOfStream()),i&&i.meta&&i.meta.duration-e.currentTime<.5?(this._stopProgress(),this.log("[check player isEnded],stopProgress and endOfStream,currentTime, ",e.currentTime,", bufferend,",o,", duration,",i.meta.duration),this.mse&&this.mse.endOfStream(),!0):!1}},{key:"switchURL",value:function(e){this.changeDefinition(e)}},{key:"oldChangeDefinition",value:function(e,i){var s=this,o=this.config,l=this.player;this.log("[oldChangeDefinition],currentTime,",l.currentTime,",from,",i,",to,",e);var u=l.currentTime,c=l.paused;this._changeDefState||(this._changeDefState={currentTime:u,paused:c},this.log("[oldChangeDefinition],currentTime,",l.currentTime,",pause,",c)),l.config.url=e.url,o.focusUserDefinition=!0,l.currentTime=0,l.pause(),this._reset(),this._isMseInit=!1,this._changeDefineCanPlay&&l.off("canplay",this._changeDefineCanPlay),this._changeDefineCanPlay=function(){s.changeDefineCanPlay(u,c,i,e),s._changeDefineCanPlay=null},l.once("canplay",this._changeDefineCanPlay),this.player.video.load(),this.initMp4()}},{key:"_loadStuckCheck",value:function(){var e=this,i=this.config,s=this.player;i.disableBufferBreakCheck||(s.currentTime-(this._lastCurrentTime||0)>.1||s.paused?(this._bufferBreakFlag===1||this._bufferBreakFlag===2)&&(this.log("视频没有卡死,重置卡死标记"),this._bufferBreakFlag=0,clearTimeout(this._bufferBreakTimer),this._bufferBreakFlag=null):this._bufferBreakFlag||(this._bufferBreakFlag=1,this.log("卡死计时开始! 持续".concat(i.waitingTimeOut,"毫秒则确认卡死")),this._bufferBreakTimer=setTimeout(function(){e.isDestroy||(e._bufferBreakFlag===1&&(e._bufferBreakFlag=2,e.log("确认卡死!!!"),e._errorHandler(new Gt(e.player,{errorType:"runtime",errorTypeCode:It.runtime,errorCode:et.waitTimeout,errorMessage:"wait_timeout",vid:i.vid}))),e._bufferBreakTimer=null)},i.waitingTimeOut)),this._lastCurrentTime=s.currentTime)}},{key:"isDestroy",get:function(){return!this.player}},{key:"_stopProgress",value:function(){this._hasStartProgress=!1,this._requestTimer&&(this._requestTimer.stop(),this._requestTimer=null),this._bufferBreakTimer&&(clearTimeout(this._bufferBreakTimer),this._bufferBreakTimer=null,this._bufferBreakFlag=void 0)}},{key:"_startProgress",value:function(){var e=this;this._hasStartProgress||(this._stopProgress(),this._requestTimer=new yl(function(){e._requestTimer&&e._onTimeUpdate()}),this._requestTimer.tickEvery(this.config.tickInSeconds),this._hasStartProgress=!0)}},{key:"log",value:function(e){for(var i=this.playerConfig,s=i&&i.vid?"[Index]".concat(i.vid," ").concat(e):"[Index] ".concat(e),o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];vs.apply(void 0,[s].concat(l))}},{key:"_reset",value:function(){this._isMseInit=!1,this.endofstream=!1,this._curLoadSegmentIdx=0,this._removeBuffeEndTime=0,this._isChangeDefinition=!1,this._stopProgress(),this.mp4&&(this.mp4.off(Ie.META_READY,this._onMp4MetaReady),this.mp4.off(Ie.ERROR,this._onMp4Error),this.mp4.off(Ie.MOOV_REQ_PROGRESS,this._onMp4DataCallBack),this.mp4.destroy(),this.mp4=null),this.mse&&(this.mse.unbindMedia(),this.mse=null),this._unloadVideo()}},{key:"_unloadVideo",value:function(){var e=this.player;try{this.log("unloadVideo src ".concat(e.video.src)),e.video&&e.video.src&&(e.video.removeAttribute("src"),e.video.load())}catch(i){this.log("unloadVideo error",i)}}},{key:"destroy",value:function(){var e=this.player;e.removeHooks("replay",this._replayHook),e.removeHooks("retry",this._retryHook),this.detachEvents(),this._reset(),this.player.playNext=pn,this.player._startInit=Hr,this.player.changeDefinition=vn,this.player.switchURL=yn,this._bufferBreakTimer&&clearInterval(this._bufferBreakTimer),this._removeBufferTimer&&(clearTimeout(this._removeBufferTimer),this._removeBufferTimer=null),this._waitInBufferTimer&&(clearTimeout(this._waitInBufferTimer),this._waitInBufferTimer=null)}}],[{key:"pluginName",get:function(){return"mp4Plugin"}},{key:"defaultConfig",get:function(){return{maxBufferLength:40,minBufferLength:5,disableBufferBreakCheck:!1,waitingTimeOut:15e3,waitingInBufferTimeOut:5e3,waitJampBufferMaxCnt:3,tickInSeconds:.1,reqOptions:null,closeDowngrade:!1}}},{key:"version",get:function(){return"3.0.20"}}]),t}(Ct);export{Ja as F,cs as H,Ll as M};
